(function(){var a;var b=window.location.pathname;if(typeof Fai!="undefined"&&typeof Fai.top!="undefined"&&typeof Fai.top._resRoot!="undefined"){a=Fai.top._resRoot}else{a=b.substr(0,b.lastIndexOf("/")+1).replace("_examples/","").replace("website/","")}window.UEDITOR_CONFIG={UEDITOR_HOME_URL:a,upSitePasteIamgeUrl:"/static/web/ajax/upsitepasteimg_h.jsp",uploadimg:true,upImgApp:"",autoHeightEnabled:false,upLoadFlashUrl:"",upLoadImageUrl:"",upImageExt:"jpg,jpeg,gif,png,bmp",upFlashExt:"swf",editoruiToolbar:470,isPasteImage:false,toolbars:[["fullscreen","shrinkopenup","removeformat","pasteplain","|","bold","italic","underline","|","fontfamily","fontsize","forecolor","backcolor","|","qqface","|","insertorderedlist","insertunorderedlist","lineheight","justifyright","|","link","unlink","phone","qqservice","insertimage","image","insertmp4","flash","|","swfuploadword","|","pagebreak","rowspacingtop","rowspacingbottom","deletetable","insertparagraphbeforetable","edittd","insertrow","deleterow","insertcol","deletecol","mergecells","mergeright","mergedown","splittocells","splittorows","splittocols","inserttable","indent","|","selectall","undo","redo","|","strikethrough","superscript","subscript","horizontal","zhspace","|","source"]],wordCount:false,elementPathEnabled:false,outerFunction:{}}})();(function(){UEDITOR_CONFIG=window.UEDITOR_CONFIG||{};var baidu=window.baidu||{};window.baidu=baidu;window.UE=baidu.editor={};UE.plugins={};UE.commands={};UE.instants={};UE.I18N={};var dom=UE.dom={};UE.I18N["zh-cn"]={labelMap:{bold:"加粗",indent:"首行缩进",italic:"斜体",underline:"下划线",strikethrough:"删除线",flash:"Flash",formatmatch:"格式刷",source:"源代码",qqservice:"QQ/MSN/Skype/阿里旺旺/淘宝旺旺",pasteplain:"纯文本粘贴模式",shrinkopenup:"展开",removeformat:"清除格式",rowspacingtop:"段前距",rowspacingbottom:"段后距",unlink:"取消链接",phone:"电话",insertrow:"前插入行",insertcol:"前插入列",mergeright:"右合并单元格",mergedown:"下合并单元格",deleterow:"删除行",deletecol:"删除列",splittorows:"拆分成行",splittocols:"拆分成列",splittocells:"完全拆分单元格",mergecells:"合并多个单元格",deletetable:"删除表格",insertparagraphbeforetable:"表格前插行",edittd:"单元格属性",fullscreen:"全屏",subscript:"下标",superscript:"上标",selectall:"全选",horizontal:"分隔线",zhspace:"中文空格",undo:"撤销",redo:"重做",fontfamily:"字体",fontsize:"字号",insertimage:"图片",insertmp4:"MP4",inserttable:"表格",link:"超链接",justifyleft:"居左对齐",justifyright:"居右对齐",justifycenter:"居中对齐",justifyjustify:"两端对齐",forecolor:"字体颜色",backcolor:"背景色",insertorderedlist:"符号列表",insertunorderedlist:"无序列表",rowspacingtop:"段前距",rowspacingbottom:"段后距",pagebreak:"分页",swfuploadword:"word文档上传",lineheight:"行间距",hoverimage:"鼠标经过换图"},insertorderedlist:{decimal:"1,2,3...","lower-alpha":"a,b,c...","lower-roman":"i,ii,iii...","upper-alpha":"A,B,C...","upper-roman":"I,II,III..."},insertunorderedlist:{circle:"○ 小圆圈",disc:"● 小圆点",square:"■ 小方块 "},contextMenu:{"delete":"删除",selectall:"全选",deletecode:"删除代码",cleardoc:"清空文档",confirmclear:"确定清空当前文档么？",unlink:"删除超链接",paragraph:"段落格式",edittable:"表格属性",edittd:"单元格属性",justifyleft:"居左对齐",justifyright:"居右对齐",justifycenter:"居中对齐",justifyjustify:"两端对齐",table:"表格",deletetable:"删除表格",insertparagraphbeforetable:"表格前插入行",deleterow:"删除行",deletecol:"删除列",insertrow:"插入行",insertcol:"插入列",mergeright:"向右合并",mergeleft:"向左合并",mergedown:"向下合并",mergecells:"合并单元格",splittocells:"完全拆分单元格",splittocols:"拆分成列",splittorows:"拆分成行",copy:"复制(Ctrl + c)",copymsg:"请使用 'Ctrl + c'执行复制操作",paste:"粘贴(Ctrl + v)",pastemsg:"请使用'Ctrl + v'执行复制操作"},fontfamily:[{first:"宋体,SimSun",second:"宋体"},{first:"隶书, SimLi",second:"隶书"},{first:"楷体,楷体_GB2312, SimKai",second:"楷体"},{first:"黑体, SimHei",second:"黑体"},{first:"幼圆, 幼圆",second:"幼圆"},{first:"仿宋体, FangSong_GB2312",second:"仿宋体"},{first:"微软雅黑,Microsoft YaHei",second:"微软雅黑"},{first:"新细明体, PMingLiU",second:"新细明体"},{first:"华文楷体, STKaiti",second:"华文楷体"},{first:"方正舒体, 方正舒体",second:"方正舒体"},{first:"华文彩云, 华文彩云",second:"华文彩云"},{first:"华文宋体, 华文宋体",second:"华文宋体"},{first:"andale mono",second:"andale mono"},{first:"arial, helvetica,sans-serif",second:"arial"},{first:"arial black,avant garde",second:"arial black"},{first:"comic sans ms",second:"comic sans ms"},{first:"impact,chicago",second:"impact"},{first:"times new roman",second:"times new roman"}],customstyle:{tc:"标题居中",tl:"标题居左",im:"强调",hi:"明显强调"},elementPathTip:"元素路径",wordOverFlowMsg:'<span style="color:red;">当前已输入{#count}个字，已超过{#pass}个字。</span>',ok:"确认",cancel:"取消",closeDialog:"关闭对话框",anthorMsg:"链接",clearColor:"清空颜色",standardColor:"标准颜色",themeColor:"主题颜色",property:"属性","default":"默认",modify:"修改",justifyleft:"居左对齐",justifyright:"居右对齐",justifycenter:"居中",justify:"两端对齐",clear:"清除",anchorMsg:"锚点","delete":"删除",clickToUpload:"点击上传",unset:"尚未设置语言文件",t_row:"行",t_col:"列",more:"更多",linkPicker:{linkText:"文本内容",linkAddress:"链接地址",linkStyle:"链接样式",hasUnderLine:"有下划线",noneUnderLine:"无下划线",openType:"打开方式",newWindow:"新窗口",currentWindow:"当前窗口",confirmLink:"确定",cancelLink:"取消",unLink:"清除链接"},link:{"static":{lang_input_text:"文本内容：",lang_input_url:"链接地址：",lang_input_title:"标题：",lang_input_target:"是否在新窗口打开："},validLink:"只支持选中一个链接时生效",httpPrompt:"您输入的超链接中不包含http等协议名称，默认将为您添加http://前缀"},wordCountTip:"字数统计",wordCountMsg:"当前已输入{#count}个字，您还可以输入{#leave}个字。 ",inserttable:{"static":{lang_baseInfo:"基础信息",lang_rows:"行数",lang_rowUnit:"行",lang_width:"宽度",lang_widthUnit:"px",lang_height:"高度",lang_heightUnit:"px",lang_cols:"列数",lang_colUnit:"列",lang_warmPrompt:"温馨提示",lang_maxPadding:"边距最大不能超过13px! ",lang_extendInfo:"扩展信息",lang_preview:"可预览",lang_tableBorder:"表格边框",lang_borderSize:"大小",lang_borderColor:"颜色",lang_mar_pad:"边距间距",lang_margin:"边距",lang_padding:"间距",lang_table_background:"表格的背景颜色",lang_table_alignment:"表格的对齐方式",lang_borderFor:"边框设置",align:{options:["默认","居中","居左","居右"]},borderType:{options:["所有单元格","仅表格"]},lang_cellPadding:"单元格间距",commCellPadding:{options:["默认","无边距"]},lang_forPreview:"这是用来预览的"},errorNum:"请输入正确的数值",errorColor:"请输入正确的颜色值，如#34abdd，red",clearColor:"清除颜色",overflowMsg:"最大值不能超过{#value}px!",overflowPreviewMsg:"超过{#value} px时将不再提供实时预览。"},edittd:{"static":{lang_background:"背景颜色",lang_alignment:"对齐方式",lang_horizontal:"水平",lang_vertical:"垂直",vAlign:{options:["默认","居中对齐","顶端对齐","底部对齐"]},align:{options:["默认","居中对齐","左对齐","右对齐"]}},clearColor:"清除颜色"}};var browser=UE.browser=function(){var agent=navigator.userAgent.toLowerCase(),opera=window.opera,browser={ie:!!window.ActiveXObject,opera:(!!opera&&opera.version),webkit:(agent.indexOf(" applewebkit/")>-1),mac:(agent.indexOf("macintosh")>-1),quirks:(document.compatMode=="BackCompat")};browser.gecko=(navigator.product=="Gecko"&&!browser.webkit&&!browser.opera);var version=0;if(browser.ie){version=parseFloat(agent.match(/msie (\d+)/)[1]);browser.ie9Compat=document.documentMode==9;browser.ie8=!!document.documentMode;browser.ie8Compat=document.documentMode==8;browser.ie7Compat=((version==7&&!document.documentMode)||document.documentMode==7);browser.ie6Compat=(version<7||browser.quirks)}if(browser.gecko){var geckoRelease=agent.match(/rv:([\d\.]+)/);if(geckoRelease){geckoRelease=geckoRelease[1].split(".");version=geckoRelease[0]*10000+(geckoRelease[1]||0)*100+(geckoRelease[2]||0)*1}}if(/chrome\/(\d+\.\d)/i.test(agent)){browser.chrome=+RegExp["\x241"]}if(/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(agent)&&!/chrome/i.test(agent)){browser.safari=+(RegExp["\x241"]||RegExp["\x242"])}if(browser.opera){version=parseFloat(opera.version())}if(browser.webkit){version=parseFloat(agent.match(/ applewebkit\/(\d+)/)[1])}browser.version=version;browser.isCompatible=!browser.mobile&&((browser.ie&&version>=6)||(browser.gecko&&version>=10801)||(browser.opera&&version>=9.5)||(browser.air&&version>=1)||(browser.webkit&&version>=522)||false);return browser}();var ie=browser.ie,webkit=browser.webkit,gecko=browser.gecko,opera=browser.opera;var utils=UE.utils={each:function(obj,iterator,context){if(obj==null){return}if(Array.prototype.forEach&&obj.forEach===Array.prototype.forEach){obj.forEach(iterator,context)}else{if(obj.length===+obj.length){for(var i=0,l=obj.length;i<l;i++){if(iterator.call(context,obj[i],i,obj)===false){return}}}else{for(var key in obj){if(obj.hasOwnProperty(key)){if(iterator.call(context,obj[key],key,obj)===false){return}}}}}},makeInstance:function(obj){var noop=new Function();noop.prototype=obj;obj=new noop;noop.prototype=null;return obj},extend:function(t,s,b){if(s){for(var k in s){if(!b||!t.hasOwnProperty(k)){t[k]=s[k]}}}return t},inherits:function(subClass,superClass){var oldP=subClass.prototype,newP=utils.makeInstance(superClass.prototype);utils.extend(newP,oldP,true);subClass.prototype=newP;return(newP.constructor=subClass)},bind:function(fn,this_){return function(){return fn.apply(this_,arguments)}},defer:function(fn,delay,exclusion){var timerID;return function(){if(exclusion){clearTimeout(timerID)}timerID=setTimeout(fn,delay)}},isArray:function(array){return Object.prototype.toString.apply(array)==="[object Array]"},isString:function(str){return typeof str=="string"||str.constructor==String},isEmptyObject:function(obj){for(var p in obj){return false}return true},isFunction:function(source){return"[object Function]"==Object.prototype.toString.call(source)},indexOf:function(array,item,at){for(var i=at||0,l=array.length;i<l;i++){if(array[i]===item){return i}}return -1},trim:function(str){return str.replace(/(^[ \t\n\r]+)|([ \t\n\r]+$)/g,"")},findNode:function(nodes,tagNames,fn){for(var i=0,ci;ci=nodes[i++];){if(fn?fn(ci):this.indexOf(tagNames,ci.tagName.toLowerCase())!=-1){return ci}}},removeItem:function(array,item){for(var i=0,l=array.length;i<l;i++){if(array[i]===item){array.splice(i,1);i--}}},listToMap:function(list){if(!list){return{}}list=utils.isArray(list)?list:list.split(",");for(var i=0,ci,obj={};ci=list[i++];){obj[ci.toUpperCase()]=obj[ci]=1}return obj},unhtml:function(str,reg){return str?str.replace(reg||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp);)?/g,function(a,b){if(b){return a}else{return{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[a]}}):""},html:function(str){return str?str.replace(/&((g|l|quo)t|amp|#39);/g,function(m){return{"&lt;":"<","&amp;":"&","&quot;":'"',"&gt;":">","&#39;":"'"}[m]}):""},cssStyleToDomStyle:function(){var test=document.createElement("div").style,cache={"float":test.cssFloat!=undefined?"cssFloat":test.styleFloat!=undefined?"styleFloat":"float"};return function(cssName){return cache[cssName]||(cache[cssName]=cssName.toLowerCase().replace(/-./g,function(match){return match.charAt(1).toUpperCase()}))}}(),loadFile:function(){var tmpList={};return function(doc,obj,fun){var item=tmpList[obj.src||obj.href];if(item){if(utils.isArray(item.funs)){item.ready?fun():tmpList[obj.src||obj.href].funs.push(fun)}return}tmpList[obj.src||obj.href]=fun?{funs:[fun]}:1;if(!doc.body){doc.write('<script src="'+obj.src+'"><\/script>');return}if(obj.id&&doc.getElementById(obj.id)){return}var element=doc.createElement(obj.tag);delete obj.tag;for(var p in obj){element.setAttribute(p,obj[p])}element.onload=element.onreadystatechange=function(){if(!this.readyState||/loaded|complete/.test(this.readyState)){item=tmpList[obj.src||obj.href];if(item.funs){item.ready=1;for(var fi;fi=item.funs.pop();){fi()}}element.onload=element.onreadystatechange=null}};doc.getElementsByTagName("head")[0].appendChild(element)}}(),fixColor:function(name,value){if(/color/i.test(name)&&/rgba?/.test(value)){var array=value.split(",");if(array.length>3){return""}value="#";for(var i=0,color;color=array[i++];){color=parseInt(color.replace(/[^\d]/gi,""),10).toString(16);value+=color.length==1?"0"+color:color}value=value.toUpperCase()}return value},optCss:function(val){var padding,margin,border;val=val.replace(/(padding|margin|border)\-([^:]+):([^;]+);?/gi,function(str,key,name,val){if(val.split(" ").length==1){switch(key){case"padding":!padding&&(padding={});padding[name]=val;return"";case"margin":!margin&&(margin={});margin[name]=val;return"";case"border":return val=="initial"?"":str}}return str});function opt(obj,name){if(!obj){return""}var t=obj.top,b=obj.bottom,l=obj.left,r=obj.right,val="";if(!t||!l||!b||!r){for(var p in obj){val+=";"+name+"-"+p+":"+obj[p]+";"}}else{val+=";"+name+":"+(t==b&&b==l&&l==r?t:t==b&&l==r?(t+" "+l):l==r?(t+" "+l+" "+b):(t+" "+r+" "+b+" "+l))+";"}return val}val+=opt(padding,"padding")+opt(margin,"margin");return val.replace(/^[ \n\r\t;]*|[ \n\r\t]*$/,"").replace(/;([ \n\r\t]+)|\1;/g,";").replace(/(&((l|g)t|quot|#39))?;{2,}/g,function(a,b){return b?b+";;":";"})},transUnitToPx:function(val){if(!/(pt|cm)/.test(val)){return val}var unit;val.replace(/([\d.]+)(\w+)/,function(str,v,u){val=v;unit=u});switch(unit){case"cm":val=parseFloat(val)*25;break;case"pt":val=Math.round(parseFloat(val)*96/72)}return val+(val?"px":"")},cssRule:browser.ie?function(key,style,doc){var indexList,index;doc=doc||document;if(doc.indexList){indexList=doc.indexList}else{indexList=doc.indexList={}}var sheetStyle;if(!indexList[key]){if(style===undefined){return""}sheetStyle=doc.createStyleSheet("",index=doc.styleSheets.length);indexList[key]=index}else{sheetStyle=doc.styleSheets[indexList[key]]}if(style===undefined){return sheetStyle.cssText}sheetStyle.cssText=style||""}:function(key,style,doc){doc=doc||document;var head=doc.getElementsByTagName("head")[0],node;if(!(node=doc.getElementById(key))){if(style===undefined){return""}node=doc.createElement("style");node.id=key;head.appendChild(node)}if(style===undefined){return node.innerHTML}if(style!==""){node.innerHTML=style}else{head.removeChild(node)}},domReady:function(){var isReady=false,fnArr=[];function doReady(){isReady=true;for(var ci;ci=fnArr.pop();){ci()}}return function(onready){if(document.readyState==="complete"){return onready&&setTimeout(onready,1)}onready&&fnArr.push(onready);isReady&&doReady();$(window).load(doReady)}}()};utils.each(["String","Function","Array","Number","RegExp","Object"],function(v){UE.utils["is"+v]=function(obj){return Object.prototype.toString.apply(obj)=="[object "+v+"]"}});utils.domReady();var EventBase=UE.EventBase=function(){};EventBase.prototype={addListener:function(types,listener){types=utils.trim(types).split(" ");for(var i=0,ti;ti=types[i++];){getListener(this,ti,true).push(listener)}},removeListener:function(types,listener){types=utils.trim(types).split(" ");for(var i=0,ti;ti=types[i++];){utils.removeItem(getListener(this,ti)||[],listener)}},fireEvent:function(types){types=utils.trim(types).split(" ");for(var i=0,ti;ti=types[i++];){var listeners=getListener(this,ti),r,t,k;if(listeners){k=listeners.length;while(k--){t=listeners[k].apply(this,arguments);if(t!==undefined){r=t}}}if(t=this["on"+ti.toLowerCase()]){r=t.apply(this,arguments)}}return r}};function getListener(obj,type,force){var allListeners;type=type.toLowerCase();return((allListeners=(obj.__allListeners||force&&(obj.__allListeners={})))&&(allListeners[type]||force&&(allListeners[type]=[])))}var dtd=dom.dtd=(function(){function _(s){for(var k in s){s[k.toUpperCase()]=s[k]}return s}function X(t){var a=arguments;for(var i=1;i<a.length;i++){var x=a[i];for(var k in x){if(!t.hasOwnProperty(k)){t[k]=x[k]}}}return t}var A=_({isindex:1,fieldset:1}),B=_({input:1,button:1,select:1,textarea:1,label:1}),C=X(_({a:1}),B),D=X({iframe:1},C),E=_({hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1}),F=_({ins:1,del:1,script:1,style:1}),G=X(_({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1}),F),H=X(_({sub:1,img:1,embed:1,video:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1}),G),I=X(_({p:1}),H),J=X(_({iframe:1}),H,B),K=_({img:1,embed:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1}),L=X(_({a:0}),J),M=_({tr:1}),N=_({"#":1}),O=X(_({param:1}),K),P=X(_({form:1}),A,D,E,I),Q=_({li:1}),R=_({style:1,script:1}),S=_({base:1,link:1,meta:1,title:1}),T=X(S,R),U=_({head:1,body:1}),V=_({html:1});var block=_({address:1,blockquote:1,center:1,dir:1,div:1,video:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1}),empty=_({area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1,embed:1,source:1});return _({$nonBodyContent:X(V,U,S),$block:block,$inline:L,$body:X(_({script:1,style:1}),block),$cdata:_({script:1,style:1}),$empty:empty,$nonChild:_({iframe:1,textarea:1}),$listItem:_({dd:1,dt:1,li:1}),$list:_({ul:1,ol:1,dl:1}),$isNotEmpty:_({table:1,ul:1,ol:1,dl:1,iframe:1,area:1,base:1,col:1,hr:1,img:1,source:1,video:1,embed:1,input:1,link:1,meta:1,param:1}),$removeEmpty:_({a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1}),$removeEmptyBlock:_({p:1,div:1}),$tableContent:_({caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,table:1}),$notTransContent:_({pre:1,script:1,style:1,textarea:1}),html:U,head:T,style:N,script:N,body:P,base:{},link:{},meta:{},title:N,col:{},tr:_({td:1,th:1}),img:{},embed:{},colgroup:_({thead:1,col:1,tbody:1,tr:1,tfoot:1}),noscript:P,td:P,br:{},th:P,center:P,kbd:L,button:X(I,E),basefont:{},h5:L,h4:L,samp:L,h6:L,ol:Q,h1:L,h3:L,option:N,h2:L,form:X(A,D,E,I),select:_({optgroup:1,option:1}),font:L,ins:L,menu:Q,abbr:L,label:L,table:_({thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1}),code:L,tfoot:M,cite:L,li:P,input:{},iframe:P,strong:L,textarea:N,noframes:P,big:L,small:L,span:_({"#":1,br:1}),hr:L,dt:L,sub:L,optgroup:_({option:1}),param:{},bdo:L,"var":L,div:P,object:O,sup:L,dd:P,strike:L,area:{},dir:Q,map:X(_({area:1,form:1,p:1}),A,F,E),applet:O,dl:_({dt:1,dd:1}),del:L,isindex:{},fieldset:X(_({legend:1}),K),thead:M,ul:Q,acronym:L,b:L,a:X(_({a:1}),J),blockquote:X(_({td:1,tr:1,tbody:1,li:1}),P),caption:L,i:L,u:L,tbody:M,s:L,address:X(D,I),tt:L,legend:L,q:L,pre:X(G,C),p:X(_({a:1}),L),em:L,dfn:L})})();var filterWord=UE.filterWord=function(){function isWordDocument(str){return/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument|<v:)/ig.test(str)}function transUnit(v){v=v.replace(/[\d.]+\w+/g,function(m){return utils.transUnitToPx(m)});return v}function filterPasteWord(str){return str.replace(/[\t\r\n]+/g,"").replace(/<!--[\s\S]*?-->/ig,"").replace(/<v:shape [^>]*>[\s\S]*?.<\/v:shape>/gi,function(str){if(browser.opera){return""}try{var width=str.match(/width:([ \d.]*p[tx])/i)[1],height=str.match(/height:([ \d.]*p[tx])/i)[1],src=str.match(/src=\s*"([^"]*)"/i)[1];return'<img width="'+transUnit(width)+'" height="'+transUnit(height)+'" src="'+src+'" />'}catch(e){return""}}).replace(/<\/?div[^>]*>/g,"").replace(/v:\w+=(["']?)[^'"]+\1/g,"").replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|xml|meta|link|style|\w+:\w+)(?=[\s\/>]))[^>]*>/gi,"").replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>").replace(/\s+(class|lang|align)\s*=\s*(['"]?)([\w-]+)\2/ig,function(str,name,marks,val){return name=="class"&&val=="MsoListParagraph"?str:""}).replace(/<(font|span)[^>]*>\s*<\/\1>/gi,"").replace(/(<[a-z][^>]*)\sstyle=(["'])([^\2]*?)\2/gi,function(str,tag,tmp,style){var n=[],s=style.replace(/^\s+|\s+$/,"").replace(/&#39;/g,"'").replace(/&quot;/gi,"'").split(/;\s*/g);for(var i=0,v;v=s[i];i++){var name,value,parts=v.split(":");if(parts.length==2){name=parts[0].toLowerCase();value=parts[1].toLowerCase();if(/^(background)\w*/.test(name)&&value.replace(/(initial|\s)/g,"").length==0||/^(margin)\w*/.test(name)&&/^0\w+$/.test(value)){continue}switch(name){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":if(!/<table/.test(tag)){n[i]=name.replace(/^mso-|-alt$/g,"")+":"+transUnit(value)}continue;case"horiz-align":n[i]="text-align:"+value;continue;case"vert-align":n[i]="vertical-align:"+value;continue;case"font-color":case"mso-foreground":n[i]="color:"+value;continue;case"mso-background":case"mso-highlight":n[i]="background:"+value;continue;case"mso-default-height":n[i]="min-height:"+transUnit(value);continue;case"mso-default-width":n[i]="min-width:"+transUnit(value);continue;case"mso-padding-between-alt":n[i]="border-collapse:separate;border-spacing:"+transUnit(value);continue;case"text-line-through":if((value=="single")||(value=="double")){n[i]="text-decoration:line-through"}continue;case"mso-zero-height":if(value=="yes"){n[i]="display:none"}continue;case"background":break;case"margin":if(!/[1-9]/.test(value)){continue}}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?:decor|trans)|top-bar|version|vnd|word-break)/.test(name)||/text\-indent|padding|margin/.test(name)&&/\-[\d.]+/.test(value)){continue}n[i]=name+":"+parts[1]}}return tag+(n.length?' style="'+n.join(";").replace(/;{2,}/g,";")+'"':"")}).replace(/[\d.]+(cm|pt)/g,function(str){return utils.transUnitToPx(str)})}return function(html){return(isWordDocument(html)?filterPasteWord(html):html)}}();var htmlparser=UE.htmlparser=function(htmlstr,ignoreBlank){var re_tag=/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)-->)|(?:([^\s\/>]+)\s*((?:(?:"[^"]*")|(?:'[^']*')|[^"'<>])*)\/?>))/g,re_attr=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g;var allowEmptyTags={b:1,code:1,i:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,span:1,sub:1,img:1,sup:1,font:1,big:1,small:1,iframe:1,a:1,br:1,pre:1};htmlstr=htmlstr.replace(new RegExp(domUtils.fillChar,"g"),"");if(!ignoreBlank){htmlstr=htmlstr.replace(new RegExp("[\\r\\t\\n"+(ignoreBlank?"":" ")+"]*</?(\\w+)\\s*(?:[^>]*)>[\\r\\t\\n"+(ignoreBlank?"":" ")+"]*","g"),function(a,b){if(b&&allowEmptyTags[b.toLowerCase()]){return a.replace(/(^[\n\r]+)|([\n\r]+$)/g,"")}return a.replace(new RegExp("^[\\r\\n"+(ignoreBlank?"":" ")+"]+"),"").replace(new RegExp("[\\r\\n"+(ignoreBlank?"":" ")+"]+$"),"")})}var uNode=UE.uNode,needParentNode={td:"tr",tr:["tbody","thead","tfoot"],tbody:"table",th:"tr",thead:"table",tfoot:"table",caption:"table",li:["ul","ol"],dt:"dl",dd:"dl",option:"select"},needChild={ol:"li",ul:"li"};function text(parent,data){if(needChild[parent.tagName]){var tmpNode=uNode.createElement(needChild[parent.tagName]);parent.appendChild(tmpNode);tmpNode.appendChild(uNode.createText(data));parent=tmpNode}else{parent.appendChild(uNode.createText(data))}}function element(parent,tagName,htmlattr){var needParentTag;if(needParentTag=needParentNode[tagName]){var tmpParent=parent,hasParent;while(tmpParent.type!="root"){if(utils.isArray(needParentTag)?utils.indexOf(needParentTag,tmpParent.tagName)!=-1:needParentTag==tmpParent.tagName){parent=tmpParent;hasParent=true;break}tmpParent=tmpParent.parentNode}if(!hasParent){parent=element(parent,utils.isArray(needParentTag)?needParentTag[0]:needParentTag)}}var elm=new uNode({parentNode:parent,type:"element",tagName:tagName.toLowerCase(),children:dtd.$empty[tagName]?null:[]});if(htmlattr){var attrs={},match;while(match=re_attr.exec(htmlattr)){attrs[match[1].toLowerCase()]=utils.unhtml(match[2]||match[3]||match[4])}elm.attrs=attrs}parent.children.push(elm);return dtd.$empty[tagName]?parent:elm}function comment(parent,data){parent.children.push(new uNode({type:"comment",data:data,parentNode:parent}))}var match,currentIndex=0,nextIndex=0;var root=new uNode({type:"root",children:[]});var currentParent=root;while(match=re_tag.exec(htmlstr)){currentIndex=match.index;try{if(currentIndex>nextIndex){text(currentParent,htmlstr.slice(nextIndex,currentIndex))}if(match[3]){currentParent=element(currentParent,match[3].toLowerCase(),match[4])}else{if(match[1]){if(currentParent.type!="root"){var tmpParent=currentParent;while(currentParent.type=="element"&&currentParent.tagName!=match[1].toLowerCase()){currentParent=currentParent.parentNode;if(currentParent.type=="root"){currentParent=tmpParent;throw"break"}}currentParent=currentParent.parentNode}}else{if(match[2]){comment(currentParent,match[2])}}}}catch(e){}nextIndex=re_tag.lastIndex}if(nextIndex<htmlstr.length){text(currentParent,htmlstr.slice(nextIndex))}return root};(function(){var uNode=UE.uNode=function(obj){this.type=obj.type;this.data=obj.data;this.tagName=obj.tagName;this.parentNode=obj.parentNode;this.attrs=obj.attrs||{};this.children=obj.children};var indentChar="    ",breakChar="\n";function insertLine(arr,current,begin){arr.push(breakChar);return current+(begin?1:-1)}function insertIndent(arr,current){for(var i=0;i<current;i++){arr.push(indentChar)}}uNode.createElement=function(html){if(/[<>]/.test(html)){return UE.htmlparser(html).children[0]}else{return new uNode({type:"element",children:[],tagName:html})}};uNode.createText=function(data){return new UE.uNode({type:"text",data:utils.unhtml(data||"")})};function nodeToHtml(node,arr,formatter,current){switch(node.type){case"root":for(var i=0,ci;ci=node.children[i++];){if(formatter&&ci.type=="element"&&!dtd.$inlineWithA[ci.tagName]&&i>1){insertLine(arr,current,true);insertIndent(arr,current)}nodeToHtml(ci,arr,formatter,current)}break;case"text":isText(node,arr);break;case"element":isElement(node,arr,formatter,current);break;case"comment":isComment(node,arr,formatter)}return arr}function isText(node,arr){arr.push(node.parentNode.tagName=="pre"?node.data:node.data.replace(/[ ]{2}/g," &nbsp;"))}function isElement(node,arr,formatter,current){var attrhtml="";if(node.attrs){attrhtml=[];var attrs=node.attrs;for(var a in attrs){attrhtml.push(a+(attrs[a]!==undefined?'="'+utils.unhtml(attrs[a])+'"':""))}attrhtml=attrhtml.join(" ")}arr.push("<"+node.tagName+(attrhtml?" "+attrhtml:"")+(dtd.$empty[node.tagName]?"/":"")+">");if(formatter&&!dtd.$inlineWithA[node.tagName]&&node.tagName!="pre"){if(node.children&&node.children.length){current=insertLine(arr,current,true);insertIndent(arr,current)}}if(node.children&&node.children.length){for(var i=0,ci;ci=node.children[i++];){if(formatter&&ci.type=="element"&&!dtd.$inlineWithA[ci.tagName]&&i>1){insertLine(arr,current);insertIndent(arr,current)}nodeToHtml(ci,arr,formatter,current)}}if(!dtd.$empty[node.tagName]){if(formatter&&!dtd.$inlineWithA[node.tagName]&&node.tagName!="pre"){if(node.children&&node.children.length){current=insertLine(arr,current);insertIndent(arr,current)}}arr.push("</"+node.tagName+">")}}function isComment(node,arr){arr.push("<!--"+node.data+"-->")}function getNodeById(root,id){var node;if(root.type=="element"&&root.getAttr("id")==id){return root}if(root.children&&root.children.length){for(var i=0,ci;ci=root.children[i++];){if(node=getNodeById(ci,id)){return node}}}}function getNodesByTagName(node,tagName,arr){if(node.type=="element"&&node.tagName==tagName){arr.push(node)}if(node.children&&node.children.length){for(var i=0,ci;ci=node.children[i++];){getNodesByTagName(ci,tagName,arr)}}}function nodeTraversal(root,fn){if(root.children&&root.children.length){for(var i=0,ci;ci=root.children[i];){nodeTraversal(ci,fn);if(ci.parentNode){if(ci.children&&ci.children.length){fn(ci)}if(ci.parentNode){i++}}}}else{fn(root)}}uNode.prototype={toHtml:function(formatter){var arr=[];nodeToHtml(this,arr,formatter,0);return arr.join("")},innerHTML:function(htmlstr){if(this.type!="element"||dtd.$empty[this.tagName]){return this}if(utils.isString(htmlstr)){if(this.children){for(var i=0,ci;ci=this.children[i++];){ci.parentNode=null}}this.children=[];var tmpRoot=UE.htmlparser(htmlstr);for(var i=0,ci;ci=tmpRoot.children[i++];){this.children.push(ci);ci.parentNode=this}return this}else{var tmpRoot=new UE.uNode({type:"root",children:this.children});return tmpRoot.toHtml()}},innerText:function(textStr){if(this.type!="element"||dtd.$empty[this.tagName]){return this}if(textStr){if(this.children){for(var i=0,ci;ci=this.children[i++];){ci.parentNode=null}}this.children=[];this.appendChild(uNode.createText(textStr));return this}else{return this.toHtml().replace(/<[^>]+>/g,"")}},getData:function(){if(this.type=="element"){return""}return this.data},firstChild:function(){return this.children?this.children[0]:null},lastChild:function(){return this.children?this.children[this.children.length-1]:null},previousSibling:function(){var parent=this.parentNode;for(var i=0,ci;ci=parent.children[i];i++){if(ci===this){return i==0?null:parent.children[i-1]}}},nextSibling:function(){var parent=this.parentNode;for(var i=0,ci;ci=parent.children[i++];){if(ci===this){return parent.children[i]}}},replaceChild:function(target,source){if(this.children){if(target.parentNode){target.parentNode.removeChild(target)}for(var i=0,ci;ci=this.children[i];i++){if(ci===source){this.children.splice(i,1,target);source.parentNode=null;target.parentNode=this;return target}}}},appendChild:function(node){if(this.type=="root"||(this.type=="element"&&!dtd.$empty[this.tagName])){if(!this.children){this.children=[]}if(node.parentNode){node.parentNode.removeChild(node)}for(var i=0,ci;ci=this.children[i];i++){if(ci===node){this.children.splice(i,1);break}}this.children.push(node);node.parentNode=this;return node}},insertBefore:function(target,source){if(this.children){if(target.parentNode){target.parentNode.removeChild(target)}for(var i=0,ci;ci=this.children[i];i++){if(ci===source){this.children.splice(i,0,target);target.parentNode=this;return target}}}},insertAfter:function(target,source){if(this.children){if(target.parentNode){target.parentNode.removeChild(target)}for(var i=0,ci;ci=this.children[i];i++){if(ci===source){this.children.splice(i+1,0,target);target.parentNode=this;return target}}}},removeChild:function(node,keepChildren){if(this.children){for(var i=0,ci;ci=this.children[i];i++){if(ci===node){this.children.splice(i,1);ci.parentNode=null;if(keepChildren&&ci.children&&ci.children.length){for(var j=0,cj;cj=ci.children[j];j++){this.children.splice(i+j,0,cj);cj.parentNode=this}}return ci}}}},getAttr:function(attrName){return this.attrs&&this.attrs[attrName.toLowerCase()]},setAttr:function(attrName,attrVal){if(!attrName){delete this.attrs;return}if(!this.attrs){this.attrs={}}if(utils.isObject(attrName)){for(var a in attrName){if(!attrName[a]){delete this.attrs[a]}else{this.attrs[a.toLowerCase()]=attrName[a]}}}else{if(!attrVal){delete this.attrs[attrName]}else{this.attrs[attrName.toLowerCase()]=attrVal}}},getIndex:function(){var parent=this.parentNode;for(var i=0,ci;ci=parent.children[i];i++){if(ci===this){return i}}return -1},getNodeById:function(id){var node;if(this.children&&this.children.length){for(var i=0,ci;ci=this.children[i++];){if(node=getNodeById(ci,id)){return node}}}},getNodesByTagName:function(tagNames){tagNames=utils.trim(tagNames).replace(/[ ]{2,}/g," ").split(" ");var arr=[],me=this;utils.each(tagNames,function(tagName){if(me.children&&me.children.length){for(var i=0,ci;ci=me.children[i++];){getNodesByTagName(ci,tagName,arr)}}});return arr},getStyle:function(name){var cssStyle=this.getAttr("style");if(!cssStyle){return""}var reg=new RegExp(name+":([^;]+)","i");var match=cssStyle.match(reg);if(match&&match[0]){return match[1]}return""},setStyle:function(name,val){function exec(name,val){var reg=new RegExp(name+":([^;]+;?)","gi");cssStyle=cssStyle.replace(reg,"");if(val){cssStyle=name+":"+utils.unhtml(val)+";"+cssStyle}}var cssStyle=this.getAttr("style");if(!cssStyle){cssStyle=""}if(utils.isObject(name)){for(var a in name){exec(a,name[a])}}else{exec(name,val)}this.setAttr("style",utils.trim(cssStyle))},traversal:function(fn){if(this.children&&this.children.length){nodeTraversal(this,fn)}return this}}})();function getDomNode(node,start,ltr,startFromChild,fn,guard){var tmpNode=startFromChild&&node[start],parent;!tmpNode&&(tmpNode=node[ltr]);while(!tmpNode&&(parent=(parent||node).parentNode)){if(parent.tagName=="BODY"||guard&&!guard(parent)){return null}tmpNode=parent[ltr]}if(tmpNode&&fn&&!fn(tmpNode)){return getDomNode(tmpNode,start,ltr,false,fn)}return tmpNode}var attrFix=ie&&browser.version<9?{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder"}:{tabindex:"tabIndex",readonly:"readOnly"},styleBlock=utils.listToMap(["-webkit-box","-moz-box","block","list-item","table","table-row-group","table-header-group","table-footer-group","table-row","table-column-group","table-column","table-cell","table-caption"]);var domUtils=dom.domUtils={NODE_ELEMENT:1,NODE_DOCUMENT:9,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11,POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16,fillChar:ie&&browser.version=="6"?"\ufeff":"\u200B",keys:{8:1,46:1,16:1,17:1,18:1,37:1,38:1,39:1,40:1,13:1},getPosition:function(nodeA,nodeB){if(nodeA===nodeB){return 0}var node,parentsA=[nodeA],parentsB=[nodeB];node=nodeA;while(node=node.parentNode){if(node===nodeB){return 10}parentsA.push(node)}node=nodeB;while(node=node.parentNode){if(node===nodeA){return 20}parentsB.push(node)}parentsA.reverse();parentsB.reverse();if(parentsA[0]!==parentsB[0]){return 1}var i=-1;while(i++,parentsA[i]===parentsB[i]){}nodeA=parentsA[i];nodeB=parentsB[i];while(nodeA=nodeA.nextSibling){if(nodeA===nodeB){return 4}}return 2},getNodeIndex:function(node,normalized){var preNode=node,i=0;while(preNode=preNode.previousSibling){if(normalized&&preNode.nodeType==3){continue}i++}return i},inDoc:function(node,doc){while(node=node.parentNode){if(node===doc){return true}}return false},findParent:function(node,tester,includeSelf){if(!domUtils.isBody(node)){node=includeSelf?node:node.parentNode;while(node){if(!tester||tester(node)||this.isBody(node)){return tester&&!tester(node)&&this.isBody(node)?null:node}node=node.parentNode}}return null},findParentByTagName:function(node,tagName,includeSelf,excludeFn){if(node&&node.nodeType&&!this.isBody(node)&&(node.nodeType==1||node.nodeType)){tagName=utils.listToMap(utils.isArray(tagName)?tagName:[tagName]);node=node.nodeType==3||!includeSelf?node.parentNode:node;while(node&&node.tagName&&node.nodeType!=9){if(excludeFn&&excludeFn(node)){break}if(tagName[node.tagName]){return node}node=node.parentNode}}return null},findParents:function(node,includeSelf,tester,closerFirst){var parents=includeSelf&&(tester&&tester(node)||!tester)?[node]:[];while(node=domUtils.findParent(node,tester)){parents.push(node)}return closerFirst?parents:parents.reverse()},insertAfter:function(node,nodeToInsert){return node.parentNode.insertBefore(nodeToInsert,node.nextSibling)},remove:function(node,keepChildren){var parent=node.parentNode,child;if(parent){if(keepChildren&&node.hasChildNodes()){while(child=node.firstChild){parent.insertBefore(child,node)}}parent.removeChild(node)}return node},getNextDomNode:function(node,startFromChild,filter,guard){return getDomNode(node,"firstChild","nextSibling",startFromChild,filter,guard)},isBookmarkNode:function(node){return node.nodeType==1&&node.id&&/^_baidu_bookmark_/i.test(node.id)},getWindow:function(node){var doc=node.ownerDocument||node;return doc.defaultView||doc.parentWindow},getCommonAncestor:function(nodeA,nodeB){if(nodeA===nodeB){return nodeA}var parentsA=[nodeA],parentsB=[nodeB],parent=nodeA,i=-1;while(parent=parent.parentNode){if(parent===nodeB){return parent}parentsA.push(parent)}parent=nodeB;while(parent=parent.parentNode){if(parent===nodeA){return parent}parentsB.push(parent)}parentsA.reverse();parentsB.reverse();while(i++,parentsA[i]===parentsB[i]){}return i==0?null:parentsA[i-1]},clearEmptySibling:function(node,ingoreNext,ingorePre){function clear(next,dir){var tmpNode;while(next&&!domUtils.isBookmarkNode(next)&&(domUtils.isEmptyInlineElement(next)||!new RegExp("[^\t\n\r"+domUtils.fillChar+"]").test(next.nodeValue))){tmpNode=next[dir];domUtils.remove(next);next=tmpNode}}!ingoreNext&&clear(node.nextSibling,"nextSibling");!ingorePre&&clear(node.previousSibling,"previousSibling")},split:function(node,offset){var doc=node.ownerDocument;if(browser.ie&&offset==node.nodeValue.length){var next=doc.createTextNode("");return domUtils.insertAfter(node,next)}var retval=node.splitText(offset);if(browser.ie8){var tmpNode=doc.createTextNode("");domUtils.insertAfter(retval,tmpNode);domUtils.remove(tmpNode)}return retval},isWhitespace:function(node){return !new RegExp("[^ \t\n\r"+domUtils.fillChar+"]").test(node.nodeValue)},getXY:function(element){var x=0,y=0;while(element.offsetParent){y+=element.offsetTop;x+=element.offsetLeft;element=element.offsetParent}return{x:x,y:y}},on:function(obj,type,handler){var types=utils.isArray(type)?type:[type],k=types.length;if(k){while(k--){type=types[k];if(obj.addEventListener){obj.addEventListener(type,handler,false)}else{if(!handler._d){handler._d={}}var key=type+handler.toString();if(!handler._d[key]){handler._d[key]=function(evt){return handler.call(evt.srcElement,evt||window.event)};obj.attachEvent("on"+type,handler._d[key])}}}}obj=null},un:function(obj,type,handler){var types=utils.isArray(type)?type:[type],k=types.length;if(k){while(k--){type=types[k];if(obj.removeEventListener){obj.removeEventListener(type,handler,false)}else{var key=type+handler.toString();obj.detachEvent("on"+type,handler._d?handler._d[key]:handler);if(handler._d&&handler._d[key]){delete handler._d[key]}}}}},isSameElement:function(nodeA,nodeB){if(nodeA.tagName!=nodeB.tagName){return 0}var thisAttribs=nodeA.attributes,otherAttribs=nodeB.attributes;if(!ie&&thisAttribs.length!=otherAttribs.length){return 0}var attrA,attrB,al=0,bl=0;for(var i=0;attrA=thisAttribs[i++];){if(attrA.nodeName=="style"){if(attrA.specified){al++}if(domUtils.isSameStyle(nodeA,nodeB)){continue}else{return 0}}if(ie){if(attrA.specified){al++;attrB=otherAttribs.getNamedItem(attrA.nodeName)}else{continue}}else{attrB=nodeB.attributes[attrA.nodeName]}if(!attrB.specified||attrA.nodeValue!=attrB.nodeValue){return 0}}if(ie){for(i=0;attrB=otherAttribs[i++];){if(attrB.specified){bl++}}if(al!=bl){return 0}}return 1},isSameStyle:function(elementA,elementB){var styleA=elementA.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":"),styleB=elementB.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":");if(browser.opera){styleA=elementA.style;styleB=elementB.style;if(styleA.length!=styleB.length){return 0}for(var p in styleA){if(/^(\d+|csstext)$/i.test(p)){continue}if(styleA[p]!=styleB[p]){return 0}}return 1}if(!styleA||!styleB){return styleA==styleB?1:0}styleA=styleA.split(";");styleB=styleB.split(";");if(styleA.length!=styleB.length){return 0}for(var i=0,ci;ci=styleA[i++];){if(utils.indexOf(styleB,ci)==-1){return 0}}return 1},isBlockElm:function(node){return node.nodeType==1&&(dtd.$block[node.tagName]||styleBlock[domUtils.getComputedStyle(node,"display")])&&!dtd.$nonChild[node.tagName]},isBody:function(node){return node&&node.nodeType==1&&node.tagName.toLowerCase()=="body"},breakParent:function(node,parent){var tmpNode,parentClone=node,clone=node,leftNodes,rightNodes;do{parentClone=parentClone.parentNode;if(leftNodes){tmpNode=parentClone.cloneNode(false);tmpNode.appendChild(leftNodes);leftNodes=tmpNode;tmpNode=parentClone.cloneNode(false);tmpNode.appendChild(rightNodes);rightNodes=tmpNode}else{leftNodes=parentClone.cloneNode(false);rightNodes=leftNodes.cloneNode(false)}while(tmpNode=clone.previousSibling){leftNodes.insertBefore(tmpNode,leftNodes.firstChild)}while(tmpNode=clone.nextSibling){rightNodes.appendChild(tmpNode)}clone=parentClone}while(parent!==parentClone);tmpNode=parent.parentNode;tmpNode.insertBefore(leftNodes,parent);tmpNode.insertBefore(rightNodes,parent);tmpNode.insertBefore(node,rightNodes);domUtils.remove(parent);return node},isEmptyInlineElement:function(node){if(node.nodeType!=1||!dtd.$removeEmpty[node.tagName]){return 0}node=node.firstChild;while(node){if(domUtils.isBookmarkNode(node)){return 0}if(node.nodeType==1&&!domUtils.isEmptyInlineElement(node)||node.nodeType==3&&!domUtils.isWhitespace(node)){return 0}node=node.nextSibling}return 1},trimWhiteTextNode:function(node){function remove(dir){var child;while((child=node[dir])&&child.nodeType==3&&domUtils.isWhitespace(child)){node.removeChild(child)}}remove("firstChild");remove("lastChild")},mergChild:function(node,tagName,attrs){var list=domUtils.getElementsByTagName(node,node.tagName.toLowerCase());for(var i=0,ci;ci=list[i++];){if(!ci.parentNode||domUtils.isBookmarkNode(ci)){continue}if(ci.tagName.toLowerCase()=="span"){if(node===ci.parentNode){domUtils.trimWhiteTextNode(node);if(node.childNodes.length==1){node.style.cssText=ci.style.cssText+";"+node.style.cssText;domUtils.remove(ci,true);continue}}ci.style.cssText=node.style.cssText+";"+ci.style.cssText;if(attrs){var style=attrs.style;if(style){style=style.split(";");for(var j=0,s;s=style[j++];){ci.style[utils.cssStyleToDomStyle(s.split(":")[0])]=s.split(":")[1]}}}if(domUtils.isSameStyle(ci,node)){domUtils.remove(ci,true)}continue}if(domUtils.isSameElement(node,ci)){domUtils.remove(ci,true)}}if(tagName=="span"){var as=domUtils.getElementsByTagName(node,"a");for(var i=0,ai;ai=as[i++];){ai.style.cssText=";"+node.style.cssText;ai.style.textDecoration="underline"}}},getElementsByTagName:function(node,name){var list=node.getElementsByTagName(name),arr=[];for(var i=0,ci;ci=list[i++];){arr.push(ci)}return arr},mergToParent:function(node){var parent=node.parentNode;while(parent&&dtd.$removeEmpty[parent.tagName]){if(parent.tagName==node.tagName||parent.tagName=="A"){domUtils.trimWhiteTextNode(parent);if(parent.tagName=="SPAN"&&!domUtils.isSameStyle(parent,node)||(parent.tagName=="A"&&node.tagName=="SPAN")){if(parent.childNodes.length>1||parent!==node.parentNode){node.style.cssText=parent.style.cssText+";"+node.style.cssText;parent=parent.parentNode;continue}else{parent.style.cssText+=";"+node.style.cssText;if(parent.tagName=="A"){parent.style.textDecoration="underline"}}}if(parent.tagName!="A"){parent===node.parentNode&&domUtils.remove(node,true);break}}parent=parent.parentNode}},mergSibling:function(node,ingorePre,ingoreNext){function merg(rtl,start,node){var next;if((next=node[rtl])&&!domUtils.isBookmarkNode(next)&&next.nodeType==1&&domUtils.isSameElement(node,next)){while(next.firstChild){if(start=="firstChild"){node.insertBefore(next.lastChild,node.firstChild)}else{node.appendChild(next.firstChild)}}domUtils.remove(next)}}!ingorePre&&merg("previousSibling","firstChild",node);!ingoreNext&&merg("nextSibling","lastChild",node)},mergeChild:function(node,tagName,attrs){var list=domUtils.getElementsByTagName(node,node.tagName.toLowerCase());for(var i=0,ci;ci=list[i++];){if(!ci.parentNode||domUtils.isBookmarkNode(ci)){continue}if(ci.tagName.toLowerCase()=="span"){if(node===ci.parentNode){domUtils.trimWhiteTextNode(node);if(node.childNodes.length==1){node.style.cssText=ci.style.cssText+";"+node.style.cssText;domUtils.remove(ci,true);continue}}ci.style.cssText=node.style.cssText+";"+ci.style.cssText;if(attrs){var style=attrs.style;if(style){style=style.split(";");for(var j=0,s;s=style[j++];){ci.style[utils.cssStyleToDomStyle(s.split(":")[0])]=s.split(":")[1]}}}if(domUtils.isSameStyle(ci,node)){domUtils.remove(ci,true)}continue}if(domUtils.isSameElement(node,ci)){domUtils.remove(ci,true)}}},mergeToParent:function(node){var parent=node.parentNode;while(parent&&dtd.$removeEmpty[parent.tagName]){if(parent.tagName==node.tagName||parent.tagName=="A"){domUtils.trimWhiteTextNode(parent);if(parent.tagName=="SPAN"&&!domUtils.isSameStyle(parent,node)||(parent.tagName=="A"&&node.tagName=="SPAN")){if(parent.childNodes.length>1||parent!==node.parentNode){node.style.cssText=parent.style.cssText+";"+node.style.cssText;parent=parent.parentNode;continue}else{parent.style.cssText+=";"+node.style.cssText;if(parent.tagName=="A"){parent.style.textDecoration="underline"}}}if(parent.tagName!="A"){parent===node.parentNode&&domUtils.remove(node,true);break}}parent=parent.parentNode}},mergeSibling:function(node,ignorePre,ignoreNext){function merge(rtl,start,node){var next;if((next=node[rtl])&&!domUtils.isBookmarkNode(next)&&next.nodeType==1&&domUtils.isSameElement(node,next)){while(next.firstChild){if(start=="firstChild"){node.insertBefore(next.lastChild,node.firstChild)}else{node.appendChild(next.firstChild)}}domUtils.remove(next)}}!ignorePre&&merge("previousSibling","firstChild",node);!ignoreNext&&merge("nextSibling","lastChild",node)},unselectable:ie||browser.opera?function(node){node.onselectstart=function(){return false};node.onclick=node.onkeyup=node.onkeydown=function(){return false};node.unselectable="on";node.setAttribute("unselectable","on");for(var i=0,ci;ci=node.all[i++];){switch(ci.tagName.toLowerCase()){case"iframe":case"textarea":case"input":case"select":break;default:ci.unselectable="on";node.setAttribute("unselectable","on")}}}:function(node){node.style.MozUserSelect=node.style.webkitUserSelect=node.style.KhtmlUserSelect="none"},removeAttributes:function(node,attrNames){attrNames=utils.isArray(attrNames)?attrNames:utils.trim(attrNames).replace(/[ ]{2,}/g," ").split(" ");for(var i=0,ci;ci=attrNames[i++];){ci=attrFix[ci]||ci;switch(ci){case"className":node[ci]="";break;case"style":node.style.cssText="";!browser.ie&&node.getAttributeNode("style")&&node.removeAttributeNode(node.getAttributeNode("style"))}node.removeAttribute(ci)}},creElm:function(doc,tag,attrs){return this.setAttributes(doc.createElement(tag),attrs)},setAttributes:function(node,attrs){for(var name in attrs){var value=attrs[name];switch(name){case"class":node.className=value;break;case"forecolor":node.style.cssText=node.style.cssText+";"+value;break;case"wUnderline":node.style.cssText=node.style.cssText+";"+value;break;case"innerHTML":node[name]=value;break;case"value":node.value=value;break;case"wBold":node.style.cssText=node.style.cssText+";"+value;break;case"linkStyleClose":break;case"wbackColorClose":break;case"style":node.style.cssText=node.style.cssText+";"+value;break;default:node.setAttribute(attrFix[name]||name,value)}}return node},getComputedStyle:function(element,styleName){var pros="width height top left";if(pros.indexOf(styleName)>-1){return element["offset"+styleName.replace(/^\w/,function(s){return s.toUpperCase()})]+"px"}if(element.nodeType==3){element=element.parentNode}if(browser.ie&&browser.version<9&&styleName=="font-size"&&!element.style.fontSize&&!dtd.$empty[element.tagName]&&!dtd.$nonChild[element.tagName]){var span=element.ownerDocument.createElement("span");span.style.cssText="padding:0;border:0;font-family:simsun;";span.innerHTML=".";element.appendChild(span);var result=span.offsetHeight;element.removeChild(span);span=null;return result+"px"}try{var value=domUtils.getStyle(element,styleName)||(window.getComputedStyle?domUtils.getWindow(element).getComputedStyle(element,"").getPropertyValue(styleName):(element.currentStyle||element.style)[utils.cssStyleToDomStyle(styleName)])}catch(e){return""}return utils.transUnitToPx(utils.fixColor(styleName,value))},removeClasses:function(elm,classNames){classNames=utils.isArray(classNames)?classNames:utils.trim(classNames).replace(/[ ]{2,}/g," ").split(" ");for(var i=0,ci,cls=elm.className;ci=classNames[i++];){cls=cls.replace(new RegExp("\\b"+ci+"\\b"),"")}cls=utils.trim(cls).replace(/[ ]{2,}/g," ");if(cls){elm.className=cls}else{domUtils.removeAttributes(elm,["class"])}},addClass:function(element,className){if(!this.hasClass(element,className)){element.className+=" "+className}},removeStyle:function(node,name){node.style[utils.cssStyleToDomStyle(name)]="";if(!node.style.cssText){domUtils.removeAttributes(node,["style"])}},hasClass:function(element,className){if(!element){return}if(utils.isRegExp(className)){return className.test(element.className)}className=utils.trim(className).replace(/[ ]{2,}/g," ").split(" ");for(var i=0,ci,cls=element.className;ci=className[i++];){if(!new RegExp("\\b"+ci+"\\b","i").test(cls)){return false}}return i-1==className.length},preventDefault:function(evt){evt.preventDefault?evt.preventDefault():(evt.returnValue=false)},getStyle:function(element,name){var value=element.style[utils.cssStyleToDomStyle(name)];return utils.fixColor(name,value)},setStyle:function(element,name,value){element.style[utils.cssStyleToDomStyle(name)]=value},setStyles:function(element,styles){for(var name in styles){if(styles.hasOwnProperty(name)){domUtils.setStyle(element,name,styles[name])}}},removeDirtyAttr:function(node){for(var i=0,ci,nodes=node.getElementsByTagName("*");ci=nodes[i++];){ci.removeAttribute("_moz_dirty")}node.removeAttribute("_moz_dirty")},getChildCount:function(node,fn){var count=0,first=node.firstChild;fn=fn||function(){return 1};while(first){if(fn(first)){count++}first=first.nextSibling}return count},isEmptyNode:function(node){return !node.firstChild||domUtils.getChildCount(node,function(node){return !domUtils.isBr(node)&&!domUtils.isBookmarkNode(node)&&!domUtils.isWhitespace(node)})==0},clearSelectedArr:function(nodes){var node;while(node=nodes.pop()){domUtils.removeAttributes(node,["class"])}},scrollToView:function(node,win,offsetTop){var getViewPaneSize=function(){var doc=win.document,mode=doc.compatMode=="CSS1Compat";return{width:(mode?doc.documentElement.clientWidth:doc.body.clientWidth)||0,height:(mode?doc.documentElement.clientHeight:doc.body.clientHeight)||0}},getScrollPosition=function(win){if("pageXOffset" in win){return{x:win.pageXOffset||0,y:win.pageYOffset||0}}else{var doc=win.document;return{x:doc.documentElement.scrollLeft||doc.body.scrollLeft||0,y:doc.documentElement.scrollTop||doc.body.scrollTop||0}}};var winHeight=getViewPaneSize().height,offset=winHeight*-1+offsetTop;offset+=(node.offsetHeight||0);var elementPosition=domUtils.getXY(node);offset+=elementPosition.y;var currentScroll=getScrollPosition(win).y;if(offset>currentScroll||offset<currentScroll-winHeight){win.scrollTo(0,offset+(offset<0?-20:20))}},isBr:function(node){return node.nodeType==1&&node.tagName=="BR"},isFillChar:function(node){return node.nodeType==3&&!node.nodeValue.replace(new RegExp(domUtils.fillChar),"").length},isStartInblock:function(range){var tmpRange=range.cloneRange(),flag=0,start=tmpRange.startContainer,tmp;while(start&&domUtils.isFillChar(start)){tmp=start;start=start.previousSibling}if(tmp){tmpRange.setStartBefore(tmp);start=tmpRange.startContainer}if(start.nodeType==1&&domUtils.isEmptyNode(start)&&tmpRange.startOffset==1){tmpRange.setStart(start,0).collapse(true)}while(!tmpRange.startOffset){start=tmpRange.startContainer;if(domUtils.isBlockElm(start)||domUtils.isBody(start)){flag=1;break}var pre=tmpRange.startContainer.previousSibling,tmpNode;if(!pre){tmpRange.setStartBefore(tmpRange.startContainer)}else{while(pre&&domUtils.isFillChar(pre)){tmpNode=pre;pre=pre.previousSibling}if(tmpNode){tmpRange.setStartBefore(tmpNode)}else{tmpRange.setStartBefore(tmpRange.startContainer)}}}return flag&&!domUtils.isBody(tmpRange.startContainer)?1:0},isEmptyBlock:function(node){var reg=new RegExp("[ \t\r\n"+domUtils.fillChar+"]","g");if(node[browser.ie?"innerText":"textContent"].replace(reg,"").length>0){return 0}for(var n in dtd.$isNotEmpty){if(node.getElementsByTagName(n).length){return 0}}return 1},setViewportOffset:function(element,offset){var left=parseInt(element.style.left)|0;var top=parseInt(element.style.top)|0;var rect=element.getBoundingClientRect();var offsetLeft=offset.left-rect.left;var offsetTop=offset.top-rect.top;if(offsetLeft){element.style.left=left+offsetLeft+"px"}if(offsetTop){element.style.top=top+offsetTop+"px"}},fillNode:function(doc,node){var tmpNode=browser.ie?doc.createTextNode(domUtils.fillChar):doc.createElement("br");node.innerHTML="";node.appendChild(tmpNode)},moveChild:function(src,tag,dir){while(src.firstChild){if(dir&&tag.firstChild){tag.insertBefore(src.lastChild,tag.firstChild)}else{tag.appendChild(src.firstChild)}}},hasNoAttributes:function(node){return browser.ie?/^<\w+\s*?>/.test(node.outerHTML):node.attributes.length==0},isCustomeNode:function(node){return node.nodeType==1&&node.getAttribute("_ue_custom_node_")},isTagNode:function(node,tagName){return node.nodeType==1&&node.tagName.toLowerCase()==tagName}};var fillCharReg=new RegExp(domUtils.fillChar,"g");(function(){var guid=0,fillChar=domUtils.fillChar,fillData;function updateCollapse(range){range.collapsed=range.startContainer&&range.endContainer&&range.startContainer===range.endContainer&&range.startOffset==range.endOffset}function selectOneNode(rng){return !rng.collapsed&&rng.startContainer.nodeType==1&&rng.startContainer===rng.endContainer&&rng.endOffset-rng.startOffset==1}function setEndPoint(toStart,node,offset,range){if(node.nodeType==1&&(dtd.$empty[node.tagName]||dtd.$nonChild[node.tagName])){offset=domUtils.getNodeIndex(node)+(toStart?0:1);node=node.parentNode}if(toStart){range.startContainer=node;range.startOffset=offset;if(!range.endContainer){range.collapse(true)}}else{range.endContainer=node;range.endOffset=offset;if(!range.startContainer){range.collapse(false)}}updateCollapse(range);return range}function execContentsAction(range,action){var start=range.startContainer,end=range.endContainer,startOffset=range.startOffset,endOffset=range.endOffset,doc=range.document,frag=doc.createDocumentFragment(),tmpStart,tmpEnd;if(start.nodeType==1){start=start.childNodes[startOffset]||(tmpStart=start.appendChild(doc.createTextNode("")))}if(end.nodeType==1){end=end.childNodes[endOffset]||(tmpEnd=end.appendChild(doc.createTextNode("")))}if(start===end&&start.nodeType==3){frag.appendChild(doc.createTextNode(start.substringData(startOffset,endOffset-startOffset)));if(action){start.deleteData(startOffset,endOffset-startOffset);range.collapse(true)}return frag}var current,currentLevel,clone=frag,startParents=domUtils.findParents(start,true),endParents=domUtils.findParents(end,true);for(var i=0;startParents[i]==endParents[i];){i++}for(var j=i,si;si=startParents[j];j++){current=si.nextSibling;if(si==start){if(!tmpStart){if(range.startContainer.nodeType==3){clone.appendChild(doc.createTextNode(start.nodeValue.slice(startOffset)));if(action){start.deleteData(startOffset,start.nodeValue.length-startOffset)}}else{clone.appendChild(!action?start.cloneNode(true):start)}}}else{currentLevel=si.cloneNode(false);clone.appendChild(currentLevel)}while(current){if(current===end||current===endParents[j]){break}si=current.nextSibling;clone.appendChild(!action?current.cloneNode(true):current);current=si}clone=currentLevel}clone=frag;if(!startParents[i]){clone.appendChild(startParents[i-1].cloneNode(false));clone=clone.firstChild}for(var j=i,ei;ei=endParents[j];j++){current=ei.previousSibling;if(ei==end){if(!tmpEnd&&range.endContainer.nodeType==3){clone.appendChild(doc.createTextNode(end.substringData(0,endOffset)));if(action){end.deleteData(0,endOffset)}}}else{currentLevel=ei.cloneNode(false);clone.appendChild(currentLevel)}if(j!=i||!startParents[i]){while(current){if(current===start){break}ei=current.previousSibling;clone.insertBefore(!action?current.cloneNode(true):current,clone.firstChild);current=ei}}clone=currentLevel}if(action){range.setStartBefore(!endParents[i]?endParents[i-1]:!startParents[i]?startParents[i-1]:endParents[i]).collapse(true)}tmpStart&&domUtils.remove(tmpStart);tmpEnd&&domUtils.remove(tmpEnd);return frag}var Range=dom.Range=function(document){var me=this;me.startContainer=me.startOffset=me.endContainer=me.endOffset=null;me.document=document;me.collapsed=true};function removeFillData(doc,excludeNode){try{if(fillData&&domUtils.inDoc(fillData,doc)){if(!fillData.nodeValue.replace(fillCharReg,"").length){var tmpNode=fillData.parentNode;domUtils.remove(fillData);while(tmpNode&&domUtils.isEmptyInlineElement(tmpNode)&&(browser.safari?!(domUtils.getPosition(tmpNode,excludeNode)&domUtils.POSITION_CONTAINS):!tmpNode.contains(excludeNode))){fillData=tmpNode.parentNode;domUtils.remove(tmpNode);tmpNode=fillData}}else{fillData.nodeValue=fillData.nodeValue.replace(fillCharReg,"")}}}catch(e){}}function mergeSibling(node,dir){var tmpNode;node=node[dir];while(node&&domUtils.isFillChar(node)){tmpNode=node[dir];domUtils.remove(node);node=tmpNode}}Range.prototype={cloneContents:function(){return this.collapsed?null:execContentsAction(this,0)},deleteContents:function(){var txt;if(!this.collapsed){execContentsAction(this,1)}if(browser.webkit){txt=this.startContainer;if(txt.nodeType==3&&!txt.nodeValue.length){this.setStartBefore(txt).collapse(true);domUtils.remove(txt)}}return this},extractContents:function(){return this.collapsed?null:execContentsAction(this,2)},setStart:function(node,offset){return setEndPoint(true,node,offset,this)},setEnd:function(node,offset){return setEndPoint(false,node,offset,this)},setStartAfter:function(node){return this.setStart(node.parentNode,domUtils.getNodeIndex(node)+1)},setStartBefore:function(node){return this.setStart(node.parentNode,domUtils.getNodeIndex(node))},setEndAfter:function(node){return this.setEnd(node.parentNode,domUtils.getNodeIndex(node)+1)},setEndBefore:function(node){return this.setEnd(node.parentNode,domUtils.getNodeIndex(node))},setStartAtFirst:function(node){return this.setStart(node,0)},setStartAtLast:function(node){return this.setStart(node,node.nodeType==3?node.nodeValue.length:node.childNodes.length)},setEndAtFirst:function(node){return this.setEnd(node,0)},setEndAtLast:function(node){return this.setEnd(node,node.nodeType==3?node.nodeValue.length:node.childNodes.length)},selectNode:function(node){return this.setStartBefore(node).setEndAfter(node)},selectNodeContents:function(node){return this.setStart(node,0).setEndAtLast(node)},cloneRange:function(){var me=this;return new Range(me.document).setStart(me.startContainer,me.startOffset).setEnd(me.endContainer,me.endOffset)},collapse:function(toStart){var me=this;if(toStart){me.endContainer=me.startContainer;me.endOffset=me.startOffset}else{me.startContainer=me.endContainer;me.startOffset=me.endOffset}me.collapsed=true;return me},shrinkBoundary:function(ignoreEnd){var me=this,child,collapsed=me.collapsed;function check(node){return node.nodeType==1&&!domUtils.isBookmarkNode(node)&&!dtd.$empty[node.tagName]&&!dtd.$nonChild[node.tagName]}while(me.startContainer.nodeType==1&&(child=me.startContainer.childNodes[me.startOffset])&&check(child)){me.setStart(child,0)}if(collapsed){return me.collapse(true)}if(!ignoreEnd){while(me.endContainer.nodeType==1&&me.endOffset>0&&(child=me.endContainer.childNodes[me.endOffset-1])&&check(child)){me.setEnd(child,child.childNodes.length)}}return me},getCommonAncestor:function(includeSelf,ignoreTextNode){var me=this,start=me.startContainer,end=me.endContainer;if(start===end){if(includeSelf&&selectOneNode(this)){start=start.childNodes[me.startOffset];if(start.nodeType==1){return start}}return ignoreTextNode&&start.nodeType==3?start.parentNode:start}return domUtils.getCommonAncestor(start,end)},trimBoundary:function(ignoreEnd){this.txtToElmBoundary();var start=this.startContainer,offset=this.startOffset,collapsed=this.collapsed,end=this.endContainer;if(start.nodeType==3){if(offset==0){this.setStartBefore(start)}else{if(offset>=start.nodeValue.length){this.setStartAfter(start)}else{var textNode=domUtils.split(start,offset);if(start===end){this.setEnd(textNode,this.endOffset-offset)}else{if(start.parentNode===end){this.endOffset+=1}}this.setStartBefore(textNode)}}if(collapsed){return this.collapse(true)}}if(!ignoreEnd){offset=this.endOffset;end=this.endContainer;if(end.nodeType==3){if(offset==0){this.setEndBefore(end)}else{offset<end.nodeValue.length&&domUtils.split(end,offset);this.setEndAfter(end)}}}return this},txtToElmBoundary:function(){function adjust(r,c){var container=r[c+"Container"],offset=r[c+"Offset"];if(container.nodeType==3){if(!offset){r["set"+c.replace(/(\w)/,function(a){return a.toUpperCase()})+"Before"](container)}else{if(offset>=container.nodeValue.length){r["set"+c.replace(/(\w)/,function(a){return a.toUpperCase()})+"After"](container)}}}}if(!this.collapsed){adjust(this,"start");adjust(this,"end")}return this},insertNode:function(node){var first=node,length=1;if(node.nodeType==11){first=node.firstChild;length=node.childNodes.length}this.trimBoundary(true);var start=this.startContainer,offset=this.startOffset;var nextNode=start.childNodes[offset];if(nextNode){start.insertBefore(node,nextNode)}else{start.appendChild(node)}if(first.parentNode===this.endContainer){this.endOffset=this.endOffset+length}return this.setStartBefore(first)},setCursor:function(toEnd,noFillData){return this.collapse(!toEnd).select(noFillData)},createBookmark:function(serialize,same){var endNode,startNode=this.document.createElement("span");startNode.style.cssText="display:none;line-height:0px;";startNode.appendChild(this.document.createTextNode("\u200D"));startNode.id="_baidu_bookmark_start_"+(same?"":guid++);if(!this.collapsed){endNode=startNode.cloneNode(true);endNode.id="_baidu_bookmark_end_"+(same?"":guid++)}this.insertNode(startNode);if(endNode){this.collapse().insertNode(endNode).setEndBefore(endNode)}this.setStartAfter(startNode);return{start:serialize?startNode.id:startNode,end:endNode?serialize?endNode.id:endNode:null,id:serialize}},moveToBookmark:function(bookmark){var start=bookmark.id?this.document.getElementById(bookmark.start):bookmark.start,end=bookmark.end&&bookmark.id?this.document.getElementById(bookmark.end):bookmark.end;this.setStartBefore(start);domUtils.remove(start);if(end){this.setEndBefore(end);domUtils.remove(end)}else{this.collapse(true)}return this},enlarge:function(toBlock,stopFn){var isBody=domUtils.isBody,pre,node,tmp=this.document.createTextNode("");if(toBlock){node=this.startContainer;if(node.nodeType==1){if(node.childNodes[this.startOffset]){pre=node=node.childNodes[this.startOffset]}else{node.appendChild(tmp);pre=node=tmp}}else{pre=node}while(1){if(domUtils.isBlockElm(node)){node=pre;while((pre=node.previousSibling)&&!domUtils.isBlockElm(pre)){node=pre}this.setStartBefore(node);break}pre=node;node=node.parentNode}node=this.endContainer;if(node.nodeType==1){if(pre=node.childNodes[this.endOffset]){node.insertBefore(tmp,pre)}else{node.appendChild(tmp)}pre=node=tmp}else{pre=node}while(1){if(domUtils.isBlockElm(node)){node=pre;while((pre=node.nextSibling)&&!domUtils.isBlockElm(pre)){node=pre}this.setEndAfter(node);break}pre=node;node=node.parentNode}if(tmp.parentNode===this.endContainer){this.endOffset--}domUtils.remove(tmp)}if(!this.collapsed){while(this.startOffset==0){if(stopFn&&stopFn(this.startContainer)){break}if(isBody(this.startContainer)){break}this.setStartBefore(this.startContainer)}while(this.endOffset==(this.endContainer.nodeType==1?this.endContainer.childNodes.length:this.endContainer.nodeValue.length)){if(stopFn&&stopFn(this.endContainer)){break}if(isBody(this.endContainer)){break}this.setEndAfter(this.endContainer)}}return this},adjustmentBoundary:function(){if(!this.collapsed){while(!domUtils.isBody(this.startContainer)&&this.startOffset==this.startContainer[this.startContainer.nodeType==3?"nodeValue":"childNodes"].length&&this.startContainer[this.startContainer.nodeType==3?"nodeValue":"childNodes"].length){this.setStartAfter(this.startContainer)}while(!domUtils.isBody(this.endContainer)&&!this.endOffset&&this.endContainer[this.endContainer.nodeType==3?"nodeValue":"childNodes"].length){this.setEndBefore(this.endContainer)}}return this},applyInlineStyle:function(tagName,attrs,list){if(this.collapsed){return this}this.trimBoundary().enlarge(false,function(node){return node.nodeType==1&&domUtils.isBlockElm(node)}).adjustmentBoundary();var bookmark=this.createBookmark(),end=bookmark.end,filterFn=function(node){return node.nodeType==1?node.tagName.toLowerCase()!="br":!domUtils.isWhitespace(node)},current=domUtils.getNextDomNode(bookmark.start,false,filterFn),node,pre,range=this.cloneRange();while(current&&(domUtils.getPosition(current,end)&domUtils.POSITION_PRECEDING)){if(current.nodeType==3||dtd[tagName][current.tagName]){range.setStartBefore(current);node=current;while(node&&(node.nodeType==3||dtd[tagName][node.tagName])&&node!==end){pre=node;node=domUtils.getNextDomNode(node,node.nodeType==1,null,function(parent){return dtd[tagName][parent.tagName]})}var frag=range.setEndAfter(pre).extractContents(),elm;if(list&&list.length>0){var level,top;top=level=list[0].cloneNode(false);for(var i=1,ci;ci=list[i++];){level.appendChild(ci.cloneNode(false));level=level.firstChild}elm=level}else{elm=range.document.createElement(tagName)}if(attrs){domUtils.setAttributes(elm,attrs)}elm.appendChild(frag);range.insertNode(list?top:elm);var aNode;if(tagName=="span"&&attrs.style&&/text\-decoration/.test(attrs.style)&&(aNode=domUtils.findParentByTagName(elm,"a",true))){domUtils.setAttributes(aNode,attrs);domUtils.remove(elm,true);elm=aNode}else{domUtils.mergeSibling(elm);domUtils.clearEmptySibling(elm)}domUtils.mergeChild(elm,attrs);current=domUtils.getNextDomNode(elm,false,filterFn);domUtils.mergeToParent(elm);if(node===end){break}}else{current=domUtils.getNextDomNode(current,true,filterFn)}}return this.moveToBookmark(bookmark)},removeInlineStyle:function(tagNames){if(this.collapsed){return this}tagNames=utils.isArray(tagNames)?tagNames:[tagNames];this.shrinkBoundary().adjustmentBoundary();var start=this.startContainer,end=this.endContainer;while(1){if(start.nodeType==1){if(utils.indexOf(tagNames,start.tagName.toLowerCase())>-1){break}if(start.tagName.toLowerCase()=="body"){start=null;break}}start=start.parentNode}while(1){if(end.nodeType==1){if(utils.indexOf(tagNames,end.tagName.toLowerCase())>-1){break}if(end.tagName.toLowerCase()=="body"){end=null;break}}end=end.parentNode}var bookmark=this.createBookmark(),frag,tmpRange;if(start){tmpRange=this.cloneRange().setEndBefore(bookmark.start).setStartBefore(start);frag=tmpRange.extractContents();tmpRange.insertNode(frag);domUtils.clearEmptySibling(start,true);start.parentNode.insertBefore(bookmark.start,start)}if(end){tmpRange=this.cloneRange().setStartAfter(bookmark.end).setEndAfter(end);frag=tmpRange.extractContents();tmpRange.insertNode(frag);domUtils.clearEmptySibling(end,false,true);end.parentNode.insertBefore(bookmark.end,end.nextSibling)}var current=domUtils.getNextDomNode(bookmark.start,false,function(node){return node.nodeType==1}),next;while(current&&current!==bookmark.end){next=domUtils.getNextDomNode(current,true,function(node){return node.nodeType==1});if(utils.indexOf(tagNames,current.tagName.toLowerCase())>-1){domUtils.remove(current,true)}current=next}return this.moveToBookmark(bookmark)},getClosedNode:function(){var node;if(!this.collapsed){var range=this.cloneRange().adjustmentBoundary().shrinkBoundary();if(selectOneNode(range)){var child=range.startContainer.childNodes[range.startOffset];if(child&&child.nodeType==1&&(dtd.$empty[child.tagName]||dtd.$nonChild[child.tagName])){node=child}}}return node},select:browser.ie?function(noFillData,textRange){var nativeRange;if(!this.collapsed){this.shrinkBoundary()}var node=this.getClosedNode();if(node&&!textRange){try{nativeRange=this.document.body.createControlRange();nativeRange.addElement(node);nativeRange.select()}catch(e){}return this}var bookmark=this.createBookmark(),start=bookmark.start,end;nativeRange=this.document.body.createTextRange();nativeRange.moveToElementText(start);nativeRange.moveStart("character",1);if(!this.collapsed){var nativeRangeEnd=this.document.body.createTextRange();end=bookmark.end;nativeRangeEnd.moveToElementText(end);nativeRange.setEndPoint("EndToEnd",nativeRangeEnd)}else{if(!noFillData&&this.startContainer.nodeType!=3){var tmpText=this.document.createTextNode(fillChar),tmp=this.document.createElement("span");tmp.appendChild(this.document.createTextNode(fillChar));start.parentNode.insertBefore(tmp,start);start.parentNode.insertBefore(tmpText,start);removeFillData(this.document,tmpText);fillData=tmpText;mergeSibling(tmp,"previousSibling");mergeSibling(start,"nextSibling");nativeRange.moveStart("character",-1);nativeRange.collapse(true)}}this.moveToBookmark(bookmark);tmp&&domUtils.remove(tmp);try{nativeRange.select()}catch(e){}return this}:function(notInsertFillData){function checkOffset(rng){function check(node,offset,dir){if(node.nodeType==3&&node.nodeValue.length<offset){rng[dir+"Offset"]=node.nodeValue.length}}check(rng.startContainer,rng.startOffset,"start");check(rng.endContainer,rng.endOffset,"end")}var win=domUtils.getWindow(this.document),sel=win.getSelection(),txtNode;browser.gecko?this.document.body.focus():win.focus();if(sel){sel.removeAllRanges();if(this.collapsed&&!notInsertFillData){var start=this.startContainer,child=start;if(start.nodeType==1){child=start.childNodes[this.startOffset]}if(!(start.nodeType==3&&this.startOffset)&&(child?(!child.previousSibling||child.previousSibling.nodeType!=3):(!start.lastChild||start.lastChild.nodeType!=3))){txtNode=this.document.createTextNode(fillChar);this.insertNode(txtNode);removeFillData(this.document,txtNode);mergeSibling(txtNode,"previousSibling");mergeSibling(txtNode,"nextSibling");fillData=txtNode;this.setStart(txtNode,browser.webkit?1:0).collapse(true)}}var nativeRange=this.document.createRange();if(this.collapsed&&browser.opera&&this.startContainer.nodeType==1){var child=this.startContainer.childNodes[this.startOffset];if(!child){child=this.startContainer.lastChild;if(child&&domUtils.isBr(child)){this.setStartBefore(child).collapse(true)}}else{while(child&&domUtils.isBlockElm(child)){if(child.nodeType==1&&child.childNodes[0]){child=child.childNodes[0]}else{break}}child&&this.setStartBefore(child).collapse(true)}}checkOffset(this);nativeRange.setStart(this.startContainer,this.startOffset);nativeRange.setEnd(this.endContainer,this.endOffset);if(this.startContainer.className=="J_hoverImageParent"&&this.endContainer.className=="J_hoverImageParent"){nativeRange.setStart(this.startContainer,0)}sel.addRange(nativeRange)}return this},scrollToView:function(win,offset){win=win?window:domUtils.getWindow(this.document);var me=this,span=me.document.createElement("span");span.innerHTML="&nbsp;";me.cloneRange().insertNode(span);domUtils.scrollToView(span,win,offset);domUtils.remove(span);return me},inFillChar:function(){var start=this.startContainer;if(this.collapsed&&start.nodeType==3&&start.nodeValue.replace(new RegExp("^"+domUtils.fillChar),"").length+1==start.nodeValue.length){return true}return false},createAddress:function(ignoreEnd,ignoreTxt){var addr={},me=this;function getAddress(isStart){var node=isStart?me.startContainer:me.endContainer;var parents=domUtils.findParents(node,true,function(node){return !domUtils.isBody(node)}),addrs=[];for(var i=0,ci;ci=parents[i++];){addrs.push(domUtils.getNodeIndex(ci,ignoreTxt))}var firstIndex=0;if(ignoreTxt){if(node.nodeType==3){var tmpNode=node.previousSibling;while(tmpNode&&tmpNode.nodeType==3){firstIndex+=tmpNode.nodeValue.replace(fillCharReg,"").length;tmpNode=tmpNode.previousSibling}firstIndex+=(isStart?me.startOffset:me.endOffset)}else{node=node.childNodes[isStart?me.startOffset:me.endOffset];if(node){firstIndex=domUtils.getNodeIndex(node,ignoreTxt)}else{node=isStart?me.startContainer:me.endContainer;var first=node.firstChild;while(first){if(domUtils.isFillChar(first)){first=first.nextSibling;continue}firstIndex++;if(first.nodeType==3){while(first&&first.nodeType==3){first=first.nextSibling}}else{first=first.nextSibling}}}}}else{firstIndex=isStart?domUtils.isFillChar(node)?0:me.startOffset:me.endOffset}if(firstIndex<0){firstIndex=0}addrs.push(firstIndex);return addrs}addr.startAddress=getAddress(true);if(!ignoreEnd){addr.endAddress=me.collapsed?[].concat(addr.startAddress):getAddress()}return addr},moveToAddress:function(addr,ignoreEnd){var me=this;function getNode(address,isStart){var tmpNode=me.document.body,parentNode,offset;for(var i=0,ci,l=address.length;i<l;i++){ci=address[i];parentNode=tmpNode;tmpNode=tmpNode.childNodes[ci];if(!tmpNode){offset=ci;break}}if(isStart){if(tmpNode){me.setStartBefore(tmpNode)}else{me.setStart(parentNode,offset)}}else{if(tmpNode){me.setEndBefore(tmpNode)}else{me.setEnd(parentNode,offset)}}}getNode(addr.startAddress,true);!ignoreEnd&&addr.endAddress&&getNode(addr.endAddress);return me},equals:function(rng){for(var p in this){if(this.hasOwnProperty(p)){if(this[p]!==rng[p]){return false}}}return true},traversal:function(doFn,filterFn){if(this.collapsed){return this}var bookmark=this.createBookmark(),end=bookmark.end,current=domUtils.getNextDomNode(bookmark.start,false,filterFn);while(current&&current!==end&&(domUtils.getPosition(current,end)&domUtils.POSITION_PRECEDING)){var tmpNode=domUtils.getNextDomNode(current,false,filterFn);doFn(current);current=tmpNode}return this.moveToBookmark(bookmark)}}})();(function(){function getBoundaryInformation(range,start){var getIndex=domUtils.getNodeIndex;range=range.duplicate();range.collapse(start);var parent=range.parentElement();if(!parent.hasChildNodes()){return{container:parent,offset:0}}var siblings=parent.children,child,testRange=range.duplicate(),startIndex=0,endIndex=siblings.length-1,index=-1,distance;while(startIndex<=endIndex){index=Math.floor((startIndex+endIndex)/2);child=siblings[index];testRange.moveToElementText(child);var position=testRange.compareEndPoints("StartToStart",range);if(position>0){endIndex=index-1}else{if(position<0){startIndex=index+1}else{return{container:parent,offset:getIndex(child)}}}}if(index==-1){testRange.moveToElementText(parent);testRange.setEndPoint("StartToStart",range);distance=testRange.text.replace(/(\r\n|\r)/g,"\n").length;siblings=parent.childNodes;if(!distance){child=siblings[siblings.length-1];return{container:child,offset:child.nodeValue.length}}var i=siblings.length;while(distance>0){distance-=siblings[--i].nodeValue.length}return{container:siblings[i],offset:-distance}}testRange.collapse(position>0);testRange.setEndPoint(position>0?"StartToStart":"EndToStart",range);distance=testRange.text.replace(/(\r\n|\r)/g,"\n").length;if(!distance){return dtd.$empty[child.tagName]||dtd.$nonChild[child.tagName]?{container:parent,offset:getIndex(child)+(position>0?0:1)}:{container:child,offset:position>0?0:child.childNodes.length}}while(distance>0){try{var pre=child;child=child[position>0?"previousSibling":"nextSibling"];distance-=child.nodeValue.length}catch(e){return{container:parent,offset:getIndex(pre)}}}return{container:child,offset:position>0?-distance:child.nodeValue.length+distance}}function transformIERangeToRange(ieRange,range){if(ieRange.item){range.selectNode(ieRange.item(0))}else{var bi=getBoundaryInformation(ieRange,true);range.setStart(bi.container,bi.offset);if(ieRange.compareEndPoints("StartToEnd",ieRange)!=0){bi=getBoundaryInformation(ieRange,false);range.setEnd(bi.container,bi.offset)}}return range}function _getIERange(sel){var ieRange;try{ieRange=sel.getNative().createRange()}catch(e){return null}var el=ieRange.item?ieRange.item(0):ieRange.parentElement();if((el.ownerDocument||el)===sel.document){return ieRange}return null}var Selection=dom.Selection=function(doc){var me=this,iframe;me.document=doc;if(ie){iframe=domUtils.getWindow(doc).frameElement;domUtils.on(iframe,"beforedeactivate",function(){me._bakIERange=me.getIERange()});domUtils.on(iframe,"activate",function(){try{if(!_getIERange(me)&&me._bakIERange){me._bakIERange.select()}}catch(ex){}me._bakIERange=null})}iframe=doc=null};Selection.prototype={getNative:function(){var doc=this.document;try{return !doc?null:ie?doc.selection:domUtils.getWindow(doc).getSelection()}catch(e){return null}},getIERange:function(){var ieRange=_getIERange(this);if(!ieRange){if(this._bakIERange){return this._bakIERange}}return ieRange},cache:function(){this.clear();this._cachedRange=this.getRange();this._cachedStartElement=this.getStart();this._cachedStartElementPath=this.getStartElementPath()},getStartElementPath:function(){if(this._cachedStartElementPath){return this._cachedStartElementPath}var start=this.getStart();if(start){return domUtils.findParents(start,true,null,true)}return[]},clear:function(){this._cachedStartElementPath=this._cachedRange=this._cachedStartElement=null},isFocus:function(){try{return browser.ie&&_getIERange(this)||!browser.ie&&this.getNative().rangeCount?true:false}catch(e){return false}},getRange:function(){var me=this;function optimze(range){var child=me.document.body.firstChild,collapsed=range.collapsed;while(child&&child.firstChild){range.setStart(child,0);child=child.firstChild}if(!range.startContainer){range.setStart(me.document.body,0)}if(collapsed){range.collapse(true)}}if(me._cachedRange!=null){return this._cachedRange}var range=new baidu.editor.dom.Range(me.document);if(ie){var nativeRange=me.getIERange();if(nativeRange){try{transformIERangeToRange(nativeRange,range)}catch(e){optimze(range)}}else{optimze(range)}}else{var sel=me.getNative();if(sel&&sel.rangeCount){var firstRange=sel.getRangeAt(0);var lastRange=sel.getRangeAt(sel.rangeCount-1);range.setStart(firstRange.startContainer,firstRange.startOffset).setEnd(lastRange.endContainer,lastRange.endOffset);if(range.collapsed&&domUtils.isBody(range.startContainer)&&!range.startOffset){optimze(range)}}else{var hasBakInDoc=this._bakRange&&domUtils.inDoc(this._bakRange.startContainer,this.document);if(hasBakInDoc){return this._bakRange}optimze(range)}}if(range.startContainer.className=="J_hoverImageParent"&&range.endContainer.className=="J_hoverImageParent"){range.setStart(range.startContainer,0)}return this._bakRange=range},getStart:function(){if(this._cachedStartElement){return this._cachedStartElement}var range=ie?this.getIERange():this.getRange(),tmpRange,start,tmp,parent;if(ie){if(!range){return this.document.body.firstChild}if(range.item){return range.item(0)}tmpRange=range.duplicate();tmpRange.text.length>0&&tmpRange.moveStart("character",1);tmpRange.collapse(1);start=tmpRange.parentElement();parent=tmp=range.parentElement();while(tmp=tmp.parentNode){if(tmp==start){start=parent;break}}}else{range.shrinkBoundary();start=range.startContainer;if(start.nodeType==1&&start.hasChildNodes()){start=start.childNodes[Math.min(start.childNodes.length-1,range.startOffset)]}if(start.nodeType==3){return start.parentNode}}if(start.className=="hoverImage"){start=start.parentNode}return start},getText:function(){var nativeSel,nativeRange;if(this.isFocus()&&(nativeSel=this.getNative())){nativeRange=browser.ie?nativeSel.createRange():nativeSel.getRangeAt(0);return browser.ie?nativeRange.text:nativeRange.toString()}return""},clearRange:function(){this.getNative()[browser.ie?"empty":"removeAllRanges"]()}}})();(function(){var uid=0,_selectionChangeTimer;function replaceSrc(div){var imgs=div.getElementsByTagName("img"),orgSrc;for(var i=0,img;img=imgs[i++];){if(orgSrc=img.getAttribute("orgSrc")){img.src=orgSrc;img.removeAttribute("orgSrc")}}var as=div.getElementsByTagName("a");for(var i=0,ai;ai=as[i++];i++){if(ai.getAttribute("data_ue_src")){ai.setAttribute("href",ai.getAttribute("data_ue_src"))}}}function setValue(form,editor){var textarea;if(editor.textarea){if(utils.isString(editor.textarea)){for(var i=0,ti,tis=domUtils.getElementsByTagName(form,"textarea");ti=tis[i++];){if(ti.id=="ueditor_textarea_"+editor.options.textarea){textarea=ti;break}}}else{textarea=editor.textarea}}if(!textarea){form.appendChild(textarea=domUtils.creElm(document,"textarea",{name:editor.options.textarea,id:"ueditor_textarea_"+editor.options.textarea,style:"display:none"}))}textarea.value=editor.options.allHtmlEnabled?editor.getAllHtml():editor.getContent(null,null,true)}var Editor=UE.Editor=function(options){var me=this;me.uid=uid++;EventBase.call(me);me.commands={};me.options=utils.extend(options||{},UEDITOR_CONFIG,true);me.shortcutkeys={};me.inputRules=[];me.outputRules=[];me.setOpt({isShow:true,initialContent:"",autoClearinitialContent:false,textarea:"editorValue",focus:false,minFrameHeight:320,autoClearEmptyNode:true,fullscreen:false,readonly:false,zIndex:0,imagePopup:true,enterTag:"p",pageBreakTag:"_baidu_page_break_tag_",customDomain:false,lang:"zh-cn",langPath:me.options.UEDITOR_HOME_URL+"/js/comm/ueditor/",allHtmlEnabled:false});UE.instants["ueditorInstant"+me.uid]=me;for(var pi in UE.plugins){UE.plugins[pi].call(me)}me.langIsReady=true;me.fireEvent("langReady")};Editor.prototype={ready:function(fn){var me=this;if(fn){me.isReady?fn.apply(me):me.addListener("ready",fn)}},setOpt:function(key,val){var obj={};if(utils.isString(key)){obj[key]=val}else{obj=key}utils.extend(this.options,obj,true)},destroy:function(){var me=this;me.fireEvent("destroy");me.container.innerHTML="";domUtils.remove(me.container);for(var p in me){if(me.hasOwnProperty(p)){delete this[p]}}},addshortcutkey:function(cmd,keys){var obj={};if(keys){obj[cmd]=keys}else{obj=cmd}utils.extend(this.shortcutkeys,obj)},render:function(container){var me=this,options=me.options;if(container.constructor===String){container=document.getElementById(container)}if(container){var useBodyAsViewport=ie&&browser.version<9,html=(ie&&browser.version<9?"":"<!DOCTYPE html>")+"<html xmlns='http://www.w3.org/1999/xhtml'"+(!useBodyAsViewport?" class='view'":"")+"><head>"+(options.iframeCssUrl?"<link rel='stylesheet' type='text/css' href='"+utils.unhtml(options.iframeCssUrl)+"'/>":"")+"<style type='text/css'>.selectTdClass{background-color:#3399FF !important;}table.noBorderTable td{border:1px dashed #ddd !important}table{clear:both;border-collapse:collapse;word-break:break-all;}.pagebreak{display:block;clear:both !important;cursor:default !important;width: 100% !important;margin:0;}.anchorclass{background: url('"+me.options.UEDITOR_HOME_URL+"themes/default/images/anchor.gif') no-repeat scroll left center transparent;border: 1px dotted #0000FF;cursor: auto;display: inline-block;height: 16px;width: 15px;}.view{padding:0;word-wrap:break-word;cursor:text;height:100%;}\nbody{margin:8px;font-family:'宋体';font-size:12px;background-color:#F4F4F4}li{clear:both}p{margin:0;padding:0;outline:0;border:0;line-height:1.8;}img{vertical-align:top;}"+ +(options.initialStyle||"")+"</style></head><body"+(useBodyAsViewport?" class='view'":"")+"></body>";if(options.customDomain&&document.domain!=location.hostname){html+="<script id='ueditorInstant'>window.parent.UE.instants['ueditorInstant"+me.uid+"']._setup(document);<\/script></html>";container.appendChild(domUtils.creElm(document,"iframe",{id:"baidu_editor_"+me.uid,width:"100%",height:"100%",frameborder:"0",src:'javascript:void(function(){document.open();document.domain="'+document.domain+'";document.write("'+html+'");document.close();}())'}))}else{container.innerHTML='<iframe id="baidu_editor_'+this.uid+'"width="100%" height="100%" scroll="no" frameborder="0" ></iframe>';var doc=container.firstChild.contentWindow.document;var _contentWin=container.firstChild.contentWindow;!browser.webkit&&doc.open();doc.write(html+"</html>");!browser.webkit&&doc.close();me._setup(doc,_contentWin,container)}container.style.overflow="hidden"}},_setup:function(doc,_contentWin,container){var me=this,options=me.options;if(ie){doc.body.disabled=true;doc.body.contentEditable=true;doc.body.disabled=false}else{doc.body.contentEditable=true;doc.body.spellcheck=false}if(doc.getElementById("ueditorInstant")){doc.getElementById("ueditorInstant").outerHTML=""}me.document=doc;me.window=doc.defaultView||doc.parentWindow;me.iframe=me.window.frameElement;me.body=doc.body;me.setHeight(options.minFrameHeight);me.selection=new dom.Selection(doc);var geckoSel;if(browser.gecko&&(geckoSel=this.selection.getNative())){geckoSel.removeAllRanges()}this._initEvents();if(options.initialContent){if(options.autoClearinitialContent){var oldExecCommand=me.execCommand;me.execCommand=function(){me.fireEvent("firstBeforeExecCommand");oldExecCommand.apply(me,arguments)};this.setDefaultContent(options.initialContent)}else{this.setContent(options.initialContent,false,true)}if(typeof options.initComplete=="function"){if(options.openHoverImage){options.initComplete.call(me)}else{options.initComplete()}}if(typeof options.initHoverStyle=="function"){if(options.openSetLinkStyle){options.initHoverStyle.call(me)}else{options.initHoverStyle()}}}for(var form=this.iframe.parentNode;!domUtils.isBody(form);form=form.parentNode){if(form.tagName=="FORM"){domUtils.on(form,"submit",function(){setValue(this,me)});break}}if(domUtils.isEmptyNode(me.body)){me.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>"}if(options.focus){setTimeout(function(){me.focus();!me.options.autoClearinitialContent&&me._selectionChange()})}if(!me.container){me.container=this.iframe.parentNode}if(options.fullscreen&&me.ui){me.ui.setFullScreen(true)}me.isReady=1;me.fireEvent("ready");if(!browser.ie){domUtils.on(me.window,["blur","focus"],function(e){if(e.type=="blur"){me._bakRange=me.selection.getRange();try{me.selection.getNative().removeAllRanges()}catch(e){}}else{try{me._bakRange&&me._bakRange.select()}catch(e){}}})}if(browser.gecko&&browser.version<=10902){me.body.contentEditable=false;setTimeout(function(){me.body.contentEditable=true},100);setInterval(function(){me.body.style.height=me.iframe.offsetHeight-20+"px"},100)}!options.isShow&&me.setHide();options.readonly&&me.setDisabled();domUtils.on(doc,"keydown",function(evt){if(typeof me.options.ueditorChangeEvent=="function"){me.options.ueditorChangeEvent()}});if(me.options.ueditorEncapsulationEvent){domUtils.on(doc,me.options.ueditorEncapsulationEvent.operation,function(evt){if(typeof me.options.ueditorEncapsulationEvent.eventFun=="function"){me.options.ueditorEncapsulationEvent.eventFun()}})}domUtils.on(doc,"click",function(evt){if($("#pasteImageTipsDiv")){$("#pasteImageTipsDiv").remove()}});if(!_contentWin){return}if(/chrome\/(\d+\.\d)/ig.test(navigator.appVersion)&&me.options.isPasteImage){var version=/chrome\/(\d+\.\d)/ig.exec(navigator.appVersion)[0];var versionNum=version.substring(7,version.length);if(/chrome\/(\d+\.\d)/ig.test(version)&&versionNum>=13){var browserHint=function(){if(!$.cookie("_ueditor_closeTip")){var top=$(_contentWin.parent.document.body).height()-$(_contentWin.document.body).height();var pasteImageDiv=["<div id='pasteImageTipsDiv'>","<div class='closeTipsDiv' contentEditable='false'>×</div>","<div class='closeTipsDiv' contentEditable='false' style='width: 50px;'><a>我知道了</a></div>","您的浏览器支持在编辑区中直接粘贴并上传本地图片","</div>"];$(container.firstChild.parentNode).prepend(pasteImageDiv.join(""));$(".closeTipsDiv").live("click",function(){$("#pasteImageTipsDiv").remove();$.cookie("_ueditor_closeTip","true",{expires:365,path:"/"})})}}()}}_contentWin.localImageDiv=function(img){src=img.getAttribute("word_img");var localDiv=["<div id='xhe_bigShowImageNote' style='width:100%;height:100%;position: absolute ;border-radius: 5px;background-color:black;z-index:9999;cursor: default;filter: alpha(opacity=50); opacity:0.5;'>","</div><div id='xhe_showImageNote' style='font-size: 12px;margin:0 auto;display: block;border-radius: 8px;position: absolute; width: 440px;top: 35%;left:35%;z-index:10000;background-color:#eee;padding-top: 15px;padding-left:15px; color:#000;-webkit-box-shadow:5px 5px 20px #000;-moz-box-shadow:5px 5px 20px #000;-ms-box-shadow:5px 5px 20px #000;-o-box-shadow:5px 5px 20px #000;box-shadow:5px 5px 20px #000;'>","<div>  <div style='margin-top:5px' onselectstart='return false;'>目前无法直接从文档（如word）中粘贴图片，请通过以下方法上传图片：<br /></div>","<div style='margin-top:10px' onselectstart='return false;'>方法一：在文档中将该图片另存为本地图片，再点击上传按钮<span class='xhe_showImageNoteTag' style='background:url("+me.options.UEDITOR_HOME_URL+"/image/comm/ueditor/images/menu/icons.gif) no-repeat 20px 20px; display: inline-block;vertical-align: middle;width: 20px;height: 20px;background-position: -420px 0 !important;'></span>把图片上传。<br /></div>","<div style='margin-top:5px' onselectstart='return false;'>方法二：直接点击上传按钮<span class='xhe_showImageNoteTag' style='background:url("+me.options.UEDITOR_HOME_URL+"/image/comm/ueditor/images/menu/icons.gif) no-repeat 20px 20px; display: inline-block;vertical-align: middle;width: 20px;height: 20px;background-position: -420px 0 !important;' ></span>，在选择文件框的“文件名”中，粘贴以下路径：</div>","<div class='xhe_srcStyle' style='color:red; font-size:13px;margin-top: 5px;margin-bottom: 10px;word-wrap: break-word; margin-right: 10px;word-break: normal;'><p>"+src+"</p></div>","<div style='margin-bottom:15px;'  onselectstart='return false;'>如下图所示：<br /></div>","<div><span class='xhe_showImageExample' style='background:url("+me.options.UEDITOR_HOME_URL+"/image/comm/ueditor/images/menu/showImageExam1.png) no-repeat;margin-left: 20px;width:370px;height:70px; display:block'></span></div>","</div>","<div id='xhe_cancelImageDiv' style=' width:100%; height:10%'>","<input type='button' class='xhe_spanCancel' value='关闭' style='margin-right: 45% ;margin-right: 45%;margin-bottom: 15px;margin-top: 30px;*margin-bottom: 10px;text-decoration: none;cursor: pointer;float: right;width: 45px;height: 25px;text-align: center;' />","</div>","</div>"];container.parentNode.parentNode.style.position="absolute";$(_contentWin.parent.parent.document.body).append(localDiv.join(""));$("#xhe_bigShowImageNote").css("height",_contentWin.parent.document.body.scrollHeight+"px");for(var i=0;i<_contentWin.parent.document.getElementsByTagName("iframe").length;i++){if(_contentWin.parent.document.getElementsByTagName("iframe")[i].contentWindow===_contentWin){$("#xhe_showImageNote").css("top",$(_contentWin.parent.document.getElementsByTagName("iframe")[i]).offset().top+"px")}}};$(_contentWin.parent.parent.document.body).find(".xhe_spanCancel").live("click",function(){$(_contentWin.parent.parent.document.body).find("#xhe_bigShowImageNote").remove();$(_contentWin.parent.parent.document.body).find("#xhe_showImageNote").remove()})},sync:function(formId){var me=this,form=formId?document.getElementById(formId):domUtils.findParent(me.iframe.parentNode,function(node){return node.tagName=="FORM"},true);form&&setValue(form,me)},setHeight:function(height){if(height!==parseInt(this.iframe.parentNode.style.height)){this.iframe.parentNode.style.height=height+"px"}this.document.body.style.height=height-20+"px"},getContent1:function(cmd,fn,notSetCursor,ignoreBlank,formatter){var me=this;if(cmd&&utils.isFunction(cmd)){fn=cmd;cmd=""}if(fn?!fn():!this.hasContents()){return""}me.fireEvent("beforegetcontent");var root=UE.htmlparser(me.body.innerHTML,ignoreBlank);me.filterOutputRule(root);me.fireEvent("aftergetcontent",cmd);return root.toHtml(formatter)},getContent:function(cmd,fn,isPreview){var me=this;if(cmd&&utils.isFunction(cmd)){fn=cmd;cmd=""}var reg=new RegExp(domUtils.fillChar,"g"),html=me.body.innerHTML.replace(reg,"").replace(/>[\t\r\n]*?</g,"><");me.fireEvent("aftergetcontent",cmd);if(me.serialize){var node=me.serialize.parseHTML(html);node=me.serialize.transformOutput(node);html=me.serialize.toHTML(node)}if(ie&&isPreview){html=html.replace(/<p>\s*?<\/p>/g,"<p>&nbsp;</p>")}else{html=html.replace(/(&nbsp;)+/g,function(s){for(var i=0,str=[],l=s.split(";").length-1;i<l;i++){str.push(i%2==0?" ":"&nbsp;")}return str.join("")});html=html.replace(/<p>\s*?<\/p>/g,"<p>&nbsp;</p>")}html=html==="<p><br /></p>"?"":html;html=html==="<p>&nbsp;</p>"?"":html;return html},getAllHtml:function(){var me=this,headHtml={html:""},html="";me.fireEvent("getAllHtml",headHtml);return"<html><head>"+(me.options.charset?'<meta http-equiv="Content-Type" content="text/html; charset='+me.options.charset+'"/>':"")+me.document.getElementsByTagName("head")[0].innerHTML+headHtml.html+"</head><body "+(ie&&browser.version<9?'class="view"':"")+">"+me.getContent(null,null,true)+"</body></html>"},getPlainTxt:function(){var reg=new RegExp(domUtils.fillChar,"g"),html=this.body.innerHTML.replace(/[\n\r]/g,"");html=html.replace(/<(p|div)[^>]*>(<br\/?>|&nbsp;)<\/\1>/gi,"\n").replace(/<br\/?>/gi,"\n").replace(/<[^>/]+>/g,"").replace(/(\n)?<\/([^>]+)>/g,function(a,b,c){return dtd.$block[c]?"\n":b?b:""});return html.replace(reg,"").replace(/\u00a0/g," ").replace(/&nbsp;/g," ")},getContentTxt:function(){var reg=new RegExp(domUtils.fillChar,"g"),bodyHtml;if(UE.plugins.source.sourceMode&&UE.plugins.source.getContent){bodyHtml=UE.plugins.source.getContent();bodyHtml=bodyHtml.replace(/(<([^>]+)>)/ig,"").replace(/&nbsp;/g,"")}else{bodyHtml=this.body[browser.ie?"innerText":"textContent"]}return bodyHtml.replace(reg,"").replace(/\u00a0/g," ")},setContent:function(html,isAppendTo,notFireSelectionchange){var me=this;me.fireEvent("beforesetcontent",html);var root=UE.htmlparser(html);me.filterInputRule(root);html=root.toHtml();me.body.innerHTML=(isAppendTo?me.body.innerHTML:"")+html;function isCdataDiv(node){return node.tagName=="DIV"&&node.getAttribute("cdata_tag")}if(me.options.enterTag=="p"){var child=this.body.firstChild,tmpNode;if(!child||child.nodeType==1&&(dtd.$cdata[child.tagName]||isCdataDiv(child)||domUtils.isCustomeNode(child))&&child===this.body.lastChild){this.body.innerHTML="<p>"+(browser.ie?"&nbsp;":"<br/>")+"</p>"+this.body.innerHTML}else{var p=me.document.createElement("p");while(child){while(child&&(child.nodeType==3||child.nodeType==1&&dtd.p[child.tagName]&&!dtd.$cdata[child.tagName])){tmpNode=child.nextSibling;p.appendChild(child);child=tmpNode}if(p.firstChild){if(!child){me.body.appendChild(p);break}else{child.parentNode.insertBefore(p,child);p=me.document.createElement("p")}}child=child.nextSibling}}}me.fireEvent("aftersetcontent");me.fireEvent("contentchange");!notFireSelectionchange&&me._selectionChange();me._bakRange=me._bakIERange=me._bakNativeRange=null;var geckoSel;if(browser.gecko&&(geckoSel=this.selection.getNative())){geckoSel.removeAllRanges()}if(me.options.autoSyncData){me.form&&setValue(me.form,me)}},focus:function(toEnd){try{var me=this,rng=me.selection.getRange();if(toEnd){rng.setStartAtLast(me.body.lastChild).setCursor(false,true)}else{rng.select(true)}}catch(e){}},_initEvents:function(){var me=this,doc=me.document,win=me.window;me._proxyDomEvent=utils.bind(me._proxyDomEvent,me);domUtils.on(doc,["click","contextmenu","mousedown","keydown","keyup","keypress","mouseup","mouseover","mouseout","selectstart"],me._proxyDomEvent);domUtils.on(win,["focus","blur"],me._proxyDomEvent);domUtils.on(doc,["mouseup","keydown"],function(evt){if(evt.type=="keydown"&&(evt.ctrlKey||evt.metaKey||evt.shiftKey||evt.altKey)){return}if(evt.button==2){return}me._selectionChange(250,evt)});var innerDrag=0,source=browser.ie?me.body:me.document,dragoverHandler;domUtils.on(source,"dragstart",function(){innerDrag=1});domUtils.on(source,browser.webkit?"dragover":"drop",function(){return browser.webkit?function(){clearTimeout(dragoverHandler);dragoverHandler=setTimeout(function(){if(!innerDrag){var sel=me.selection,range=sel.getRange();if(range){var common=range.getCommonAncestor();if(common&&me.serialize){var f=me.serialize,node=f.filter(f.transformInput(f.parseHTML(f.word(common.innerHTML))));common.innerHTML=f.toHTML(node)}}}innerDrag=0},200)}:function(e){if(!innerDrag){e.preventDefault?e.preventDefault():(e.returnValue=false)}innerDrag=0}}())},_proxyDomEvent:function(evt){return this.fireEvent(evt.type.replace(/^on/,""),evt)},_selectionChange:function(delay,evt){var me=this;var hackForMouseUp=false;var mouseX,mouseY;if(browser.ie&&browser.version<9&&evt&&evt.type=="mouseup"){var range=this.selection.getRange();if(!range.collapsed){hackForMouseUp=true;mouseX=evt.clientX;mouseY=evt.clientY}}clearTimeout(_selectionChangeTimer);_selectionChangeTimer=setTimeout(function(){if(!me.selection.getNative()){return}var ieRange;if(hackForMouseUp&&me.selection.getNative().type=="None"){ieRange=me.document.body.createTextRange();try{ieRange.moveToPoint(mouseX,mouseY)}catch(ex){ieRange=null}}var bakGetIERange;if(ieRange){bakGetIERange=me.selection.getIERange;me.selection.getIERange=function(){return ieRange}}me.selection.cache();if(bakGetIERange){me.selection.getIERange=bakGetIERange}if(me.selection._cachedRange&&me.selection._cachedStartElement){me.fireEvent("beforeselectionchange");me.fireEvent("selectionchange",!!evt);me.fireEvent("afterselectionchange");me.selection.clear()}},delay||50)},_callCmdFn:function(fnName,args){var cmdName=args[0].toLowerCase(),cmd,cmdFn;cmd=this.commands[cmdName]||UE.commands[cmdName];cmdFn=cmd&&cmd[fnName];if((!cmd||!cmdFn)&&fnName=="queryCommandState"){return 0}else{if(cmdFn){return cmdFn.apply(this,args)}}},execCommand:function(cmdName){cmdName=cmdName.toLowerCase();var me=this,result,cmd=me.commands[cmdName]||UE.commands[cmdName];if(!cmd||!cmd.execCommand){return}if(!cmd.notNeedUndo&&!me.__hasEnterExecCommand){me.__hasEnterExecCommand=true;if(me.queryCommandState(cmdName)!=-1){me.fireEvent("beforeexeccommand",cmdName);result=this._callCmdFn("execCommand",arguments);me.fireEvent("afterexeccommand",cmdName)}me.__hasEnterExecCommand=false}else{result=this._callCmdFn("execCommand",arguments)}me._selectionChange();return result},queryCommandState:function(cmdName){return this._callCmdFn("queryCommandState",arguments)},pasteChoiceImage:function(result){if(typeof this.options.ueditorChangeEvent=="function"){this.options.ueditorChangeEvent()}this.execCommand("inserthtml",result,true);this.focus()},pasteChoiceMp4:function(result){if(typeof this.options.ueditorChangeEvent=="function"){this.options.ueditorChangeEvent()}this.execCommand("inserthtml",result,true);this.focus()},pasteChoiceFlash:function(result){if(typeof this.options.ueditorChangeEvent=="function"){this.options.ueditorChangeEvent()}var arrResult=result.split(" ");arrResult.splice(0,1,'<embed wmode="transparent"');result=arrResult.join(" ");this.execCommand("inserthtml",result,true);this.focus()},queryCommandValue:function(cmdName){return this._callCmdFn("queryCommandValue",arguments)},hasContents:function(tags){if(tags){for(var i=0,ci;ci=tags[i++];){if(this.document.getElementsByTagName(ci).length>0){return true}}}if(!domUtils.isEmptyBlock(this.body)){return true}tags=["div"];for(i=0;ci=tags[i++];){var nodes=domUtils.getElementsByTagName(this.document,ci);for(var n=0,cn;cn=nodes[n++];){if(domUtils.isCustomeNode(cn)){return true}}}return false},reset:function(){this.fireEvent("reset")},setEnabled:function(){var me=this,range;if(me.body.contentEditable=="false"){me.body.contentEditable=true;range=me.selection.getRange();try{range.moveToBookmark(me.lastBk);delete me.lastBk}catch(e){range.setStartAtFirst(me.body).collapse(true)}range.select(true);if(me.bkqueryCommandState){me.queryCommandState=me.bkqueryCommandState;delete me.bkqueryCommandState}me.fireEvent("selectionchange")}},setDisabled:function(exclude){var me=this;exclude=exclude?utils.isArray(exclude)?exclude:[exclude]:[];if(me.body.contentEditable=="true"){if(!me.lastBk){me.lastBk=me.selection.getRange().createBookmark(true)}me.body.contentEditable=false;me.bkqueryCommandState=me.queryCommandState;me.queryCommandState=function(type){if(utils.indexOf(exclude,type)!=-1){return me.bkqueryCommandState.apply(me,arguments)}return -1};me.fireEvent("selectionchange")}},setDefaultContent:function(){function clear(){var me=this;if(me.document.getElementById("initContent")){me.document.body.innerHTML="<p>"+(ie?"":"<br/>")+"</p>";var range=me.selection.getRange();me.removeListener("firstBeforeExecCommand",clear);me.removeListener("focus",clear);setTimeout(function(){range.setStart(me.document.body.firstChild,0).collapse(true).select(true);me._selectionChange()})}}return function(cont){var me=this;me.document.body.innerHTML='<p id="initContent">'+cont+"</p>";if(browser.ie&&browser.version<7){replaceSrc(me.document.body)}me.addListener("firstBeforeExecCommand",clear);me.addListener("focus",clear)}}(),setShow:function(){var me=this,range=me.selection.getRange();if(me.container.style.display=="none"){try{range.moveToBookmark(me.lastBk);delete me.lastBk}catch(e){range.setStartAtFirst(me.body).collapse(true)}range.select(true);me.container.style.display=""}},setHide:function(){var me=this;if(!me.lastBk){me.lastBk=me.selection.getRange().createBookmark(true)}me.container.style.display="none"},getLang:function(path){var lang=UE.I18N[this.options.lang];path=(path||"").split(".");for(var i=0,ci;ci=path[i++];){lang=lang[ci];if(!lang){break}}return lang},addInputRule:function(rule){this.inputRules.push(rule)},filterInputRule:function(root){for(var i=0,ci;ci=this.inputRules[i++];){ci.call(this,root)}},addOutputRule:function(rule){this.outputRules.push(rule)},filterOutputRule:function(root){for(var i=0,ci;ci=this.outputRules[i++];){ci.call(this,root)}}};utils.inherits(Editor,EventBase)})();UE.ajax=function(){return{request:function(url,ajaxOptions){var ajaxRequest=creatAjaxRequest(),timeIsOut=false,defaultAjaxOptions={method:"POST",timeout:5000,async:true,data:{},onsuccess:function(){},onerror:function(){}};if(typeof url==="object"){ajaxOptions=url;url=ajaxOptions.url}if(!ajaxRequest||!url){return}var ajaxOpts=ajaxOptions?utils.extend(defaultAjaxOptions,ajaxOptions):defaultAjaxOptions;var submitStr=json2str(ajaxOpts);if(!utils.isEmptyObject(ajaxOpts.data)){submitStr+=(submitStr?"&":"")+json2str(ajaxOpts.data)}var timerID=setTimeout(function(){if(ajaxRequest.readyState!=4){timeIsOut=true;ajaxRequest.abort();clearTimeout(timerID)}},ajaxOpts.timeout);var method=ajaxOpts.method.toUpperCase();var str=url+(url.indexOf("?")==-1?"?":"&")+(method=="POST"?"":submitStr+"&noCache="+ +new Date);ajaxRequest.open(method,str,ajaxOpts.async);ajaxRequest.onreadystatechange=function(){if(ajaxRequest.readyState==4){if(!timeIsOut&&ajaxRequest.status==200){ajaxOpts.onsuccess(ajaxRequest)}else{ajaxOpts.onerror(ajaxRequest)}}};if(method=="POST"){ajaxRequest.setRequestHeader("Content-Type","application/x-www-form-urlencoded");ajaxRequest.send(submitStr)}else{ajaxRequest.send(null)}}};function json2str(json){var strArr=[];for(var i in json){if(i=="method"||i=="timeout"||i=="async"){continue}if(!((typeof json[i]).toLowerCase()=="function"||(typeof json[i]).toLowerCase()=="object")){strArr.push(encodeURIComponent(i)+"="+encodeURIComponent(json[i]))}}return strArr.join("&")}function creatAjaxRequest(){var xmlHttp=null;if(window.XMLHttpRequest){xmlHttp=new XMLHttpRequest()}else{try{xmlHttp=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{xmlHttp=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}}return xmlHttp}}();(function(){var uNode=UE.uNode=function(obj){this.type=obj.type;this.data=obj.data;this.tagName=obj.tagName;this.parentNode=obj.parentNode;this.attrs=obj.attrs||{};this.children=obj.children};var notTransAttrs={href:1,src:1,_src:1,_href:1,cdata_data:1};var notTransTagName={style:1,script:1};var indentChar="    ",breakChar="\n";function insertLine(arr,current,begin){arr.push(breakChar);return current+(begin?1:-1)}function insertIndent(arr,current){for(var i=0;i<current;i++){arr.push(indentChar)}}uNode.createElement=function(html){if(/[<>]/.test(html)){return UE.htmlparser(html).children[0]}else{return new uNode({type:"element",children:[],tagName:html})}};uNode.createText=function(data,noTrans){return new UE.uNode({type:"text",data:noTrans?data:utils.unhtml(data||"")})};function nodeToHtml(node,arr,formatter,current){switch(node.type){case"root":for(var i=0,ci;ci=node.children[i++];){if(formatter&&ci.type=="element"&&!dtd.$inlineWithA[ci.tagName]&&i>1){insertLine(arr,current,true);insertIndent(arr,current)}nodeToHtml(ci,arr,formatter,current)}break;case"text":isText(node,arr);break;case"element":isElement(node,arr,formatter,current);break;case"comment":isComment(node,arr,formatter)}return arr}function isText(node,arr){if(node.parentNode.tagName=="pre"){arr.push(node.data)}else{arr.push(notTransTagName[node.parentNode.tagName]?utils.html(node.data):node.data.replace(/[ ]{2}/g," &nbsp;"))}}function isElement(node,arr,formatter,current){var attrhtml="";if(node.attrs){attrhtml=[];var attrs=node.attrs;for(var a in attrs){attrhtml.push(a+(attrs[a]!==undefined?'="'+(notTransAttrs[a]?utils.html(attrs[a]).replace(/["]/g,function(a){return"&quot;"}):utils.unhtml(attrs[a]))+'"':""))}attrhtml=attrhtml.join(" ")}arr.push("<"+node.tagName+(attrhtml?" "+attrhtml:"")+(dtd.$empty[node.tagName]?"/":"")+">");if(formatter&&!dtd.$inlineWithA[node.tagName]&&node.tagName!="pre"){if(node.children&&node.children.length){current=insertLine(arr,current,true);insertIndent(arr,current)}}if(node.children&&node.children.length){for(var i=0,ci;ci=node.children[i++];){if(formatter&&ci.type=="element"&&!dtd.$inlineWithA[ci.tagName]&&i>1){insertLine(arr,current);insertIndent(arr,current)}nodeToHtml(ci,arr,formatter,current)}}if(!dtd.$empty[node.tagName]){if(formatter&&!dtd.$inlineWithA[node.tagName]&&node.tagName!="pre"){if(node.children&&node.children.length){current=insertLine(arr,current);insertIndent(arr,current)}}arr.push("</"+node.tagName+">")}}function isComment(node,arr){arr.push("<!--"+node.data+"-->")}function getNodeById(root,id){var node;if(root.type=="element"&&root.getAttr("id")==id){return root}if(root.children&&root.children.length){for(var i=0,ci;ci=root.children[i++];){if(node=getNodeById(ci,id)){return node}}}}function getNodesByTagName(node,tagName,arr){if(node.type=="element"&&node.tagName==tagName){arr.push(node)}if(node.children&&node.children.length){for(var i=0,ci;ci=node.children[i++];){getNodesByTagName(ci,tagName,arr)}}}function nodeTraversal(root,fn){if(root.children&&root.children.length){for(var i=0,ci;ci=root.children[i];){nodeTraversal(ci,fn);if(ci.parentNode){if(ci.children&&ci.children.length){fn(ci)}if(ci.parentNode){i++}}}}else{fn(root)}}uNode.prototype={toHtml:function(formatter){var arr=[];nodeToHtml(this,arr,formatter,0);return arr.join("")},innerHTML:function(htmlstr){if(this.type!="element"||dtd.$empty[this.tagName]){return this}if(utils.isString(htmlstr)){if(this.children){for(var i=0,ci;ci=this.children[i++];){ci.parentNode=null}}this.children=[];var tmpRoot=UE.htmlparser(htmlstr);for(var i=0,ci;ci=tmpRoot.children[i++];){this.children.push(ci);ci.parentNode=this}return this}else{var tmpRoot=new UE.uNode({type:"root",children:this.children});return tmpRoot.toHtml()}},innerText:function(textStr,noTrans){if(this.type!="element"||dtd.$empty[this.tagName]){return this}if(textStr){if(this.children){for(var i=0,ci;ci=this.children[i++];){ci.parentNode=null}}this.children=[];this.appendChild(uNode.createText(textStr,noTrans));return this}else{return this.toHtml().replace(/<[^>]+>/g,"")}},getData:function(){if(this.type=="element"){return""}return this.data},firstChild:function(){return this.children?this.children[0]:null},lastChild:function(){return this.children?this.children[this.children.length-1]:null},previousSibling:function(){var parent=this.parentNode;for(var i=0,ci;ci=parent.children[i];i++){if(ci===this){return i==0?null:parent.children[i-1]}}},nextSibling:function(){var parent=this.parentNode;for(var i=0,ci;ci=parent.children[i++];){if(ci===this){return parent.children[i]}}},replaceChild:function(target,source){if(this.children){if(target.parentNode){target.parentNode.removeChild(target)}for(var i=0,ci;ci=this.children[i];i++){if(ci===source){this.children.splice(i,1,target);source.parentNode=null;target.parentNode=this;return target}}}},appendChild:function(node){if(this.type=="root"||(this.type=="element"&&!dtd.$empty[this.tagName])){if(!this.children){this.children=[]}if(node.parentNode){node.parentNode.removeChild(node)}for(var i=0,ci;ci=this.children[i];i++){if(ci===node){this.children.splice(i,1);break}}this.children.push(node);node.parentNode=this;return node}},insertBefore:function(target,source){if(this.children){if(target.parentNode){target.parentNode.removeChild(target)}for(var i=0,ci;ci=this.children[i];i++){if(ci===source){this.children.splice(i,0,target);target.parentNode=this;return target}}}},insertAfter:function(target,source){if(this.children){if(target.parentNode){target.parentNode.removeChild(target)}for(var i=0,ci;ci=this.children[i];i++){if(ci===source){this.children.splice(i+1,0,target);target.parentNode=this;return target}}}},removeChild:function(node,keepChildren){if(this.children){for(var i=0,ci;ci=this.children[i];i++){if(ci===node){this.children.splice(i,1);ci.parentNode=null;if(keepChildren&&ci.children&&ci.children.length){for(var j=0,cj;cj=ci.children[j];j++){this.children.splice(i+j,0,cj);cj.parentNode=this}}return ci}}}},getAttr:function(attrName){return this.attrs&&this.attrs[attrName.toLowerCase()]},setAttr:function(attrName,attrVal){if(!attrName){delete this.attrs;return}if(!this.attrs){this.attrs={}}if(utils.isObject(attrName)){for(var a in attrName){if(!attrName[a]){delete this.attrs[a]}else{this.attrs[a.toLowerCase()]=attrName[a]}}}else{if(!attrVal){delete this.attrs[attrName]}else{this.attrs[attrName.toLowerCase()]=attrVal}}},getIndex:function(){var parent=this.parentNode;for(var i=0,ci;ci=parent.children[i];i++){if(ci===this){return i}}return -1},getNodeById:function(id){var node;if(this.children&&this.children.length){for(var i=0,ci;ci=this.children[i++];){if(node=getNodeById(ci,id)){return node}}}},getNodesByTagName:function(tagNames){tagNames=utils.trim(tagNames).replace(/[ ]{2,}/g," ").split(" ");var arr=[],me=this;utils.each(tagNames,function(tagName){if(me.children&&me.children.length){for(var i=0,ci;ci=me.children[i++];){getNodesByTagName(ci,tagName,arr)}}});return arr},getStyle:function(name){var cssStyle=this.getAttr("style");if(!cssStyle){return""}var reg=new RegExp("(^|;)\\s*"+name+":([^;]+)","i");var match=cssStyle.match(reg);if(match&&match[0]){return match[2]}return""},setStyle:function(name,val){function exec(name,val){var reg=new RegExp("(^|;)\\s*"+name+":([^;]+;?)","gi");cssStyle=cssStyle.replace(reg,"$1");if(val){cssStyle=name+":"+utils.unhtml(val)+";"+cssStyle}}var cssStyle=this.getAttr("style");if(!cssStyle){cssStyle=""}if(utils.isObject(name)){for(var a in name){exec(a,name[a])}}else{exec(name,val)}this.setAttr("style",utils.trim(cssStyle))},traversal:function(fn){if(this.children&&this.children.length){nodeTraversal(this,fn)}return this}}})();var htmlparser=UE.htmlparser=function(htmlstr,ignoreBlank){var re_tag=/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)-->)|(?:([^\s\/>]+)\s*((?:(?:"[^"]*")|(?:'[^']*')|[^"'<>])*)\/?>))/g,re_attr=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g;var allowEmptyTags={b:1,code:1,i:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,span:1,sub:1,img:1,sup:1,font:1,big:1,small:1,iframe:1,a:1,br:1,pre:1};htmlstr=htmlstr.replace(new RegExp(domUtils.fillChar,"g"),"");if(!ignoreBlank){htmlstr=htmlstr.replace(new RegExp("[\\r\\t\\n"+(ignoreBlank?"":" ")+"]*</?(\\w+)\\s*(?:[^>]*)>[\\r\\t\\n"+(ignoreBlank?"":" ")+"]*","g"),function(a,b){if(b&&allowEmptyTags[b.toLowerCase()]){return a.replace(/(^[\n\r]+)|([\n\r]+$)/g,"")}return a.replace(new RegExp("^[\\r\\n"+(ignoreBlank?"":" ")+"]+"),"").replace(new RegExp("[\\r\\n"+(ignoreBlank?"":" ")+"]+$"),"")})}var uNode=UE.uNode,needParentNode={td:"tr",tr:["tbody","thead","tfoot"],tbody:"table",th:"tr",thead:"table",tfoot:"table",caption:"table",li:["ul","ol"],dt:"dl",dd:"dl",option:"select"},needChild={ol:"li",ul:"li"};function text(parent,data){if(needChild[parent.tagName]){var tmpNode=uNode.createElement(needChild[parent.tagName]);parent.appendChild(tmpNode);tmpNode.appendChild(uNode.createText(data));parent=tmpNode}else{parent.appendChild(uNode.createText(data))}}function element(parent,tagName,htmlattr){var needParentTag;if(needParentTag=needParentNode[tagName]){var tmpParent=parent,hasParent;while(tmpParent.type!="root"){if(utils.isArray(needParentTag)?utils.indexOf(needParentTag,tmpParent.tagName)!=-1:needParentTag==tmpParent.tagName){parent=tmpParent;hasParent=true;break}tmpParent=tmpParent.parentNode}if(!hasParent){parent=element(parent,utils.isArray(needParentTag)?needParentTag[0]:needParentTag)}}var elm=new uNode({parentNode:parent,type:"element",tagName:tagName.toLowerCase(),children:dtd.$empty[tagName]?null:[]});if(htmlattr){var attrs={},match;while(match=re_attr.exec(htmlattr)){attrs[match[1].toLowerCase()]=utils.unhtml(match[2]||match[3]||match[4])}elm.attrs=attrs}parent.children.push(elm);return dtd.$empty[tagName]?parent:elm}function comment(parent,data){parent.children.push(new uNode({type:"comment",data:data,parentNode:parent}))}var match,currentIndex=0,nextIndex=0;var root=new uNode({type:"root",children:[]});var currentParent=root;while(match=re_tag.exec(htmlstr)){currentIndex=match.index;try{if(currentIndex>nextIndex){text(currentParent,htmlstr.slice(nextIndex,currentIndex))}if(match[3]){currentParent=element(currentParent,match[3].toLowerCase(),match[4])}else{if(match[1]){if(currentParent.type!="root"){var tmpParent=currentParent;while(currentParent.type=="element"&&currentParent.tagName!=match[1].toLowerCase()){currentParent=currentParent.parentNode;if(currentParent.type=="root"){currentParent=tmpParent;throw"break"}}currentParent=currentParent.parentNode}}else{if(match[2]){comment(currentParent,match[2])}}}}catch(e){}nextIndex=re_tag.lastIndex}if(nextIndex<htmlstr.length){text(currentParent,htmlstr.slice(nextIndex))}return root};UE.commands.inserthtml={execCommand:function(command,html,notSerialize){var me=this,range,div;if(!html){return}range=me.selection.getRange();div=range.document.createElement("div");div.style.display="inline";var serialize=me.serialize;if(!notSerialize&&serialize){var node=serialize.parseHTML(html);node=serialize.transformInput(node);node=serialize.filter(node);html=serialize.toHTML(node)}div.innerHTML=utils.trim(html);if(!range.collapsed){range.deleteContents();if(range.startContainer.nodeType==1){var child=range.startContainer.childNodes[range.startOffset],pre;if(child&&domUtils.isBlockElm(child)&&(pre=child.previousSibling)&&domUtils.isBlockElm(pre)){range.setEnd(pre,pre.childNodes.length).collapse();while(child.firstChild){pre.appendChild(child.firstChild)}domUtils.remove(child)}}}var child,parent,pre,tmp,hadBreak=0,nextNode;if(range.inFillChar()){child=range.startContainer;range.setStartBefore(child).collapse(true);domUtils.remove(child)}while(child=div.firstChild){range.insertNode(child);nextNode=child.nextSibling;if(!hadBreak&&child.nodeType==domUtils.NODE_ELEMENT&&domUtils.isBlockElm(child)){parent=domUtils.findParent(child,function(node){return domUtils.isBlockElm(node)});if(parent&&parent.tagName.toLowerCase()!="body"&&!(dtd[parent.tagName][child.nodeName]&&child.parentNode===parent)){if(!dtd[parent.tagName][child.nodeName]){pre=parent}else{tmp=child.parentNode;while(tmp!==parent){pre=tmp;tmp=tmp.parentNode}}domUtils.breakParent(child,pre||tmp);var pre=child.previousSibling;domUtils.trimWhiteTextNode(pre);if(!pre.childNodes.length){domUtils.remove(pre)}if(!browser.ie&&(next=child.nextSibling)&&domUtils.isBlockElm(next)&&next.lastChild&&!domUtils.isBr(next.lastChild)){next.appendChild(me.document.createElement("br"))}hadBreak=1}}var next=child.nextSibling;if(!div.firstChild&&next&&domUtils.isBlockElm(next)){range.setStart(next,0).collapse(true);break}range.setEndAfter(child).collapse()}child=range.startContainer;if(nextNode&&domUtils.isBr(nextNode)){domUtils.remove(nextNode)}if(domUtils.isBlockElm(child)&&domUtils.isEmptyNode(child)){if(nextNode=child.nextSibling){domUtils.remove(child);if(nextNode.nodeType==1&&dtd.$block[nextNode.tagName]){range.setStart(nextNode,0).collapse(true).shrinkBoundary()}}else{child.innerHTML=browser.ie?domUtils.fillChar:"<br/>"}}range.select(true);setTimeout(function(){range=me.selection.getRange();range.scrollToView(me.autoHeightEnabled,me.autoHeightEnabled?domUtils.getXY(me.iframe).y:0);me.fireEvent("afterinserthtml")},200)}};UE.commands.autosubmit={execCommand:function(){var me=this,form=domUtils.findParentByTagName(me.iframe,"form",false);if(form){if(me.fireEvent("beforesubmit")===false){return}me.sync();form.submit()}}};UE.commands.horizontal={execCommand:function(cmdName){var me=this,hrStr="";if(me.queryCommandState(cmdName)!==-1){hrStr=("footerHrFunction" in me.options.outerFunction&&me.options.outerFunction.footerHrFunction())||"";me.execCommand("inserthtml","<hr "+hrStr+">");var range=me.selection.getRange(),start=range.startContainer;if(start.nodeType==1&&start.childNodes[range.startOffset]){var tmp;if(tmp=start.childNodes[range.startOffset-1]){if(tmp.nodeType==1&&tmp.tagName=="HR"){if(me.options.enterTag=="p"){tmp=me.document.createElement("p");range.insertNode(tmp);range.setStart(tmp,0).setCursor()}else{tmp=me.document.createElement("br");range.insertNode(tmp);range.setStartBefore(tmp).setCursor()}}}}return true}},queryCommandState:function(){return this.highlight||utils.findNode(this.selection.getStartElementPath(),"table")?-1:0}};UE.commands.zhspace={execCommand:function(cmdName){var me=this;if(me.queryCommandState(cmdName)!==-1){me.execCommand("inserthtml","　");return true}}};UE.commands.imagefloat={execCommand:function(cmd,align){var me=this,range=me.selection.getRange();if(!range.collapsed){var img=range.getClosedNode();if(!img){img=range.cloneRange().adjustmentBoundary().shrinkBoundary();img=img.startContainer}if(img&&(img.tagName=="IMG"||img.tagName=="EMBED"||img.tagName=="VIDEO")){var isHovImage=img.className.toLowerCase()==="hoverimage";switch(align){case"left":case"right":case"none":var pN=img.parentNode,tmpNode,pre,next;var isHovImage=img.className.toLowerCase()==="hoverimage";while(dtd.$inline[pN.tagName]||pN.tagName=="A"){pN=pN.parentNode}tmpNode=pN;if(tmpNode.tagName=="P"&&domUtils.getStyle(tmpNode,"text-align")=="center"){if(!domUtils.isBody(tmpNode)&&domUtils.getChildCount(tmpNode,function(node){return !domUtils.isBr(node)&&!domUtils.isWhitespace(node)})==1){pre=tmpNode.previousSibling;next=tmpNode.nextSibling;if(pre&&next&&pre.nodeType==1&&next.nodeType==1&&pre.tagName==next.tagName&&domUtils.isBlockElm(pre)){pre.appendChild(tmpNode.firstChild);while(next.firstChild){pre.appendChild(next.firstChild)}domUtils.remove(tmpNode);domUtils.remove(next)}else{domUtils.setStyle(tmpNode,"text-align","")}}range.selectNode(img).select()}if(isHovImage){domUtils.setStyle(img.parentNode,"float",align)}else{domUtils.setStyle(img,"float",align)}break;case"imageLeft":if(me.queryCommandValue("imagefloat")!="imageLeft"){operationImagePosition("left")}break;case"center":if(me.queryCommandValue("imagefloat")!="center"){operationImagePosition("center");if(isHovImage){me.editor.options.outerFunction.hoverChangeImage&&me.editor.options.outerFunction.hoverChangeImage(me.body)}}break;case"imageRight":if(me.queryCommandValue("imagefloat")!="imageRight"){operationImagePosition("right")}break}range.setStartAfter(img).setCursor(true)}}function operationImagePosition(pos){var isHovImage=img.className==="hoverImage";pN=img.parentNode;domUtils.setStyle(img,"float","none");tmpNode=img;while(pN&&domUtils.getChildCount(pN,function(node){return !domUtils.isBr(node)&&!domUtils.isWhitespace(node)})==1&&(dtd.$inline[pN.tagName]||pN.tagName=="A")){tmpNode=pN;pN=pN.parentNode}if(isHovImage){img.parentNode.setAttribute("id","hoverImageParentSpan")}range.setStartBefore(tmpNode).setCursor(false);pN=me.document.createElement("div");pN.appendChild(tmpNode);domUtils.setStyle(tmpNode,"float","");me.execCommand("insertHtml",'<p id="_img_parent_tmp" style="text-align:'+pos+'">'+pN.innerHTML+"</p>");tmpNode=me.document.getElementById("_img_parent_tmp");tmpNode.removeAttribute("id");tmpNode=tmpNode.firstChild;range.selectNode(tmpNode).select();next=tmpNode.parentNode.nextSibling;if(next&&domUtils.isEmptyNode(next)){domUtils.remove(next)}if(isHovImage){var nextChildrenSpans=next.getElementsByTagName("span");for(var i=0;i<nextChildrenSpans.length;i++){var spanElem=nextChildrenSpans[i];var hasHoverImage=spanElem.getElementsByClassName("J_hoverImage").length==1;if(hasHoverImage){domUtils.remove(spanElem)}}var tmpParentNode=me.document.getElementById("hoverImageParentSpan");domUtils.remove(tmpParentNode)}}},queryCommandValue:function(){var range=this.selection.getRange(),startNode,floatStyle;if(range.collapsed){return"none"}startNode=range.getClosedNode();if(!startNode){startNode=range.cloneRange().adjustmentBoundary().shrinkBoundary();startNode=startNode.startContainer}if(startNode&&startNode.nodeType==1&&(startNode.tagName=="IMG"||startNode.tagName=="EMBED"||startNode.tagName=="VIDEO")){floatStyle=domUtils.getComputedStyle(startNode,"float");if(floatStyle=="none"){floatStyle=domUtils.getComputedStyle(startNode.parentNode,"text-align");if(floatStyle=="center"){floatStyle="center"}else{if(floatStyle=="left"){floatStyle="imageLeft"}else{if(floatStyle=="right"){floatStyle="imageRight"}}}}return{left:1,right:1,center:1,imageLeft:1,imageRight:1}[floatStyle]?floatStyle:"none"}return"none"},queryCommandState:function(){if(this.highlight){return -1}var range=this.selection.getRange(),startNode;if(range.collapsed){return -1}startNode=range.getClosedNode();if(!startNode){startNode=range.cloneRange().adjustmentBoundary().shrinkBoundary();startNode=startNode.startContainer}if(startNode&&startNode.nodeType==1&&(startNode.tagName=="IMG"||startNode.tagName=="EMBED"||startNode.tagName=="VIDEO")){return 0}return -1}};UE.commands.insertimage={};UE.commands.indent={execCommand:function(){var me=this,value=me.queryCommandState("indent")?"0em":(me.options.indentValue||"2em");me.execCommand("Paragraph","p",{style:"text-indent:"+value})},queryCommandState:function(){if(this.highlight){return -1}var pN=utils.findNode(this.selection.getStartElementPath(),["p","h1","h2","h3","h4","h5","h6"]);return pN&&pN.style.textIndent&&parseInt(pN.style.textIndent)?1:0}};UE.commands.skypeservice={execCommand:function(cmd,me,cont){var isSkype=function(skyNumber){return true},header=function(str){var reg=/^[a-zA-Z]/;if(!reg.test(str)){return false}return true};var skyNumber=document.getElementById("xheSkype").value;var skyName=document.getElementById("xheNameSkype").value;var editor=me.editor,range=editor.selection.getRange(),skypeservice=range.collapsed?editor.queryCommandValue("link"):editor.selection.getStart(),skypeservice=domUtils.findParentByTagName(skypeservice,"a",true);if(skyName){skyName=Fai.encodeHtml(skyName)}var sHtml="<a skyNumber='"+skyNumber+"' skyName='"+skyName+"' href='skype:"+skyNumber+"?call'><img _hidetool='true' class='fk-xhe' src='"+me.editor.options.UEDITOR_HOME_URL+"/image/comm/ueditor/images/skype2.png' style='border:none;vertical-align: middle;' width='22' height='21' />"+((skyName==""||skyName==null)?skyNumber:skyName)+"</a>&nbsp;";if(skyNumber){if(isSkype(skyNumber)&&header(skyNumber)&&skyNumber.length>5&&skyNumber.length<33){if(skypeservice!=null){skypeservice.outerHTML=sHtml}else{me.editor.execCommand("inserthtml",sHtml,true)}me.popup.hide()}else{alert("您输入的Skype帐号格式不正确，请重新输入。")}}else{alert("请输入Skype帐号")}}};UE.commands.phoneservice={execCommand:function(cmd,me,cont){var isPhone=function(phoneNumber){var pattern=/((\d{20})|^((\d{5,20})|(\d{4}|\d{3})-(\d{4,14})|(\d{4}|\d{3})-(\d{4,14})-(\d{4}|\d{3}|\d{2}|\d{1})|(\d{4,14})-(\d{4}|\d{3}|\d{2}|\d{1}))$)/;return pattern.test(phoneNumber)};var phoneNumber=document.getElementById("xhePhoneNumber").value;var editor=me.editor,range=editor.selection.getRange(),phoneservice=range.collapsed?editor.queryCommandValue("link"):editor.selection.getStart(),phoneservice=domUtils.findParentByTagName(phoneservice,"a",true);if(phoneNumber){if(isPhone(phoneNumber)){var allHtml="<a phoneNumber='"+phoneNumber+"' href='tel:"+phoneNumber+"'>"+phoneNumber+"</a>&nbsp;";if(phoneservice!=null){phoneservice.outerHTML=allHtml}else{me.editor.execCommand("inserthtml",allHtml,true)}me.popup.hide()}else{alert("您输入的电话号码格式不正确，请重新输入。")}}else{alert("请输入电话号码")}}};UE.commands.msnservice={execCommand:function(cmd,me,cont){var isMail=function(msnNumber){var pattern=/^[a-zA-Z0-9_\-\.\+]+@[a-zA-Z0-9][a-zA-Z0-9_\-]*\.[a-zA-Z0-9\-][a-zA-Z0-9_\-\.]*[a-zA-Z0-9 ]$/;return pattern.test(msnNumber)};var msnNumber=document.getElementById("xheMSN").value;var msnName=document.getElementById("xheNameMSN").value;var editor=me.editor,range=editor.selection.getRange(),msnservice=range.collapsed?editor.queryCommandValue("link"):editor.selection.getStart(),msnservice=domUtils.findParentByTagName(msnservice,"a",true);if(msnName){msnName=Fai.encodeHtml(msnName)}var sHtml="<img _hidetool='true' class='fk-xhe' style='vertical-align: middle;' src='"+me.editor.options.UEDITOR_HOME_URL+"/image/comm/msn.gif' border='0'/>"+(msnName==""?msnNumber:msnName)+"";if(msnNumber){if(isMail(msnNumber)){var allHtml="<a _onlineSerivceMark='true' msnNumber='"+msnNumber+"' msnName='"+msnName+"' href='msnim:chat?contact="+msnNumber+"'>"+sHtml+"</a>&nbsp;";if(msnservice!=null){msnservice.outerHTML=allHtml}else{me.editor.execCommand("inserthtml",allHtml,true)}me.popup.hide()}else{alert("您输入的MSN帐号格式不正确，请重新输入。")}}else{alert("请输入MSN帐号")}}};UE.commands.qqservice={execCommand:function(cmd,me,cont){var isNumber=function(num){if(/[^\d]/.test(num)){return false}else{return true}};var qqNumber=document.getElementById("xheQQ").value;var qqName=document.getElementById("xheName").value;var qqState=document.getElementsByName("showQQstate"),qqStateValue;var qqStyle=document.getElementsByName("displayStyle"),qqStyleVlaue;var editor=me.editor,range=editor.selection.getRange(),xheQQ=document.getElementById("xheQQ"),xheName=document.getElementById("xheName"),qqservice=range.collapsed?editor.queryCommandValue("link"):editor.selection.getStart(),qqservice=domUtils.findParentByTagName(qqservice,"a",true);for(var i=0;i<qqStyle.length;i++){if(qqStyle[i].checked){qqStyleVlaue=qqStyle[i].value}}for(var i=0;i<qqState.length;i++){if(qqState[i].checked){qqStateValue=qqState[i].value}}if((qqStyleVlaue==4||qqStyleVlaue==45)&&qqName==""){}if(qqNumber){if(isNumber(qqNumber)&&qqNumber.length>4&&qqNumber.length<11){qqName=Fai.encodeHtml(qqName);var stillOnline=editor.options.UEDITOR_HOME_URL+"/image/comm/ueditor/images/menu/pa"+qqStyleVlaue+".gif",RTOnline="http://wpa.qq.com/pa?p=1:"+qqNumber+":"+qqStyleVlaue;var qqImg='<img _hidetool="true" class="fk-xhe" style="text-decoration:none;CURSOR: pointer;vertical-align: middle;" qqName="'+qqName+'" qqNumber="'+qqNumber+'"  border="0" SRC="'+(qqStateValue==1?RTOnline:stillOnline)+'" alt="'+qqName+'">&nbsp;';var qqLink="<a _onlineSerivceMark='true' qqStyleVlaue='"+qqStyleVlaue+"' qqStateValue='"+qqStateValue+"' qqName='"+qqName+"' qqNumber='"+qqNumber+"' href='http://wpa.qq.com/msgrd?v=3&uin="+qqNumber+"&site=qq&menu=yes' target='_blank' style='text-decoration:none;'>";qqName=qqName?qqName:qqNumber;var qqHtml=qqLink+qqImg+qqName+"</a>&nbsp;";if(qqservice!=null){qqservice.outerHTML=qqHtml}else{me.editor.execCommand("insertHtml",qqHtml,true)}me.popup.hide()}else{alert("您输入的QQ号码格式不正确，请重新输入。")}}else{alert("请输入QQ号码")}}};UE.commands.aliwangwangservice={execCommand:function(cmd,me,cont){var isAliWangWang=function(aliWangWang){if(!isNaN(aliWangWang)){return false}var pattern=/^(\w|[\u4E00-\u9FA5])*$/;return pattern.test(aliWangWang)},getlengthB=function(str){return str.replace(/[^\x00-\xff]/g,"**").length};var xhexheAliWangWang=document.getElementById("xheAliWangWang").value;var xheNameAliWangWang=document.getElementById("xheNameAliWangWang").value;var aliwangwangState=document.getElementsByName("showAliWangWangstate"),aliwangwangStateValue;var editor=me.editor,range=editor.selection.getRange(),aliwangwangservice=range.collapsed?editor.queryCommandValue("link"):editor.selection.getStart(),aliwangwangservice=domUtils.findParentByTagName(aliwangwangservice,"a",true);if(xheNameAliWangWang){xheNameAliWangWang=Fai.encodeHtml(xheNameAliWangWang)}for(var i=0;i<aliwangwangState.length;i++){if(aliwangwangState[i].checked){aliwangwangStateValue=aliwangwangState[i].value}}if(xhexheAliWangWang){if(isAliWangWang(xhexheAliWangWang)&&getlengthB(xhexheAliWangWang)>4&&getlengthB(xhexheAliWangWang)<26){var onlineImg="http://amos.alicdn.com/online.aw?v=2&uid="+encodeURIComponent(xhexheAliWangWang)+"&site=cnalichn&s=11&charset=UTF-8",nativeImg=editor.options.UEDITOR_HOME_URL+"/image/comm/ueditor/images/menu/online.gif";var sHtml='<a _onlineSerivceMark="true" target="_blank" aliwangwangStateValue="'+aliwangwangStateValue+'" aliWangWang="'+xhexheAliWangWang+'" aliWangWangName="'+xheNameAliWangWang+'" href="http://amos.alicdn.com/msg.aw?v=2&uid='+encodeURIComponent(xhexheAliWangWang)+'&site=cnalichn&s=10&charset=UTF-8" ><img _hidetool="true" class="fk-xhe" style="vertical-align: middle;" border="0" src="'+(aliwangwangStateValue==1?onlineImg:nativeImg)+'" alt="'+xheNameAliWangWang+'" /><span>'+xheNameAliWangWang+"</span></a>&nbsp;";if(aliwangwangservice!=null){aliwangwangservice.outerHTML=sHtml}else{me.editor.execCommand("inserthtml",sHtml,true)}me.popup.hide()}else{alert("您输入的阿里旺旺用户名格式不正确，请重新输入。")}}else{alert("请输入阿里旺旺用户名")}}};UE.commands.taobaowangwangservice={execCommand:function(cmd,me,cont){var isTaoBaoWangWang=function(taobaoWangWang){if(!isNaN(taobaoWangWang)){return false}var pattern=/^(\w|[\u4E00-\u9FA5])*$/;return pattern.test(taobaoWangWang)},getlengthB=function(str){return str.replace(/[^\x00-\xff]/g,"**").length};var xhexheTaoBaoWangWang=document.getElementById("xheTaoBaoWangWang").value;var xheNameTaoBaoWangWang=document.getElementById("xheNameTaoBaoWangWang").value;var taobaowangwangState=document.getElementsByName("showTaoBaoWangWangstate"),taobaowangwangStateValue;var editor=me.editor,range=editor.selection.getRange(),taobaowangwangservice=range.collapsed?editor.queryCommandValue("link"):editor.selection.getStart(),taobaowangwangservice=domUtils.findParentByTagName(taobaowangwangservice,"a",true);if(xheNameTaoBaoWangWang){xheNameTaoBaoWangWang=Fai.encodeHtml(xheNameTaoBaoWangWang)}for(var i=0;i<taobaowangwangState.length;i++){if(taobaowangwangState[i].checked){taobaowangwangStateValue=taobaowangwangState[i].value}}if(xhexheTaoBaoWangWang){if(isTaoBaoWangWang(xhexheTaoBaoWangWang)&&getlengthB(xhexheTaoBaoWangWang)>4&&getlengthB(xhexheTaoBaoWangWang)<26){var onlineImg="http://amos.alicdn.com/online.aw?v=2&uid="+xhexheTaoBaoWangWang+"&site=cntaobao&s=2&charset=UTF-8",nativeImg=editor.options.UEDITOR_HOME_URL+"/image/comm/ueditor/images/menu/online.gif";var sHtml='<a _onlineSerivceMark="true" target="_blank" taobaowangwangStateValue="'+taobaowangwangStateValue+'" taobaoWangWang="'+xhexheTaoBaoWangWang+'" taobaoWangWangName="'+xheNameTaoBaoWangWang+'" href="http://www.taobao.com/webww/ww.php?ver=3&touid='+encodeURIComponent(xhexheTaoBaoWangWang)+'&siteid=cntaobao&status=2&charset=utf-8" ><img _hidetool="true" class="fk-xhe" style="vertical-align: middle;" border="0" src="'+(taobaowangwangStateValue==1?onlineImg:nativeImg)+'" alt="'+xheNameTaoBaoWangWang+'" /><span>'+xheNameTaoBaoWangWang+"</span></a>&nbsp;";if(taobaowangwangservice!=null){taobaowangwangservice.outerHTML=sHtml}else{me.editor.execCommand("inserthtml",sHtml,true)}me.popup.hide()}else{alert("您输入的淘宝旺旺用户名格式不正确，请重新输入。")}}else{alert("请输入淘宝旺旺用户名")}}};(function(){var Html4Upload=baidu.editor.Html4Upload=function(fromfile,tourl,callback){var uid=new Date().getTime(),idIO="jUploadFrame"+uid,_this=this;var jIO=$('<iframe name="'+idIO+'" class="xheHideArea" style="display:none" />').appendTo("body");var jForm=$('<form action="'+tourl+'" target="'+idIO+'" method="post" enctype="multipart/form-data" class="xheHideArea"></form>').appendTo("body");var jOldFile=$(fromfile),jNewFile=jOldFile.clone().attr("disabled",true);jOldFile.before(jNewFile).appendTo(jForm);this.remove=function(){jForm.remove()};this.onLoad=function(){callback($(jIO[0].contentWindow.document.body).text(),true)};this.start=function(){jForm.submit();jIO.load(this.onLoad)};return this}})();(function(){var ShowModal=baidu.editor.ShowModal=function(title,content,w,h,onRemove){if($(".xheModal").length==1){return false}var jModal,jModalShadow,jOverlay,layerShadow,jHideSelect;layerShadow=3;jModal=$('<div class="xheModal" style="width:'+(w-1)+"px;height:"+h+"px;margin-left:-"+Math.ceil(w/2)+"px;"+($.browser.msie&&$.browser.version<=7?"":"margin-top:-"+Math.ceil(h/2)+"px")+'">'+(true?'<div class="xheModalTitle"><span class="xheModalClose" title="关闭 (Esc)"></span>'+title+"</div>":"")+'<div class="xheModalContent"></div></div>').appendTo("body");jOverlay=$('<div class="xheModalOverlay"></div>').appendTo("body");if(layerShadow>0){jModalShadow=$('<div class="xheModalShadow" style="width:'+jModal.outerWidth()+"px;height:"+jModal.outerHeight()+"px;margin-left:-"+(Math.ceil(w/2)-layerShadow-2)+"px;"+($.browser.msie&&$.browser.version<=7?"":"margin-top:-"+(Math.ceil(h/2)-layerShadow-2)+"px")+'"></div>').appendTo("body")}$(".xheModalContent",jModal).css("height",h-($(".xheModalTitle").outerHeight())).html(content);if($.browser.msie&&$.browser.version==6){jHideSelect=$("select:visible").css("visibility","hidden")}this.removeModal=function(){if(jHideSelect){jHideSelect.css("visibility","visible")}$(document).unbind("keydown",this.modalEscCheck);jModal.remove();if(layerShadow>0){jModalShadow.remove()}jOverlay.remove();if(onRemove){onRemove()}};this.modalEscCheck=function(ev){if(ev.which==27){this.removeModal();return false}};$(document).keydown(this.modalEscCheck);$(".xheModalClose",jModal).click(this.removeModal);jOverlay.show();if(layerShadow>0){jModalShadow.show()}jModal.show()}})();(function(){UE.commands.uploadinit={execCommand:function(cmd,me,jText,tourl,uptext,xheDivSrcPanel){var inputname="filedata",jUpload=$('<span class="xheUpload" style="position: relative;  display: inline-block;  width: 164px;"><input type="text" style="visibility:hidden;" tabindex="-1" /><input type="button" value="浏览" class="xheBtn" tabindex="-1" style="position: absolute;  top: 0px;  left: 114px;  width: 50px;  z-index: 1000001;  padding: 0;"/><input type="file" class="xheFile" size="13" name="filedata" tabindex="-1" style="cursor: pointer;  position: absolute;  top: 0px;  left: 0px;  width: 164px;  opacity: 0;  -ms-filter: alpha(opacity=0);  filter: alpha(opacity=0);  z-index: 1000002;"></span>'),jUpBtn=$(".xheBtn",jUpload);if(xheDivSrcPanel.find(".xheUpload").size()==0){jText.after(jUpload);jUpBtn.before(jText)}var jFile=$(".xheFile",jUpload),arrMsg=[];jFile.change(function(){startUplaod(jFile[0],me,tourl,uptext)})}};function startUplaod(fromfiles,me,tourl,uptext){var arrMsg=[];var url=window.UEDITOR_CONFIG.UEDITOR_HOME_URL+"/";if(url.substring(url.length-1,url.length)=="/"){url=url.substring(0,url.length-1)}var upload,fileList,filename,jUploadTip=$('<div style="margin:22px 0;text-align:center;line-height:30px;">文件上传中，请稍候……<br /></div>'),sLoading='<img src="'+url+'/image/comm/ueditor/images/menu/loading.gif">';if(fromfiles.nodeType&&!((fileList=fromfiles.files)&&fileList[0])){if(!checkFileExt(fromfiles.value,uptext)){return}jUploadTip.append(sLoading);upload=new baidu.editor.Html4Upload(fromfiles,tourl,onUploadCallback)}else{if(!checkFileExt(fromfiles.value,uptext)){return}jUploadTip.append(sLoading);upload=new baidu.editor.Html4Upload(fromfiles,tourl,onUploadCallback)}bShowPanel=false;new baidu.editor.ShowModal("文件上传中(Esc取消上传)",jUploadTip,320,150,function(){bShowPanel=true;upload.remove()});upload.start();upload.remove()}function removeModal(){$(".xheModal").remove();$(".xheModalOverlay").remove();$(".xheModalShadow").remove()}function onUploadCallback(sText,bFinish){var data=Object,onUpload="";var result;try{result=jQuery.parseJSON(sText)}catch(ex){}if(!result||!result.success){var msg;if(result&&result.msg){msg=result.msg}else{msg="上传失败"}alert(msg);removeModal();return false}removeModal();setUploadMsg(result.url);if(onUpload){onUpload(arrMsg)}return true}function checkFileExt(filename,uptext){if(uptext=="*"||filename.match(new RegExp(".("+uptext.replace(/,/g,"|")+")$","i"))){return true}else{alert("上传文件扩展名必需为: "+uptext);return false}}function setUploadMsg(arrMsg){if(typeof(arrMsg)=="string"){arrMsg=[arrMsg]}var bImmediate=false,i,count=arrMsg.length,msg,url,arrUrl=[];for(i=0;i<count;i++){msg=arrMsg[i];if(typeof(msg)=="string"){url=msg}else{url=msg.url}if(url.substr(0,1)=="!"){bImmediate=true;url=url.substr(1)}arrUrl.push(url)}$(".xheDialogDiv").find("button")[0].onclick(arrUrl.join(" "))}})();UE.plugins.selectall=function(){var me=this;me.commands.selectall={execCommand:function(){var me=this,body=me.body,range=me.selection.getRange();range.selectNodeContents(body);if(domUtils.isEmptyBlock(body)){if(browser.opera&&body.firstChild&&body.firstChild.nodeType==1){range.setStartAtFirst(body.firstChild)}range.collapse(true)}range.select(true);this.selectAll=true},notNeedUndo:1};me.addListener("ready",function(){domUtils.on(me.document,"click",function(evt){me.selectAll=false})})};UE.plugins.wordcount=function(){var me=this;me.setOpt({wordCount:true,maximumWords:me.options.maximumWords,wordCountMsg:me.options.wordCountMsg||me.getLang("wordCountMsg"),wordOverFlowMsg:me.options.wordOverFlowMsg||me.getLang("wordOverFlowMsg")});var opt=me.options,max=opt.maximumWords,msg=opt.wordCountMsg,errMsg=opt.wordOverFlowMsg;if(!opt.wordCount){return}me.commands.wordcount={queryCommandValue:function(cmd,onlyCount){var length,contentText,reg;if(onlyCount){reg=new RegExp("[\r\t\n]","g");contentText=this.getContentTxt().replace(reg,"");return contentText.length}reg=new RegExp("[\r\t\n]","g");contentText=this.getContentTxt().replace(reg,"");length=contentText.length;if(max-length<0){me.fireEvent("wordcountoverflow");return errMsg.replace("{#pass}",length-max).replace("{#count}",length)}return msg.replace("{#leave}",max-length>=0?max-length:0).replace("{#count}",length)}}};UE.plugins.undo=function(){var saveSceneTimer;var me=this,maxUndoCount=me.options.maxUndoCount||20,maxInputCount=me.options.maxInputCount||20,fillchar=new RegExp(domUtils.fillChar+"|</hr>","gi");var noNeedFillCharTags={ol:1,ul:1,table:1,tbody:1,tr:1,body:1};var orgState=me.options.autoClearEmptyNode;function compareAddr(indexA,indexB){if(indexA.length!=indexB.length){return 0}for(var i=0,l=indexA.length;i<l;i++){if(indexA[i]!=indexB[i]){return 0}}return 1}function compareRangeAddress(rngAddrA,rngAddrB){if(rngAddrA.collapsed!=rngAddrB.collapsed){return 0}if(!compareAddr(rngAddrA.startAddress,rngAddrB.startAddress)||!compareAddr(rngAddrA.endAddress,rngAddrB.endAddress)){return 0}return 1}function UndoManager(){this.list=[];this.index=0;this.hasUndo=false;this.hasRedo=false;this.undo=function(){if(this.hasUndo){if(!this.list[this.index-1]&&this.list.length==1){this.reset();return}while(this.list[this.index].content==this.list[this.index-1].content){this.index--;if(this.index==0){return this.restore(0)}}this.restore(--this.index)}};this.redo=function(){if(this.hasRedo){while(this.list[this.index].content==this.list[this.index+1].content){this.index++;if(this.index==this.list.length-1){return this.restore(this.index)}}this.restore(++this.index)}};this.restore=function(){var me=this.editor;var scene=this.list[this.index];var root=UE.htmlparser(scene.content.replace(fillchar,""));me.options.autoClearEmptyNode=false;me.filterInputRule(root);me.options.autoClearEmptyNode=orgState;me.document.body.innerHTML=root.toHtml();me.fireEvent("afterscencerestore");if(browser.ie){utils.each(domUtils.getElementsByTagName(me.document,"td th caption p"),function(node){if(domUtils.isEmptyNode(node)){domUtils.fillNode(me.document,node)}})}try{var rng=new dom.Range(me.document).moveToAddress(scene.address);rng.select(noNeedFillCharTags[rng.startContainer.nodeName.toLowerCase()])}catch(e){}this.update();this.clearKey();me.fireEvent("reset",true)};this.getScene=function(notSetCursor){var me=this.editor;var rng=me.selection.getRange(),rngAddress=rng.createAddress(false,true);me.fireEvent("beforegetscene");var root=UE.htmlparser(me.body.innerHTML,true);me.options.autoClearEmptyNode=false;me.filterOutputRule(root);me.options.autoClearEmptyNode=orgState;var cont=root.toHtml();browser.ie&&(cont=cont.replace(/>&nbsp;</g,"><").replace(/\s*</g,"<").replace(/>\s*/g,">"));me.fireEvent("aftergetscene");try{}catch(e){}return{address:rngAddress,content:cont}};this.save=function(notCompareRange,notSetCursor){clearTimeout(saveSceneTimer);var currentScene=this.getScene(notSetCursor),lastScene=this.list[this.index];if(lastScene&&lastScene.content==currentScene.content&&(notCompareRange?1:compareRangeAddress(lastScene.address,currentScene.address))){return}this.list=this.list.slice(0,this.index+1);this.list.push(currentScene);if(this.list.length>maxUndoCount){this.list.shift()}this.index=this.list.length-1;this.clearKey();this.update()};this.update=function(){this.hasRedo=!!this.list[this.index+1];this.hasUndo=!!this.list[this.index-1]};this.reset=function(){this.list=[];this.index=0;this.hasUndo=false;this.hasRedo=false;this.clearKey()};this.clearKey=function(){keycont=0;lastKeyCode=null}}me.undoManger=new UndoManager();me.undoManger.editor=me;function saveScene(){this.undoManger.save()}me.addListener("saveScene",function(){var args=Array.prototype.splice.call(arguments,1);this.undoManger.save.apply(this.undoManger,args)});me.addListener("beforeexeccommand",saveScene);me.addListener("afterexeccommand",saveScene);me.addListener("reset",function(type,exclude){if(!exclude){this.undoManger.reset()}});me.commands.redo=me.commands.undo={execCommand:function(cmdName){this.undoManger[cmdName]()},queryCommandState:function(cmdName){return this.undoManger["has"+(cmdName.toLowerCase()=="undo"?"Undo":"Redo")]?0:-1},notNeedUndo:1};var keys={16:1,17:1,18:1,37:1,38:1,39:1,40:1},keycont=0,lastKeyCode;var inputType=false;me.addListener("ready",function(){domUtils.on(this.body,"compositionstart",function(){inputType=true});domUtils.on(this.body,"compositionend",function(){inputType=false})});me.addshortcutkey({Undo:"ctrl+90",Redo:"ctrl+89"});var isCollapsed=true;me.addListener("keydown",function(type,evt){var me=this;var range=me.selection.getRange();var start=range.startContainer;var tmp=true;var keyCode=evt.keyCode||evt.which;if(!keys[keyCode]&&!evt.ctrlKey&&!evt.metaKey&&!evt.shiftKey&&!evt.altKey){if(inputType){return}if(range.collapsed){if(keyCode!=8){if(tmp&&$(start).parent().parent().is("a")&&(typeof $(start).parent().parent().attr("astyle_h")!="undefined")){if(range.endOffset==0){$(start).parent().parent().before("\u200D");range.setStartAtFirst($(start).parent().parent()[0].previousSibling).setCursor(false,true);tmp=false}else{if(range.endOffset==range.endContainer.length){$(start).parent().parent().after("\u200D");range.setStartAtLast($(start).parent().parent()[0].nextSibling).setCursor(false,true);tmp=false}}}else{if(tmp&&$(start).parent().parent().parent().is("a")&&(typeof $(start).parent().parent().parent().attr("astyle_h")!="undefined")){if(range.endOffset==0){$(start).parent().parent().parent().before("\u200D");range.setStartAtFirst($(start).parent().parent().parent()[0].previousSibling).setCursor(false,true);tmp=false}else{if(range.endOffset==range.endContainer.length){$(start).parent().parent().parent().after("\u200D");range.setStartAtLast($(start).parent().parent().parent()[0].nextSibling).setCursor(false,true);tmp=false}}}}}}if(!me.selection.getRange().collapsed){me.undoManger.save(false,true);isCollapsed=false;return}if(me.undoManger.list.length==0){me.undoManger.save(true)}clearTimeout(saveSceneTimer);function save(cont){if(cont.selection.getRange().collapsed){cont.fireEvent("contentchange")}cont.undoManger.save(false,true);cont.fireEvent("selectionchange")}saveSceneTimer=setTimeout(function(){if(inputType){var interalTimer=setInterval(function(){if(!inputType){save(me);clearInterval(interalTimer)}},300);return}save(me)},200);lastKeyCode=keyCode;keycont++;if(keycont>=maxInputCount){save(me)}}});me.addListener("keyup",function(type,evt){var keyCode=evt.keyCode||evt.which;if(!keys[keyCode]&&!evt.ctrlKey&&!evt.metaKey&&!evt.shiftKey&&!evt.altKey){if(inputType){return}if(!isCollapsed){this.undoManger.save(false,true);isCollapsed=true}}})};UE.plugins.justifyleft=function(){this.setOpt({wordagejustify:{left:"居左对齐",right:"居右对齐",center:"居中对齐",justify:"两端对齐"}});var block=domUtils.isBlockElm,defaultValue={left:1,right:1,center:1,justify:1},doJustify=function(range,style){var bookmark=range.createBookmark(),filterFn=function(node){return node.nodeType==1?node.tagName.toLowerCase()!="br"&&!domUtils.isBookmarkNode(node):!domUtils.isWhitespace(node)};range.enlarge(true);var bookmark2=range.createBookmark(),current=domUtils.getNextDomNode(bookmark2.start,false,filterFn),tmpRange=range.cloneRange(),tmpNode;while(current&&!(domUtils.getPosition(current,bookmark2.end)&domUtils.POSITION_FOLLOWING)){if(current.nodeType==3||!block(current)){tmpRange.setStartBefore(current);while(current&&current!==bookmark2.end&&!block(current)){tmpNode=current;current=domUtils.getNextDomNode(current,false,null,function(node){return !block(node)})}tmpRange.setEndAfter(tmpNode);var common=tmpRange.getCommonAncestor();if(!domUtils.isBody(common)&&block(common)){domUtils.setStyles(common,utils.isString(style)?{"text-align":style}:style);current=common}else{var p=range.document.createElement("p");domUtils.setStyles(p,utils.isString(style)?{"text-align":style}:style);var frag=tmpRange.extractContents();p.appendChild(frag);tmpRange.insertNode(p);current=p}current=domUtils.getNextDomNode(current,false,filterFn)}else{current=domUtils.getNextDomNode(current,true,filterFn)}}return range.moveToBookmark(bookmark2).moveToBookmark(bookmark)};UE.commands.justify={execCommand:function(cmdName,align){var range=this.selection.getRange(),txt;if(this.currentSelectedArr&&this.currentSelectedArr.length>0){for(var i=0,ti;ti=this.currentSelectedArr[i++];){if(domUtils.isEmptyNode(ti)){txt=this.document.createTextNode("p");range.setStart(ti,0).collapse(true).insertNode(txt).selectNode(txt)}else{range.selectNodeContents(ti)}doJustify(range,align.toLowerCase());txt&&domUtils.remove(txt)}range.selectNode(this.currentSelectedArr[0]).select()}else{if(range.collapsed){txt=this.document.createTextNode("p");range.insertNode(txt)}doJustify(range,align);if(txt){range.setStartBefore(txt).collapse(true);domUtils.remove(txt)}range.select()}return true},queryCommandValue:function(){var startNode=this.selection.getStart(),value=domUtils.getComputedStyle(startNode,"text-align");return defaultValue[value]?value:"left"},queryCommandState:function(){return this.highlight?-1:0}}};UE.plugins.keystrokes=function(){var me=this,flag=0,keys=domUtils.keys,trans={B:"strong",I:"em",FONT:"span"},sizeMap=[0,10,12,16,18,24,32,48],listStyle={OL:["decimal","lower-alpha","lower-roman","upper-alpha","upper-roman"],UL:["circle","disc","square"]};me.addListener("keydown",function(type,evt){var keyCode=evt.keyCode||evt.which;if(this.selectAll){this.selectAll=false;if((keyCode==8||keyCode==46)){me.undoManger&&me.undoManger.save();me.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>";new dom.Range(me.document).setStart(me.body.firstChild,0).setCursor(false,true);me.undoManger&&me.undoManger.save();browser.ie&&me._selectionChange();domUtils.preventDefault(evt);return}}if(keyCode==8){var range=me.selection.getRange(),tmpRange,start,end;start=range.startContainer;if(start.tagName=="SPAN"&&start.className=="J_hoverImageParent"){me.undoManger&&me.undoManger.save();domUtils.remove(start);domUtils.preventDefault(evt);return}if(range.collapsed){start=range.startContainer;if(domUtils.isWhitespace(start)){start=start.parentNode}if(domUtils.isEmptyNode(start)&&start===me.body.firstChild){if(start.tagName!="P"){p=me.document.createElement("p");me.body.insertBefore(p,start);domUtils.fillNode(me.document,p);range.setStart(p,0).setCursor(false,true);domUtils.remove(start)}domUtils.preventDefault(evt);return}}if(range.collapsed&&range.startContainer.nodeType==3&&range.startContainer.nodeValue.replace(new RegExp(domUtils.fillChar,"g"),"").length==0){range.setStartBefore(range.startContainer).collapse(true)}if(start=range.getClosedNode()){me.undoManger&&me.undoManger.save();range.setStartBefore(start);domUtils.remove(start);range.setCursor();me.undoManger&&me.undoManger.save();domUtils.preventDefault(evt);return}if(!browser.ie){start=domUtils.findParentByTagName(range.startContainer,"table",true);end=domUtils.findParentByTagName(range.endContainer,"table",true);if(start&&!end||!start&&end||start!==end){evt.preventDefault();return}}if(me.undoManger){if(!range.collapsed){me.undoManger.save();flag=1}}}if(keyCode==9){range=me.selection.getRange();me.undoManger&&me.undoManger.save();for(var i=0,txt="",tabSize=me.options.tabSize||4,tabNode=me.options.tabNode||"&nbsp;";i<tabSize;i++){txt+=tabNode}var span=me.document.createElement("span");span.innerHTML=txt;if(range.collapsed){var li=domUtils.findParentByTagName(range.startContainer,"li",true);if(li&&domUtils.isStartInblock(range)){bk=range.createBookmark();var parentLi=li.parentNode,list=me.document.createElement(parentLi.tagName);var index=utils.indexOf(listStyle[list.tagName],domUtils.getComputedStyle(parentLi,"list-style-type"));index=index+1==listStyle[list.tagName].length?0:index+1;domUtils.setStyle(list,"list-style-type",listStyle[list.tagName][index]);parentLi.insertBefore(list,li);list.appendChild(li);range.moveToBookmark(bk).select()}else{range.insertNode(span.cloneNode(true).firstChild).setCursor(true)}}else{start=domUtils.findParentByTagName(range.startContainer,"table",true);end=domUtils.findParentByTagName(range.endContainer,"table",true);if(start||end){evt.preventDefault?evt.preventDefault():(evt.returnValue=false);return}start=domUtils.findParentByTagName(range.startContainer,["ol","ul"],true);end=domUtils.findParentByTagName(range.endContainer,["ol","ul"],true);if(start&&end&&start===end){var bk=range.createBookmark();start=domUtils.findParentByTagName(range.startContainer,"li",true);end=domUtils.findParentByTagName(range.endContainer,"li",true);if(start===start.parentNode.firstChild){var parentList=me.document.createElement(start.parentNode.tagName);start.parentNode.parentNode.insertBefore(parentList,start.parentNode);parentList.appendChild(start.parentNode)}else{parentLi=start.parentNode;list=me.document.createElement(parentLi.tagName);index=utils.indexOf(listStyle[list.tagName],domUtils.getComputedStyle(parentLi,"list-style-type"));index=index+1==listStyle[list.tagName].length?0:index+1;domUtils.setStyle(list,"list-style-type",listStyle[list.tagName][index]);start.parentNode.insertBefore(list,start);var nextLi;while(start!==end){nextLi=start.nextSibling;list.appendChild(start);start=nextLi}list.appendChild(end)}range.moveToBookmark(bk).select()}else{if(start||end){evt.preventDefault?evt.preventDefault():(evt.returnValue=false);return}start=domUtils.findParent(range.startContainer,filterFn);end=domUtils.findParent(range.endContainer,filterFn);if(start&&end&&start===end){range.deleteContents();range.insertNode(span.cloneNode(true).firstChild).setCursor(true)}else{var bookmark=range.createBookmark(),filterFn=function(node){return domUtils.isBlockElm(node)};range.enlarge(true);var bookmark2=range.createBookmark(),current=domUtils.getNextDomNode(bookmark2.start,false,filterFn);while(current&&!(domUtils.getPosition(current,bookmark2.end)&domUtils.POSITION_FOLLOWING)){current.insertBefore(span.cloneNode(true).firstChild,current.firstChild);current=domUtils.getNextDomNode(current,false,filterFn)}range.moveToBookmark(bookmark2).moveToBookmark(bookmark).select()}}}me.undoManger&&me.undoManger.save();evt.preventDefault?evt.preventDefault():(evt.returnValue=false)}if(browser.gecko&&keyCode==46){range=me.selection.getRange();if(range.collapsed){start=range.startContainer;if(domUtils.isEmptyBlock(start)){var parent=start.parentNode;while(domUtils.getChildCount(parent)==1&&!domUtils.isBody(parent)){start=parent;parent=parent.parentNode}if(start===parent.lastChild){evt.preventDefault()}return}}}if(keyCode==32){var range=this.selection.getRange(),startContainer=range.startContainer,startContainerNode=startContainer.parentNode&&startContainer.parentNode.nodeName=="BODY"?startContainer:startContainer.parentNode,startContainerNodeValue=browser.ie?(startContainerNode.innerText?startContainerNode.innerText.replace(/\n\r/g,""):startContainerNode.nodeValue):startContainerNode.textContent,reg_zh=/[\u4E00-\u9FA5]/g,startOffset=range.startOffset;if(startContainerNodeValue!=null&&startContainerNodeValue!=""){var subNextStr=startContainerNodeValue.substring(startOffset,startOffset+1);var subPreStr=startContainerNodeValue.substring(startOffset-1,startOffset);if(reg_zh.test(subNextStr)||reg_zh.test(subPreStr)){me.execCommand("inserthtml","　");if(evt.preventDefault){evt.preventDefault()}else{evt.returnValue=false}}}else{if(startContainerNode&&startContainerNode.previousSibling){var previousNodeText=startContainerNode.previousSibling[browser.ie?"innerText":"textContent"];if(previousNodeText){var previousNextStr=previousNodeText.substring(previousNodeText.length-1,previousNodeText.length);if(reg_zh.test(previousNextStr)){me.execCommand("inserthtml","　");if(evt.preventDefault){evt.preventDefault()}else{evt.returnValue=false}}}}}}});me.addListener("keyup",function(type,evt){var keyCode=evt.keyCode||evt.which;if(!browser.gecko&&!keys[keyCode]&&!evt.ctrlKey&&!evt.metaKey&&!evt.shiftKey&&!evt.altKey){range=me.selection.getRange();if(range.collapsed){var start=range.startContainer,isFixed=0;while(!domUtils.isBlockElm(start)){if(start.nodeType==1&&utils.indexOf(["FONT","B","I"],start.tagName)!=-1){var tmpNode=me.document.createElement(trans[start.tagName]);if(start.tagName=="FONT"){tmpNode.style.cssText=(start.getAttribute("size")?"font-size:"+(sizeMap[start.getAttribute("size")]||12)+"px":"")+";"+(start.getAttribute("color")?"color:"+start.getAttribute("color"):"")+";"+(start.getAttribute("face")?"font-family:"+start.getAttribute("face"):"")+";"+start.style.cssText}while(start.firstChild){tmpNode.appendChild(start.firstChild)}start.parentNode.insertBefore(tmpNode,start);domUtils.remove(start);if(!isFixed){range.setEnd(tmpNode,tmpNode.childNodes.length).collapse(true)}start=tmpNode;isFixed=1}start=start.parentNode}isFixed&&range.select()}}if(keyCode==8){if(browser.gecko){for(var i=0,li,lis=domUtils.getElementsByTagName(this.body,"li");li=lis[i++];){if(domUtils.isEmptyNode(li)&&!li.previousSibling){var liOfPn=li.parentNode;domUtils.remove(li);if(domUtils.isEmptyNode(liOfPn)){domUtils.remove(liOfPn)}}}}var range,start,parent,tds=this.currentSelectedArr;if(tds&&tds.length>0){for(var i=0,ti;ti=tds[i++];){ti.innerHTML=browser.ie?(browser.version<9?"&#65279":""):"<br/>"}range=new dom.Range(this.document);range.setStart(tds[0],0).setCursor();if(flag){me.undoManger.save();flag=0}if(browser.webkit){evt.preventDefault()}return}range=me.selection.getRange();start=range.startContainer;if(domUtils.isWhitespace(start)){start=start.parentNode}var removeFlag=0;while(start.nodeType==1&&domUtils.isEmptyNode(start)&&dtd.$removeEmpty[start.tagName]){removeFlag=1;parent=start.parentNode;domUtils.remove(start);start=parent}if(removeFlag&&start.nodeType==1&&domUtils.isEmptyNode(start)){if(browser.ie){var span=range.document.createElement("span");start.appendChild(span);range.setStart(start,0).setCursor();li=domUtils.findParentByTagName(start,"li",true);if(li){var next=li.nextSibling;while(next){if(domUtils.isEmptyBlock(next)){li=next;next=next.nextSibling;domUtils.remove(li);continue}break}}}else{start.innerHTML="<br/>";range.setStart(start,0).setCursor(false,true)}setTimeout(function(){if(browser.ie){domUtils.remove(span)}if(flag){me.undoManger.save();flag=0}},0)}else{if(flag){me.undoManger.save();flag=0}}}})};UE.plugins.font=function(){var me=this,fonts={forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family",underline:"text-decoration",strikethrough:"text-decoration"};me.options.fontfamily=me.options.fontfamily||me.getLang("fontfamily");me.setOpt({fontsize:[12,14,16,18,20,22,24,30,36]});for(var p in fonts){(function(cmd,style){UE.commands[cmd]={execCommand:function(cmdName,value){value=value||(this.queryCommandState(cmdName)?"none":cmdName=="underline"?"underline":"line-through");var me=this,range=this.selection.getRange(),text;if(value=="default"){if(range.collapsed){text=me.document.createTextNode("font");range.insertNode(text).select()}me.execCommand("removeFormat","span,a",style);if(text){range.setStartBefore(text).setCursor();domUtils.remove(text)}}else{if(me.currentSelectedArr&&me.currentSelectedArr.length>0){for(var i=0,ci;ci=me.currentSelectedArr[i++];){range.selectNodeContents(ci);range.applyInlineStyle("span",{style:style+":"+value})}range.selectNodeContents(this.currentSelectedArr[0]).select()}else{if(!range.collapsed){if((cmd=="underline"||cmd=="strikethrough")&&me.queryCommandValue(cmd)){me.execCommand("removeFormat","span,a",style)}range=me.selection.getRange();range.applyInlineStyle("span",{style:style+":"+value}).select()}else{var span=domUtils.findParentByTagName(range.startContainer,"span",true);text=me.document.createTextNode("font");if(span&&!span.children.length&&!span[browser.ie?"innerText":"textContent"].replace(fillCharReg,"").length){range.insertNode(text);if(cmd=="underline"||cmd=="strikethrough"){range.selectNode(text).select();me.execCommand("removeFormat","span,a",style,null);span=domUtils.findParentByTagName(text,"span",true);range.setStartBefore(text)}span.style.cssText+=";"+style+":"+value;range.collapse(true).select()}else{range.insertNode(text);range.selectNode(text).select();span=range.document.createElement("span");if(cmd=="underline"||cmd=="strikethrough"){if(domUtils.findParentByTagName(text,"a",true)){range.setStartBefore(text).setCursor();domUtils.remove(text);return}me.execCommand("removeFormat","span,a",style)}span.style.cssText=style+":"+value;text.parentNode.insertBefore(span,text);if(!browser.ie||browser.ie&&browser.version==9){var spanParent=span.parentNode;while(!domUtils.isBlockElm(spanParent)){if(spanParent.tagName=="SPAN"){span.style.cssText=spanParent.style.cssText+";"+span.style.cssText}spanParent=spanParent.parentNode}}if(opera){setTimeout(function(){range.setStart(span,0).setCursor()})}else{range.setStart(span,0).setCursor()}}domUtils.remove(text)}}}return true},queryCommandValue:function(cmdName){var startNode=this.selection.getStart();if(cmdName=="underline"||cmdName=="strikethrough"){var tmpNode=startNode,value;while(tmpNode&&!domUtils.isBlockElm(tmpNode)&&!domUtils.isBody(tmpNode)){if(tmpNode.nodeType==1){value=domUtils.getComputedStyle(tmpNode,style);if(value!="none"){return value}}tmpNode=tmpNode.parentNode}return"none"}return domUtils.getComputedStyle(startNode,style)},queryCommandState:function(cmdName){if(this.highlight){return -1}if(!(cmdName=="underline"||cmdName=="strikethrough")){return 0}return this.queryCommandValue(cmdName)==(cmdName=="underline"?"underline":"line-through")}}})(p,fonts[p])}};UE.plugins.link=function(){function optimize(range){var start=range.startContainer,end=range.endContainer;if(start=domUtils.findParentByTagName(start,"a",true)){range.setStartBefore(start)}if(end=domUtils.findParentByTagName(end,"a",true)){range.setEndAfter(end)}}UE.commands.unlink={execCommand:function(){var as,range=new dom.Range(this.document),tds=this.currentSelectedArr,bookmark;if(tds&&tds.length>0){for(var i=0,ti;ti=tds[i++];){as=domUtils.getElementsByTagName(ti,"a");for(var j=0,aj;aj=as[j++];){domUtils.remove(aj,true)}}if(domUtils.isEmptyNode(tds[0])){range.setStart(tds[0],0).setCursor()}else{range.selectNodeContents(tds[0]).select()}}else{range=this.selection.getRange();if(range.collapsed&&!domUtils.findParentByTagName(range.startContainer,"a",true)){return}bookmark=range.createBookmark();optimize(range);range.removeInlineStyle("a").moveToBookmark(bookmark).select();optimize(range=range.adjustmentBoundary());var start=range.startContainer;start=start.childNodes[range.startOffset];if($(start).parent().parent().is("strong")){if($(start).parent().is("span")){var inlineHtml=$(start).parent().html();$(start).parent().parent().replaceWith(inlineHtml)}}else{if($(start).parent().is("span")){var inlineHtml=$(start).parent().html();$(start).parent().replaceWith(inlineHtml)}}}},queryCommandState:function(){return !this.highlight&&this.queryCommandValue("link")?0:-1}};function doLink(range,opt){optimize(range=range.adjustmentBoundary());var start=range.startContainer,styleA;isIE=false;if(start.nodeType==3){if($(start).parent().parent().is("p")||$(start).parent().parent().is("td")){start=$(start).parent()[0]}else{if($(start).parent().parent().is("a")){start=$(start).parent().parent()[0]}}start.nodeType=1;isIE=true}if(start.nodeType==1){if(!isIE){start=start.childNodes[range.startOffset]}if(!!opt.styleHover){if(typeof opt.styleHover.wo=="undefined"){if($(start).is("span")){opt.styleHover=""}else{if($(start).is("a")){if($(start).attr("stylehover")==undefined){opt.styleHover=""}else{opt.styleHover=$(start).attr("stylehover")}}}}else{if(opt.styleHover.wo){opt.styleHover=JSON.stringify(opt.styleHover)}else{opt.styleHover=""}}}if(!!opt.wbackColor_h){if(typeof opt.wbackColor_h.bo=="undefined"){if($(start).is("span")){opt.wbackColor_h=""}else{if($(start).is("a")){if($(start).attr("wbackcolor_h")==undefined){opt.wbackColor_h=""}else{opt.wbackColor_h=$(start).attr("wbackcolor_h")}}}}else{if(opt.wbackColor_h.bo){opt.wbackColor_h=JSON.stringify(opt.wbackColor_h)}else{opt.wbackColor_h=""}}}if(opt.wUnderline){if($(start).is("span")){opt.wUnderline="text-decoration:underline;"}else{if($(start).is("a")){$(start).css({"text-decoration":"underline"})}}}else{if(typeof opt.wUnderline!="undefined"){if($(start).is("span")){opt.wUnderline="text-decoration:none;"}else{if($(start).is("a")){$(start).css({"text-decoration":"none"})}}}}if(opt.linkStyleClose){$(start).removeAttr("style");opt.wUnderline="";$(start).find("span").css({color:"","font-family":"","font-size":"","text-decoration":"","font-weight":""})}if(opt.wbackColorClose){$(start).find("span").css({"background-color":""})}if(opt.wBold){if($(start).is("span")){if($(start).parent().find("strong").length==0){$(start).wrapAll("<strong></strong>")}opt.wBold="font-weight:bold;"}else{if($(start).is("a")){if($(start).find("strong").length==0){$(start).find("span").wrapAll("<strong></strong>")}$(start).css({"font-weight":"bold"})}}}else{if(typeof opt.wBold!="undefined"){if($(start).is("span")){opt.wBold="font-weight:normal;"}else{if($(start).is("a")){$(start).css({"font-weight":"normal"})}}}var inlineHtml=$(start).find("strong").html();$(start).find("strong").replaceWith(inlineHtml)}if((opt.href=="unlink"||opt.href=="http://unlink")&&$(start).is("a")){opt.href=$(start).attr("href");opt.data_ue_src=$(start).attr("href")}if(typeof $(start).attr("_mu")=="string"){opt._mu=$(start).attr("_mu");opt["class"]="switchJump"}if(start&&start.nodeType==1&&start.tagName=="A"&&/^(?:https?|ftp|file)\s*:\s*\/\//.test(start[browser.ie?"innerText":"textContent"])){start[browser.ie?"innerText":"textContent"]=utils.html(opt.textValue||opt.href)}if(start&&start.nodeType==1&&start.tagName=="A"){styleA=start.getAttribute("style")}}range.removeInlineStyle("a");if(range.collapsed){var a=range.document.createElement("a"),text="";if(opt.textValue){text=utils.html(opt.textValue);delete opt.textValue}else{text=utils.html(opt.href)}if(styleA){a.setAttributes("style",styleA)}domUtils.setAttributes(a,opt);range.insertNode(a);a[browser.ie?"innerText":"textContent"]=text;range.selectNode(a)}else{if(styleA){opt.style=styleA+opt.style}range.applyInlineStyle("a",opt)}if(!editor.options.isMobi){this.editor.options.outerFunction.hoverStyle&&this.editor.options.outerFunction.hoverStyle.apply(this)}}UE.commands.link={queryCommandState:function(){return this.highlight?-1:0},execCommand:function(cmdName,opt){var range=new dom.Range(this.document),tds=this.currentSelectedArr;opt.data_ue_src&&(opt.data_ue_src=utils.unhtml(opt.data_ue_src,/[<">]/g));opt.href&&(opt.href=utils.unhtml(opt.href,/[<">]/g));opt.textValue&&(opt.textValue=utils.unhtml(opt.textValue,/[<">]/g));if(tds&&tds.length){for(var i=0,ti;ti=tds[i++];){if(domUtils.isEmptyNode(ti)){ti[browser.ie?"innerText":"textContent"]=utils.html(opt.textValue||opt.href)}doLink(range.selectNodeContents(ti),opt)}range.selectNodeContents(tds[0]).select()}else{doLink(range=this.selection.getRange(),opt);range.collapse().select(true)}},queryCommandValue:function(){var range=new dom.Range(this.document),tds=this.currentSelectedArr,as,node;if(tds&&tds.length){for(var i=0,ti;ti=tds[i++];){as=ti.getElementsByTagName("a");if(as[0]){return as[0]}}}else{range=this.selection.getRange();if(range.collapsed){node=this.selection.getStart();if(node&&(node=domUtils.findParentByTagName(node,"a",true))){return node}}else{range.shrinkBoundary();var start=range.startContainer.nodeType==3||!range.startContainer.childNodes[range.startOffset]?range.startContainer:range.startContainer.childNodes[range.startOffset],end=range.endContainer.nodeType==3||range.endOffset==0?range.endContainer:range.endContainer.childNodes[range.endOffset-1],common=range.getCommonAncestor();node=domUtils.findParentByTagName(common,"a",true);if(!node&&common.nodeType==1){var as=common.getElementsByTagName("a"),ps,pe;for(var i=0,ci;ci=as[i++];){ps=domUtils.getPosition(ci,start),pe=domUtils.getPosition(ci,end);if((ps&domUtils.POSITION_FOLLOWING||ps&domUtils.POSITION_CONTAINS)&&(pe&domUtils.POSITION_PRECEDING||pe&domUtils.POSITION_CONTAINS)){node=ci;break}}}return node}}}}};UE.plugins.removeformat=function(){var me=this;me.setOpt({removeFormatTags:"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var",removeFormatAttributes:"class,style,lang,width,height,align,hspace,valign",removeformatSelect:["清除选中样式","清除全部样式","清除全部链接"]});me.commands.removeformat={execCommand:function(cmdName,tags,style,attrs,notIncludeA,removeType){var tagReg=new RegExp("^(?:"+(tags||this.options.removeFormatTags).replace(/,/g,"|")+")$","i"),removeFormatAttributes=style?[]:(attrs||this.options.removeFormatAttributes).split(","),range=new dom.Range(this.document),bookmark,node,parent,filter=function(node){return node.nodeType==1};function isRedundantSpan(node){if(node.nodeType==3||node.tagName.toLowerCase()!="span"){return 0}if(browser.ie){var attrs=node.attributes;if(attrs.length){for(var i=0,l=attrs.length;i<l;i++){if(attrs[i].specified){return 0}}return 1}}return !node.attributes.length}function doRemove(range){var bookmark1=range.createBookmark();if(range.collapsed){range.enlarge(true)}if(!notIncludeA){var aNode=domUtils.findParentByTagName(range.startContainer,"a",true);if(aNode){range.setStartBefore(aNode)}aNode=domUtils.findParentByTagName(range.endContainer,"a",true);if(aNode){range.setEndAfter(aNode)}}bookmark=range.createBookmark();node=bookmark.start;while((parent=node.parentNode)&&!domUtils.isBlockElm(parent)){domUtils.breakParent(node,parent);domUtils.clearEmptySibling(node)}if(bookmark.end){node=bookmark.end;while((parent=node.parentNode)&&!domUtils.isBlockElm(parent)){domUtils.breakParent(node,parent);domUtils.clearEmptySibling(node)}var current=domUtils.getNextDomNode(bookmark.start,false,filter),next;while(current){if(current==bookmark.end){break}next=domUtils.getNextDomNode(current,true,filter);if(!dtd.$empty[current.tagName.toLowerCase()]&&!domUtils.isBookmarkNode(current)){if(tagReg.test(current.tagName)){if(style){domUtils.removeStyle(current,style);if(isRedundantSpan(current)&&style!="text-decoration"){domUtils.remove(current,true)}}else{domUtils.remove(current,true)}}else{if(!dtd.$tableContent[current.tagName]&&!dtd.$list[current.tagName]){domUtils.removeAttributes(current,removeFormatAttributes);if(isRedundantSpan(current)){domUtils.remove(current,true)}}}}current=next}}var pN=bookmark.start.parentNode;if(domUtils.isBlockElm(pN)&&!dtd.$tableContent[pN.tagName]&&!dtd.$list[pN.tagName]){domUtils.removeAttributes(pN,removeFormatAttributes)}pN=bookmark.end.parentNode;if(bookmark.end&&domUtils.isBlockElm(pN)&&!dtd.$tableContent[pN.tagName]&&!dtd.$list[pN.tagName]){domUtils.removeAttributes(pN,removeFormatAttributes)}range.moveToBookmark(bookmark).moveToBookmark(bookmark1);var node=range.startContainer,tmp,collapsed=range.collapsed;while(node.nodeType==1&&domUtils.isEmptyNode(node)&&dtd.$removeEmpty[node.tagName]){tmp=node.parentNode;range.setStartBefore(node);if(range.startContainer===range.endContainer){range.endOffset--}domUtils.remove(node);node=tmp}if(!collapsed){node=range.endContainer;while(node.nodeType==1&&domUtils.isEmptyNode(node)&&dtd.$removeEmpty[node.tagName]){tmp=node.parentNode;range.setEndBefore(node);domUtils.remove(node);node=tmp}}}if(this.currentSelectedArr&&this.currentSelectedArr.length){for(var i=0,ci;ci=this.currentSelectedArr[i++];){range.selectNodeContents(ci);doRemove(range)}range.selectNodeContents(this.currentSelectedArr[0]).select()}else{if(removeType=="清除全部样式"){var body=this.body,range=this.selection.getRange();range.selectNodeContents(body);if(domUtils.isEmptyBlock(body)){if(browser.opera&&body.firstChild&&body.firstChild.nodeType==1){range.setStartAtFirst(body.firstChild)}range.collapse(true)}range.select(true);doRemove(range);range.select()}else{if(removeType=="清除选中样式"){range=this.selection.getRange();range.select(true);if(browser.version<9){if(this.document.selection.createRange().text!=""){doRemove(range);range.select()}}else{if(this.selection.getText().trim()!=""){doRemove(range);range.select()}}}else{if(removeType=="清除全部链接"){var doc=this.document,aTags=doc.getElementsByTagName("a"),aTagsLength=aTags.length;if(!aTags){return}for(var i=aTagsLength-1;i>=0;i--){var spanTag=doc.createElement("span"),atagStyle=aTags[i].style;spanTag.innerHTML=aTags[i].innerHTML;aTags[i].parentNode.insertBefore(spanTag,aTags[i]);aTags[i].parentNode.removeChild(aTags[i])}}else{range=this.selection.getRange();doRemove(range);range.select()}}}}},queryCommandState:function(){return this.highlight?-1:0}}};UE.plugins.paragraph=function(){var me=this,block=domUtils.isBlockElm,notExchange=["TD","LI","PRE"],doParagraph=function(range,style,attrs,sourceCmdName){var bookmark=range.createBookmark(),filterFn=function(node){return node.nodeType==1?node.tagName.toLowerCase()!="br"&&!domUtils.isBookmarkNode(node):!domUtils.isWhitespace(node)},para;range.enlarge(true);var bookmark2=range.createBookmark(),current=domUtils.getNextDomNode(bookmark2.start,false,filterFn),tmpRange=range.cloneRange(),tmpNode;while(current&&!(domUtils.getPosition(current,bookmark2.end)&domUtils.POSITION_FOLLOWING)){if(current.nodeType==3||!block(current)){tmpRange.setStartBefore(current);while(current&&current!==bookmark2.end&&!block(current)){tmpNode=current;current=domUtils.getNextDomNode(current,false,null,function(node){return !block(node)})}tmpRange.setEndAfter(tmpNode);para=range.document.createElement(style);if(attrs){domUtils.setAttributes(para,attrs);if(sourceCmdName&&sourceCmdName=="customstyle"&&attrs.style){para.style.cssText=attrs.style}}para.appendChild(tmpRange.extractContents());if(domUtils.isEmptyNode(para)){domUtils.fillChar(range.document,para)}tmpRange.insertNode(para);var parent=para.parentNode;if(block(parent)&&!domUtils.isBody(para.parentNode)&&utils.indexOf(notExchange,parent.tagName)==-1){if(!(sourceCmdName&&sourceCmdName=="customstyle")){parent.getAttribute("dir")&&para.setAttribute("dir",parent.getAttribute("dir"));parent.style.cssText&&(para.style.cssText=parent.style.cssText+";"+para.style.cssText);parent.style.textAlign&&!para.style.textAlign&&(para.style.textAlign=parent.style.textAlign);parent.style.textIndent&&!para.style.textIndent&&(para.style.textIndent=parent.style.textIndent);parent.style.padding&&!para.style.padding&&(para.style.padding=parent.style.padding)}if(attrs&&/h\d/i.test(parent.tagName)&&!/h\d/i.test(para.tagName)){domUtils.setAttributes(parent,attrs);if(sourceCmdName&&sourceCmdName=="customstyle"&&attrs.style){parent.style.cssText=attrs.style}domUtils.remove(para,true);para=parent}else{domUtils.remove(para.parentNode,true)}}if(utils.indexOf(notExchange,parent.tagName)!=-1){current=parent}else{current=para}current=domUtils.getNextDomNode(current,false,filterFn)}else{current=domUtils.getNextDomNode(current,true,filterFn)}}return range.moveToBookmark(bookmark2).moveToBookmark(bookmark)};me.setOpt("paragraph",{p:"",h1:"",h2:"",h3:"",h4:"",h5:"",h6:""});me.commands.paragraph={execCommand:function(cmdName,style,attrs,sourceCmdName){var range=new dom.Range(this.document);if(this.currentSelectedArr&&this.currentSelectedArr.length>0){for(var i=0,ti;ti=this.currentSelectedArr[i++];){if(ti.style.display=="none"){continue}if(domUtils.isEmptyNode(ti)){var tmpTxt=this.document.createTextNode("paragraph");ti.innerHTML="";ti.appendChild(tmpTxt)}doParagraph(range.selectNodeContents(ti),style,attrs,sourceCmdName);if(tmpTxt){var pN=tmpTxt.parentNode;domUtils.remove(tmpTxt);if(domUtils.isEmptyNode(pN)){domUtils.fillNode(this.document,pN)}}}var td=this.currentSelectedArr[0];if(domUtils.isEmptyBlock(td)){range.setStart(td,0).setCursor(false,true)}else{range.selectNode(td).select()}}else{range=this.selection.getRange();if(range.collapsed){var txt=this.document.createTextNode("p");range.insertNode(txt);if(browser.ie){var node=txt.previousSibling;if(node&&domUtils.isWhitespace(node)){domUtils.remove(node)}node=txt.nextSibling;if(node&&domUtils.isWhitespace(node)){domUtils.remove(node)}}}range=doParagraph(range,style,attrs,sourceCmdName);if(txt){range.setStartBefore(txt).collapse(true);pN=txt.parentNode;domUtils.remove(txt);if(domUtils.isBlockElm(pN)&&domUtils.isEmptyNode(pN)){domUtils.fillNode(this.document,pN)}}if(browser.gecko&&range.collapsed&&range.startContainer.nodeType==1){var child=range.startContainer.childNodes[range.startOffset];if(child&&child.nodeType==1&&child.tagName.toLowerCase()==style){range.setStart(child,0).collapse(true)}}range.select()}return true},queryCommandValue:function(){var node=utils.findNode(this.selection.getStartElementPath(),["p","h1","h2","h3","h4","h5","h6"]);return node?node.tagName.toLowerCase():""},queryCommandState:function(){return this.highlight?-1:0}}};UE.plugins.lineheight=function(){var me=this;me.setOpt({lineheight:["1","1.5","1.75","2","2.5","3","4","5"]});me.commands.lineheight={execCommand:function(cmdName,value){this.execCommand("paragraph","p",{style:"line-height:"+(value=="1"?"normal":value+"em")});return true},queryCommandValue:function(){var pN=utils.findNode(this.selection.getStartElementPath(),null,function(node){return domUtils.isBlockElm(node)});if(pN){var value=domUtils.getComputedStyle(pN,"line-height");return value=="normal"?1:value.replace(/[^\d.]*/ig,"")}},queryCommandState:function(){return this.highlight?-1:0}}};UE.plugins.pagebreak=function(){var me=this,notBreakTags=["td"];function fillNode(node){if(domUtils.isEmptyBlock(node)){var firstChild=node.firstChild,tmpNode;while(firstChild&&firstChild.nodeType==1&&domUtils.isEmptyBlock(firstChild)){tmpNode=firstChild;firstChild=firstChild.firstChild}!tmpNode&&(tmpNode=node);domUtils.fillNode(me.document,tmpNode)}}function isHr(node){return node&&node.nodeType==1&&node.tagName=="HR"&&node.className=="pagebreak"}me.setOpt("pageBreakTag","_baidu_page_break_tag_");me.addInputRule(function(root){root.traversal(function(node){if(node.type=="text"&&node.data==me.options.pageBreakTag){var hr=UE.uNode.createElement('<hr class="pagebreak" noshade="noshade" size="5" style="-webkit-user-select: none;">');node.parentNode.insertBefore(hr,node);node.parentNode.removeChild(node)}})});me.addOutputRule(function(node){utils.each(node.getNodesByTagName("hr"),function(n){if(n.getAttr("class")=="pagebreak"){var txt=UE.uNode.createText(me.options.pageBreakTag);n.parentNode.insertBefore(txt,n);n.parentNode.removeChild(n)}})});me.commands.pagebreak={execCommand:function(){var range=me.selection.getRange(),hr=me.document.createElement("hr");domUtils.setAttributes(hr,{"class":"pagebreak",noshade:"noshade",size:"5"});domUtils.unselectable(hr);var node=domUtils.findParentByTagName(range.startContainer,notBreakTags,true),parents=[],pN;if(node){switch(node.tagName){case"TD":pN=node.parentNode;if(!pN.previousSibling){var table=domUtils.findParentByTagName(pN,"table");table.parentNode.insertBefore(hr,table);parents=domUtils.findParents(hr,true)}else{pN.parentNode.insertBefore(hr,pN);parents=domUtils.findParents(hr)}pN=parents[1];if(hr!==pN){domUtils.breakParent(hr,pN)}domUtils.clearSelectedArr(me.currentSelectedArr);me.fireEvent("afteradjusttable",me.document)}}else{if(!range.collapsed){range.deleteContents();var start=range.startContainer;while(!domUtils.isBody(start)&&domUtils.isBlockElm(start)&&domUtils.isEmptyNode(start)){range.setStartBefore(start).collapse(true);domUtils.remove(start);start=range.startContainer}}range.insertNode(hr);var pN=hr.parentNode,nextNode;while(!domUtils.isBody(pN)){domUtils.breakParent(hr,pN);nextNode=hr.nextSibling;if(nextNode&&domUtils.isEmptyBlock(nextNode)){domUtils.remove(nextNode)}pN=hr.parentNode}nextNode=hr.nextSibling;var pre=hr.previousSibling;if(isHr(pre)){domUtils.remove(pre)}else{pre&&fillNode(pre)}if(!nextNode){var p=me.document.createElement("p");hr.parentNode.appendChild(p);domUtils.fillNode(me.document,p);range.setStart(p,0).collapse(true)}else{if(isHr(nextNode)){domUtils.remove(nextNode)}else{fillNode(nextNode)}range.setEndAfter(hr).collapse(false)}range.select(true)}},queryCommandState:function(){return this.highlight?-1:0}}};(function(){function getClipboardData(callback){var doc=this.document;if(doc.getElementById("baidu_pastebin")){return}var range=this.selection.getRange(),bk=range.createBookmark(),pastebin=doc.createElement("div");pastebin.id="baidu_pastebin";browser.webkit&&pastebin.appendChild(doc.createTextNode(domUtils.fillChar+domUtils.fillChar));doc.body.appendChild(pastebin);bk.start.style.display="";pastebin.style.cssText="position:absolute;width:1px;height:1px;overflow:hidden;left:-1000px;white-space:nowrap;top:"+domUtils.getXY(bk.start).y+"px";range.selectNodeContents(pastebin).select(true);setTimeout(function(){if(browser.webkit){for(var i=0,pastebins=doc.querySelectorAll("#baidu_pastebin"),pi;pi=pastebins[i++];){if(domUtils.isEmptyNode(pi)){domUtils.remove(pi)}else{pastebin=pi;break}}}try{pastebin.parentNode.removeChild(pastebin)}catch(e){}range.moveToBookmark(bk).select(true);callback(pastebin)},0)}UE.plugins.paste=function(){var me=this;var word_img_flag={flag:""};var pasteplain=me.options.pasteplain===true;var modify_num={flag:""};me.commands.pasteplain={queryCommandState:function(){return pasteplain},execCommand:function(){pasteplain=!pasteplain|0},notNeedUndo:1};function filter(div){var html;if(div.firstChild){var nodes=domUtils.getElementsByTagName(div,"span");for(var i=0,ni;ni=nodes[i++];){if(ni.id=="_baidu_cut_start"||ni.id=="_baidu_cut_end"){domUtils.remove(ni)}}if(browser.webkit){var brs=div.querySelectorAll("div br");for(var i=0,bi;bi=brs[i++];){var pN=bi.parentNode;if(pN.tagName=="DIV"&&pN.childNodes.length==1){pN.innerHTML="<p><br/></p>";domUtils.remove(pN)}}var divs=div.querySelectorAll("#baidu_pastebin");for(var i=0,di;di=divs[i++];){var tmpP=me.document.createElement("p");di.parentNode.insertBefore(tmpP,di);while(di.firstChild){tmpP.appendChild(di.firstChild)}domUtils.remove(di)}var metas=div.querySelectorAll("meta");for(var i=0,ci;ci=metas[i++];){domUtils.remove(ci)}var brs=div.querySelectorAll("br");for(i=0;ci=brs[i++];){if(/^apple-/.test(ci)){domUtils.remove(ci)}}}if(browser.gecko){var dirtyNodes=div.querySelectorAll("[_moz_dirty]");for(i=0;ci=dirtyNodes[i++];){ci.removeAttribute("_moz_dirty")}if(/<img data\:image\/*\/>/.test(div.innerHTML)){div.innerHTML=""}}if(!browser.ie){var spans=div.querySelectorAll("span.apple-style-span");for(var i=0,ci;ci=spans[i++];){domUtils.remove(ci,true)}}html=div.innerHTML;html=UE.filterWord(html);var f=me.serialize;if(f){try{var node=f.transformInput(f.parseHTML(f.word(html)),word_img_flag);node=f.transformFliterStyle(node);node=f.filter(node,pasteplain?{whiteList:{p:{br:1,BR:1,$:{}},br:{"$":{}},div:{br:1,BR:1,"$":{}},li:{"$":{}},tr:{td:1,"$":{}},td:{"$":{}}},blackList:{style:1,script:1,object:1}}:null,!pasteplain?modify_num:null);if(browser.webkit){var length=node.children.length,child;while((child=node.children[length-1])&&child.tag=="br"){node.children.splice(length-1,1);length=node.children.length}}var delIdClass=true;html=f.toHTML(node,pasteplain,delIdClass);txtContent=f.filter(node,{whiteList:{p:{br:1,BR:1,$:{}},br:{"$":{}},div:{br:1,BR:1,"$":{},table:1,ul:1,ol:1},li:{"$":{}},ul:{li:1,"$":{}},ol:{li:1,"$":{}},tr:{td:1,"$":{}},td:{"$":{}},table:{tr:1,tbody:1,td:1,"$":{}},tbody:{tr:1,td:1,"$":{}},h1:{"$":{}},h2:{"$":{}},h3:{"$":{}},h4:{"$":{}},h5:{"$":{}},h6:{"$":{}}},blackList:{style:1,script:1,object:1}});txtContent=f.toHTML(txtContent,true)}catch(e){}}html={html:html};me.fireEvent("beforepaste",html);me.execCommand("insertHtml",html.html,true);me.fireEvent("afterpaste")}}me.addListener("ready",function(){domUtils.on(me.body,"cut",function(){var range=me.selection.getRange();if(!range.collapsed&&me.undoManger){me.undoManger.save()}});domUtils.on(me.body,browser.ie||browser.opera?"keydown":"paste",function(ev){if((browser.ie||browser.opera)&&(!ev.ctrlKey||ev.keyCode!="86")){return}if(baidu.editor.PasteImgUpload(ev,me)){return}getClipboardData.call(me,function(div){filter(div);if(me.options.setContentTxt){var reg=new RegExp(domUtils.fillChar,"g");div.innerHTML=div[browser.ie?"innerText":"textContent"].replace(reg,"").replace(/\u00a0/g," ")}})})})}})();UE.plugins.list=function(){var me=this,notExchange={TD:1,PRE:1,BLOCKQUOTE:1};me.setOpt({insertorderedlist:{decimal:"","lower-alpha":"","lower-roman":"","upper-alpha":"","upper-roman":""},insertunorderedlist:{circle:"",disc:"",square:""}});function adjustList(list,tag,style){var nextList=list.nextSibling;if(nextList&&nextList.nodeType==1&&nextList.tagName.toLowerCase()==tag&&(domUtils.getStyle(nextList,"list-style-type")||(tag=="ol"?"decimal":"disc"))==style){domUtils.moveChild(nextList,list);if(nextList.childNodes.length==0){domUtils.remove(nextList)}}var preList=list.previousSibling;if(preList&&preList.nodeType==1&&preList.tagName.toLowerCase()==tag&&(domUtils.getStyle(preList,"list-style-type")||(tag=="ol"?"decimal":"disc"))==style){domUtils.moveChild(list,preList)}if(list.childNodes.length==0){domUtils.remove(list)}}me.addListener("keydown",function(type,evt){function preventAndSave(){evt.preventDefault?evt.preventDefault():(evt.returnValue=false);me.undoManger&&me.undoManger.save()}var keyCode=evt.keyCode||evt.which;if(keyCode==13){var range=me.selection.getRange(),start=domUtils.findParentByTagName(range.startContainer,["ol","ul"],true,function(node){return node.tagName=="TABLE"}),end=domUtils.findParentByTagName(range.endContainer,["ol","ul"],true,function(node){return node.tagName=="TABLE"});if(start&&end&&start===end){if(!range.collapsed){start=domUtils.findParentByTagName(range.startContainer,"li",true);end=domUtils.findParentByTagName(range.endContainer,"li",true);if(start&&end&&start===end){range.deleteContents();li=domUtils.findParentByTagName(range.startContainer,"li",true);if(li&&domUtils.isEmptyBlock(li)){pre=li.previousSibling;next=li.nextSibling;p=me.document.createElement("p");domUtils.fillNode(me.document,p);parentList=li.parentNode;if(pre&&next){range.setStart(next,0).collapse(true).select(true);domUtils.remove(li)}else{if(!pre&&!next||!pre){parentList.parentNode.insertBefore(p,parentList)}else{li.parentNode.parentNode.insertBefore(p,parentList.nextSibling)}domUtils.remove(li);if(!parentList.firstChild){domUtils.remove(parentList)}range.setStart(p,0).setCursor()}preventAndSave();return}}else{var tmpRange=range.cloneRange(),bk=tmpRange.collapse(false).createBookmark();range.deleteContents();tmpRange.moveToBookmark(bk);var li=domUtils.findParentByTagName(tmpRange.startContainer,"li",true),pre=li.previousSibling,next=li.nextSibling;if(pre){li=pre;if(pre.firstChild&&domUtils.isBlockElm(pre.firstChild)){pre=pre.firstChild}if(domUtils.isEmptyNode(pre)){domUtils.remove(li)}}if(next){li=next;if(next.firstChild&&domUtils.isBlockElm(next.firstChild)){next=next.firstChild}if(domUtils.isEmptyNode(next)){domUtils.remove(li)}}tmpRange.select();preventAndSave();return}}li=domUtils.findParentByTagName(range.startContainer,"li",true);if(li){if(domUtils.isEmptyBlock(li)){bk=range.createBookmark();var parentList=li.parentNode;if(li!==parentList.lastChild){domUtils.breakParent(li,parentList)}else{parentList.parentNode.insertBefore(li,parentList.nextSibling);if(domUtils.isEmptyNode(parentList)){domUtils.remove(parentList)}}if(!dtd.$list[li.parentNode.tagName]){if(!domUtils.isBlockElm(li.firstChild)){p=me.document.createElement("p");li.parentNode.insertBefore(p,li);while(li.firstChild){p.appendChild(li.firstChild)}domUtils.remove(li)}else{domUtils.remove(li,true)}}range.moveToBookmark(bk).select()}else{var first=li.firstChild;if(!first||!domUtils.isBlockElm(first)){var p=me.document.createElement("p");!li.firstChild&&domUtils.fillNode(me.document,p);while(li.firstChild){p.appendChild(li.firstChild)}li.appendChild(p);first=p}var span=me.document.createElement("span");range.insertNode(span);domUtils.breakParent(span,li);var nextLi=span.nextSibling;first=nextLi.firstChild;if(!first){p=me.document.createElement("p");domUtils.fillNode(me.document,p);nextLi.appendChild(p);first=p}if(domUtils.isEmptyNode(first)){first.innerHTML="";domUtils.fillNode(me.document,first)}range.setStart(first,0).collapse(true).shrinkBoundary().select();domUtils.remove(span);pre=nextLi.previousSibling;if(pre&&domUtils.isEmptyBlock(pre)){pre.innerHTML="<p></p>";domUtils.fillNode(me.document,pre.firstChild)}}preventAndSave()}}}if(keyCode==8){range=me.selection.getRange();if(range.collapsed&&domUtils.isStartInblock(range)){tmpRange=range.cloneRange().trimBoundary();li=domUtils.findParentByTagName(range.startContainer,"li",true);if(li&&domUtils.isStartInblock(tmpRange)){if(li&&(pre=li.previousSibling)){if(keyCode==46&&li.childNodes.length){return}if(dtd.$list[pre.tagName]){pre=pre.lastChild}me.undoManger&&me.undoManger.save();first=li.firstChild;if(domUtils.isBlockElm(first)){if(domUtils.isEmptyNode(first)){pre.appendChild(first);range.setStart(first,0).setCursor(false,true);while(li.firstChild){pre.appendChild(li.firstChild)}}else{start=domUtils.findParentByTagName(range.startContainer,"p",true);if(start&&start!==first){return}span=me.document.createElement("span");range.insertNode(span);if(domUtils.isEmptyBlock(pre)){pre.innerHTML=""}domUtils.moveChild(li,pre);range.setStartBefore(span).collapse(true).select(true);domUtils.remove(span)}}else{if(domUtils.isEmptyNode(li)){var p=me.document.createElement("p");pre.appendChild(p);range.setStart(p,0).setCursor()}else{range.setEnd(pre,pre.childNodes.length).collapse().select(true);while(li.firstChild){pre.appendChild(li.firstChild)}}}domUtils.remove(li);me.undoManger&&me.undoManger.save();domUtils.preventDefault(evt);return}if(li&&!li.previousSibling){first=li.firstChild;if(!first||li.lastChild===first&&domUtils.isEmptyNode(domUtils.isBlockElm(first)?first:li)){var p=me.document.createElement("p");li.parentNode.parentNode.insertBefore(p,li.parentNode);domUtils.fillNode(me.document,p);range.setStart(p,0).setCursor();domUtils.remove(!li.nextSibling?li.parentNode:li);me.undoManger&&me.undoManger.save();domUtils.preventDefault(evt);return}}}}}});me.commands.insertorderedlist=me.commands.insertunorderedlist={execCommand:function(command,style){if(!style){style=command.toLowerCase()=="insertorderedlist"?"decimal":"disc"}var me=this,range=this.selection.getRange(),filterFn=function(node){return node.nodeType==1?node.tagName.toLowerCase()!="br":!domUtils.isWhitespace(node)},tag=command.toLowerCase()=="insertorderedlist"?"ol":"ul",frag=me.document.createDocumentFragment();range.adjustmentBoundary().shrinkBoundary();var bko=range.createBookmark(true),start=domUtils.findParentByTagName(me.document.getElementById(bko.start),"li"),modifyStart=0,end=domUtils.findParentByTagName(me.document.getElementById(bko.end),"li"),modifyEnd=0,startParent,endParent,list,tmp;if(start||end){start&&(startParent=start.parentNode);if(!bko.end){end=start}end&&(endParent=end.parentNode);if(startParent===endParent){while(start!==end){tmp=start;start=start.nextSibling;if(!domUtils.isBlockElm(tmp.firstChild)){var p=me.document.createElement("p");while(tmp.firstChild){p.appendChild(tmp.firstChild)}tmp.appendChild(p)}frag.appendChild(tmp)}tmp=me.document.createElement("span");startParent.insertBefore(tmp,end);if(!domUtils.isBlockElm(end.firstChild)){p=me.document.createElement("p");while(end.firstChild){p.appendChild(end.firstChild)}end.appendChild(p)}frag.appendChild(end);domUtils.breakParent(tmp,startParent);if(domUtils.isEmptyNode(tmp.previousSibling)){domUtils.remove(tmp.previousSibling)}if(domUtils.isEmptyNode(tmp.nextSibling)){domUtils.remove(tmp.nextSibling)}var nodeStyle=domUtils.getComputedStyle(startParent,"list-style-type")||(command.toLowerCase()=="insertorderedlist"?"decimal":"disc");if(startParent.tagName.toLowerCase()==tag&&nodeStyle==style){for(var i=0,ci,tmpFrag=me.document.createDocumentFragment();ci=frag.childNodes[i++];){while(ci.firstChild){tmpFrag.appendChild(ci.firstChild)}}tmp.parentNode.insertBefore(tmpFrag,tmp)}else{list=me.document.createElement(tag);domUtils.setStyle(list,"list-style-type",style);list.appendChild(frag);tmp.parentNode.insertBefore(list,tmp)}domUtils.remove(tmp);list&&adjustList(list,tag,style);range.moveToBookmark(bko).select();return}if(start){while(start){tmp=start.nextSibling;var tmpfrag=me.document.createDocumentFragment(),hasBlock=0;while(start.firstChild){if(domUtils.isBlockElm(start.firstChild)){hasBlock=1}tmpfrag.appendChild(start.firstChild)}if(!hasBlock){var tmpP=me.document.createElement("p");tmpP.appendChild(tmpfrag);frag.appendChild(tmpP)}else{frag.appendChild(tmpfrag)}domUtils.remove(start);start=tmp}startParent.parentNode.insertBefore(frag,startParent.nextSibling);if(domUtils.isEmptyNode(startParent)){range.setStartBefore(startParent);domUtils.remove(startParent)}else{range.setStartAfter(startParent)}modifyStart=1}if(end){start=endParent.firstChild;while(start!==end){tmp=start.nextSibling;tmpfrag=me.document.createDocumentFragment();hasBlock=0;while(start.firstChild){if(domUtils.isBlockElm(start.firstChild)){hasBlock=1}tmpfrag.appendChild(start.firstChild)}if(!hasBlock){tmpP=me.document.createElement("p");tmpP.appendChild(tmpfrag);frag.appendChild(tmpP)}else{frag.appendChild(tmpfrag)}domUtils.remove(start);start=tmp}frag.appendChild(end.firstChild);domUtils.remove(end);endParent.parentNode.insertBefore(frag,endParent);range.setEndBefore(endParent);if(domUtils.isEmptyNode(endParent)){domUtils.remove(endParent)}modifyEnd=1}}if(!modifyStart){range.setStartBefore(me.document.getElementById(bko.start))}if(bko.end&&!modifyEnd){range.setEndAfter(me.document.getElementById(bko.end))}range.enlarge(true,function(node){return notExchange[node.tagName]});frag=me.document.createDocumentFragment();var bk=range.createBookmark(),current=domUtils.getNextDomNode(bk.start,false,filterFn),tmpRange=range.cloneRange(),tmpNode,block=domUtils.isBlockElm;while(current&&current!==bk.end&&(domUtils.getPosition(current,bk.end)&domUtils.POSITION_PRECEDING)){if(current.nodeType==3||dtd.li[current.tagName]){if(current.nodeType==1&&dtd.$list[current.tagName]){while(current.firstChild){frag.appendChild(current.firstChild)}tmpNode=domUtils.getNextDomNode(current,false,filterFn);domUtils.remove(current);current=tmpNode;continue}tmpNode=current;tmpRange.setStartBefore(current);while(current&&current!==bk.end&&(!block(current)||domUtils.isBookmarkNode(current))){tmpNode=current;current=domUtils.getNextDomNode(current,false,null,function(node){return !notExchange[node.tagName]})}if(current&&block(current)){tmp=domUtils.getNextDomNode(tmpNode,false,filterFn);if(tmp&&domUtils.isBookmarkNode(tmp)){current=domUtils.getNextDomNode(tmp,false,filterFn);tmpNode=tmp}}tmpRange.setEndAfter(tmpNode);current=domUtils.getNextDomNode(tmpNode,false,filterFn);var li=range.document.createElement("li");li.appendChild(tmpRange.extractContents());frag.appendChild(li)}else{current=domUtils.getNextDomNode(current,true,filterFn)}}range.moveToBookmark(bk).collapse(true);list=me.document.createElement(tag);domUtils.setStyle(list,"list-style-type",style);list.appendChild(frag);range.insertNode(list);adjustList(list,tag,style);range.moveToBookmark(bko).select()},queryCommandState:function(command){return this.highlight?-1:utils.findNode(this.selection.getStartElementPath(),[command.toLowerCase()=="insertorderedlist"?"ol":"ul"])?1:0},queryCommandValue:function(command){var node=utils.findNode(this.selection.getStartElementPath(),[command.toLowerCase()=="insertorderedlist"?"ol":"ul"]);return node?domUtils.getComputedStyle(node,"list-style-type"):null}}};(function(){function SourceFormater(config){config=config||{};this.indentChar=config.indentChar||"    ";this.breakChar=config.breakChar||"\n";this.selfClosingEnd=config.selfClosingEnd||" />"}var unhtml1=function(){var map={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function rep(m){return map[m]}return function(str){str=str+"";return str?str.replace(/[<>"']/g,rep):""}}();var inline=utils.extend({a:1,A:1},dtd.$inline,true);function printAttrs(attrs){var buff=[];for(var k in attrs){buff.push(k+'="'+unhtml1(attrs[k])+'"')}return buff.join(" ")}SourceFormater.prototype={format:function(html){var node=UE.serialize.parseHTML(html);this.buff=[];this.indents="";this.indenting=1;this.visitNode(node);return this.buff.join("")},visitNode:function(node){if(node.type=="fragment"){this.visitChildren(node.children)}else{if(node.type=="element"){var selfClosing=dtd.$empty[node.tag];this.visitTag(node.tag,node.attributes,selfClosing);this.visitChildren(node.children);if(!selfClosing){this.visitEndTag(node.tag)}}else{if(node.type=="comment"){this.visitComment(node.data)}else{this.visitText(node.data,dtd.$notTransContent[node.parent.tag])}}}},visitChildren:function(children){for(var i=0;i<children.length;i++){this.visitNode(children[i])}},visitTag:function(tag,attrs,selfClosing){if(this.indenting){this.indent()}else{if(!inline[tag]){this.newline();this.indent()}}this.buff.push("<",tag);var attrPart=printAttrs(attrs);if(attrPart){this.buff.push(" ",attrPart)}if(selfClosing){this.buff.push(this.selfClosingEnd);if(tag=="br"){this.newline()}}else{this.buff.push(">");this.indents+=this.indentChar}if(!inline[tag]){this.newline()}},indent:function(){this.buff.push(this.indents);this.indenting=0},newline:function(){this.buff.push(this.breakChar);this.indenting=1},visitEndTag:function(tag){this.indents=this.indents.slice(0,-this.indentChar.length);if(this.indenting){this.indent()}else{if(!inline[tag]){this.newline();this.indent()}}this.buff.push("</",tag,">")},visitText:function(text,notTrans){if(this.indenting){this.indent()}this.buff.push(text)},visitComment:function(text){if(this.indenting){this.indent()}this.buff.push("<!--",text,"-->")}};var sourceEditors={textarea:function(editor,holder){var textarea=holder.ownerDocument.createElement("textarea");textarea.style.cssText="position:absolute;resize:none;width:100%;height:100%;border:0;padding:0;margin:0;overflow-y:auto;";if(browser.ie&&browser.version<8){textarea.style.width=holder.offsetWidth+"px";textarea.style.height=holder.offsetHeight+"px";holder.onresize=function(){textarea.style.width=holder.offsetWidth+"px";textarea.style.height=holder.offsetHeight+"px"}}holder.appendChild(textarea);return{setContent:function(content){textarea.value=content},getContent:function(){return textarea.value},select:function(){var range;if(browser.ie){range=textarea.createTextRange();range.collapse(true);range.select()}else{textarea.setSelectionRange(0,0);textarea.focus()}},dispose:function(){holder.removeChild(textarea);holder.onresize=null;textarea=null;holder=null}}},codemirror:function(editor,holder){var codeEditor=window.CodeMirror(holder,{mode:"text/html",tabMode:"indent",lineNumbers:true,lineWrapping:true});var dom=codeEditor.getWrapperElement();dom.style.cssText='position:absolute;left:0;top:0;width:100%;height:100%;font-family:consolas,"Courier new",monospace;font-size:13px;';codeEditor.getScrollerElement().style.cssText="position:absolute;left:0;top:0;width:100%;height:100%;";codeEditor.refresh();return{getCodeMirror:function(){return codeEditor},setContent:function(content){codeEditor.setValue(content)},getContent:function(){return codeEditor.getValue()},select:function(){codeEditor.focus()},dispose:function(){holder.removeChild(dom);dom=null;codeEditor=null}}}};UE.plugins.source=function(){var me=this;var opt=this.options;var formatter=new SourceFormater(opt.source);var sourceMode=false;var sourceEditor;opt.sourceEditor=browser.ie?"textarea":(opt.sourceEditor||"codemirror");me.setOpt({sourceEditorFirst:false});function createSourceEditor(holder){return sourceEditors[opt.sourceEditor=="codemirror"&&window.CodeMirror?"codemirror":"textarea"](me,holder)}var bakCssText;var oldGetContent=me.getContent,bakAddress;me.commands.source={execCommand:function(){sourceMode=!sourceMode;if(sourceMode){if(typeof me.options.htmlModuleRichTip=="function"){me.options.htmlModuleRichTip()}bakAddress=me.selection.getRange().createAddress(false,true);me.undoManger&&me.undoManger.save(true);if(browser.gecko){me.body.contentEditable=false}bakCssText=me.iframe.style.cssText;me.iframe.style.cssText+="position:absolute;left:-32768px;top:-32768px;";var content=formatter.format(me.getContent()=="<p><br /></p>"?"":me.getContent());sourceEditor=createSourceEditor(me.iframe.parentNode);sourceEditor.setContent(content);setTimeout(function(){sourceEditor.select();me.addListener("fullscreenchanged",function(){try{sourceEditor.getCodeMirror().refresh()}catch(e){}})});UE.plugins.source.getContent=me.getContent=function(){var cont=sourceEditor.getContent()||"<p>"+(browser.ie?"":"<br/>")+"</p>";return cont.replace(/>[\n\r\t]+([ ]{4})+/g,">").replace(/[\n\r\t]+([ ]{4})+</g,"<").replace(/>[\n\r\t]+</g,"><")}}else{me.iframe.style.cssText=bakCssText;var cont=sourceEditor.getContent()||"<p>"+(browser.ie?"":"<br/>")+"</p>";cont=cont.replace(/>[\n\r\t]+([ ]{4})+/g,">").replace(/[\n\r\t]+([ ]{4})+</g,"<").replace(/>[\n\r\t]+</g,"><");me.setContent(cont);sourceEditor.dispose();sourceEditor=null;me.getContent=oldGetContent;var first=me.body.firstChild;if(!first){me.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>";first=me.body.firstChild}me.undoManger&&me.undoManger.save(true);if(browser.gecko){var input=document.createElement("input");input.style.cssText="position:absolute;left:0;top:-32768px";document.body.appendChild(input);me.body.contentEditable=false;setTimeout(function(){domUtils.setViewportOffset(input,{left:-32768,top:0});input.focus();setTimeout(function(){me.body.contentEditable=true;me.selection.getRange().moveToAddress(bakAddress).select();domUtils.remove(input)})})}else{try{me.selection.getRange().moveToAddress(bakAddress).select()}catch(e){}}}this.fireEvent("sourcemodechanged",sourceMode);UE.plugins.source.sourceMode=sourceMode},queryCommandState:function(){return sourceMode|0},notNeedUndo:1};var oldQueryCommandState=me.queryCommandState;me.queryCommandState=function(cmdName){cmdName=cmdName.toLowerCase();if(sourceMode){return cmdName in {source:1,fullscreen:1}?1:-1}return oldQueryCommandState.apply(this,arguments)}}})();UE.plugins.fiximgclick=function(){var me=this;if(browser.webkit){me.addListener("click",function(type,e){if(e.target.tagName=="IMG"){var range=new dom.Range(me.document);range.selectNode(e.target).select()}})}};UE.plugins.rowspacing=function(){var me=this;me.setOpt({rowspacingtop:["5","10","15","20","25"],rowspacingbottom:["5","10","15","20","25"]});me.commands.rowspacing={execCommand:function(cmdName,value,dir){this.execCommand("paragraph","p",{style:"margin-"+dir+":"+value+"px"});return true},queryCommandValue:function(cmdName,dir){var pN=utils.findNode(this.selection.getStartElementPath(),null,function(node){return domUtils.isBlockElm(node)}),value;if(pN){value=domUtils.getComputedStyle(pN,"margin-"+dir).replace(/[^\d]/g,"");return !value?0:value}return 0},queryCommandState:function(){return this.highlight?-1:0}}};UE.plugins.autoheight=function(){var me=this;me.autoHeightEnabled=me.options.autoHeightEnabled!==false;if(!me.autoHeightEnabled){return}var bakOverflow,span,tmpNode,lastHeight=0,currentHeight,timer;function adjustHeight(){clearTimeout(timer);timer=setTimeout(function(){if(me.queryCommandState("source")!=1){if(!span){span=me.document.createElement("span");span.style.cssText="display:block;width:0;margin:0;padding:0;border:0;clear:both;";span.innerHTML="."}tmpNode=span.cloneNode(true);me.body.appendChild(tmpNode);currentHeight=Math.max(domUtils.getXY(tmpNode).y+tmpNode.offsetHeight,me.options.minFrameHeight);if(currentHeight!=lastHeight){me.setHeight(currentHeight);lastHeight=currentHeight}domUtils.remove(tmpNode)}},50)}me.addListener("destroy",function(){me.removeListener("contentchange",adjustHeight);me.removeListener("keyup",adjustHeight);me.removeListener("mouseup",adjustHeight)});me.enableAutoHeight=function(){if(!me.autoHeightEnabled){return}var doc=me.document;me.autoHeightEnabled=true;bakOverflow=doc.body.style.overflowY;doc.body.style.overflowY="hidden";me.addListener("contentchange",adjustHeight);me.addListener("keyup",adjustHeight);me.addListener("mouseup",adjustHeight);setTimeout(function(){adjustHeight()},browser.gecko?100:0);me.fireEvent("autoheightchanged",me.autoHeightEnabled)};me.disableAutoHeight=function(){me.body.style.overflowY=bakOverflow||"";me.removeListener("contentchange",adjustHeight);me.removeListener("keyup",adjustHeight);me.removeListener("mouseup",adjustHeight);me.autoHeightEnabled=false;me.fireEvent("autoheightchanged",me.autoHeightEnabled)};me.addListener("ready",function(){me.enableAutoHeight();var timer;domUtils.on(browser.ie?me.body:me.document,browser.webkit?"dragover":"drop",function(){clearTimeout(timer);timer=setTimeout(function(){adjustHeight()},100)})})};UE.plugins.serialize=function(){var ie=browser.ie,version=browser.version;function ptToPx(value){return/pt/.test(value)?value.replace(/([\d.]+)pt/g,function(str){return Math.round(parseFloat(str)*96/72)+"px"}):value}var me=this,autoClearEmptyNode=me.options.autoClearEmptyNode,EMPTY_TAG=dtd.$empty,parseHTML=function(){var RE_PART=/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)-->)|(?:([^\s\/>]+)\s*((?:(?:"[^"]*")|(?:'[^']*')|[^"'<>])*)\/?>))/g,RE_ATTR=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,EMPTY_ATTR={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1},CDATA_TAG={script:1,style:1},NEED_PARENT_TAG={li:{"$":"ul",ul:1,ol:1},dd:{"$":"dl",dl:1},dt:{"$":"dl",dl:1},option:{"$":"select",select:1},td:{"$":"tr",tr:1},th:{"$":"tr",tr:1},tr:{"$":"tbody",tbody:1,thead:1,tfoot:1,table:1},tbody:{"$":"table",table:1,colgroup:1},thead:{"$":"table",table:1},tfoot:{"$":"table",table:1},col:{"$":"colgroup",colgroup:1}};var NEED_CHILD_TAG={table:"td",tbody:"td",thead:"td",tfoot:"td",tr:"td",colgroup:"col",ul:"li",ol:"li",dl:"dd",select:"option"};function parse(html,callbacks){var match,nextIndex=0,tagName,cdata;RE_PART.exec("");while((match=RE_PART.exec(html))){var tagIndex=match.index;if(tagIndex>nextIndex){var text=html.slice(nextIndex,tagIndex);if(cdata){cdata.push(text)}else{callbacks.onText(text)}}nextIndex=RE_PART.lastIndex;if((tagName=match[1])){tagName=tagName.toLowerCase();if(cdata&&tagName==cdata._tag_name){callbacks.onCDATA(cdata.join(""));cdata=null}if(!cdata){callbacks.onTagClose(tagName);continue}}if(cdata){cdata.push(match[0]);continue}if((tagName=match[3])){if(/="/.test(tagName)){continue}tagName=tagName.toLowerCase();var attrPart=match[4],attrMatch,attrMap={},selfClosing=attrPart&&attrPart.slice(-1)=="/";if(attrPart){RE_ATTR.exec("");while((attrMatch=RE_ATTR.exec(attrPart))){var attrName=attrMatch[1].toLowerCase(),attrValue=attrMatch[2]||attrMatch[3]||attrMatch[4]||"";if(!attrValue&&EMPTY_ATTR[attrName]){attrValue=attrName}if(attrName=="style"){if(ie&&version<=6){attrValue=attrValue.replace(/(?!;)\s*([\w-]+):/g,function(m,p1){return p1.toLowerCase()+":"})}}if(attrValue){attrMap[attrName]=attrValue.replace(/:\s*/g,":")}}}callbacks.onTagOpen(tagName,attrMap,selfClosing);if(!cdata&&CDATA_TAG[tagName]){cdata=[];cdata._tag_name=tagName}continue}if((tagName=match[2])){callbacks.onComment(tagName)}}if(html.length>nextIndex){callbacks.onText(html.slice(nextIndex,html.length))}}return function(html,forceDtd){var fragment={type:"fragment",parent:null,children:[]};var currentNode=fragment;function addChild(node){node.parent=currentNode;currentNode.children.push(node)}function addElement(element,open){var node=element;if(NEED_PARENT_TAG[node.tag]){while(NEED_PARENT_TAG[currentNode.tag]&&NEED_PARENT_TAG[currentNode.tag][node.tag]){currentNode=currentNode.parent}if(currentNode.tag==node.tag){currentNode=currentNode.parent}while(NEED_PARENT_TAG[node.tag]){if(NEED_PARENT_TAG[node.tag][currentNode.tag]){break}node=node.parent={type:"element",tag:NEED_PARENT_TAG[node.tag]["$"],attributes:{},children:[node]}}}if(forceDtd){while(dtd[node.tag]&&!(currentNode.tag=="span"?utils.extend(dtd.strong,{a:1,A:1}):(dtd[currentNode.tag]||dtd.div))[node.tag]){if(tagEnd(currentNode)){continue}if(!currentNode.parent){break}currentNode=currentNode.parent}}node.parent=currentNode;currentNode.children.push(node);if(open){currentNode=element}if(element.attributes.style){}return element}function tagEnd(node){var needTag;if(!node.children.length&&(needTag=NEED_CHILD_TAG[node.tag])){addElement({type:"element",tag:needTag,attributes:{},children:[]},true);return true}return false}parse(html,{onText:function(text){while(!(dtd[currentNode.tag]||dtd.div)["#"]){if(tagEnd(currentNode)){continue}currentNode=currentNode.parent}addChild({type:"text",data:text})},onComment:function(text){addChild({type:"comment",data:text})},onCDATA:function(text){while(!(dtd[currentNode.tag]||dtd.div)["#"]){if(tagEnd(currentNode)){continue}currentNode=currentNode.parent}addChild({type:"cdata",data:text})},onTagOpen:function(tag,attrs,closed){closed=closed||EMPTY_TAG[tag];addElement({type:"element",tag:tag,attributes:attrs,closed:closed,children:[]},!closed)},onTagClose:function(tag){var node=currentNode;while(node&&tag!=node.tag){node=node.parent}if(node){for(var tnode=currentNode;tnode!==node.parent;tnode=tnode.parent){tagEnd(tnode)}currentNode=node.parent}else{if(!(dtd.$removeEmpty[tag]||dtd.$removeEmptyBlock[tag]||tag=="embed")){node={type:"element",tag:tag,attributes:{},children:[]};addElement(node,true);tagEnd(node);currentNode=node.parent}}}});while(currentNode!==fragment){tagEnd(currentNode);currentNode=currentNode.parent}return fragment}}();var unhtml1=function(){var map={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function rep(m){return map[m]}return function(str){str=str+"";return str?str.replace(/[<>"']/g,rep):""}}();var toHTML=function(){function printChildren(node,pasteplain,delIdClass){var children=node.children;var buff=[];for(var i=0,ci;ci=children[i];i++){buff.push(toHTML(ci,pasteplain,delIdClass))}return buff.join("")}function printAttrs(attrs){var buff=[];for(var k in attrs){var value=attrs[k];if(k=="style"){value=ptToPx(value);if(/rgba?\s*\([^)]*\)/.test(value)){value=value.replace(/rgba?\s*\(([^)]*)\)/g,function(str){return utils.fixColor("color",str)})}attrs[k]=utils.optCss(value.replace(/windowtext/g,"#000")).replace(/white-space[^;]+;/g,"")}buff.push(k+'="'+unhtml1(attrs[k])+'"')}return buff.join(" ")}function printData(node,notTrans){return notTrans?node.data.replace(/&nbsp;/g," "):unhtml1(node.data).replace(/ /g,"&nbsp;")}var transHtml={div:"p",li:"p",tr:"p",br:"br",p:"p"};function printElement(node,pasteplain,delIdClass){if(node.type=="element"&&!node.children.length&&(dtd.$removeEmpty[node.tag])&&node.tag!="a"&&utils.isEmptyObject(node.attributes)&&autoClearEmptyNode){return html}if(delIdClass){if(node.attributes&&node.attributes["class"]){delete node.attributes["class"]}if(node.attributes&&node.attributes.id){delete node.attributes.id}}var tag=node.tag;if(pasteplain&&tag=="td"){if(!html){html=""}html+=printChildren(node,pasteplain,delIdClass)+"&nbsp;&nbsp;&nbsp;"}else{var attrs=printAttrs(node.attributes);var html="<"+(pasteplain&&transHtml[tag]?transHtml[tag]:tag)+(attrs?" "+attrs:"")+(EMPTY_TAG[tag]?" />":">");if(!EMPTY_TAG[tag]){if(tag=="p"&&!node.children.length){html+=browser.ie?"&nbsp;":"<br/>"}html+=printChildren(node,pasteplain,delIdClass);html+="</"+(pasteplain&&transHtml[tag]?transHtml[tag]:tag)+">"}}return html}return function(node,pasteplain,delIdClass){if(node.type=="fragment"){return printChildren(node,pasteplain,delIdClass)}else{if(node.type=="element"){return printElement(node,pasteplain,delIdClass)}else{if(node.type=="text"||node.type=="cdata"){return printData(node,dtd.$notTransContent[node.parent.tag])}else{if(node.type=="comment"){return"<!--"+node.data+"-->"}}}}return""}}();var transformWordHtml=function(){function isWordDocument(strValue){var re=new RegExp(/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument|<v:)/ig);return re.test(strValue)}function ensureUnits(v){v=v.replace(/([\d.]+)([\w]+)?/g,function(m,p1,p2){return(Math.round(parseFloat(p1))||1)+(p2||"px")});return v}function filterPasteWord(str){str=str.replace(/<!--\s*EndFragment\s*-->[\s\S]*$/,"").replace(/^(\r\n|\n|\r)|(\r\n|\n|\r)$/ig,"").replace(/^\s*(&nbsp;)+/ig,"").replace(/(&nbsp;|<br[^>]*>)+\s*$/ig,"").replace(/<!--[\s\S]*?-->/ig,"").replace(/<v:shape [^>]*>[\s\S]*?.<\/v:shape>/gi,function(str){if(browser.opera){return""}try{var width=str.match(/width:([ \d.]*p[tx])/i)[1],height=str.match(/height:([ \d.]*p[tx])/i)[1],src=str.match(/src=\s*"([^"]*)"/i)[1];return'<img width="'+ptToPx(width)+'" height="'+ptToPx(height)+'" src="'+src+'" />'}catch(e){return""}}).replace(/v:\w+=["']?[^'"]+["']?/g,"").replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|xml|meta|link|style|\w+:\w+)(?=[\s\/>]))[^>]*>/gi,"").replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>").replace(/(lang)\s*=\s*([\'\"]?)[\w-]+\2/ig,"").replace(/<font[^>]*>\s*<\/font>/gi,"").replace(/class\s*=\s*["']?(?:(?:MsoTableGrid)|(?:MsoListParagraph)|(?:MsoNormal(Table)?))\s*["']?/gi,"");str=str.replace(/(<[a-z][^>]*)\sstyle=(["'])([^\2]*?)\2/gi,function(str,tag,tmp,style){var n=[],i=0,s=style.replace(/^\s+|\s+$/,"").replace(/&quot;/gi,"'").split(/;\s*/g);for(var i=0;i<s.length;i++){var v=s[i];var name,value,parts=v.split(":");if(parts.length==2){name=parts[0].toLowerCase();value=parts[1].toLowerCase();switch(name){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":if(!/<table/.test(tag)){n[i]=name.replace(/^mso-|-alt$/g,"")+":"+ensureUnits(value)}continue;case"horiz-align":n[i]="text-align:"+value;continue;case"vert-align":n[i]="vertical-align:"+value;continue;case"font-color":case"mso-foreground":n[i]="color:"+value;continue;case"mso-background":case"mso-highlight":n[i]="background:"+value;continue;case"mso-default-height":n[i]="min-height:"+ensureUnits(value);continue;case"mso-default-width":n[i]="min-width:"+ensureUnits(value);continue;case"mso-padding-between-alt":n[i]="border-collapse:separate;border-spacing:"+ensureUnits(value);continue;case"text-line-through":if((value=="single")||(value=="double")){n[i]="text-decoration:line-through"}continue;case"mso-zero-height":if(value=="yes"){n[i]="display:none"}continue;case"margin":if(!/[1-9]/.test(parts[1])){continue}}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?:decor|trans)|top-bar|version|vnd|word-break)/.test(name)){continue}if(/text\-indent|padding|margin/.test(name)&&/\-[\d.]+/.test(value)){continue}n[i]=name+":"+parts[1]}}if(i>0){return tag+' style="'+n.join(";")+'"'}else{return tag}});str=str.replace(/([ ]+)<\/span>/ig,function(m,p){return new Array(p.length+1).join("&nbsp;")+"</span>"});return str}return function(html){first=null;parentTag="",liStyle="",firstTag="";if(isWordDocument(html)){html=filterPasteWord(html)}return html.replace(/>[ \t\r\n]*</g,"><")}}();var NODE_NAME_MAP={text:"#text",comment:"#comment",cdata:"#cdata-section",fragment:"#document-fragment"};var first,parentTag="",liStyle="",firstTag;function transNode(node,word_img_flag){var sizeMap=[0,10,12,16,18,24,32,48],attr,indexOf=utils.indexOf;switch(node.tag){case"img":if(browser.gecko){if(node.attributes.src&&/^data:/.test(node.attributes.src)){return{type:"fragment",children:[]}}}if(node.attributes.src&&/^(?:file)/.test(node.attributes.src)){if(!/(gif|bmp|png|jpg|jpeg)$/.test(node.attributes.src)){return{type:"fragment",children:[]}}node.attributes.word_img=node.attributes.src;node.attributes.onclick="localImageDiv(this);";node.attributes._hideTool=true;node.attributes.src=me.options.UEDITOR_HOME_URL+"/image/comm/ueditor/images/menu/wordimg3.gif";var flag=parseInt(node.attributes.width)<128||parseInt(node.attributes.height)<43;node.attributes.style="background:url("+me.options.UEDITOR_HOME_URL+"/image/comm/ueditor/images/menu/wordimg3.gif) no-repeat center center;border:1px solid #ddd";node.attributes.style="width:181px;height:66px;";word_img_flag&&(word_img_flag.flag=1)}if(browser.ie&&browser.version<7){node.attributes.orgSrc=node.attributes.src}node.attributes.data_ue_src=node.attributes.data_ue_src||node.attributes.src;break;case"li":var child=node.children[0];if(!child||child.type!="element"||child.tag!="p"&&dtd.p[child.tag]){var tmpPNode={type:"element",tag:"p",attributes:{},parent:node};tmpPNode.children=child?node.children:[browser.ie?{type:"text",data:domUtils.fillChar,parent:tmpPNode}:{type:"element",tag:"br",attributes:{},closed:true,children:[],parent:tmpPNode}];node.children=[tmpPNode]}break;case"table":case"td":optStyle(node);break;case"a":if(node.attributes.anchorname){node.tag="img";node.attributes={"class":"anchorclass",anchorname:node.attributes.name};node.closed=1}if(node.attributes.name&&node.attributes.name.toLowerCase().indexOf("ole_link")===0&&node.children.length===0){node.tag="";node.attributes="";node.type="";node.closed=1}if(node.attributes.name&&node.attributes.name.toLowerCase().indexOf("ole_link")===0&&node.children.length!==0){node.tag="span"}var pat=new RegExp("http://"+location.hostname);if(pat.test(node.attributes.href)){node.attributes.href=node.attributes.href.substring(node.attributes.href.lastIndexOf("/")+1)}node.attributes.href&&(node.attributes.data_ue_src=node.attributes.href);if(!node.attributes.style){node.attributes.style="color:blue;"}break;case"b":node.tag=node.name="strong";break;case"i":node.tag=node.name="em";break;case"u":node.tag=node.name="span";node.attributes.style=(node.attributes.style||"")+";text-decoration:underline;";break;case"s":case"del":node.tag=node.name="span";node.attributes.style=(node.attributes.style||"")+";text-decoration:line-through;";if(node.children.length==1){child=node.children[0];if(child.tag==node.tag){node.attributes.style+=";"+child.attributes.style;node.children=child.children}}break;case"span":var style=node.attributes.style;if(style){if(!node.attributes.style||browser.webkit&&style=="white-space:nowrap;"){delete node.attributes.style}}if(browser.gecko&&browser.version<=10902&&node.parent){var parent=node.parent;if(parent.tag=="span"&&parent.attributes&&parent.attributes.style){node.attributes.style=parent.attributes.style+";"+node.attributes.style}}if(utils.isEmptyObject(node.attributes)&&autoClearEmptyNode){node.type="fragment"}if(node.parent&&node.parent.tag==="a"&&node.attributes.style){node.parent.attributes.style+=node.attributes.style}break;case"font":node.tag=node.name="span";attr=node.attributes;node.attributes={style:(attr.size?"font-size:"+(sizeMap[attr.size]||12)+"px":"")+";"+(attr.color?"color:"+attr.color:"")+";"+(attr.face?"font-family:"+attr.face:"")+";"+(attr.style||"")};while(node.parent.tag==node.tag&&node.parent.children.length==1){node.attributes.style&&(node.parent.attributes.style?(node.parent.attributes.style+=";"+node.attributes.style):(node.parent.attributes.style=node.attributes.style));node.parent.children=node.children;node=node.parent}break;case"p":if(node.attributes.align){node.attributes.style=(node.attributes.style||"")+";text-align:"+node.attributes.align+";";delete node.attributes.align}}if(node&&node.attributes){var style=node.attributes.style;if(style){if(node.attributes.style){var styleArray=node.attributes.style.split(";");for(var i=styleArray.length-1;i>=0;i--){if(styleArray[i].indexOf("background-repeat")!==-1){var stylePropertyArray=styleArray[i].split(":");if(stylePropertyArray[1].toLowerCase()=="no-repeat no-repeat"){stylePropertyArray[1]="no-repeat"}styleArray[i]=stylePropertyArray.join(":")}}if(styleArray.length>0){node.attributes.style=styleArray.join(";")}}}}return node}function filterNodeStyle(node){switch(node.tag){case"span":case"p":var style=node.attributes.style;if(style){if(node.attributes.style){var removeStyle=["background","color"],styleArray=node.attributes.style.split(";");for(var i=styleArray.length-1;i>=0;i--){if(styleArray[i].indexOf("background")!==-1){var stylePropertyArray=styleArray[i].split(":")[1];if(stylePropertyArray.toLowerCase()==="white"||stylePropertyArray.toLowerCase()==="#fff"||stylePropertyArray.toLowerCase()==="#ffffff"){styleArray.splice(i,1)}}else{if(styleArray[i].indexOf("color")!==-1){var stylePropertyArray=styleArray[i].split(":")[1];if(stylePropertyArray.toLowerCase()==="black"||stylePropertyArray.toLowerCase()==="#000"||stylePropertyArray.toLowerCase()==="#000"){styleArray.splice(i,1)}}}}if(styleArray.length>0){node.attributes.style=styleArray.join(";")}else{delete node.attributes.style}}}break}return node}function optStyle(node){if(ie&&node.attributes.style){var style=node.attributes.style;node.attributes.style=style.replace(/;\s*/g,";");node.attributes.style=node.attributes.style.replace(/^\s*|\s*$/,"")}}function transOutNode(node){switch(node.tag){case"div":if(node.attributes._ue_div_script){node.tag="script";node.children=[{type:"cdata",data:node.attributes._ue_script_data?decodeURIComponent(node.attributes._ue_script_data):"",parent:node}];delete node.attributes._ue_div_script;delete node.attributes._ue_script_data;delete node.attributes._ue_custom_node_}if(node.attributes._ue_div_style){node.tag="style";node.children=[{type:"cdata",data:node.attributes._ue_style_data?decodeURIComponent(node.attributes._ue_style_data):"",parent:node}];delete node.attributes._ue_div_style;delete node.attributes._ue_style_data;delete node.attributes._ue_custom_node_}break;case"table":!node.attributes.style&&delete node.attributes.style;if(ie&&node.attributes.style){optStyle(node)}if(node.attributes["class"]=="noBorderTable"){delete node.attributes["class"]}break;case"td":case"th":if(/display\s*:\s*none/i.test(node.attributes.style)){return{type:"fragment",children:[]}}if(ie&&!node.children.length){var txtNode={type:"text",data:domUtils.fillChar,parent:node};node.children[0]=txtNode}if(ie&&node.attributes.style){optStyle(node)}if(node.attributes["class"]=="selectTdClass"){delete node.attributes["class"]}break;case"img":if(node.attributes.anchorname){node.tag="a";node.attributes={name:node.attributes.anchorname,anchorname:1};node.closed=null}else{if(node.attributes.data_ue_src){node.attributes.src=node.attributes.data_ue_src;delete node.attributes.data_ue_src}}break;case"a":if(node.attributes.data_ue_src){node.attributes.href=node.attributes.data_ue_src;delete node.attributes.data_ue_src}}return node}function childrenAccept(node,visit,ctx){if(!node.children||!node.children.length){return node}var children=node.children;for(var i=0;i<children.length;i++){var newNode=visit(children[i],ctx);if(newNode.type=="fragment"){var args=[i,1];args.push.apply(args,newNode.children);children.splice.apply(children,args);if(!children.length){node={type:"fragment",children:[]}}i--}else{children[i]=newNode}}return node}function Serialize(rules){this.rules=rules}Serialize.prototype={rules:null,filter:function(node,rules,modify){rules=rules||this.rules;var whiteList=rules&&rules.whiteList;var blackList=rules&&rules.blackList;function visitNode(node,parent){node.name=node.type=="element"?node.tag:NODE_NAME_MAP[node.type];if(parent==null){return childrenAccept(node,visitNode,node)}if(blackList&&blackList[node.name]){modify&&(modify.flag=1);return{type:"fragment",children:[]}}if(whiteList){if(node.type=="element"){if(parent.type=="fragment"?whiteList[node.name]:whiteList[node.name]&&whiteList[parent.name][node.name]){var props;if((props=whiteList[node.name].$)){var oldAttrs=node.attributes;var newAttrs={};for(var k in props){if(oldAttrs[k]){newAttrs[k]=oldAttrs[k]}}node.attributes=newAttrs}}else{modify&&(modify.flag=1);node.type="fragment";node.name=parent.name}}else{}}if(blackList||whiteList){childrenAccept(node,visitNode,node)}return node}return visitNode(node,null)},transformFliterStyle:function(node){function visitNode(node){node=filterNodeStyle(node);node=childrenAccept(node,visitNode,node);return node}return visitNode(node)},transformInput:function(node,word_img_flag){function visitNode(node){node=transNode(node,word_img_flag);node=childrenAccept(node,visitNode,node);if(me.options.pageBreakTag&&node.type=="text"&&node.data.replace(/\s/g,"")==me.options.pageBreakTag){node.type="element";node.name=node.tag="hr";delete node.data;node.attributes={"class":"pagebreak",noshade:"noshade",size:"5",unselectable:"on",style:"moz-user-select:none;-khtml-user-select: none;"};node.children=[]}if(node.type=="text"&&!dtd.$notTransContent[node.parent.tag]){node.data=node.data.replace(/[\r\t\n]*/g,"")}return node}return visitNode(node)},transformOutput:function(node){function visitNode(node){if(node.tag=="hr"&&node.attributes["class"]=="pagebreak"){delete node.tag;node.type="text";node.data=me.options.pageBreakTag;delete node.children}node=transOutNode(node);if(node.tag=="ol"||node.tag=="ul"){first=1}node=childrenAccept(node,visitNode,node);if(node.tag=="ol"||node.tag=="ul"){first=0}return node}return visitNode(node)},toHTML:toHTML,parseHTML:parseHTML,word:transformWordHtml};me.serialize=new Serialize(me.options.serialize||{});UE.serialize=new Serialize({})};UE.plugins.table=function(){var me=this,keys=domUtils.keys,clearSelectedTd=domUtils.clearSelectedArr,debug=true;function showError(e){if(debug){throw e}}var anchorTd,tableOpt,_isEmpty=domUtils.isEmptyNode;var startTd=null,currentId=null,onDrag="",onBorder=false,dragLine=null,dragTd=null;var mousedown=false,needIEHack=true;me.setOpt({maxColNum:50,maxRowNum:200,defaultCols:5,defaultRows:5,tdvalign:"top",cursorpath:me.options.UEDITOR_HOME_URL+"/image/comm/ueditor/images/cursor_"});function getIndex(cell){var cells=cell.parentNode.cells;for(var i=0,ci;ci=cells[i];i++){if(ci===cell){return i}}}function deleteTable(table,range){var p=table.ownerDocument.createElement("p");domUtils.fillNode(me.document,p);var pN=table.parentNode;if(pN&&pN.getAttribute("dropdrag")){table=pN}table.parentNode.insertBefore(p,table);domUtils.remove(table);range.setStart(p,0).setCursor()}function _isHide(cell){return cell.style.display=="none"}function getCount(arr){var count=0;for(var i=0,ti;ti=arr[i++];){if(!_isHide(ti)){count++}}return count}var commands={deletetable:1,inserttable:1,cellvalign:1,insertcaption:1,deletecaption:1,inserttitle:1,deletetitle:1,mergeright:1,mergedown:1,mergecells:1,insertrow:1,insertrownext:1,deleterow:1,insertcol:1,insertcolnext:1,deletecol:1,splittocells:1,splittorows:1,splittocols:1,adaptbytext:1,adaptbywindow:1,adaptbycustomer:1,insertparagraph:1};me.currentSelectedArr=[];me.ready(function(){utils.cssRule("table",".selectTdClass{background-color:#edf5fa !important}table.noBorderTable td{border:1px dashed #ddd !important}table{line-height:22px;border-collapse:collapse;display:table;}td,th{ padding: 0 10px;line-height: 22px;}caption{border:1px dashed #DDD;border-bottom:0;padding:3px;text-align:center;}th{border-top:2px solid #BBB;background:#F7F7F7;}td p{margin:0;padding:0;}",me.document);var tableCopyList,isFullCol,isFullRow;me.addListener("keydown",function(cmd,evt){var me=this;var keyCode=evt.keyCode||evt.which;if(keyCode==8){}if(keyCode==46){ut=getUETableBySelected(me);if(ut){me.fireEvent("saveScene");for(var i=0,ci;ci=ut.selectedTds[i++];){domUtils.fillNode(me.document,ci)}me.fireEvent("saveScene");domUtils.preventDefault(evt)}}if(keyCode==13){var rng=me.selection.getRange(),caption=domUtils.findParentByTagName(rng.startContainer,"caption");if(caption){var table=domUtils.findParentByTagName(caption,"table");if(!rng.collapsed){rng.deleteContents();me.fireEvent("saveScene")}else{if(caption){rng.setStart(table.rows[0].cells[0],0).setCursor(false,true)}}domUtils.preventDefault(evt);return}if(rng.collapsed){var table=domUtils.findParentByTagName(rng.startContainer,"table");if(table){var cell=table.rows[0].cells[0],start=domUtils.findParentByTagName(me.selection.getStart(),["td","th"],true),preNode=table.previousSibling;if(cell===start&&(!preNode||preNode.nodeType==1&&preNode.tagName=="TABLE")&&domUtils.isStartInblock(rng)){me.execCommand("insertparagraphbeforetable");domUtils.preventDefault(evt)}}}}if((evt.ctrlKey||evt.metaKey)&&evt.keyCode=="67"){tableCopyList=null;table=getUETableBySelected(me);if(table){var tds=table.selectedTds;isFullCol=table.isFullCol();isFullRow=table.isFullRow();tableCopyList=[[cloneCell(tds[0])]];for(var i=1,ci;ci=tds[i];i++){if(ci.parentNode!==tds[i-1].parentNode){tableCopyList.push([cloneCell(ci)])}else{tableCopyList[tableCopyList.length-1].push(cloneCell(ci))}}}}});me.addListener("beforepaste",function(cmd,html){var me=this;var rng=me.selection.getRange();if(domUtils.findParentByTagName(rng.startContainer,"caption",true)){var div=me.document.createElement("div");div.innerHTML=html.html;html.html=div[browser.ie?"innerText":"textContent"];return}var table=getUETableBySelected(me);if(tableCopyList){me.fireEvent("saveScene");var rng=me.selection.getRange();var td=domUtils.findParentByTagName(rng.startContainer,["td","th"],true),tmpNode,preNode;if(td){var ut=getUETable(td);if(isFullRow){var rowIndex=ut.getCellInfo(td).rowIndex;if(td.tagName=="TH"){rowIndex++}for(var i=0,ci;ci=tableCopyList[i++];){var tr=ut.insertRow(rowIndex++);for(var j=0,cj;cj=ci[j];j++){var cell=tr.cells[j];if(!cell){cell=tr.insertCell(j)}cell.innerHTML=cj.innerHTML;cj.getAttribute("width")&&cell.setAttribute("width",cj.getAttribute("width"));cj.getAttribute("valign")&&cell.setAttribute("valign",cj.getAttribute("valign"));cj.getAttribute("align")&&cell.setAttribute("align",cj.getAttribute("align"));cj.style.cssText&&(cell.style.cssText=cj.style.cssText)}for(var j=0,cj;cj=tr.cells[j];j++){if(!ci[j]){break}cj.innerHTML=ci[j].innerHTML;ci[j].getAttribute("width")&&cj.setAttribute("width",ci[j].getAttribute("width"));ci[j].getAttribute("valign")&&cj.setAttribute("valign",ci[j].getAttribute("valign"));ci[j].getAttribute("align")&&cj.setAttribute("align",ci[j].getAttribute("align"));ci[j].style.cssText&&(cj.style.cssText=ci[j].style.cssText)}}}else{if(isFullCol){cellInfo=ut.getCellInfo(td);var maxColNum=0;for(var j=0,ci=tableCopyList[0],cj;cj=ci[j++];){maxColNum+=cj.colSpan||1}me.__hasEnterExecCommand=true;for(i=0;i<maxColNum;i++){me.execCommand("insertcol")}me.__hasEnterExecCommand=false;td=ut.table.rows[0].cells[cellInfo.cellIndex];if(td.tagName=="TH"){td=ut.table.rows[1].cells[cellInfo.cellIndex]}}for(var i=0,ci;ci=tableCopyList[i++];){tmpNode=td;for(var j=0,cj;cj=ci[j++];){if(td){td.innerHTML=cj.innerHTML;cj.getAttribute("width")&&td.setAttribute("width",cj.getAttribute("width"));cj.getAttribute("valign")&&td.setAttribute("valign",cj.getAttribute("valign"));cj.getAttribute("align")&&td.setAttribute("align",cj.getAttribute("align"));cj.style.cssText&&(td.style.cssText=cj.style.cssText);preNode=td;td=td.nextSibling}else{var cloneTd=cj.cloneNode(true);domUtils.removeAttributes(cloneTd,["class","rowSpan","colSpan"]);preNode.parentNode.appendChild(cloneTd)}}td=ut.getNextCell(tmpNode,true,true);if(!tableCopyList[i]){break}if(!td){var cellInfo=ut.getCellInfo(tmpNode);ut.table.insertRow(ut.table.rows.length);ut.update();td=ut.getVSideCell(tmpNode,true)}}}ut.update()}else{table=me.document.createElement("table");for(var i=0,ci;ci=tableCopyList[i++];){var tr=table.insertRow(table.rows.length);for(var j=0,cj;cj=ci[j++];){cloneTd=cloneCell(cj);domUtils.removeAttributes(cloneTd,["class"]);tr.appendChild(cloneTd)}if(j==2&&cloneTd.rowSpan>1){cloneTd.rowSpan=1}}var defaultValue=getDefaultValue(me),width=me.body.offsetWidth-(needIEHack?parseInt(domUtils.getComputedStyle(me.body,"margin-left"),10)*2:0)-defaultValue.tableBorder*2-(me.options.offsetWidth||0);me.execCommand("insertHTML","<table  "+(isFullCol&&isFullRow?'width="'+width+'"':"")+">"+table.innerHTML.replace(/>\s*</g,"><")+"</table>")}me.fireEvent("contentchange");me.fireEvent("saveScene");html.html=""}else{var div=me.document.createElement("div"),tables;div.innerHTML=html.html;tables=div.getElementsByTagName("table");if(domUtils.findParentByTagName(me.selection.getStart(),"table")){utils.each(tables,function(t){domUtils.remove(t)});if(domUtils.findParentByTagName(me.selection.getStart(),"caption",true)){div.innerHTML=div[browser.ie?"innerText":"textContent"]}}else{utils.each(tables,function(table){removeStyleSize(table,true);domUtils.removeAttributes(table,["style"]);utils.each(domUtils.getElementsByTagName(table,"td"),function(td){var tdHeight=td&&parseInt(td.height?td.height:0)>0;if(isEmptyBlock(td)&&!tdHeight){domUtils.fillNode(me.document,td)}removeStyleSize(td,true);domUtils.removeAttributes(td,["style"])})})}html.html=div.innerHTML}});me.addListener("blur",function(){tableCopyList=null});var timer;me.addListener("keydown",function(){clearTimeout(timer);timer=setTimeout(function(){var rng=me.selection.getRange(),cell=domUtils.findParentByTagName(rng.startContainer,["th","td"],true);if(cell){var table=cell.parentNode.parentNode.parentNode;if(table.offsetWidth>table.getAttribute("width")){cell.style.wordBreak="break-all"}}},100)});me.addListener("selectionchange",function(){toggleDragableState(me,false,"",null)});me.addListener("contentchange",function(){var me=this;hideDragLine(me);if(getUETableBySelected(me)){return}var rng=me.selection.getRange();var start=rng.startContainer;start=domUtils.findParentByTagName(start,["td","th"],true);utils.each(domUtils.getElementsByTagName(me.document,"table"),function(table){if(me.fireEvent("excludetable",table)===true){return}table.ueTable=new UETable(table);utils.each(domUtils.getElementsByTagName(me.document,"td"),function(td){if(domUtils.isEmptyBlock(td)&&td!==start){var tdHeight=td&&parseInt(td.height?td.height:0)>0;if(!tdHeight){domUtils.fillNode(me.document,td)}if(browser.ie&&browser.version==6){td.innerHTML="&nbsp;"}}});utils.each(domUtils.getElementsByTagName(me.document,"th"),function(th){if(domUtils.isEmptyBlock(th)&&th!==start){domUtils.fillNode(me.document,th);if(browser.ie&&browser.version==6){th.innerHTML="&nbsp;"}}});table.onmousemove=function(){me.options.tableDragable&&toggleDragButton(true,this,me)};table.onmouseout=function(){toggleDragableState(me,false,"",null);hideDragLine(me)};table.onclick=function(evt){evt=me.window.event||evt;var target=getParentTdOrTh(evt.target||evt.srcElement);if(!target){return}var ut=getUETable(target),table=ut.table,cellInfo=ut.getCellInfo(target),cellsRange,rng=me.selection.getRange();if(inTableSide(table,target,evt,true)){var endTdCol=ut.getCell(ut.indexTable[ut.rowsNum-1][cellInfo.colIndex].rowIndex,ut.indexTable[ut.rowsNum-1][cellInfo.colIndex].cellIndex);if(evt.shiftKey&&ut.selectedTds.length){if(ut.selectedTds[0]!==endTdCol){cellsRange=ut.getCellsRange(ut.selectedTds[0],endTdCol);ut.setSelected(cellsRange)}else{rng&&rng.selectNodeContents(endTdCol).select()}}else{if(target!==endTdCol){cellsRange=ut.getCellsRange(target,endTdCol);ut.setSelected(cellsRange)}else{rng&&rng.selectNodeContents(endTdCol).select()}}return}if(inTableSide(table,target,evt)){var endTdRow=ut.getCell(ut.indexTable[cellInfo.rowIndex][ut.colsNum-1].rowIndex,ut.indexTable[cellInfo.rowIndex][ut.colsNum-1].cellIndex);if(evt.shiftKey&&ut.selectedTds.length){if(ut.selectedTds[0]!==endTdRow){cellsRange=ut.getCellsRange(ut.selectedTds[0],endTdRow);ut.setSelected(cellsRange)}else{rng&&rng.selectNodeContents(endTdRow).select()}}else{if(target!==endTdRow){cellsRange=ut.getCellsRange(target,endTdRow);ut.setSelected(cellsRange)}else{rng&&rng.selectNodeContents(endTdRow).select()}}}};table.ondblclick=function(evt){evt=me.window.event||evt;var target=getParentTdOrTh(evt.target||evt.srcElement);if(target){var h;if(h=getRelation(target,mouseCoords(evt))){if(h=="h1"){h="h";if(inTableSide(domUtils.findParentByTagName(target,"table"),target,evt)){me.execCommand("adaptbywindow")}else{target=getUETable(target).getPreviewCell(target);if(target){var rng=me.selection.getRange();rng.selectNodeContents(target).setCursor(true,true)}}}h=="h"&&me.execCommand("adaptbytext")}}}});switchBoderColor(true)});if(!browser.ie||(browser.ie&&browser.version>7)){domUtils.on(me.document,"mousemove",mouseMoveEvent)}domUtils.on(me.document,"mouseout",function(evt){var target=evt.target||evt.srcElement;if(target.tagName=="TABLE"){toggleDragableState(me,false,"",null)}});me.addListener("mousedown",mouseDownEvent);me.addListener("mouseup",mouseUpEvent);var currentRowIndex=0;me.addListener("tabkeydown",function(){var range=this.selection.getRange(),common=range.getCommonAncestor(true,true),table=domUtils.findParentByTagName(common,"table");if(table){if(domUtils.findParentByTagName(common,"caption")){var cell=domUtils.getElementsByTagName(table,"th td");if(cell&&cell.length){range.setStart(cell[0],0).setCursor(false,true)}}else{var cell=domUtils.findParentByTagName(common,["td","th"],true),ua=getUETable(cell);currentRowIndex=cell.rowSpan>1?currentRowIndex:ua.getCellInfo(cell).rowIndex;var nextCell=ua.getTabNextCell(cell,currentRowIndex);if(nextCell){if(isEmptyBlock(nextCell)){range.setStart(nextCell,0).setCursor(false,true)}else{range.selectNodeContents(nextCell).select()}}else{me.fireEvent("saveScene");me.__hasEnterExecCommand=true;this.execCommand("insertrownext");me.__hasEnterExecCommand=false;range=this.selection.getRange();range.setStart(table.rows[table.rows.length-1].cells[0],0).setCursor();me.fireEvent("saveScene")}}return true}});browser.ie&&me.addListener("selectionchange",function(){toggleDragableState(this,false,"",null)});me.addListener("keydown",function(type,evt){var me=this;var keyCode=evt.keyCode||evt.which;if(keyCode==8||keyCode==46){return}var notCtrlKey=!evt.ctrlKey&&!evt.metaKey&&!evt.shiftKey&&!evt.altKey;var ut=getUETableBySelected(me);if(!ut){return}notCtrlKey&&ut.clearSelected()});me.addListener("beforegetcontent",function(){switchBoderColor(false);browser.ie&&utils.each(me.document.getElementsByTagName("caption"),function(ci){if(domUtils.isEmptyNode(ci)){ci.innerHTML="&nbsp;"}})});me.addListener("aftergetcontent",function(){switchBoderColor(true)});me.addListener("getAllHtml",function(){removeSelectedClass(me.document.getElementsByTagName("td"))});me.addListener("fullscreenchanged",function(type,fullscreen){if(!fullscreen){var ratio=this.body.offsetWidth/document.body.offsetWidth,tables=domUtils.getElementsByTagName(this.body,"table");utils.each(tables,function(table){if(table.offsetWidth<me.body.offsetWidth){return false}var tds=domUtils.getElementsByTagName(table,"td"),backWidths=[];utils.each(tds,function(td){backWidths.push(td.offsetWidth)});for(var i=0,td;td=tds[i];i++){td.setAttribute("width",Math.floor(backWidths[i]*ratio))}table.setAttribute("width",Math.floor(getTableWidth(me,needIEHack,getDefaultValue(me))))})}});var oldExecCommand=me.execCommand;me.execCommand=function(cmd){var me=this;cmd=cmd.toLowerCase();var ut=getUETableBySelected(me),tds,range=new dom.Range(me.document),cmdFun=me.commands[cmd]||UE.commands[cmd],result;if(!cmdFun){return}if(ut&&!commands[cmd]&&!cmdFun.notNeedUndo&&!me.__hasEnterExecCommand){me.__hasEnterExecCommand=true;me.fireEvent("beforeexeccommand",cmd);tds=ut.selectedTds;var lastState=-2,lastValue=-2,value,state;for(var i=0,td;td=tds[i];i++){if(cmd=="backcolor"){cmd="edittd"}if(isEmptyBlock(td)){range.setStart(td,0).setCursor(false,true)}else{range.selectNodeContents(td).select()}state=me.queryCommandState(cmd);value=me.queryCommandValue(cmd);if(state!=-1){if(lastState!==state||lastValue!==value){me._ignoreContentChange=true;result=oldExecCommand.apply(me,arguments);me._ignoreContentChange=false;if(domUtils.isEmptyBlock(td)){domUtils.fillNode(me.document,td)}}lastState=me.queryCommandState(cmd);lastValue=me.queryCommandValue(cmd)}}range.setStart(tds[0],0).shrinkBoundary(true).setCursor(false,true);me.fireEvent("contentchange");me.fireEvent("afterexeccommand",cmd);me.__hasEnterExecCommand=false;me._selectionChange();if(cmd=="edittd"){removeSelectedClass(domUtils.getElementsByTagName(me.body,"td"))}}else{result=oldExecCommand.apply(me,arguments)}return result}});function reset(){me.currentSelectedArr=[];anchorTd=null}function removeStyleSize(obj,replaceToProperty){removeStyle(obj,"width",true);removeStyle(obj,"height",true)}function removeStyle(obj,styleName,replaceToProperty){if(obj.style[styleName]){replaceToProperty&&obj.setAttribute(styleName,parseInt(obj.style[styleName],10));obj.style[styleName]=""}}function getParentTdOrTh(ele){if(ele.tagName=="TD"||ele.tagName=="TH"){return ele}var td;if(td=domUtils.findParentByTagName(ele,"td",true)||domUtils.findParentByTagName(ele,"th",true)){return td}return null}function isEmptyBlock(node){var reg=new RegExp(domUtils.fillChar,"g");if(node[browser.ie?"innerText":"textContent"].replace(/^\s*$/,"").replace(reg,"").length>0){return 0}for(var n in dtd.$isNotEmpty){if(node.getElementsByTagName(n).length){return 0}}return 1}function mouseCoords(evt){if(evt.pageX||evt.pageY){return{x:evt.pageX,y:evt.pageY}}return{x:evt.clientX+me.document.body.scrollLeft-me.document.body.clientLeft,y:evt.clientY+me.document.body.scrollTop-me.document.body.clientTop}}function mouseMoveEvent(evt){try{var target=getParentTdOrTh(evt.target||evt.srcElement),pos;if(onDrag&&dragTd){me.document.body.style.webkitUserSelect="none";me.selection.getNative()[browser.ie?"empty":"removeAllRanges"]();pos=mouseCoords(evt);toggleDragableState(me,true,"",pos,target);if(onDrag=="h"){dragLine.style.left=getPermissionX(dragTd,evt)+"px"}else{if(onDrag=="v"){dragLine.style.top=getPermissionY(dragTd,evt)+"px"}}return}if(target){pos=mouseCoords(evt);var state=getRelation(target,pos),table=domUtils.findParentByTagName(target,"table",true);if(inTableSide(table,target,evt,true)){me.body.style.cursor="url("+me.options.cursorpath+"h.png),pointer"}else{if(inTableSide(table,target,evt)){me.body.style.cursor="url("+me.options.cursorpath+"v.png),pointer"}else{me.body.style.cursor="text";if(/\d/.test(state)){state=state.replace(/\d/,"");target=getUETable(target).getPreviewCell(target,state=="v")}toggleDragableState(me,target?!!state:false,target?state:"",pos,target)}}}}catch(e){showError(e)}}function inTableSide(table,cell,evt,top){var pos=mouseCoords(evt),state=getRelation(cell,pos);if(top){var caption=table.getElementsByTagName("caption")[0],capHeight=caption?caption.offsetHeight:0;return(state=="v1")&&((pos.y-domUtils.getXY(table).y-capHeight)<8)}else{return(state=="h1")&&((pos.x-domUtils.getXY(table).x)<8)}}function getPermissionX(dragTd,evt){var ut=getUETable(dragTd);if(ut){var preTd=ut.getSameEndPosCells(dragTd,"x")[0],nextTd=ut.getSameStartPosXCells(dragTd)[0],mouseX=mouseCoords(evt).x,left=(preTd?domUtils.getXY(preTd).x:domUtils.getXY(ut.table).x)+20,right=nextTd?domUtils.getXY(nextTd).x+nextTd.offsetWidth-20:(me.body.offsetWidth+5||parseInt(domUtils.getComputedStyle(me.body,"width"),10));return mouseX<left?left:mouseX>right?right:mouseX}}function getPermissionY(dragTd,evt){try{var top=domUtils.getXY(dragTd).y,mousePosY=mouseCoords(evt).y;return mousePosY<top?top:mousePosY}catch(e){showError(e)}}function toggleDragableState(editor,dragable,dir,mousePos,cell){try{editor.body.style.cursor=dir=="h"?"col-resize":dir=="v"?"row-resize":"text";if(browser.ie){if(dir&&!mousedown&&!getUETableBySelected(editor)){getDragLine(editor,editor.document);showDragLineAt(dir,cell)}else{hideDragLine(editor)}}onBorder=dragable}catch(e){showError(e)}}function getRelation(ele,mousePos){var elePos=domUtils.getXY(ele);if(elePos.x+ele.offsetWidth-mousePos.x<4){return"h"}if(mousePos.x-elePos.x<4){return"h1"}if(elePos.y+ele.offsetHeight-mousePos.y<4){return"v"}if(mousePos.y-elePos.y<4){return"v1"}return""}function mouseDownEvent(type,evt){if(evt.button==2){var ut=getUETableBySelected(me),flag=false;if(ut){var td=getTargetTd(me,evt);utils.each(ut.selectedTds,function(ti){if(ti===td){flag=true}});if(!flag){ut.clearSelected()}else{td=ut.selectedTds[0];setTimeout(function(){me.selection.getRange().setStart(td,0).setCursor(false,true)},0)}}return}if(evt.shiftKey){return}startTd=getTargetTd(me,evt);if(!startTd){return}var table=domUtils.findParentByTagName(startTd,"table",true);ut=getUETable(table);ut&&ut.clearSelected();if(!onBorder){me.document.body.style.webkitUserSelect="";mousedown=true;me.addListener("mouseover",mouseOverEvent)}else{if(browser.ie&&browser.version<8){return}var state=getRelation(startTd,mouseCoords(evt));if(/\d/.test(state)){state=state.replace(/\d/,"");startTd=getUETable(startTd).getPreviewCell(startTd,state=="v")}hideDragLine(me);getDragLine(me,me.document);showDragLineAt(state,startTd);mousedown=true;onDrag=state;dragTd=startTd}if(typeof this.options.ueditorChangeEvent=="function"){this.options.ueditorChangeEvent()}}function getDefaultValue(editor,table){var borderMap={thin:"0px",medium:"1px",thick:"2px"},tableBorder,tdPadding,tdBorder,tmpValue;if(!table){table=editor.document.createElement("table");table.insertRow(0).insertCell(0).innerHTML="xxx";editor.body.appendChild(table);var td=table.getElementsByTagName("td")[0];tmpValue=domUtils.getComputedStyle(table,"border-left-width");tableBorder=parseInt(borderMap[tmpValue]||tmpValue,10);tmpValue=domUtils.getComputedStyle(td,"padding-left");tdPadding=parseInt(borderMap[tmpValue]||tmpValue,10);tmpValue=domUtils.getComputedStyle(td,"border-left-width");tdBorder=parseInt(borderMap[tmpValue]||tmpValue,10);domUtils.remove(table);return{tableBorder:tableBorder,tdPadding:tdPadding,tdBorder:tdBorder}}else{td=table.getElementsByTagName("td")[0];tmpValue=domUtils.getComputedStyle(table,"border-left-width");tableBorder=parseInt(borderMap[tmpValue]||tmpValue,10);tmpValue=domUtils.getComputedStyle(td,"padding-left");tdPadding=parseInt(borderMap[tmpValue]||tmpValue,10);tmpValue=domUtils.getComputedStyle(td,"border-left-width");tdBorder=parseInt(borderMap[tmpValue]||tmpValue,10);return{tableBorder:tableBorder,tdPadding:tdPadding,tdBorder:tdBorder}}}function removeSelectedClass(cells){utils.each(cells,function(cell){domUtils.removeClasses(cell,"selectTdClass")})}function addSelectedClass(cells){utils.each(cells,function(cell){domUtils.addClass(cell,"selectTdClass")})}function getWidth(cell){if(!cell){return 0}return parseInt(domUtils.getComputedStyle(cell,"width"),10)}function changeColWidth(cell,changeValue){if(Math.abs(changeValue)<10){return}var ut=getUETable(cell);if(ut){var table=ut.table,backTableWidth=getWidth(table),defaultValue=getDefaultValue(me,table),leftCells=ut.getSameEndPosCells(cell,"x"),backLeftWidth=getWidth(leftCells[0])-defaultValue.tdPadding*2-defaultValue.tdBorder,rightCells=ut.getSameStartPosXCells(cell),backRightWidth=getWidth(rightCells[0])-defaultValue.tdPadding*2-defaultValue.tdBorder;utils.each(leftCells,function(cell){if(cell.style.width){cell.style.width=""}if(changeValue<0){cell.style.wordBreak="break-all"}cell.setAttribute("width",backLeftWidth+changeValue)});utils.each(rightCells,function(cell){if(cell.style.width){cell.style.width=""}if(changeValue>0){cell.style.wordBreak="break-all"}cell.setAttribute("width",backRightWidth-changeValue)});if(!cell.nextSibling){if(table.style.width){table.style.width=""}table.setAttribute("width",backTableWidth+changeValue)}}}function changeRowHeight(td,changeValue){if(Math.abs(changeValue)<10){return}var ut=getUETable(td);if(ut){var cells=ut.getSameEndPosCells(td,"y"),backHeight=cells[0]?cells[0].offsetHeight:0;for(var i=0,cell;cell=cells[i++];){setCellHeight(cell,changeValue,backHeight)}}}function setCellHeight(cell,height,backHeight){var lineHight=parseInt(domUtils.getComputedStyle(cell,"line-height"),10),tmpHeight=backHeight+height;height=tmpHeight<lineHight?lineHight:tmpHeight;if(cell.style.height){cell.style.height=""}cell.rowSpan==1?cell.setAttribute("height",height):(cell.removeAttribute&&cell.removeAttribute("height"))}function mouseUpEvent(type,evt){if(evt.button==2){return}mousedown=false;me.document.body.style.webkitUserSelect="";if((!browser.ie||(browser.ie&&browser.version>7))&&onDrag&&dragTd){dragLine=me.document.getElementById("ue_tableDragLine");var dragTdPos=domUtils.getXY(dragTd),dragLinePos=domUtils.getXY(dragLine);switch(onDrag){case"h":changeColWidth(dragTd,dragLinePos.x-dragTdPos.x-dragTd.offsetWidth);break;case"v":changeRowHeight(dragTd,dragLinePos.y-dragTdPos.y-dragTd.offsetHeight);break;default:}onDrag="";dragTd=null;hideDragLine(me);return}var range=null;if(!startTd){var target=domUtils.findParentByTagName(evt.target||evt.srcElement,"td",true);if(!target){target=domUtils.findParentByTagName(evt.target||evt.srcElement,"th",true)}if(target&&(target.tagName=="TD"||target.tagName=="TH")){range=new dom.Range(me.document);range.setStart(target,0).setCursor(false,true)}}else{var ut=getUETable(startTd),cell=ut?ut.selectedTds[0]:null;if(cell){range=new dom.Range(me.document);if(domUtils.isEmptyBlock(cell)){range.setStart(cell,0).setCursor(false,true)}else{range.selectNodeContents(cell).shrinkBoundary().setCursor(false,true)}}else{range=me.selection.getRange().shrinkBoundary();if(!range.collapsed){var start=domUtils.findParentByTagName(range.startContainer,["td","th"],true),end=domUtils.findParentByTagName(range.endContainer,["td","th"],true);if(start&&!end||!start&&end||start&&end&&start!==end){range.setCursor(false,true)}}}startTd=null;me.removeListener("mouseover",mouseOverEvent)}me._selectionChange()}function mouseOverEvent(type,evt){currentTd=evt.target||evt.srcElement;if(startTd&&((startTd.tagName=="TD"&&currentTd.tagName=="TD")||(startTd.tagName=="TH"&&currentTd.tagName=="TH"))&&domUtils.findParentByTagName(startTd,"table")==domUtils.findParentByTagName(currentTd,"table")){var ut=getUETable(currentTd);if(startTd!=currentTd){me.document.body.style.webkitUserSelect="none";me.selection.getNative()[browser.ie?"empty":"removeAllRanges"]();var range=ut.getCellsRange(startTd,currentTd);ut.setSelected(range)}else{me.document.body.style.webkitUserSelect="";ut.clearSelected()}}evt.preventDefault?evt.preventDefault():(evt.returnValue=false)}function getUETable(tdOrTable){var tag=tdOrTable.tagName.toLowerCase();tdOrTable=(tag=="td"||tag=="th")?domUtils.findParentByTagName(tdOrTable,"table",true):tdOrTable;if(!tdOrTable.ueTable){tdOrTable.ueTable=new UETable(tdOrTable)}return tdOrTable.ueTable}function getUETableBySelected(editor){var table=getTableItemsByRange(editor).table;if(table&&table.ueTable&&table.ueTable.selectedTds.length){return table.ueTable}return null}function getDragLine(editor,doc){if(mousedown){return}dragLine=editor.document.createElement("div");domUtils.setAttributes(dragLine,{id:"ue_tableDragLine",unselectable:"on",contenteditable:false,onresizestart:"return false",ondragstart:"return false",onselectstart:"return false",style:"background-color:blue;position:absolute;padding:0;margin:0;background-image:none;border:0px none;opacity:0;filter:alpha(opacity=0)"});editor.body.appendChild(dragLine)}function hideDragLine(editor){if(mousedown){return}var line;while(line=editor.document.getElementById("ue_tableDragLine")){domUtils.remove(line)}}function showDragLineAt(state,cell){if(!cell){return}var table=domUtils.findParentByTagName(cell,"table"),caption=table.getElementsByTagName("caption"),width=table.offsetWidth,height=table.offsetHeight-(caption.length>0?caption[0].offsetHeight:0),tablePos=domUtils.getXY(table),cellPos=domUtils.getXY(cell),css;switch(state){case"h":css="height:"+height+"px;top:"+(tablePos.y+(caption.length>0?caption[0].offsetHeight:0))+"px;left:"+(cellPos.x+cell.offsetWidth-2);dragLine.style.cssText=css+"px;position: absolute;display:block;background-color:blue;width:1px;border:0; color:blue;opacity:.3;filter:alpha(opacity=30)";break;case"v":css="width:"+width+"px;left:"+tablePos.x+"px;top:"+(cellPos.y+cell.offsetHeight-2);dragLine.style.cssText=css+"px;overflow:hidden;position: absolute;display:block;background-color:blue;height:1px;border:0;color:blue;opacity:.2;filter:alpha(opacity=20)";break;default:}}function switchBoderColor(flag){var tableArr=domUtils.getElementsByTagName(me.body,"table"),color;for(var i=0,node;node=tableArr[i++];){var td=domUtils.getElementsByTagName(node,"td");if(td[0]){if(flag){color=(td[0].style.borderColor).replace(/\s/g,"");if(/(#ffffff)|(rgb\(255,f55,255\))/ig.test(color)){domUtils.addClass(node,"noBorderTable")}}else{domUtils.removeClasses(node,"noBorderTable")}}}}function getTableWidth(editor,needIEHack,defaultValue){var body=editor.body;return body.offsetWidth-(needIEHack?parseInt(domUtils.getComputedStyle(body,"margin-left"),10)*2:0)-defaultValue.tableBorder*2-(editor.options.offsetWidth||0)}me.commands.inserttable={queryCommandState:function(){if(this.highlight){return -1}var range=this.selection.getRange();return domUtils.findParentByTagName(range.startContainer,"table",true)||domUtils.findParentByTagName(range.endContainer,"table",true)||me.currentSelectedArr.length>0?0:0},execCommand:function(cmdName,opt){opt=opt||{numRows:5,numCols:5,border:1};var html=["<table "+(opt.border=="0"?' class="noBorderTable"':"")+' _innerCreateTable = "true" '];if(opt.cellSpacing&&opt.cellSpacing!="0"){html.push(' style="border-collapse:separate;" ')}opt.cellSpacing&&opt.cellSpacing!="0"&&html.push(' cellSpacing="'+opt.cellSpacing+'" ');opt.cellPadding&&html.push(' cellPadding="'+opt.cellPadding+'" ');html.push(' width="'+(opt.ueditorWidth||this.body.clientWidth)+(typeof opt.ueditorWidthUnit=="undefined"?"px":opt.ueditorWidthUnit)+'" ');opt.ueditorHeight&&html.push(' height="'+opt.ueditorHeight+(typeof opt.ueditorHeightUnit=="undefined"?"px":opt.ueditorHeightUnit)+'" ');opt.align&&(html.push(' align="'+opt.align+'" '));html.push(' border="'+(opt.border||0)+'" borderColor="'+(opt.borderColor||"#000000")+'"');opt.borderType=="1"&&html.push(' borderType="1" frame="box" rules="none" ');opt.commCellPadding=="1"&&html.push(' commCellPadding="1" ');opt.bgColor&&html.push(' bgColor="'+opt.bgColor+'"');html.push(" ><tbody>");opt.ueditorWidth=Math.floor((opt.ueditorWidth||this.body.clientWidth)/opt.numCols);for(var i=0;i<opt.numRows;i++){html.push("<tr>");for(var j=0;j<opt.numCols;j++){html.push('<td width="'+opt.ueditorWidth+'" valign="top" style="'+(opt.cellPadding!=""?"padding:"+opt.cellPadding+"px;":"")+'">'+(browser.ie?domUtils.fillChar:"<br/>")+"</td>")}html.push("</tr>")}me.execCommand("insertHtml",html.join("")+"</tbody></table>");reset();if(opt.align){var range=me.selection.getRange(),bk=range.createBookmark(),start=range.startContainer;while(start&&!domUtils.isBody(start)){if(domUtils.isBlockElm(start)){start.style.clear="both";range.moveToBookmark(bk).select();break}start=start.parentNode}}}};me.commands.edittable={queryCommandState:function(){var range=this.selection.getRange();if(this.highlight){return -1}return domUtils.findParentByTagName(range.startContainer,"table",true)||me.currentSelectedArr.length>0?0:-1},execCommand:function(cmdName,opt){var start=me.selection.getStart(),table=domUtils.findParentByTagName(start,"table",true);if(table){table.style.cssText=table.style.cssText.replace(/border[^;]+/gi,"");table.style.borderCollapse=opt.cellSpacing&&opt.cellSpacing!="0"?"separate":"collapse";opt.cellSpacing&&opt.cellSpacing!="0"?table.setAttribute("cellSpacing",opt.cellSpacing):table.removeAttribute("cellSpacing");opt.ueditorHeight&&table.setAttribute("height",opt.ueditorHeight+"px");opt.align&&table.setAttribute("align",opt.align);if(opt.ueditorWidth){table.setAttribute("width",opt.ueditorWidth+"px");table.style.width=""}if(opt.bgColor){table.setAttribute("bgColor",opt.bgColor)}else{domUtils.removeAttributes(table,["bgColor"])}opt.borderColor&&table.setAttribute("borderColor",opt.borderColor);table.setAttribute("border",opt.border);if(domUtils.hasClass(table,"noBorderTable")){domUtils.removeClasses(table,["noBorderTable"])}domUtils.addClass(table,opt.border=="0"?" noBorderTable":"");if(opt.borderType=="1"){table.setAttribute("borderType","1");table.setAttribute("frame","box");table.setAttribute("rules","none")}else{table.removeAttribute("borderType");table.removeAttribute("frame");table.removeAttribute("rules")}if(opt.cellPadding!=""){for(var i=0,ti,tds=table.getElementsByTagName("td");ti=tds[i++];){ti.style.padding=opt.cellPadding+"px"}table.setAttribute("cellPadding",opt.cellPadding)}else{for(var i=0,ti,tds=table.getElementsByTagName("td");ti=tds[i++];){ti.style.padding=""}table.removeAttribute("cellPadding")}}}};me.commands.edittd={queryCommandState:function(){var tableItems=getTableItemsByRange(this);if(!tableItems.cell){return -1}return 0},execCommand:function(cmdName,tdItems){var range=this.selection.getRange(),tdsall=getUETableBySelected(this),tds=!me.currentSelectedArr.length?[domUtils.findParentByTagName(range.startContainer,["td","th"],true)]:me.currentSelectedArr;if(Object.prototype.toString.call(tdItems)==="[object Object]"){tds=tdsall&&tdsall.selectedTds?tdsall.selectedTds:tds;for(var i=0,td;td=tds[i++];){td.style.backgroundColor=tdItems.bgColor;td.bgColor=tdItems.bgColor;domUtils.setAttributes(td,{align:tdItems.align,vAlign:tdItems.vAlign})}}else{if(tdsall&&tdsall.selectedTds){tdsall=tdsall.selectedTds}for(var i=0,td1;td1=tdsall[i++];){td1.style.backgroundColor=tdItems=="default"?"":tdItems;td1.bgColor=tdItems=="default"?"":tdItems}}}};me.commands.deletetable={queryCommandState:function(){if(this.highlight){return -1}var range=this.selection.getRange();return(domUtils.findParentByTagName(range.startContainer,"table",true)&&domUtils.findParentByTagName(range.endContainer,"table",true))||me.currentSelectedArr.length>0?0:-1},execCommand:function(){var range=this.selection.getRange(),table=domUtils.findParentByTagName(me.currentSelectedArr.length>0?me.currentSelectedArr[0]:range.startContainer,"table",true);deleteTable(table,range);reset()}};me.commands.mergeright={queryCommandState:function(cmd){var tableItems=getTableItemsByRange(this);if(!tableItems.cell){return -1}var ut=getUETable(tableItems.table);if(ut.selectedTds.length){return -1}var cellInfo=ut.getCellInfo(tableItems.cell),rightColIndex=cellInfo.colIndex+cellInfo.colSpan;if(rightColIndex>=ut.colsNum){return -1}var rightCellInfo=ut.indexTable[cellInfo.rowIndex][rightColIndex];return(rightCellInfo.rowIndex==cellInfo.rowIndex&&rightCellInfo.rowSpan==cellInfo.rowSpan)?0:-1},execCommand:function(cmd){var rng=this.selection.getRange(),bk=rng.createBookmark(true);var cell=getTableItemsByRange(this).cell,ut=getUETable(cell);ut.mergeRight(cell);rng.moveToBookmark(bk).select()}};me.commands.mergedown={queryCommandState:function(cmd){var tableItems=getTableItemsByRange(this),cell=tableItems.cell;if(!cell||cell.tagName=="TH"){return -1}var ut=getUETable(tableItems.table);if(ut.selectedTds.length){return -1}var cellInfo=ut.getCellInfo(tableItems.cell),downRowIndex=cellInfo.rowIndex+cellInfo.rowSpan;if(downRowIndex>=ut.rowsNum){return -1}var downCellInfo=ut.indexTable[downRowIndex][cellInfo.colIndex];return(downCellInfo.colIndex==cellInfo.colIndex&&downCellInfo.colSpan==cellInfo.colSpan)&&tableItems.cell.tagName!=="TH"?0:-1},execCommand:function(){var rng=this.selection.getRange(),bk=rng.createBookmark(true);var cell=getTableItemsByRange(this).cell,ut=getUETable(cell);ut.mergeDown(cell);rng.moveToBookmark(bk).select()}};me.commands.deleterow={queryCommandState:function(){var tableItems=getTableItemsByRange(this);if(!tableItems.cell){return -1}return 0},execCommand:function(){var cell=getTableItemsByRange(this).cell,ut=getUETable(cell),cellsRange=ut.cellsRange,cellInfo=ut.getCellInfo(cell),preCell=ut.getVSideCell(cell),nextCell=ut.getVSideCell(cell,true),rng=this.selection.getRange();if(utils.isEmptyObject(cellsRange)){ut.deleteRow(cellInfo.rowIndex)}else{for(var i=cellsRange.beginRowIndex;i<cellsRange.endRowIndex+1;i++){ut.deleteRow(cellsRange.beginRowIndex)}}var table=ut.table;if(!table.getElementsByTagName("td").length){var nextSibling=table.nextSibling;domUtils.remove(table);if(nextSibling){rng.setStart(nextSibling,0).setCursor(false,true)}}else{if(cellInfo.rowSpan==1||cellInfo.rowSpan==cellsRange.endRowIndex-cellsRange.beginRowIndex+1){if(nextCell||preCell){rng.selectNodeContents(nextCell||preCell).setCursor(false,true)}}else{var newCell=ut.getCell(cellInfo.rowIndex,ut.indexTable[cellInfo.rowIndex][cellInfo.colIndex].cellIndex);if(newCell){rng.selectNodeContents(newCell).setCursor(false,true)}}}}};me.commands.deletecol={queryCommandState:function(){var tableItems=getTableItemsByRange(this);if(!tableItems.cell){return -1}return 0},execCommand:function(){var cell=getTableItemsByRange(this).cell,ut=getUETable(cell),range=ut.cellsRange,cellInfo=ut.getCellInfo(cell),preCell=ut.getHSideCell(cell),nextCell=ut.getHSideCell(cell,true);if(utils.isEmptyObject(range)){ut.deleteCol(cellInfo.colIndex)}else{for(var i=range.beginColIndex;i<range.endColIndex+1;i++){ut.deleteCol(range.beginColIndex)}}var table=ut.table,rng=this.selection.getRange();if(!table.getElementsByTagName("td").length){var nextSibling=table.nextSibling;domUtils.remove(table);if(nextSibling){rng.setStart(nextSibling,0).setCursor(false,true)}}else{if(domUtils.inDoc(cell,this.document)){rng.setStart(cell,0).setCursor(false,true)}else{if(nextCell&&domUtils.inDoc(nextCell,this.document)){rng.selectNodeContents(nextCell).setCursor(false,true)}else{if(preCell&&domUtils.inDoc(preCell,this.document)){rng.selectNodeContents(preCell).setCursor(true,true)}}}}}};me.commands.splittocells={queryCommandState:function(){var tableItems=getTableItemsByRange(this),cell=tableItems.cell;if(!cell){return -1}var ut=getUETable(tableItems.table);if(ut.selectedTds.length>0){return -1}return cell&&(cell.colSpan>1||cell.rowSpan>1)?0:-1},execCommand:function(){var rng=this.selection.getRange(),bk=rng.createBookmark(true);var cell=getTableItemsByRange(this).cell,ut=getUETable(cell);ut.splitToCells(cell);rng.moveToBookmark(bk).select()}};me.commands.splittorows={queryCommandState:function(){var tableItems=getTableItemsByRange(this),cell=tableItems.cell;if(!cell){return -1}var ut=getUETable(tableItems.table);if(ut.selectedTds.length>0){return -1}return cell&&cell.rowSpan>1?0:-1},execCommand:function(){var rng=this.selection.getRange(),bk=rng.createBookmark(true);var cell=getTableItemsByRange(this).cell,ut=getUETable(cell);ut.splitToRows(cell);rng.moveToBookmark(bk).select()}};me.commands.insertparagraphbeforetable={queryCommandState:function(){if(this.highlight){return -1}var range=this.selection.getRange(),start=range.startContainer,td=domUtils.findParentByTagName(start,"td",true)||me.currentSelectedArr[0];return td&&domUtils.findParentByTagName(td,"table")?0:-1},execCommand:function(){var range=this.selection.getRange(),start=range.startContainer,table=domUtils.findParentByTagName(start,"table",true);start=me.document.createElement(me.options.enterTag);table.parentNode.insertBefore(start,table);clearSelectedTd(me.currentSelectedArr);if(start.tagName=="P"){start.innerHTML=browser.ie?"":"<br/>";range.setStart(start,0)}else{range.setStartBefore(start)}range.setCursor()}};me.commands.splittocols={queryCommandState:function(){var tableItems=getTableItemsByRange(this),cell=tableItems.cell;if(!cell){return -1}var ut=getUETable(tableItems.table);if(ut.selectedTds.length>0){return -1}return cell&&cell.colSpan>1?0:-1},execCommand:function(){var rng=this.selection.getRange(),bk=rng.createBookmark(true);var cell=getTableItemsByRange(this).cell,ut=getUETable(cell);ut.splitToCols(cell);rng.moveToBookmark(bk).select()}};me.commands.insertrow={queryCommandState:function(){var tableItems=getTableItemsByRange(this),cell=tableItems.cell;return cell&&cell.tagName=="TD"&&getUETable(tableItems.table).rowsNum<this.options.maxRowNum?0:-1},execCommand:function(){var rng=this.selection.getRange(),bk=rng.createBookmark(true);var cell=getTableItemsByRange(this).cell,ut=getUETable(cell),cellInfo=ut.getCellInfo(cell);if(!ut.selectedTds.length){ut.insertRow(cellInfo.rowIndex)}else{var range=ut.cellsRange;for(var i=0,len=range.endRowIndex-range.beginRowIndex+1;i<len;i++){ut.insertRow(range.beginRowIndex)}}rng.moveToBookmark(bk).select()}};me.commands.insertcol={queryCommandState:function(cmd){var tableItems=getTableItemsByRange(this),cell=tableItems.cell;return cell&&(cell.tagName=="TD"||cell.tagName=="TH")&&getUETable(tableItems.table).colsNum<this.options.maxColNum?0:-1},execCommand:function(cmd){var rng=this.selection.getRange(),bk=rng.createBookmark(true);if(this.queryCommandState(cmd)==-1){return}var cell=getTableItemsByRange(this).cell,ut=getUETable(cell),cellInfo=ut.getCellInfo(cell);if(!ut.selectedTds.length){ut.insertCol(cellInfo.colIndex)}else{var range=ut.cellsRange;for(var i=0,len=range.endColIndex-range.beginColIndex+1;i<len;i++){ut.insertCol(range.beginColIndex)}}rng.moveToBookmark(bk).select()}};me.commands.mergecells={queryCommandState:function(){return getUETableBySelected(this)?0:-1},execCommand:function(){var ut=getUETableBySelected(this);if(ut&&ut.selectedTds.length){var cell=ut.selectedTds[0];getUETableBySelected(this).mergeRange();var rng=this.selection.getRange();if(domUtils.isEmptyBlock(cell)){rng.setStart(cell,0).collapse(true)}else{rng.selectNodeContents(cell)}rng.select()}}};function _moveContent(cellTo,cellFrom){if(_isEmpty(cellFrom)){return}if(_isEmpty(cellTo)){cellTo.innerHTML=cellFrom.innerHTML;return}var child=cellTo.lastChild;if(child.nodeType!=1||child.tagName!="BR"){cellTo.appendChild(cellTo.ownerDocument.createElement("br"))}while(child=cellFrom.firstChild){cellTo.appendChild(child)}}function _getCellsRange(cellA,cellB){var trA=cellA.parentNode,trB=cellB.parentNode,aRowIndex=trA.rowIndex,bRowIndex=trB.rowIndex,rows=trA.parentNode.parentNode.rows,rowsNum=rows.length,cellsNum=rows[0].cells.length,cellAIndex=getIndex(cellA),cellBIndex=getIndex(cellB);if(cellA==cellB){return{beginRowIndex:aRowIndex,beginCellIndex:cellAIndex,endRowIndex:aRowIndex+cellA.rowSpan-1,endCellIndex:cellBIndex+cellA.colSpan-1}}var beginRowIndex=Math.min(aRowIndex,bRowIndex),beginCellIndex=Math.min(cellAIndex,cellBIndex),endRowIndex=Math.max(aRowIndex+cellA.rowSpan-1,bRowIndex+cellB.rowSpan-1),endCellIndex=Math.max(cellAIndex+cellA.colSpan-1,cellBIndex+cellB.colSpan-1);while(1){var tmpBeginRowIndex=beginRowIndex,tmpBeginCellIndex=beginCellIndex,tmpEndRowIndex=endRowIndex,tmpEndCellIndex=endCellIndex;if(beginRowIndex>0){for(cellIndex=beginCellIndex;cellIndex<=endCellIndex;){var currentTopTd=rows[beginRowIndex].cells[cellIndex];if(_isHide(currentTopTd)){beginRowIndex=currentTopTd.getAttribute("rootRowIndex");currentTopTd=rows[currentTopTd.getAttribute("rootRowIndex")].cells[currentTopTd.getAttribute("rootCellIndex")]}cellIndex=getIndex(currentTopTd)+(currentTopTd.colSpan||1)}}if(beginCellIndex>0){for(var rowIndex=beginRowIndex;rowIndex<=endRowIndex;){var currentLeftTd=rows[rowIndex].cells[beginCellIndex];if(_isHide(currentLeftTd)){beginCellIndex=currentLeftTd.getAttribute("rootCellIndex");currentLeftTd=rows[currentLeftTd.getAttribute("rootRowIndex")].cells[currentLeftTd.getAttribute("rootCellIndex")]}rowIndex=currentLeftTd.parentNode.rowIndex+(currentLeftTd.rowSpan||1)}}if(endRowIndex<rowsNum){for(var cellIndex=beginCellIndex;cellIndex<=endCellIndex;){var currentDownTd=rows[endRowIndex].cells[cellIndex];if(_isHide(currentDownTd)){currentDownTd=rows[currentDownTd.getAttribute("rootRowIndex")].cells[currentDownTd.getAttribute("rootCellIndex")]}endRowIndex=currentDownTd.parentNode.rowIndex+currentDownTd.rowSpan-1;cellIndex=getIndex(currentDownTd)+(currentDownTd.colSpan||1)}}if(endCellIndex<cellsNum){for(rowIndex=beginRowIndex;rowIndex<=endRowIndex;){var currentRightTd=rows[rowIndex].cells[endCellIndex];if(_isHide(currentRightTd)){currentRightTd=rows[currentRightTd.getAttribute("rootRowIndex")].cells[currentRightTd.getAttribute("rootCellIndex")]}endCellIndex=getIndex(currentRightTd)+currentRightTd.colSpan-1;rowIndex=currentRightTd.parentNode.rowIndex+(currentRightTd.rowSpan||1)}}if(tmpBeginCellIndex==beginCellIndex&&tmpEndCellIndex==endCellIndex&&tmpEndRowIndex==endRowIndex&&tmpBeginRowIndex==beginRowIndex){break}}return{beginRowIndex:beginRowIndex,beginCellIndex:beginCellIndex,endRowIndex:endRowIndex,endCellIndex:endCellIndex}}function _mouseDownEvent(type,evt){anchorTd=evt.target||evt.srcElement;if(me.queryCommandState("highlightcode")||domUtils.findParent(anchorTd,function(node){return node.tagName=="DIV"&&/highlighter/.test(node.id)})){return}if(evt.button==2){return}me.document.body.style.webkitUserSelect="";clearSelectedTd(me.currentSelectedArr);domUtils.clearSelectedArr(me.currentSelectedArr);if(anchorTd.tagName!=="TD"){anchorTd=domUtils.findParentByTagName(anchorTd,"td")||anchorTd}if(anchorTd.tagName=="TD"){me.addListener("mouseover",function(type,evt){var tmpTd=evt.target||evt.srcElement;_mouseOverEvent.call(me,tmpTd);evt.preventDefault?evt.preventDefault():(evt.returnValue=false)})}else{reset()}}function _mouseOverEvent(tmpTd){if(anchorTd&&tmpTd.tagName=="TD"&&domUtils.findParentByTagName(anchorTd,"table")==domUtils.findParentByTagName(tmpTd,"table")){me.document.body.style.webkitUserSelect="none";var table=tmpTd.parentNode.parentNode.parentNode;me.selection.getNative()[browser.ie?"empty":"removeAllRanges"]();var range=_getCellsRange(anchorTd,tmpTd);_toggleSelect(table,range)}}function _toggleSelect(table,cellsRange){var rows=table.rows;clearSelectedTd(me.currentSelectedArr);for(var i=cellsRange.beginRowIndex;i<=cellsRange.endRowIndex;i++){for(var j=cellsRange.beginCellIndex;j<=cellsRange.endCellIndex;j++){var td=rows[i].cells[j];td.className="selectTdClass";me.currentSelectedArr.push(td)}}}function update(table){var tds=table.getElementsByTagName("td"),rowIndex,cellIndex,rows=table.rows;for(var j=0,tj;tj=tds[j++];){if(!_isHide(tj)){rowIndex=tj.parentNode.rowIndex;cellIndex=getIndex(tj);for(var r=0;r<tj.rowSpan;r++){var c=r==0?1:0;for(;c<tj.colSpan;c++){var tmp=rows[rowIndex+r].children[cellIndex+c];tmp.setAttribute("rootRowIndex",rowIndex);tmp.setAttribute("rootCellIndex",cellIndex)}}}if(!_isHide(tj)){domUtils.removeAttributes(tj,["rootRowIndex","rootCellIndex"])}if(tj.colSpan&&tj.colSpan==1){tj.removeAttribute("colSpan")}if(tj.rowSpan&&tj.rowSpan==1){tj.removeAttribute("rowSpan")}var width;if(!_isHide(tj)&&(width=tj.style.width)&&/%/.test(width)){tj.style.width=Math.floor(100/tj.parentNode.cells.length)+"%"}}}me.adjustTable=function(cont){var table=cont.getElementsByTagName("table");for(var i=0,ti;ti=table[i++];){if(ti.getAttribute("align")){var next=ti.nextSibling;while(next){if(domUtils.isBlockElm(next)){break}next=next.nextSibling}if(next){next.style.clear="both"}}ti.removeAttribute("_innerCreateTable");var tds=domUtils.getElementsByTagName(ti,"td"),td,tmpTd;for(var j=0,tj;tj=tds[j++];){if(domUtils.isEmptyNode(tj)){tj.innerHTML=browser.ie?domUtils.fillChar:"<br/>"}var index=getIndex(tj),rowIndex=tj.parentNode.rowIndex,rows=domUtils.findParentByTagName(tj,"table").rows;for(var r=0;r<tj.rowSpan;r++){var c=r==0?1:0;for(;c<tj.colSpan;c++){if(!td){td=tj.cloneNode(false);td.rowSpan=td.colSpan=1;td.style.display="none";td.innerHTML=browser.ie?"":"<br/>"}else{td=td.cloneNode(true)}td.setAttribute("rootRowIndex",tj.parentNode.rowIndex);td.setAttribute("rootCellIndex",index);if(r==0){if(tj.nextSibling){tj.parentNode.insertBefore(td,tj.nextSibling)}else{tj.parentNode.appendChild(td)}}else{tmpTd=rows[rowIndex+r].children[index];if(tmpTd){tmpTd.parentNode.insertBefore(td,tmpTd)}else{rows[rowIndex+r].appendChild(td)}}}}}var bw=domUtils.getComputedStyle(ti,"border-width");if(bw=="0px"&&ti.style.border!="none"||((bw==""||bw=="medium")&&ti.getAttribute("border")==="0")){domUtils.addClass(ti,"noBorderTable")}}me.fireEvent("afteradjusttable",cont)};function UETable(table){this.table=table;this.indexTable=[];this.selectedTds=[];this.cellsRange={};this.update(table)}UETable.prototype={getMaxRows:function(){var rows=this.table.rows,maxLen=1;for(var i=0,row;row=rows[i];i++){var currentMax=1;for(var j=0,cj;cj=row.cells[j++];){currentMax=Math.max(cj.rowSpan||1,currentMax)}maxLen=Math.max(currentMax+i,maxLen)}return maxLen},getMaxCols:function(){var rows=this.table.rows,maxLen=0,cellRows={};for(var i=0,row;row=rows[i];i++){var cellsNum=0;for(var j=0,cj;cj=row.cells[j++];){cellsNum+=(cj.colSpan||1);if(cj.rowSpan&&cj.rowSpan>1){for(var k=1;k<cj.rowSpan;k++){if(!cellRows["row_"+(i+k)]){cellRows["row_"+(i+k)]=(cj.colSpan||1)}else{cellRows["row_"+(i+k)]++}}}}cellsNum+=cellRows["row_"+i]||0;maxLen=Math.max(cellsNum,maxLen)}return maxLen},getCellColIndex:function(cell){},getHSideCell:function(cell,right){try{var cellInfo=this.getCellInfo(cell),previewRowIndex,previewColIndex;var len=this.selectedTds.length,range=this.cellsRange;if((!right&&(!len?!cellInfo.colIndex:!range.beginColIndex))||(right&&(!len?(cellInfo.colIndex==(this.colsNum-1)):(range.endColIndex==this.colsNum-1)))){return null}previewRowIndex=!len?cellInfo.rowIndex:range.beginRowIndex;previewColIndex=!right?(!len?(cellInfo.colIndex<1?0:(cellInfo.colIndex-1)):range.beginColIndex-1):(!len?cellInfo.colIndex+1:range.endColIndex+1);return this.getCell(this.indexTable[previewRowIndex][previewColIndex].rowIndex,this.indexTable[previewRowIndex][previewColIndex].cellIndex)}catch(e){showError(e)}},getVSideCell:function(cell,bottom,ignoreRange){try{var cellInfo=this.getCellInfo(cell),nextRowIndex,nextColIndex;var len=this.selectedTds.length&&!ignoreRange,range=this.cellsRange;if((!bottom&&(cellInfo.rowIndex==0))||(bottom&&(!len?(cellInfo.rowIndex+cellInfo.rowSpan>this.rowsNum-1):(range.endRowIndex==this.rowsNum-1)))){return null}nextRowIndex=!bottom?(!len?cellInfo.rowIndex-1:range.beginRowIndex-1):(!len?(cellInfo.rowIndex+cellInfo.rowSpan):range.endRowIndex+1);nextColIndex=!len?cellInfo.colIndex:range.beginColIndex;return this.getCell(this.indexTable[nextRowIndex][nextColIndex].rowIndex,this.indexTable[nextRowIndex][nextColIndex].cellIndex)}catch(e){showError(e)}},getSameEndPosCells:function(cell,xOrY){try{var flag=(xOrY.toLowerCase()==="x"),end=domUtils.getXY(cell)[flag?"x":"y"]+cell["offset"+(flag?"Width":"Height")],rows=this.table.rows,cells=null,returns=[];for(var i=0;i<this.rowsNum;i++){cells=rows[i].cells;for(var j=0,tmpCell;tmpCell=cells[j++];){var tmpEnd=domUtils.getXY(tmpCell)[flag?"x":"y"]+tmpCell["offset"+(flag?"Width":"Height")];if(tmpEnd>end&&flag){break}if(cell==tmpCell||end==tmpEnd){if(tmpCell[flag?"colSpan":"rowSpan"]==1){returns.push(tmpCell)}if(flag){break}}}}return returns}catch(e){showError(e)}},setCellContent:function(cell,content){cell.innerHTML=content||(browser.ie?domUtils.fillChar:"<br />")},cloneCell:cloneCell,getSameStartPosXCells:function(cell){try{var start=domUtils.getXY(cell).x+cell.offsetWidth,rows=this.table.rows,cells,returns=[];for(var i=0;i<this.rowsNum;i++){cells=rows[i].cells;for(var j=0,tmpCell;tmpCell=cells[j++];){var tmpStart=domUtils.getXY(tmpCell).x;if(tmpStart>start){break}if(tmpStart==start&&tmpCell.colSpan==1){returns.push(tmpCell);break}}}return returns}catch(e){showError(e)}},update:function(table){this.table=table||this.table;this.selectedTds=[];this.cellsRange={};this.indexTable=[];var rows=this.table.rows,rowsNum=rows.length,colsNum=this.getMaxCols();this.rowsNum=rowsNum;this.colsNum=colsNum;for(var i=0,len=rows.length;i<len;i++){this.indexTable[i]=new Array(colsNum)}for(var rowIndex=0,row;row=rows[rowIndex];rowIndex++){for(var cellIndex=0,cell,cells=row.cells;cell=cells[cellIndex];cellIndex++){if(cell.rowSpan>rowsNum){cell.rowSpan=rowsNum}var colIndex=cellIndex,rowSpan=cell.rowSpan||1,colSpan=cell.colSpan||1;while(this.indexTable[rowIndex][colIndex]){colIndex++}for(var j=0;j<rowSpan;j++){for(var k=0;k<colSpan;k++){if(this.indexTable[rowIndex+j]){this.indexTable[rowIndex+j][colIndex+k]={rowIndex:rowIndex,cellIndex:cellIndex,colIndex:colIndex,rowSpan:rowSpan,colSpan:colSpan}}}}}}for(j=0;j<rowsNum;j++){for(k=0;k<colsNum;k++){if(this.indexTable[j][k]===undefined){row=rows[j];cell=row.cells[row.cells.length-1];cell=cell?cell.cloneNode(true):this.table.ownerDocument.createElement("td");this.setCellContent(cell);if(cell.colSpan!==1){cell.colSpan=1}if(cell.rowSpan!==1){cell.rowSpan=1}row.appendChild(cell);this.indexTable[j][k]={rowIndex:j,cellIndex:cell.cellIndex,colIndex:k,rowSpan:1,colSpan:1}}}}var tds=domUtils.getElementsByTagName(this.table,"td"),selectTds=[];utils.each(tds,function(td){if(domUtils.hasClass(td,"selectTdClass")){selectTds.push(td)}});if(selectTds.length){var start=selectTds[0],end=selectTds[selectTds.length-1],startInfo=this.getCellInfo(start),endInfo=this.getCellInfo(end);this.selectedTds=selectTds;this.cellsRange={beginRowIndex:startInfo.rowIndex,beginColIndex:startInfo.colIndex,endRowIndex:endInfo.rowIndex+endInfo.rowSpan-1,endColIndex:endInfo.colIndex+endInfo.colSpan-1}}},getCellRowIndex:function(cell){var cellIndex=cell.cellIndex,rows=this.table.rows,rowLen=rows.length;if(rowLen){while(rowLen--){if(rows[rowLen].cells[cellIndex]===cell){return rowLen}}}return -1},getCellInfo:function(cell){if(!cell){return}var cellIndex=cell.cellIndex,rowIndex=this.getCellRowIndex(cell),rowInfo=this.indexTable[rowIndex],numCols=this.colsNum;for(var colIndex=cellIndex;colIndex<numCols;colIndex++){var cellInfo=rowInfo[colIndex];if(cellInfo.rowIndex===rowIndex&&cellInfo.cellIndex===cellIndex){return cellInfo}}},getCell:function(rowIndex,cellIndex){return rowIndex<this.rowsNum&&this.table.rows[rowIndex].cells[cellIndex]||null},deleteCell:function(cell,rowIndex){rowIndex=typeof rowIndex=="number"?rowIndex:this.getCellRowIndex(cell);var row=this.table.rows[rowIndex];row.deleteCell(cell.cellIndex)},getCellsRange:function(cellA,cellB){function checkRange(beginRowIndex,beginColIndex,endRowIndex,endColIndex){var tmpBeginRowIndex=beginRowIndex,tmpBeginColIndex=beginColIndex,tmpEndRowIndex=endRowIndex,tmpEndColIndex=endColIndex,cellInfo,colIndex,rowIndex;if(beginRowIndex>0){for(colIndex=beginColIndex;colIndex<endColIndex;colIndex++){cellInfo=me.indexTable[beginRowIndex][colIndex];rowIndex=cellInfo.rowIndex;if(rowIndex<beginRowIndex){tmpBeginRowIndex=Math.min(rowIndex,tmpBeginRowIndex)}}}if(endColIndex<me.colsNum){for(rowIndex=beginRowIndex;rowIndex<endRowIndex;rowIndex++){cellInfo=me.indexTable[rowIndex][endColIndex];colIndex=cellInfo.colIndex+cellInfo.colSpan-1;if(colIndex>endColIndex){tmpEndColIndex=Math.max(colIndex,tmpEndColIndex)}}}if(endRowIndex<me.rowsNum){for(colIndex=beginColIndex;colIndex<endColIndex;colIndex++){cellInfo=me.indexTable[endRowIndex][colIndex];rowIndex=cellInfo.rowIndex+cellInfo.rowSpan-1;if(rowIndex>endRowIndex){tmpEndRowIndex=Math.max(rowIndex,tmpEndRowIndex)}}}if(beginColIndex>0){for(rowIndex=beginRowIndex;rowIndex<endRowIndex;rowIndex++){cellInfo=me.indexTable[rowIndex][beginColIndex];colIndex=cellInfo.colIndex;if(colIndex<beginColIndex){tmpBeginColIndex=Math.min(cellInfo.colIndex,tmpBeginColIndex)}}}if(tmpBeginRowIndex!=beginRowIndex||tmpBeginColIndex!=beginColIndex||tmpEndRowIndex!=endRowIndex||tmpEndColIndex!=endColIndex){return checkRange(tmpBeginRowIndex,tmpBeginColIndex,tmpEndRowIndex,tmpEndColIndex)}else{return{beginRowIndex:beginRowIndex,beginColIndex:beginColIndex,endRowIndex:endRowIndex,endColIndex:endColIndex}}}try{var me=this,cellAInfo=me.getCellInfo(cellA);if(cellA===cellB){return{beginRowIndex:cellAInfo.rowIndex,beginColIndex:cellAInfo.colIndex,endRowIndex:cellAInfo.rowIndex+cellAInfo.rowSpan-1,endColIndex:cellAInfo.colIndex+cellAInfo.colSpan-1}}var cellBInfo=me.getCellInfo(cellB);var beginRowIndex=Math.min(cellAInfo.rowIndex,cellBInfo.rowIndex),beginColIndex=Math.min(cellAInfo.colIndex,cellBInfo.colIndex),endRowIndex=Math.max(cellAInfo.rowIndex+cellAInfo.rowSpan-1,cellBInfo.rowIndex+cellBInfo.rowSpan-1),endColIndex=Math.max(cellAInfo.colIndex+cellAInfo.colSpan-1,cellBInfo.colIndex+cellBInfo.colSpan-1);return checkRange(beginRowIndex,beginColIndex,endRowIndex,endColIndex)}catch(e){if(debug){throw e}}},getCells:function(range){this.clearSelected();var beginRowIndex=range.beginRowIndex,beginColIndex=range.beginColIndex,endRowIndex=range.endRowIndex,endColIndex=range.endColIndex,cellInfo,rowIndex,colIndex,tdHash={},returnTds=[];for(var i=beginRowIndex;i<=endRowIndex;i++){for(var j=beginColIndex;j<=endColIndex;j++){cellInfo=this.indexTable[i][j];rowIndex=cellInfo.rowIndex;colIndex=cellInfo.colIndex;var key=rowIndex+"|"+colIndex;if(tdHash[key]){continue}tdHash[key]=1;if(rowIndex<i||colIndex<j||rowIndex+cellInfo.rowSpan-1>endRowIndex||colIndex+cellInfo.colSpan-1>endColIndex){return null}returnTds.push(this.getCell(rowIndex,cellInfo.cellIndex))}}return returnTds},clearSelected:function(){removeSelectedClass(this.selectedTds);this.selectedTds=[];this.cellsRange={}},setSelected:function(range){var cells=this.getCells(range);addSelectedClass(cells);this.selectedTds=cells;this.cellsRange=range},isFullRow:function(){var range=this.cellsRange;return(range.endColIndex-range.beginColIndex+1)==this.colsNum},isFullCol:function(){var range=this.cellsRange,table=this.table,ths=table.getElementsByTagName("th"),rows=range.endRowIndex-range.beginRowIndex+1;return !ths.length?rows==this.rowsNum:rows==this.rowsNum||(rows==this.rowsNum-1)},getNextCell:function(cell,bottom,ignoreRange){try{var cellInfo=this.getCellInfo(cell),nextRowIndex,nextColIndex;var len=this.selectedTds.length&&!ignoreRange,range=this.cellsRange;if((!bottom&&(cellInfo.rowIndex==0))||(bottom&&(!len?(cellInfo.rowIndex+cellInfo.rowSpan>this.rowsNum-1):(range.endRowIndex==this.rowsNum-1)))){return null}nextRowIndex=!bottom?(!len?cellInfo.rowIndex-1:range.beginRowIndex-1):(!len?(cellInfo.rowIndex+cellInfo.rowSpan):range.endRowIndex+1);nextColIndex=!len?cellInfo.colIndex:range.beginColIndex;return this.getCell(this.indexTable[nextRowIndex][nextColIndex].rowIndex,this.indexTable[nextRowIndex][nextColIndex].cellIndex)}catch(e){showError(e)}},getPreviewCell:function(cell,top){try{var cellInfo=this.getCellInfo(cell),previewRowIndex,previewColIndex;var len=this.selectedTds.length,range=this.cellsRange;if((!top&&(!len?!cellInfo.colIndex:!range.beginColIndex))||(top&&(!len?(cellInfo.rowIndex>(this.colsNum-1)):(range.endColIndex==this.colsNum-1)))){return null}previewRowIndex=!top?(!len?cellInfo.rowIndex:range.beginRowIndex):(!len?(cellInfo.rowIndex<1?0:(cellInfo.rowIndex-1)):range.beginRowIndex);previewColIndex=!top?(!len?(cellInfo.colIndex<1?0:(cellInfo.colIndex-1)):range.beginColIndex-1):(!len?cellInfo.colIndex:range.endColIndex+1);return this.getCell(this.indexTable[previewRowIndex][previewColIndex].rowIndex,this.indexTable[previewRowIndex][previewColIndex].cellIndex)}catch(e){showError(e)}},moveContent:function(cellTo,cellFrom){if(isEmptyBlock(cellFrom)){return}if(isEmptyBlock(cellTo)){cellTo.innerHTML=cellFrom.innerHTML;return}var child=cellTo.lastChild;if(child.nodeType==3||!dtd.$block[child.tagName]){cellTo.appendChild(cellTo.ownerDocument.createElement("br"))}while(child=cellFrom.firstChild){cellTo.appendChild(child)}},mergeRight:function(cell){var cellInfo=this.getCellInfo(cell),rightColIndex=cellInfo.colIndex+cellInfo.colSpan,rightCellInfo=this.indexTable[cellInfo.rowIndex][rightColIndex],rightCell=this.getCell(rightCellInfo.rowIndex,rightCellInfo.cellIndex);cell.colSpan=cellInfo.colSpan+rightCellInfo.colSpan;cell.removeAttribute("width");this.moveContent(cell,rightCell);this.deleteCell(rightCell,rightCellInfo.rowIndex);this.update()},mergeDown:function(cell){var cellInfo=this.getCellInfo(cell),downRowIndex=cellInfo.rowIndex+cellInfo.rowSpan,downCellInfo=this.indexTable[downRowIndex][cellInfo.colIndex],downCell=this.getCell(downCellInfo.rowIndex,downCellInfo.cellIndex);cell.rowSpan=cellInfo.rowSpan+downCellInfo.rowSpan;cell.removeAttribute("height");this.moveContent(cell,downCell);this.deleteCell(downCell,downCellInfo.rowIndex);this.update()},mergeRange:function(){var range=this.cellsRange,leftTopCell=this.getCell(range.beginRowIndex,this.indexTable[range.beginRowIndex][range.beginColIndex].cellIndex);if(leftTopCell.tagName=="TH"&&range.endRowIndex!==range.beginRowIndex){var index=this.indexTable,info=this.getCellInfo(leftTopCell);leftTopCell=this.getCell(1,index[1][info.colIndex].cellIndex);range=this.getCellsRange(leftTopCell,this.getCell(index[this.rowsNum-1][info.colIndex].rowIndex,index[this.rowsNum-1][info.colIndex].cellIndex))}var cells=this.getCells(range),len=cells.length,cell;while(len--){cell=cells[len];if(cell!==leftTopCell){this.moveContent(leftTopCell,cell);this.deleteCell(cell)}}leftTopCell.rowSpan=range.endRowIndex-range.beginRowIndex+1;leftTopCell.rowSpan>1&&leftTopCell.removeAttribute("height");leftTopCell.colSpan=range.endColIndex-range.beginColIndex+1;leftTopCell.colSpan>1&&leftTopCell.removeAttribute("width");if(leftTopCell.rowSpan==this.rowsNum&&leftTopCell.colSpan!=1){leftTopCell.colSpan=1}if(leftTopCell.colSpan==this.colsNum&&leftTopCell.rowSpan!=1){var rowIndex=leftTopCell.parentNode.rowIndex;for(var i=0;i<leftTopCell.rowSpan-1;i++){var row=this.table.rows[rowIndex+1];row.parentNode.removeChild(row)}leftTopCell.rowSpan=1}this.update()},insertRow:function(rowIndex,tagName){var numCols=this.colsNum,table=this.table,row=table.insertRow(rowIndex),cell,width=parseInt((table.offsetWidth-numCols*20-numCols-1)/numCols,10);if(rowIndex==0||rowIndex==this.rowsNum){for(var colIndex=0;colIndex<numCols;colIndex++){cell=tagName?table.ownerDocument.createElement("th"):row.insertCell(colIndex);this.setCellContent(cell);cell.setAttribute("valign",me.options.tdvalign);tagName&&row.appendChild(cell)}}else{var infoRow=this.indexTable[rowIndex],cellIndex=0;for(colIndex=0;colIndex<numCols;colIndex++){var cellInfo=infoRow[colIndex];if(cellInfo.rowIndex<rowIndex){cell=this.getCell(cellInfo.rowIndex,cellInfo.cellIndex);cell.rowSpan=cellInfo.rowSpan+1}else{cell=row.insertCell(cellIndex++);this.setCellContent(cell)}}}this.update();return row},deleteRow:function(rowIndex){var row=this.table.rows[rowIndex],infoRow=this.indexTable[rowIndex],colsNum=this.colsNum,count=0;for(var colIndex=0;colIndex<colsNum;){var cellInfo=infoRow[colIndex],cell=this.getCell(cellInfo.rowIndex,cellInfo.cellIndex);if(cell.rowSpan>1){if(cellInfo.rowIndex==rowIndex){var clone=cell.cloneNode(true);clone.rowSpan=cell.rowSpan-1;clone.innerHTML="";cell.rowSpan=1;var nextRowIndex=rowIndex+1,nextRow=this.table.rows[nextRowIndex],insertCellIndex,preMerged=this.getPreviewMergedCellsNum(nextRowIndex,colIndex)-count;if(preMerged<colIndex){insertCellIndex=colIndex-preMerged-1;domUtils.insertAfter(nextRow.cells[insertCellIndex],clone)}else{if(nextRow.cells.length){nextRow.insertBefore(clone,nextRow.cells[0])}}count+=1}}colIndex+=cell.colSpan||1}var deleteTds=[],cacheMap={};for(colIndex=0;colIndex<colsNum;colIndex++){var tmpRowIndex=infoRow[colIndex].rowIndex,tmpCellIndex=infoRow[colIndex].cellIndex,key=tmpRowIndex+"_"+tmpCellIndex;if(cacheMap[key]){continue}cacheMap[key]=1;cell=this.getCell(tmpRowIndex,tmpCellIndex);deleteTds.push(cell)}var mergeTds=[];utils.each(deleteTds,function(td){if(td.rowSpan==1){td.parentNode.removeChild(td)}else{mergeTds.push(td)}});utils.each(mergeTds,function(td){td.rowSpan--});row.parentNode.removeChild(row);this.update()},insertCol:function(colIndex){var rowsNum=this.rowsNum,rowIndex=0,tableRow,cell,backWidth=parseInt((this.table.offsetWidth-(this.colsNum+1)*20-(this.colsNum+1))/(this.colsNum+1),10);function replaceTdToTh(rowIndex,cell,tableRow){if(rowIndex==0){var th=cell.nextSibling||cell.previousSibling;if(th.tagName=="TH"){th=cell.ownerDocument.createElement("th");th.appendChild(cell.firstChild);tableRow.insertBefore(th,cell);domUtils.remove(cell)}}}var preCell;if(colIndex==0||colIndex==this.colsNum){for(;rowIndex<rowsNum;rowIndex++){tableRow=this.table.rows[rowIndex];preCell=tableRow.cells[colIndex==0?colIndex:tableRow.cells.length];cell=tableRow.insertCell(colIndex==0?colIndex:tableRow.cells.length);this.setCellContent(cell);cell.setAttribute("valign",me.options.tdvalign);preCell&&cell.setAttribute("width",preCell.getAttribute("width"));replaceTdToTh(rowIndex,cell,tableRow)}}else{for(;rowIndex<rowsNum;rowIndex++){var cellInfo=this.indexTable[rowIndex][colIndex];if(cellInfo.colIndex<colIndex){cell=this.getCell(cellInfo.rowIndex,cellInfo.cellIndex);cell.colSpan=cellInfo.colSpan+1}else{tableRow=this.table.rows[rowIndex];preCell=tableRow.cells[cellInfo.cellIndex];cell=tableRow.insertCell(cellInfo.cellIndex);this.setCellContent(cell);cell.setAttribute("valign",me.options.tdvalign);preCell&&cell.setAttribute("width",preCell.getAttribute("width"))}replaceTdToTh(rowIndex,cell,tableRow)}}this.update();this.updateWidth(backWidth)},updateWidth:function(width){var tds=domUtils.getElementsByTagName(this.table,"td");utils.each(tds,function(td){td.setAttribute("width",width)})},deleteCol:function(colIndex){var indexTable=this.indexTable,tableRows=this.table.rows,backTableWidth=this.table.getAttribute("width"),backTdWidth=0,rowsNum=this.rowsNum,cacheMap={};for(var rowIndex=0;rowIndex<rowsNum;){var infoRow=indexTable[rowIndex],cellInfo=infoRow[colIndex],key=cellInfo.rowIndex+"_"+cellInfo.colIndex;if(cacheMap[key]){continue}cacheMap[key]=1;var cell=this.getCell(cellInfo.rowIndex,cellInfo.cellIndex);if(!backTdWidth){backTdWidth=cell&&parseInt(cell.offsetWidth/cell.colSpan,10).toFixed(0)}if(cell.colSpan>1){cell.colSpan--}else{tableRows[rowIndex].deleteCell(cellInfo.cellIndex)}rowIndex+=cellInfo.rowSpan||1}this.table.setAttribute("width",backTableWidth.replace("px","")-backTdWidth);this.update()},splitToCells:function(cell){var me=this,cells=this.splitToRows(cell);utils.each(cells,function(cell){me.splitToCols(cell)})},splitToRows:function(cell){var cellInfo=this.getCellInfo(cell),rowIndex=cellInfo.rowIndex,colIndex=cellInfo.colIndex,results=[];cell.rowSpan=1;results.push(cell);for(var i=rowIndex,endRow=rowIndex+cellInfo.rowSpan;i<endRow;i++){if(i==rowIndex){continue}var tableRow=this.table.rows[i],tmpCell=tableRow.insertCell(colIndex-this.getPreviewMergedCellsNum(i,colIndex));tmpCell.colSpan=cellInfo.colSpan;this.setCellContent(tmpCell);tmpCell.setAttribute("valign",me.options.tdvalign);if(cell.style.cssText){tmpCell.style.cssText=cell.style.cssText}results.push(tmpCell)}this.update();return results},getPreviewMergedCellsNum:function(rowIndex,colIndex){var indexRow=this.indexTable[rowIndex],num=0;for(var i=0;i<colIndex;){var colSpan=indexRow[i].colSpan,tmpRowIndex=indexRow[i].rowIndex;num+=(colSpan-(tmpRowIndex==rowIndex?1:0));i+=colSpan}return num},splitToCols:function(cell){var cellInfo=this.getCellInfo(cell),rowIndex=cellInfo.rowIndex,colIndex=cellInfo.colIndex,results=[];cell.colSpan=1;results.push(cell);for(var j=colIndex,endCol=colIndex+cellInfo.colSpan;j<endCol;j++){if(j==colIndex){continue}var tableRow=this.table.rows[rowIndex],tmpCell=tableRow.insertCell(this.indexTable[rowIndex][j].cellIndex+1);tmpCell.rowSpan=cellInfo.rowSpan;this.setCellContent(tmpCell);tmpCell.setAttribute("valign",me.options.tdvalign);if(cell.style.cssText){tmpCell.style.cssText=cell.style.cssText}if(cell.tagName=="TH"){var th=cell.ownerDocument.createElement("th");th.appendChild(tmpCell.firstChild);th.setAttribute("valign",me.options.tdvalign);th.rowSpan=tmpCell.rowSpan;tableRow.insertBefore(th,tmpCell);domUtils.remove(tmpCell)}results.push(tmpCell)}this.update();return results},isLastCell:function(cell){var cellInfo=this.getCellInfo(cell);return((cellInfo.rowIndex+cellInfo.rowSpan)==this.rowsNum)&&((cellInfo.colIndex+cellInfo.colSpan)==this.colsNum)},getLastCell:function(cells){cells=cells||this.table.getElementsByTagName("td")},selectRow:function(rowIndex){var indexRow=this.indexTable[rowIndex],start=this.getCell(indexRow[0].rowIndex,indexRow[0].cellIndex),end=this.getCell(indexRow[this.colsNum-1].rowIndex,indexRow[this.colsNum-1].cellIndex),range=this.getCellsRange(start,end);this.setSelected(range)},selectTable:function(){var tds=this.table.getElementsByTagName("td"),range=this.getCellsRange(tds[0],tds[tds.length-1]);this.setSelected(range)}};function getSelectedArr(editor){var ut=getTableItemsByRange(editor).cell||getUETableBySelected(editor);return ut?(ut.nodeType?[ut]:ut.selectedTds):[]}function getTableItemsByRange(editor){var start=editor.selection.getStart(),cell=start&&domUtils.findParentByTagName(start,["td","th"],true),tr=cell&&cell.parentNode,table=tr&&tr.parentNode.parentNode;return{cell:cell,tr:tr,table:table}}function getTargetTd(editor,evt){var target=domUtils.findParentByTagName(evt.target||evt.srcElement,["td","th"],true);return target&&!(editor.fireEvent("excludeTable",target)===true)?target:null}function cloneCell(cell,ingoreMerge){if(!cell||utils.isString(cell)){return this.table.ownerDocument.createElement(cell||"td")}var flag=domUtils.hasClass(cell,"selectTdClass");flag&&domUtils.removeClasses(cell,"selectTdClass");var tmpCell=cell.cloneNode(true);if(ingoreMerge){tmpCell.rowSpan=tmpCell.colSpan=1}tmpCell.style.borderLeftStyle="";tmpCell.style.borderTopStyle="";tmpCell.style.borderLeftColor=cell.style.borderRightColor;tmpCell.style.borderLeftWidth=cell.style.borderRightWidth;tmpCell.style.borderTopColor=cell.style.borderBottomColor;tmpCell.style.borderTopWidth=cell.style.borderBottomWidth;flag&&domUtils.addClass(cell,"selectTdClass");return tmpCell}};UE.plugins.enterkey=function(){var hTag,me=this,tag=me.options.enterTag;me.addListener("keyup",function(type,evt){var keyCode=evt.keyCode||evt.which;if(keyCode==13){var range=me.selection.getRange(),start=range.startContainer,doSave;if(!browser.ie){if(/h\d/i.test(hTag)){if(browser.gecko){var h=domUtils.findParentByTagName(start,["h1","h2","h3","h4","h5","h6","blockquote"],true);if(!h){me.document.execCommand("formatBlock",false,"<p>");doSave=1}}else{if(start.nodeType==1){var tmp=me.document.createTextNode(""),div;range.insertNode(tmp);div=domUtils.findParentByTagName(tmp,"div",true);if(div){var p=me.document.createElement("p");while(div.firstChild){p.appendChild(div.firstChild)}div.parentNode.insertBefore(p,div);domUtils.remove(div);range.setStartBefore(tmp).setCursor();doSave=1}domUtils.remove(tmp)}}if(me.undoManger&&doSave){me.undoManger.save()}}browser.opera&&range.select()}setTimeout(function(){me.selection.getRange().scrollToView(me.autoHeightEnabled,me.autoHeightEnabled?domUtils.getXY(me.iframe).y:0)},50)}});me.addListener("keydown",function(type,evt){var keyCode=evt.keyCode||evt.which;if(keyCode==13){if(me.undoManger){me.undoManger.save()}hTag="";var range=me.selection.getRange();if(!range.collapsed){var start=range.startContainer,end=range.endContainer,startTd=domUtils.findParentByTagName(start,"td",true),endTd=domUtils.findParentByTagName(end,"td",true);if(startTd&&endTd&&startTd!==endTd||!startTd&&endTd||startTd&&!endTd){evt.preventDefault?evt.preventDefault():(evt.returnValue=false);return}}me.currentSelectedArr&&domUtils.clearSelectedArr(me.currentSelectedArr);if(tag=="p"){if(!browser.ie){start=domUtils.findParentByTagName(range.startContainer,["ol","ul","p","h1","h2","h3","h4","h5","h6","blockquote"],true);if(!start&&!browser.opera){me.document.execCommand("formatBlock",false,"<p>");if(browser.gecko){range=me.selection.getRange();start=domUtils.findParentByTagName(range.startContainer,"p",true);start&&domUtils.removeDirtyAttr(start)}}else{hTag=start.tagName;start.tagName.toLowerCase()=="p"&&browser.gecko&&domUtils.removeDirtyAttr(start)}}}else{evt.preventDefault?evt.preventDefault():(evt.returnValue=false);if(!range.collapsed){range.deleteContents();start=range.startContainer;if(start.nodeType==1&&(start=start.childNodes[range.startOffset])){while(start.nodeType==1){if(dtd.$empty[start.tagName]){range.setStartBefore(start).setCursor();if(me.undoManger){me.undoManger.save()}return false}if(!start.firstChild){var br=range.document.createElement("br");start.appendChild(br);range.setStart(start,0).setCursor();if(me.undoManger){me.undoManger.save()}return false}start=start.firstChild}if(start===range.startContainer.childNodes[range.startOffset]){br=range.document.createElement("br");range.insertNode(br).setCursor()}else{range.setStart(start,0).setCursor()}}else{br=range.document.createElement("br");range.insertNode(br).setStartAfter(br).setCursor()}}else{br=range.document.createElement("br");range.insertNode(br);var parent=br.parentNode;if(parent.lastChild===br){br.parentNode.insertBefore(br.cloneNode(true),br);range.setStartBefore(br)}else{range.setStartAfter(br)}range.setCursor()}}}})};UE.plugins.basestyle=function(){var basestyles={bold:["strong","b"],italic:["em","i"],subscript:["sub"],superscript:["sup"]},getObj=function(editor,tagNames){var path=editor.selection.getStartElementPath();return utils.findNode(path,tagNames)},me=this;for(var style in basestyles){(function(cmd,tagNames){me.commands[cmd]={execCommand:function(cmdName){var range=new dom.Range(me.document),obj="";if(me.currentSelectedArr&&me.currentSelectedArr.length>0){for(var i=0,ci;ci=me.currentSelectedArr[i++];){if(ci.style.display!="none"){range.selectNodeContents(ci).select();!obj&&(obj=getObj(this,tagNames));if(cmdName=="superscript"||cmdName=="subscript"){if(!obj||obj.tagName.toLowerCase()!=cmdName){range.removeInlineStyle(["sub","sup"])}}obj?range.removeInlineStyle(tagNames):range.applyInlineStyle(tagNames[0])}}range.selectNodeContents(me.currentSelectedArr[0]).select()}else{range=me.selection.getRange();obj=getObj(this,tagNames);if(range.collapsed){if(obj){var tmpText=me.document.createTextNode("");range.insertNode(tmpText).removeInlineStyle(tagNames);range.setStartBefore(tmpText);domUtils.remove(tmpText)}else{var tmpNode=range.document.createElement(tagNames[0]);if(cmdName=="superscript"||cmdName=="subscript"){tmpText=me.document.createTextNode("");range.insertNode(tmpText).removeInlineStyle(["sub","sup"]).setStartBefore(tmpText).collapse(true)}range.insertNode(tmpNode).setStart(tmpNode,0)}range.collapse(true)}else{if(cmdName=="superscript"||cmdName=="subscript"){if(!obj||obj.tagName.toLowerCase()!=cmdName){range.removeInlineStyle(["sub","sup"])}}obj?range.removeInlineStyle(tagNames):range.applyInlineStyle(tagNames[0])}range.select()}return true},queryCommandState:function(){if(this.highlight){return -1}return getObj(this,tagNames)?1:0}}})(style,basestyles[style])}};var baidu=baidu||{};baidu.editor=baidu.editor||{};baidu.editor.ui={};(function(){var browser=baidu.editor.browser,domUtils=baidu.editor.dom.domUtils;var magic="$EDITORUI";var root=window[magic]={};var uidMagic="ID"+magic;var uidCount=0;var uiUtils=baidu.editor.ui.uiUtils={uid:function(obj){return(obj?obj[uidMagic]||(obj[uidMagic]=++uidCount):++uidCount)},hook:function(fn,callback){var dg;if(fn&&fn._callbacks){dg=fn}else{dg=function(){var q;if(fn){q=fn.apply(this,arguments)}var callbacks=dg._callbacks;var k=callbacks.length;while(k--){var r=callbacks[k].apply(this,arguments);if(q===undefined){q=r}}return q};dg._callbacks=[]}dg._callbacks.push(callback);return dg},createElementByHtml:function(html){var el=document.createElement("div");el.innerHTML=html;el=el.firstChild;el.parentNode.removeChild(el);return el},getViewportElement:function(){return(browser.ie&&browser.quirks)?document.body:document.documentElement},getClientRect:function(element){var bcr;try{bcr=element.getBoundingClientRect()}catch(e){bcr={left:0,top:0,height:0,width:0}}var rect={left:Math.round(bcr.left),top:Math.round(bcr.top),height:Math.round(bcr.bottom-bcr.top),width:Math.round(bcr.right-bcr.left)};var doc;while((doc=element.ownerDocument)!==document&&(element=domUtils.getWindow(doc).frameElement)){bcr=element.getBoundingClientRect();rect.left+=bcr.left;rect.top+=bcr.top}rect.bottom=rect.top+rect.height;rect.right=rect.left+rect.width;return rect},getViewportRect:function(){var viewportEl=uiUtils.getViewportElement();var width=(window.innerWidth||viewportEl.clientWidth)|0;var height=(window.innerHeight||viewportEl.clientHeight)|0;return{left:0,top:0,height:height,width:width,bottom:height,right:width}},setViewportOffset:function(element,offset){var rect;var fixedLayer=uiUtils.getFixedLayer();if(element.parentNode===fixedLayer){element.style.left=offset.left+"px";element.style.top=offset.top+"px"}else{domUtils.setViewportOffset(element,offset)}},getEventOffset:function(evt){var el=evt.target||evt.srcElement;var rect=uiUtils.getClientRect(el);var offset=uiUtils.getViewportOffsetByEvent(evt);return{left:offset.left-rect.left,top:offset.top-rect.top}},getViewportOffsetByEvent:function(evt){var el=evt.target||evt.srcElement;var frameEl=domUtils.getWindow(el).frameElement;var offset={left:evt.clientX,top:evt.clientY};if(frameEl&&el.ownerDocument!==document){var rect=uiUtils.getClientRect(frameEl);offset.left+=rect.left;offset.top+=rect.top}return offset},setGlobal:function(id,obj){root[id]=obj;return magic+'["'+id+'"]'},unsetGlobal:function(id){delete root[id]},copyAttributes:function(tgt,src){var attributes=src.attributes;var k=attributes.length;while(k--){var attrNode=attributes[k];if(attrNode.nodeName!="style"&&attrNode.nodeName!="class"&&(!browser.ie||attrNode.specified)){tgt.setAttribute(attrNode.nodeName,attrNode.nodeValue)}}if(src.className){tgt.className+=" "+src.className}if(src.style.cssText){tgt.style.cssText+=";"+src.style.cssText}},removeStyle:function(el,styleName){if(el.style.removeProperty){el.style.removeProperty(styleName)}else{if(el.style.removeAttribute){el.style.removeAttribute(styleName)}else{throw""}}},contains:function(elA,elB){return elA&&elB&&(elA===elB?false:(elA.contains?elA.contains(elB):elA.compareDocumentPosition(elB)&16))},startDrag:function(evt,callbacks,doc){var doc=doc||document;var startX=evt.clientX;var startY=evt.clientY;function handleMouseMove(evt){var x=evt.clientX-startX;var y=evt.clientY-startY;callbacks.ondragmove(x,y);if(evt.stopPropagation){evt.stopPropagation()}else{evt.cancelBubble=true}}if(doc.addEventListener){function handleMouseUp(evt){doc.removeEventListener("mousemove",handleMouseMove,true);doc.removeEventListener("mouseup",handleMouseMove,true);window.removeEventListener("mouseup",handleMouseUp,true);callbacks.ondragstop()}doc.addEventListener("mousemove",handleMouseMove,true);doc.addEventListener("mouseup",handleMouseUp,true);window.addEventListener("mouseup",handleMouseUp,true);evt.preventDefault()}else{var elm=evt.srcElement;elm.setCapture();function releaseCaptrue(){elm.releaseCapture();elm.detachEvent("onmousemove",handleMouseMove);elm.detachEvent("onmouseup",releaseCaptrue);elm.detachEvent("onlosecaptrue",releaseCaptrue);callbacks.ondragstop()}elm.attachEvent("onmousemove",handleMouseMove);elm.attachEvent("onmouseup",releaseCaptrue);elm.attachEvent("onlosecaptrue",releaseCaptrue);evt.returnValue=false}callbacks.ondragstart()},getFixedLayer:function(){var layer=document.getElementById("edui_fixedlayer");if(layer==null){layer=document.createElement("div");layer.id="edui_fixedlayer";document.body.appendChild(layer);if(browser.ie&&browser.version<=8){layer.style.position="absolute";bindFixedLayer();setTimeout(updateFixedOffset)}else{layer.style.position="fixed"}layer.style.left="0";layer.style.top="0";layer.style.width="0";layer.style.height="0"}return layer},makeUnselectable:function(element){if(browser.opera||(browser.ie&&browser.version<9)){element.unselectable="on";if(element.hasChildNodes()){for(var i=0;i<element.childNodes.length;i++){if(element.childNodes[i].nodeType==1){uiUtils.makeUnselectable(element.childNodes[i])}}}}else{if(element.style.MozUserSelect!==undefined){element.style.MozUserSelect="none"}else{if(element.style.WebkitUserSelect!==undefined){element.style.WebkitUserSelect="none"}else{if(element.style.KhtmlUserSelect!==undefined){element.style.KhtmlUserSelect="none"}}}}}};function updateFixedOffset(){var layer=document.getElementById("edui_fixedlayer");uiUtils.setViewportOffset(layer,{left:0,top:0})}function bindFixedLayer(adjOffset){domUtils.on(window,"scroll",updateFixedOffset);domUtils.on(window,"resize",baidu.editor.utils.defer(updateFixedOffset,0,true))}})();(function(){var _win;var PasteImgUpload=baidu.editor.PasteImgUpload=function(ev,me){if(/chrome\/(\d+\.\d)/ig.test(navigator.appVersion)&&me.options.isPasteImage){try{_win=me.ui.getDom("iframeholder").firstChild.contentWindow;var file=ev.clipboardData.items[0].getAsFile();if(file){var reader=new FileReader();reader.onload=function(evt){var result=evt.target.result;var arr=result.split(",");var data=encodeURIComponent(arr[1]);var contentType=arr[0].split(";")[0].split(":")[1];var tempImageId=Math.random();var image="<img id='"+tempImageId+"' word_img='' src='"+result+"'  />";me.execCommand("inserthtml",image,true);var message=confirm("您确定要上传粘贴的图片吗？");if(message){chromePasteImageLoad();$.ajax({type:"POST",url:me.options.upSitePasteIamgeUrl+"?app="+me.options.upImgApp,data:"contentType="+contentType+"&data="+data,success:function(info){var imageInfo=eval("("+info+")");if(imageInfo.msg){alert(imageInfo.msg);return}var images=$(_win.document.body).find("img");for(var i=0;i<images.length;i++){if($(images[i]).attr("src")==result){$(images[i]).attr("alt","").attr("src",imageInfo.path).attr("width",imageInfo.width).attr("height",imageInfo.height)}}$("#progressBody_Body").remove();$("#progressWrap_Wrap").remove()}});$(".progressCancel").live("click",function(){var images=$(_win.document.body).find("img");for(var i=0;i<images.length;i++){if($(images[i]).attr("id")==tempImageId){$(images[i]).remove()}}$("#progressBody_Body").remove();$("#progressWrap_Wrap").remove()})}else{var images=$(_win.document.body).find("img");for(var i=0;i<images.length;i++){if($(images[i]).attr("id")==tempImageId){$(images[i]).remove()}}}};reader.readAsDataURL(file);return true}return false}catch(exp){return false}}return false};function chromePasteImageLoad(){var progressIng=['<div id="progressBody_Body" class="bodyDisable"></div>','<div id="progressWrap_Wrap" class="bodyProgressWrap">','<div class="progressCenter"></div>','<div class="progressIngBody">','<div class="progressIngTitle">图片上传中...</div>','<div class="progressIngMission">','<div class="mission"><div id="progress" class="progress"></div></div>','<div id="progressNum" class="progressNum"></div>',"</div>",'<div class="progressInfo"><span class="progressFileSize"></span><a class="progressCancel" href="javascript:;">取消</a></div>',"</div>","</div>"];$(_win.parent.document.body).append(progressIng.join(""));$("#progressBody_Body").css("height",(_win.parent.document.body.scrollHeight)+"px");$("#progressWrap_Wrap").css("top",(editor.container.offsetTop-editor.container.offsetHeight/2)+"px")}})();(function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,EventBase=baidu.editor.EventBase,UIBase=baidu.editor.ui.UIBase=function(){};UIBase.prototype={className:"",uiName:"",initOptions:function(options){var me=this;for(var k in options){me[k]=options[k]}this.id=this.id||"edui"+uiUtils.uid()},initUIBase:function(){this._globalKey=utils.unhtml(uiUtils.setGlobal(this.id,this))},render:function(holder){var html=this.renderHtml();var el=uiUtils.createElementByHtml(html);var seatEl=this.getDom();if(seatEl!=null){seatEl.parentNode.replaceChild(el,seatEl);uiUtils.copyAttributes(el,seatEl)}else{if(typeof holder=="string"){holder=document.getElementById(holder)}holder=holder||uiUtils.getFixedLayer();holder.appendChild(el)}this.postRender()},getDom:function(name){if(!name){return document.getElementById(this.id)}else{return document.getElementById(this.id+"_"+name)}},postRender:function(){this.fireEvent("postrender")},getHtmlTpl:function(){return""},formatHtml:function(tpl){var prefix="edui-"+this.uiName;return(tpl.replace(/##/g,this.id).replace(/%%-/g,this.uiName?prefix+"-":"").replace(/%%/g,(this.uiName?prefix:"")+" "+this.className).replace(/\$\$/g,this._globalKey))},renderHtml:function(){return this.formatHtml(this.getHtmlTpl())},dispose:function(){var box=this.getDom();if(box){baidu.editor.dom.domUtils.remove(box)}uiUtils.unsetGlobal(this.id)}};utils.inherits(UIBase,EventBase)})();(function(){var utils=baidu.editor.utils,UIBase=baidu.editor.ui.UIBase,Separator=baidu.editor.ui.Separator=function(options){this.initOptions(options);this.initSeparator()};Separator.prototype={uiName:"separator",initSeparator:function(){this.initUIBase()},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"></div>'}};utils.inherits(Separator,UIBase)})();(function(){var utils=baidu.editor.utils,UIBase=baidu.editor.ui.UIBase,NewlineSeparator=baidu.editor.ui.NewlineSeparator=function(options){this.initOptions(options);this.initNewlineSeparator()};NewlineSeparator.prototype={uiName:"newlineseparator",initNewlineSeparator:function(){this.initUIBase()},getHtmlTpl:function(){return'<div id="##" class="edui-box %%" style="display:block !important;"></div>'}};utils.inherits(NewlineSeparator,UIBase)})();(function(){var utils=baidu.editor.utils,domUtils=baidu.editor.dom.domUtils,UIBase=baidu.editor.ui.UIBase,uiUtils=baidu.editor.ui.uiUtils;var Mask=baidu.editor.ui.Mask=function(options){this.initOptions(options);this.initUIBase()};Mask.prototype={getHtmlTpl:function(){return'<div id="##" class="edui-mask %%" onmousedown="return $$._onMouseDown(event, this);"></div>'},postRender:function(){var me=this;domUtils.on(window,"resize",function(){setTimeout(function(){if(!me.isHidden()){me._fill()}})})},show:function(zIndex){this._fill();this.getDom().style.display="";this.getDom().style.zIndex=zIndex},hide:function(){this.getDom().style.display="none";this.getDom().style.zIndex=""},isHidden:function(){return this.getDom().style.display=="none"},_onMouseDown:function(){return false},_fill:function(){var el=this.getDom();var vpRect=uiUtils.getViewportRect();el.style.width=vpRect.width+"px";el.style.height=vpRect.height+"px"}};utils.inherits(Mask,UIBase)})();(function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,domUtils=baidu.editor.dom.domUtils,UIBase=baidu.editor.ui.UIBase,Popup=baidu.editor.ui.Popup=function(options){this.initOptions(options);this.initPopup()};var allPopups=[];function closeAllPopup(el){var newAll=[];for(var i=0;i<allPopups.length;i++){var pop=allPopups[i];if(!pop.isHidden()){if(pop.queryAutoHide(el)!==false){pop.hide()}}}}Popup.postHide=closeAllPopup;var ANCHOR_CLASSES=["edui-anchor-topleft","edui-anchor-topright","edui-anchor-bottomleft","edui-anchor-bottomright"];Popup.prototype={SHADOW_RADIUS:5,content:null,_hidden:false,autoRender:true,canSideLeft:true,canSideUp:true,initPopup:function(){this.initUIBase();allPopups.push(this)},getHtmlTpl:function(){return'<div id="##" class="edui-popup %%"> <div id="##_body" class="edui-popup-body"> <iframe style="position:absolute;z-index:-1;left:0;top:0;background-color: white;" frameborder="0" width="100%" height="100%" src="javascript:"></iframe> <div class="edui-shadow"></div> <div id="##_content" class="edui-popup-content">'+this.getContentHtmlTpl()+"  </div> </div></div>"},getContentHtmlTpl:function(){if(this.content){if(typeof this.content=="string"){return this.content}return this.content.renderHtml()}else{return""}},_UIBase_postRender:UIBase.prototype.postRender,postRender:function(){if(this.content instanceof UIBase){this.content.postRender()}this.fireEvent("postRenderAfter");this.hide(true);this._UIBase_postRender()},_doAutoRender:function(){if(!this.getDom()&&this.autoRender){this.render()}},mesureSize:function(){var box=this.getDom("content");return uiUtils.getClientRect(box)},fitSize:function(){var popBodyEl=this.getDom("body");popBodyEl.style.width="";popBodyEl.style.height="";var size=this.mesureSize();popBodyEl.style.width=size.width+"px";popBodyEl.style.height=size.height+"px";return size},showAnchor:function(element,hoz){this.showAnchorRect(uiUtils.getClientRect(element),hoz)},showAnchorRect:function(rect,hoz,adj){this._doAutoRender();var vpRect=uiUtils.getViewportRect();this._show();var popSize=this.fitSize();var sideLeft,sideUp,left,top;if(hoz){sideLeft=this.canSideLeft&&(rect.right+popSize.width>vpRect.right&&rect.left>popSize.width);sideUp=this.canSideUp&&(rect.top+popSize.height>vpRect.bottom&&rect.bottom>popSize.height);left=(sideLeft?rect.left-popSize.width:rect.right);top=(sideUp?rect.bottom-popSize.height:rect.top)}else{sideLeft=this.canSideLeft&&(rect.right+popSize.width>vpRect.right&&rect.left>popSize.width);sideUp=this.canSideUp&&(rect.top+popSize.height>vpRect.bottom&&rect.bottom>popSize.height);left=(sideLeft?rect.right-popSize.width:rect.left);top=(sideUp?rect.top-popSize.height:rect.bottom)}var popEl=this.getDom();uiUtils.setViewportOffset(popEl,{left:left,top:top});domUtils.removeClasses(popEl,ANCHOR_CLASSES);popEl.className+=" "+ANCHOR_CLASSES[(sideUp?1:0)*2+(sideLeft?1:0)];if(this.editor){popEl.style.zIndex=this.editor.container.style.zIndex*1+10;baidu.editor.ui.uiUtils.getFixedLayer().style.zIndex=popEl.style.zIndex-1}},showImageTool:function(element,hoz){this.showImageToolRect(element,uiUtils.getClientRect(element),hoz)},showImageToolRect:function(element,rect,hoz){this._doAutoRender();var vpRect=uiUtils.getViewportRect();this._show();var popSize=this.fitSize();var scrollLeft=this.editor.iframe.contentWindow.document.body.scrollLeft;var scrollTop=this.editor.iframe.contentWindow.document.body.scrollTop;var popEl=this.getDom();var width=popEl.clientWidth;var height=popEl.clientHeight;var left=rect.left;var top=rect.top+rect.height-height;var iframeRect=uiUtils.getClientRect(this.editor.iframe);var iframeLeft=iframeRect.left;var iframeTop=iframeRect.top;var iframeHeight=iframeRect.height;var iframeWidth=iframeRect.width;var imageOffsetTop=element.offsetTop;var scrollHeight=20;var scrollWidth=20;if(top<iframeTop){top=iframeTop}else{if(top+height>iframeTop+iframeHeight-scrollHeight){top=iframeTop+iframeHeight-scrollHeight-height+12}}if(left<iframeLeft){left=iframeLeft}else{if(left+width>iframeLeft+iframeWidth-scrollWidth){left=iframeLeft+iframeWidth-scrollWidth-width}}uiUtils.setViewportOffset(popEl,{left:left,top:top});domUtils.removeClasses(popEl,ANCHOR_CLASSES);if(this.editor){popEl.style.zIndex=this.editor.container.style.zIndex*1+10;baidu.editor.ui.uiUtils.getFixedLayer().style.zIndex=popEl.style.zIndex-1}},showAt:function(offset){var left=offset.left;var top=offset.top;var rect={left:left,top:top,right:left,bottom:top,height:0,width:0};this.showAnchorRect(rect,false,true)},_show:function(){if(this._hidden){var box=this.getDom();box.style.display="";this._hidden=false;this.fireEvent("show")}},isHidden:function(){return this._hidden},show:function(){this._doAutoRender();this._show()},hide:function(notNofity){if(!this._hidden&&this.getDom()){this.getDom().style.display="none";this._hidden=true;if(!notNofity){this.fireEvent("hide");var className=this.getDom().className;if(/edui-for-inserttable/g.test(className)){this.getDom().outerHTML=""}}}},queryAutoHide:function(el){return !el||!uiUtils.contains(this.getDom(),el)}};utils.inherits(Popup,UIBase);domUtils.on(document,"mousedown",function(evt){var el=evt.target||evt.srcElement;closeAllPopup(el)});domUtils.on(window,"scroll",function(){closeAllPopup()})})();(function(){var utils=baidu.editor.utils,UIBase=baidu.editor.ui.UIBase,ColorPicker=baidu.editor.ui.ColorPicker=function(options){this.initOptions(options);this.noColorText=this.noColorText||this.editor.getLang("clearColor");this.initUIBase()};ColorPicker.prototype={getHtmlTpl:function(){return genColorPicker(this.noColorText,this.editor)},_onTableClick:function(evt){var tgt=evt.target||evt.srcElement;var color=tgt.getAttribute("data-color");if(color){this.fireEvent("pickcolor",color)}},_onTableOver:function(evt){var tgt=evt.target||evt.srcElement;var color=tgt.getAttribute("data-color");if(color){this.getDom("preview").style.backgroundColor=color;$(".edui-colorpicker-preview_textModifyColor").val(color)}},_onTableOut:function(){this.getDom("preview").style.backgroundColor=""},_onPickNoColor:function(){this.fireEvent("picknocolor");$(".edui-colorpicker-preview_textModifyColor").val("输入颜色值")},_onOpenUpColorText:function(event){var textModifyColor=$(".edui-colorpicker-preview_textModifyColor").val();if(/^#[0-9a-fA-F]{6}$/.test(textModifyColor)){this.fireEvent("pickcolor",textModifyColor)}else{alert("输入的十六进制颜色值无效！")}},_cleanText:function(){$(".edui-colorpicker-preview_textModifyColor").val("");$(".edui-colorpicker-preview_textModifyColor").css("color","black")}};utils.inherits(ColorPicker,UIBase);var COLORS=("ffffff,FFCCCC,FFCC99,FFFF99,FFFFCC,99FF99,99FFFF,CCFFFF,CCCCFF,FFCCFF,CCCCCC,FF6666,FF9966,FFFF66,FFFF33,66FF99,33FFFF,66FFFF,9999FF,FF99FF,C0C0C0,FF0000,FF9900,FFCC66,FFFF00,33FF33,66CCCC,33CCFF,6666CC,CC66CC,999999,CC0000,FF6600,FFCC33,FFCC00,33CC00,00CCCC,3366FF,6633FF,CC33CC,666666,990000,CC6600,CC9933,999900,009900,339999,3333FF,6600CC,993399,333333,660000,993300,996633,666600,006600,336666,000099,333399,663366,000000,330000,663300,663333,333300,003300,003333,000066,330099,330033,").split(",");function genColorPicker(noColorText,editor){var html='<div id="##" class="edui-colorpicker %%"><div class="edui-colorpicker-topbar edui-clearfix"><div unselectable="on" id="##_preview" class="edui-colorpicker-preview" style="width:50px;margin-right: 5px;"></div><input type="text" id="textModifyColor" class="edui-colorpicker-preview_textModifyColor" style="width:80px;height: 18px;border: 1px inset #C5BCBC;color:#B2B8B9;" onfocus="$$._cleanText(event, this);" value="输入颜色值" /><div unselectable="on" title="确定" id="openUpColorText" class="edui-colorpicker-openUpColorText" style="margin-left: 5px;" onclick="$$._onOpenUpColorText(event, this);"></div><div unselectable="on" title="清除颜色" class="edui-colorpicker-nocolor" onclick="$$._onPickNoColor(event, this);"></div></div><table  class="edui-box" style="border-collapse: collapse;" onmouseover="$$._onTableOver(event, this);" onmouseout="$$._onTableOut(event, this);" onclick="return $$._onTableClick(event, this);" cellspacing="0" cellpadding="0"><tr class="edui-colorpicker-tablefirstrow" >';for(var i=0;i<COLORS.length;i++){if(i&&i%10===0){html+="</tr>"+(i==60?"":"")+"<tr"+(i==60?' class="edui-colorpicker-tablefirstrow"':"")+">"}html+=i<70?'<td style="padding: 0 2px;"><a hidefocus title="'+COLORS[i]+'" onclick="return false;" href="javascript:" unselectable="on" class="edui-box edui-colorpicker-colorcell" data-color="#'+COLORS[i]+'" style="background-color:#'+COLORS[i]+";border:solid #ccc;"+(i<10||i>=60?"border-width:1px;":i>=10&&i<20?"border-width:1px 1px 0 1px;":"border-width:0 1px 0 1px;")+'"></a></td>':""}html+="</tr></table></div>";return html}})();(function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,UIBase=baidu.editor.ui.UIBase;var TablePicker=baidu.editor.ui.TablePicker=function(options){this.initOptions(options);this.initTablePicker()};TablePicker.prototype={defaultNumRows:10,defaultNumCols:10,maxNumRows:20,maxNumCols:20,numRows:10,numCols:10,lengthOfCellSide:22,initTablePicker:function(){this.initUIBase()},getHtmlTpl:function(){return'<div id="##" class="edui-tablepicker %%"><div class="edui-tablepicker-body"><div class="edui-pickarea">'+this.renderTableMenu()+"</div></div></div>"},renderTableMenu:function(){var me=this.editor,uiUtils=UE.ui.uiUtils,lang=me.getLang("contextMenu"),items="",subMenu=[{label:lang.edittable,cmdName:"edittable",exec:function(){me.ui._dialogs.inserttableDialog.alterTableOpen()}},{label:lang.edittd,cmdName:"edittd",exec:function(){if(UE.ui.edittd){new UE.ui.edittd(this)}me.ui._dialogs.edittdDialog.open()}},"-",{label:lang.deletetable,cmdName:"deletetable"},{label:lang.insertparagraphbeforetable,cmdName:"insertparagraphbeforetable"},"-",{label:lang.deleterow,cmdName:"deleterow"},{label:lang.deletecol,cmdName:"deletecol"},"-",{label:lang.insertrow,cmdName:"insertrow"},{label:lang.insertcol,cmdName:"insertcol"},"-",{label:lang.mergeright,cmdName:"mergeright"},{label:lang.mergedown,cmdName:"mergedown"},"-",{label:lang.splittorows,cmdName:"splittorows"},{label:lang.splittocols,cmdName:"splittocols"},{label:lang.mergecells,cmdName:"mergecells"},{label:lang.splittocells,cmdName:"splittocells"}];var last;for(var i=0,si,subItems=[];si=subMenu[i];i++){(function(subItem){if(subItem=="-"){if((last=subItems[subItems.length-1])&&last!=="-"){subItems.push("-")}}if((me.commands[subItem.cmdName]||UE.commands[subItem.cmdName]||subItem.query)&&(subItem.query?subItem.query():me.queryCommandState(subItem.cmdName))>-1){subItems.push({label:subItem.label,className:"edui-for-"+subItem.cmdName,onclick:subItem.exec?function(){subItem.exec.call(me)}:function(){me.execCommand(subItem.cmdName,subItem.value)}})}})(si)}if(subItems.length==0){subItems.push({label:"创建表格",className:"edittable",onclick:function(){me.ui._dialogs.inserttableDialog.alterTableOpen()}})}menuButton=new UE.ui.Menu({items:subItems,editor:me});return menuButton.getContentHtmlTpl()},_UIBase_render:UIBase.prototype.render,render:function(holder){this._UIBase_render(holder);this.getDom("label").innerHTML="0"+this.editor.getLang("t_row")+" x 0"+this.editor.getLang("t_col")},_track:function(numCols,numRows){var style=this.getDom("overlay").style;var sideLen=this.lengthOfCellSide;style.width=numCols*sideLen+"px";style.height=numRows*sideLen+"px";var label=this.getDom("label");label.innerHTML=numCols+this.editor.getLang("t_col")+" x "+numRows+this.editor.getLang("t_row");this.numCols=numCols;this.numRows=numRows},_onMouseOver:function(evt,el){var rel=evt.relatedTarget||evt.fromElement;if(!uiUtils.contains(el,rel)&&el!==rel){this.getDom("label").innerHTML="0"+this.editor.getLang("t_col")+" x 0"+this.editor.getLang("t_row");this.getDom("overlay").style.visibility=""}},_onMouseOut:function(evt,el){var rel=evt.relatedTarget||evt.toElement;if(!uiUtils.contains(el,rel)&&el!==rel){this.getDom("label").innerHTML="0"+this.editor.getLang("t_col")+" x 0"+this.editor.getLang("t_row");this.getDom("overlay").style.visibility="hidden"}},_onMouseMove:function(evt,el){var style=this.getDom("overlay").style;var offset=uiUtils.getEventOffset(evt);var sideLen=this.lengthOfCellSide;var numCols=Math.ceil(offset.left/sideLen);var numRows=Math.ceil(offset.top/sideLen);this._track(numCols,numRows)},_onClick:function(){this.fireEvent("picktable",this.numCols,this.numRows)},_onMore:function(){this.fireEvent("more")}};utils.inherits(TablePicker,UIBase)})();(function(){var utils=baidu.editor.utils,UIBase=baidu.editor.ui.UIBase,QQFacePicker=baidu.editor.ui.QQFacePicker=function(options){this.initOptions(options);this.noColorText=this.noColorText||this.editor.getLang("clearColor");this.initUIBase()};QQFacePicker.prototype={getHtmlTpl:function(){return genQQFacePicker(this.editor)},_onTableClick:function(evt){var tgt=evt.target||evt.srcElement;if(tgt.tagName==="IMG"){this.editor.execCommand("insertHtml",tgt.title);this.fireEvent("closeface")}}};utils.inherits(QQFacePicker,UIBase);var faceList=["/惊讶","/撇嘴","/色","/发呆","/得意","/害羞","/闭嘴","/睡","/大哭","/尴尬","/发怒","/调皮","/呲牙","/微笑","/难过","/酷","/折磨","/吐","/偷笑","/可爱","/白眼","/傲慢","/饥饿","/困","/惊恐","/流汗","/憨笑","/大兵","/奋斗","/疑问","/嘘","/晕","/衰","/骷髅","/敲打","/再见","/发抖","/爱情","/跳跳","/猪头","/拥抱","/蛋糕","/闪电","/炸弹","/刀","/足球","/便便","/咖啡","/饭","/玫瑰","/凋谢","/爱心","/心碎","/礼物","/太阳","/月亮","/强","/弱","/握手","/飞吻","/怄火","/西瓜","/冷汗","/抠鼻","/鼓掌","/出糗","/坏笑","/左哼哼","/右哼哼","/哈欠","/鄙视","/委屈","/快哭了","/阴险","/亲亲","/吓","/可怜","/菜刀","/啤酒","/篮球","/乒乓","/示爱","/瓢虫","/抱拳","/勾引","/拳头","/差劲","/爱你","/NO","/OK","/转圈","/磕头","/回头","/跳绳","/挥手","/激动","/街舞","/献吻","/左太极","/右太极"];function genQQFacePicker(editor){var html='<div id="##" class="edui-qqface %%"><table  class="edui-box" style="border-collapse: collapse;" onclick="return $$._onTableClick(event, this);" cellspacing="0" cellpadding="0"><tr>';for(var i=1;i<=faceList.length;i++){html+='<td id="'+i+'"><img _hidetool="true" src="'+editor.options.UEDITOR_HOME_URL+"/image/comm/ueditor/images/qqface/"+i+'.gif" id="img'+i+'" title="'+faceList[i-1]+'"/></td>';if(i%15==0){html+="</tr><tr>"}}html+="</tr></table></div>";return html}})();(function(){var utils=baidu.editor.utils,UIBase=baidu.editor.ui.UIBase;var FlashSetPicker=baidu.editor.ui.FlashSetPicker=function(options){this.initOptions(options);this.initFlashSetPicker()};FlashSetPicker.prototype={initFlashSetPicker:function(){this.initUIBase()},getHtmlTpl:function(){return'<div style="width: 250px;font-size: 12px;text-align: left;" class="xheDialogDiv"><div style="border:1px solid #F4E190; background:#FFF6D0; text-align:center; padding:4px;">Flash动画/视频（格式为swf）</div><div style="padding:4px;">文件类型：<input style="border:0px solid black;" type="radio" id="faiscoLocalFile" name="faiscoFlashType" checked=checked /><span id="faiscoLocalFileSpan" style="cursor:default;">本地文件</span><input style="border:0px solid black;margin-left:5px;" type="radio" id="faiscoWebFile" name="faiscoFlashType"/><span id="faiscoWebFileSpan" style="cursor:default;">网络地址</span></div><div id="xheFlashSrcPanel" class="xheDivSrcPanel" style="padding: 3px;">选择文件：<input type="text" id="xheFlashSrc" disabled="true" value="" class="xheText" style="position: absolute;  width: 107px;  top: 0px;  left: 0px;  z-index: 1000003;"></div><div id="xheFlashLocalSrcPanel" style="display:none;padding: 3px;">文件地址：<input type="text" id="xheFlashLocalSrc" value="" style="width:160px;" /></div><div style="padding: 3px;">宽度高度：<input type="text" id="xheFlashWidth" style="width:40px;" value="400" /> x <input type="text" id="xheFlashHeight" style="width:40px;" value="400" /></div><div style="text-align:right;"><button style="cursor: pointer;">确定</button><button style="cursor: pointer;">取消</button></div></div>'}};utils.inherits(FlashSetPicker,UIBase)})();(function(){var utils=baidu.editor.utils,UIBase=baidu.editor.ui.UIBase;var UpLoadImgSetPicker=baidu.editor.ui.UpLoadImgSetPicker=function(options){this.initOptions(options);this.initUpLoadImgSetPicker()};UpLoadImgSetPicker.prototype={initUpLoadImgSetPicker:function(){this.initUIBase()},getHtmlTpl:function(){return this.editor.options.imageExtends?'<div><div name="imageExtendsClass" class="imageExtendsClass" onclick="'+this.editor.options.htmlChoiceImage+'">插入图片</div>'+(this.editor.options.flashHidden?"":'<div name="imageExtendsClass" class="imageExtendsClass" onclick="'+this.editor.options.htmlChoiceFlash+'">插入Flash</div>')+"</div>":'<div style="font-size: 12px;width: 250px;text-align: left;" class="xheDialogDiv"><div style="padding:4px;-ms-border-radius: 5px;border-radius: 5px;">文件类型：<input style="border:0px solid black;" type="radio" id="faiscoLocalFileImage" name="faiscoImageType" checked=checked /><span id="faiscoLocalFileImageSpan" style="cursor:default;">本地文件</span><input style="border:0px solid black;margin-left:5px;" type="radio" id="faiscoWebFileImage" name="faiscoImageType"/><span id="faiscoWebFileImageSpan" style="cursor:default;">网络地址</span></div><div id="xheImageDiv" class="xheDivSrcPanel" style="margin-top: 6px;margin-left: 5px;height: 62px;">图片文件：<input type="text" id="xheImgSrc" disabled="true" value="" class="xheText" style="position: absolute;width: 107px;top: 0px;left: 0px;z-index: 1000003;"></span></div><div id="xheImageWebDiv" style="display:none;height: 62px;padding: 3px;"><div style="padding: 3px;">图片链接：<input type="text" id="xheImgLink" style="width:150px;" /></div><div style="padding: 3px;">宽度高度：<input type="text" id="xheImgWidth" style="width:40px;" /> x <input type="text" id="xheImgHeight" style="width:40px;" /></div></div><div style="text-align:right;"><button  style="cursor: pointer;">确定</button><button  style="cursor: pointer;">取消</button></div></div>'},_UIBase_render:UIBase.prototype.render};utils.inherits(UpLoadImgSetPicker,UIBase)})();(function(){var utils=baidu.editor.utils,UIBase=baidu.editor.ui.UIBase;var QQSetPicker=baidu.editor.ui.QQSetPicker=function(options){this.initOptions(options);this.initQQSetPicker()};QQSetPicker.prototype={initQQSetPicker:function(){this.initUIBase()},getHtmlTpl:function(){var me=this.editor;return['<div class="xheDialogType">','<div class="header">','<div class="qqheader" id="faiscoTypeOfQQ" name="faiscoServicesType">QQ</div>','<div class="msnheader" id="faiscoTypeOfMSN" name="faiscoServicesType">MSN</div>','<div class="skypeheader" id="faiscoTypeOfSkype" name="faiscoServicesType">Skype</div>','<div class="aliwangwangheader" id="faiscoTypeOfAliWangWang" name="faiscoServicesType">阿里旺旺</div>','<div class="taobaowangwangheader" id="faiscoTypeOfTaoBaoWangWang" name="faiscoServicesType">淘宝旺旺</div>',"</div>","</div>",'<div id="xheDialogQQ">','<div style="">','<div style="clear:both;float:left; width:60px; line-height:23px; text-align:right;">QQ号码：</div><div style="float:left;"><input type="text" id="xheQQ" value="" class="xheText" /></div></div>','<div style="clear:both;"><div style="float:left; width:60px; text-align:right; margin-top:4px;">显示名称：</div><div style="float:left; margin-top:4px;"><input type="text" id="xheName" value="" class="xheText" /></div></div>','<div style="clear:both;"><div style="float:left; width:60px; line-height:23px; text-align:right; margin-top:4px;">风格：</div><div style="float:left; width:100px; margin-top:4px;"><input type="radio" checked=checked style="border:none;" name="displayStyle" id="displayStyle45" value="45" /><span style="cursor:default;" onclick="$(\'#displayStyle45\')[0].click()"><img src="'+me.options.UEDITOR_HOME_URL+'/image/comm/ueditor/images/menu/pa45.gif" border=0 /></span></div><div style="float:left; width:100px; margin-top:7px;"><input type="radio" style="border:none;" name="displayStyle" id="displayStyle4" value="4" /><span style="cursor:default;" onclick="$(\'#displayStyle4\')[0].click()"><img src="'+me.options.UEDITOR_HOME_URL+'/image/comm/ueditor/images/menu/pa4.gif" border=0 /></span></div></div>','<div style="clear:both;"><div style="float:left; width:60px; line-height:23px; text-align:right;">&nbsp;</div><div style="float:left; width:100px; "><input type="radio" style="border:none;" name="displayStyle" id="displayStyle1" value="1"/><span style="cursor:default;" onclick="$(\'#displayStyle1\')[0].click()"><img src="'+me.options.UEDITOR_HOME_URL+'/image/comm/ueditor/images/menu/pa1.gif" border=0 /></span></div><div style="float:left; width:110px;"><input type="radio" style="border:none;" name="displayStyle" id="displayStyle3" value="3" /><span style="cursor:default;" onclick="$(\'#displayStyle3\')[0].click()"><img src="'+me.options.UEDITOR_HOME_URL+'/image/comm/ueditor/images/menu/pa3.gif" border=0 /></span></div></div>','<div style="clear:both;"><div style="float:left; width:60px; text-align:right;">&nbsp;</div><div style="float:left; width:100px;"><input type="radio" style="border:none;" name="displayStyle" value="7" id="displayStyle7" /><span style="cursor:default;" onclick="$(\'#displayStyle7\')[0].click()"><img src="'+me.options.UEDITOR_HOME_URL+'/image/comm/ueditor/images/menu/pa7.gif" border=0 /></span></div><div style="float:left; width:100px;"><input type="radio" style="border:none;" name="displayStyle" value="6" id="displayStyle6" /><span style="cursor:default;" onclick="$(\'#displayStyle6\')[0].click()"><img src="'+me.options.UEDITOR_HOME_URL+'/image/comm/ueditor/images/menu/pa6.gif" border=0 /></span></div></div>','<div style="clear:both;"><div style="float:left; width:60px; text-align:right;">&nbsp;</div><div style="float:left; width:100px;"><input type="radio" style="border:none;" name="displayStyle" value="10" id="displayStyle10" /><span style="cursor:default;" onclick="$(\'#displayStyle10\')[0].click()"><img src="'+me.options.UEDITOR_HOME_URL+'/image/comm/ueditor/images/menu/pa10.gif" border=0 /></span></div><div style="float:left; width:100px;"><input type="radio" style="border:none;" name="displayStyle" value="5" id="displayStyle5" /><span style="cursor:default;" onclick="$(\'#displayStyle5\')[0].click()"><img src="'+me.options.UEDITOR_HOME_URL+'/image/comm/ueditor/images/menu/pa5.gif" border=0 /></span></div></div>','<div style="clear:both;"><div style="float:left; width:60px; line-height:23px; text-align:right;">QQ状态：</div><div style="float:left; width:100px;"><input type="radio" checked="checked" style="border:none;" name="showQQstate" id="showQQstate0" value="0"><span style="cursor:default;" onclick="$(\'#showQQstate0\')[0].click()">一直在线</span></div><div style="float:left; width:100px;"><input type="radio" style="border:none;" name="showQQstate" id="showQQstate1" value="1"><span style="cursor:default;" onclick="$(\'#showQQstate1\')[0].click()">实时</span></div></div><div style="text-align:right; clear:both; "><div style="float:left; height:30px; padding:10px 5px 0px 0px;"><a href="http://shang.qq.com/v3/widget.html" target="_blank" style="color:red;">开通QQ商家</a></div><button style="margin-top:22px;*line-height:16px;cursor: pointer;">确定</button><button style="*line-height:16px;cursor: pointer;">取消</button></div>',"</div>",'<div id="xheDialogMSN" style="display:none;width: 280px;margin-top: 15px;height: 220px;">','<div class="xheDialog"><div style="float:left; width:80px; text-align:right;">MSN帐号：</div><div style="float:left;"><input type="text" id="xheMSN" value="" style="width: 170px;" class="xheText"></div>','<div style="float:left; width:80px; text-align:right;">显示名称：</div><div style="float:left;"><input type="text" id="xheNameMSN" style="width: 170px;" value="" class="xheText"></div><div style="float:right;margin-top: 20px;*width:90px;">','<button style="cursor: pointer;">确定</button> <button style="cursor: pointer;">取消</button></div></div>',"</div>",'<div id="xheDialogSkype" style="display:none;width: 280px;margin-top: 15px;height: 220px;">','<div class="xheDialog"><div style="float:left; width:80px; text-align:right;">Skype帐号：</div><div style="float:left;"><input type="text" id="xheSkype" value="" style="width: 170px;" class="xheText"></div>','<div style="float:left; width:80px; text-align:right;">显示名称：</div><div style="float:left;"><input type="text" id="xheNameSkype" style="width: 170px;" value="" class="xheText"></div><div style="float:right;margin-top: 20px;*width:90px;">','<button style="cursor: pointer;">确定</button> <button style="cursor: pointer;">取消</button></div></div>',"</div>",'<div id="xheDialogAliWangWang" style="display:none;width: 280px;margin-top: 15px;height: 220px;">','<div class="xheDialog"><div style="float:left; width:80px; text-align:right;">用户名：</div><div style="float:left;"><input type="text" id="xheAliWangWang" value="" style="width: 170px;" class="xheText"></div>','<div style="float:left; width:80px; text-align:right;">显示名称：</div><div style="float:left;"><input type="text" id="xheNameAliWangWang" style="width: 170px;" value="" class="xheText"></div>','<div style="clear:both;"><div style="float:left; width:80px; line-height:23px; text-align:right;">状态：</div><div style="float:left; width:100px;"><input type="radio" checked="checked" style="border:none;" name="showAliWangWangstate" id="showAliWangWangstate0" value="0">&nbsp;<span style="cursor:default;" onclick="$(\'#showAliWangWangstate0\')[0].click()">一直在线</span></div><div style="float:left; width:100px;"><input type="radio" style="border:none;" name="showAliWangWangstate" id="showAliWangWangstate1" value="1">&nbsp;<span style="cursor:default;" onclick="$(\'#showAliWangWangstate1\')[0].click()">实时</span></div></div><div style="float:right;margin-top: 20px;*width:90px;"><button style="cursor: pointer;">确定</button> <button style="cursor: pointer;">取消</button></div></div>',"</div>",'<div id="xheDialogTaoBaoWangWang" style="display:none;width: 280px;margin-top: 15px;height: 220px;">','<div class="xheDialog"><div style="float:left; width:80px; text-align:right;">用户名：</div><div style="float:left;"><input type="text" id="xheTaoBaoWangWang" value="" style="width: 170px;" class="xheText"></div>','<div style="float:left; width:80px; text-align:right;">显示名称：</div><div style="float:left;"><input type="text" id="xheNameTaoBaoWangWang" style="width: 170px;" value="" class="xheText"></div>','<div style="clear:both;"><div style="float:left; width:80px; line-height:23px; text-align:right;">状态：</div><div style="float:left; width:100px;"><input type="radio" checked="checked" style="border:none;" name="showTaoBaoWangWangstate" id="showTaoBaoWangWangstate0" value="0">&nbsp;<span style="cursor:default;" onclick="$(\'#showTaoBaoWangWangstate0\')[0].click()">一直在线</span></div><div style="float:left; width:100px;"><input type="radio" style="border:none;" name="showTaoBaoWangWangstate" id="showTaoBaoWangWangstate1" value="1">&nbsp;<span style="cursor:default;" onclick="$(\'#showTaoBaoWangWangstate1\')[0].click()">实时</span></div></div><div style="float:right;margin-top: 20px;*width:90px;"><button style="cursor: pointer;">确定</button> <button style="cursor: pointer;">取消</button></div></div>',"</div>"].join("")}};utils.inherits(QQSetPicker,UIBase)})();(function(){var utils=baidu.editor.utils,UIBase=baidu.editor.ui.UIBase;var UpLoadHoverImgSetPicker=baidu.editor.ui.UpLoadHoverImgSetPicker=function(options){this.initOptions(options);this.initUpLoadHoverImgSetPicker()};UpLoadHoverImgSetPicker.prototype={initUpLoadHoverImgSetPicker:function(){this.initUIBase()},getHtmlTpl:function(){return'<div style="font-size: 12px; color: #000; width: 135px; height: 87px;margin-top: 6px;margin-left: 6px;"><div class="insertHoverImg defImg" style="width: 119px; height: 20px; line-height: 20px; margin-bottom: 4px;"><div style="width: 85px; float: left;">默认图片</div><input type="button" value="插入" onclick='+this.editor.options.htmlChoiceDefImage+' style="width: 32px; height: 18px; line-height: 18px; padding: 0px;border: 1px solid #959595; outline: none; text-align: center; color: #959595; background-color: #fff; float: left; cursor: pointer;" /></div><div class="insertHoverImg hoverImg" style="width: 119px; height: 20px; line-height: 20px; margin-bottom: 15px;"><div style="width: 85px; float: left;">鼠标悬停图片</div><input type="button" value="插入" onclick='+this.editor.options.htmlChoiceHoverImage+' style="width: 32px; height: 18px; line-height: 18px;padding: 0px;border: 1px solid #959595; outline: none;text-align: center;color: #959595;background-color: #fff;float: left;cursor: pointer;" /></div><div style="text-align:right;"><button style="cursor: pointer; float: left;margin-left: 12px;margin-right: 4px;">确定</button><button style="cursor: pointer; float: left;margin-left: 12px;margin-right: 4px;">取消</button></div></div>'},_UIBase_render:UIBase.prototype.render};utils.inherits(UpLoadHoverImgSetPicker,UIBase)})();(function(){var utils=baidu.editor.utils,UIBase=baidu.editor.ui.UIBase;var PhoneSetPicker=baidu.editor.ui.PhoneSetPicker=function(options){this.initOptions(options);this.initPhoneSetPicker()};PhoneSetPicker.prototype={initPhoneSetPicker:function(){this.initUIBase()},getHtmlTpl:function(){var me=this.editor;return['<div class="xheDialogType">','<div class="header">','<div class="qqheader" id="faiscoTypeOfPhone" name="faiscoServicesType">电话</div>',"</div>","</div>",'<div id="xheDialogPhone" style="width: 240px;">','<div style="padding-top: 10px;">','<div style="clear:both;float:left; width:60px; line-height:23px; text-align:right;">电话号码：</div>','<div style="float:left;">','<input type="text" id="xhePhoneNumber" value="" class="xheText" />',"</div>","</div>",'<div style="text-align:right; clear:both; ">','<button style="margin-top:22px;*line-height:16px;cursor: pointer;">确定</button>','<button style="*line-height:16px;cursor: pointer;">取消</button>',"</div>","</div>"].join("")}};utils.inherits(PhoneSetPicker,UIBase)})();(function(){var utils=baidu.editor.utils,UIBase=baidu.editor.ui.UIBase;var LinkSetPicker=baidu.editor.ui.LinkSetPicker=function(options){this.initOptions(options);this.initLinkSetPicker()};LinkSetPicker.prototype={initLinkSetPicker:function(){this.initUIBase()},getHtmlTpl:function(){var me=this.editor,opt=me.options.linkPicker,lang=me.getLang("linkPicker");if(!me.options.isMobi&&me.options.openSetLinkStyle){return'<div id="##" class="edui-autotypesetpicker %%"><div class="edui-autotypesetpicker-body"><table ><tr><td colspan="8">'+lang.linkText+'：<input type="text" name="linkText" id="linkTextId" style="width: 160px;" /></td></tr><tr><td colspan="8">'+lang.linkAddress+'：<input type="text"  name="linkAddress" id="linkAddressId" style="width: 160px;" /></td></tr><tr><td colspan="4">'+lang.linkStyle+'：<span id="linkStyle" style="border: #CCC 1px solid;cursor: pointer;display: inline-block;padding: 0px 3px;line-height: 22px;" >设置样式</span></td></tr><tr><td colspan="4">'+lang.openType+'：<select id="linkOpenType"><option value="currentWindow" selected="selected">'+lang.currentWindow+'</option><option value="newWindow">'+lang.newWindow+'</option></select></td></tr><tr><td colspan="4" align="left"><input type="button" disabled="true" value="'+lang.unLink+'" name="isUnLink" id="isUnLinkId" /></td><td colspan="4" align="right"><button >'+lang.confirmLink+'</button></td><td colspan="4" align="right"><button >'+lang.cancelLink+"</button></td></tr></table></div></div>"}else{return'<div id="##" class="edui-autotypesetpicker %%"><div class="edui-autotypesetpicker-body"><table ><tr><td colspan="8">'+lang.linkText+'：<input type="text" name="linkText" id="linkTextId" style="width: 160px;" /></td></tr><tr><td colspan="8">'+lang.linkAddress+'：<input type="text"  name="linkAddress" id="linkAddressId" style="width: 160px;" /></td></tr><tr><td colspan="4">'+lang.openType+'：<select id="linkOpenType"><option value="currentWindow" selected="selected">'+lang.currentWindow+'</option><option value="newWindow">'+lang.newWindow+'</option></select></td></tr><tr><td colspan="4" align="left"><input type="button" disabled="true" value="'+lang.unLink+'" name="isUnLink" id="isUnLinkId" /></td><td colspan="4" align="right"><button >'+lang.confirmLink+'</button></td><td colspan="4" align="right"><button >'+lang.cancelLink+"</button></td></tr></table></div></div>"}},_UIBase_render:UIBase.prototype.render};utils.inherits(LinkSetPicker,UIBase)})();(function(){var browser=baidu.editor.browser,domUtils=baidu.editor.dom.domUtils,uiUtils=baidu.editor.ui.uiUtils;var TPL_STATEFUL='onmousedown="$$.Stateful_onMouseDown(event, this);" onmouseup="$$.Stateful_onMouseUp(event, this);"'+(browser.ie?(' onmouseenter="$$.Stateful_onMouseEnter(event, this);" onmouseleave="$$.Stateful_onMouseLeave(event, this);"'):(' onmouseover="$$.Stateful_onMouseOver(event, this);" onmouseout="$$.Stateful_onMouseOut(event, this);"'));baidu.editor.ui.Stateful={alwalysHoverable:false,Stateful_init:function(){this._Stateful_dGetHtmlTpl=this.getHtmlTpl;this.getHtmlTpl=this.Stateful_getHtmlTpl},Stateful_getHtmlTpl:function(){var tpl=this._Stateful_dGetHtmlTpl();return tpl.replace(/stateful/g,function(){return TPL_STATEFUL})},Stateful_onMouseEnter:function(evt,el){if(!this.isDisabled()||this.alwalysHoverable){this.addState("hover");this.fireEvent("over")}},Stateful_onMouseLeave:function(evt,el){if(!this.isDisabled()||this.alwalysHoverable){this.removeState("hover");this.removeState("active");this.fireEvent("out")}},Stateful_onMouseOver:function(evt,el){var rel=evt.relatedTarget;if(!uiUtils.contains(el,rel)&&el!==rel){this.Stateful_onMouseEnter(evt,el)}},Stateful_onMouseOut:function(evt,el){var rel=evt.relatedTarget;if(!uiUtils.contains(el,rel)&&el!==rel){this.Stateful_onMouseLeave(evt,el)}},Stateful_onMouseDown:function(evt,el){if(!this.isDisabled()){this.addState("active")}},Stateful_onMouseUp:function(evt,el){if(!this.isDisabled()){this.removeState("active")}},Stateful_postRender:function(){if(this.disabled&&!this.hasState("disabled")){this.addState("disabled")}},hasState:function(state){return domUtils.hasClass(this.getStateDom(),"edui-state-"+state)},addState:function(state){if(!this.hasState(state)){this.getStateDom().className+=" edui-state-"+state}},removeState:function(state){if(this.hasState(state)){domUtils.removeClasses(this.getStateDom(),["edui-state-"+state])}},getStateDom:function(){return this.getDom("state")},isChecked:function(){return this.hasState("checked")},setChecked:function(checked){if(!this.isDisabled()&&checked){this.addState("checked")}else{this.removeState("checked")}},isDisabled:function(){return this.hasState("disabled")},setDisabled:function(disabled){if(disabled){this.removeState("hover");this.removeState("checked");this.removeState("active");this.addState("disabled")}else{this.removeState("disabled")}}}})();(function(){var utils=baidu.editor.utils,UIBase=baidu.editor.ui.UIBase,Stateful=baidu.editor.ui.Stateful,Button=baidu.editor.ui.Button=function(options){this.initOptions(options);this.initButton()};Button.prototype={uiName:"button",label:"",title:"",showIcon:true,showText:true,initButton:function(){this.initUIBase();this.Stateful_init()},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"><div id="##_state" stateful><div class="%%-wrap"><div id="##_body" unselectable="on" '+(this.title?'title="'+this.title+'"':"")+' class="%%-body" onmousedown="return false;" onclick="return $$._onClick();">'+(this.showIcon?'<div class="edui-box edui-icon"></div>':"")+(this.showText?'<div class="edui-box edui-label">'+this.label+"</div>":"")+"</div></div></div></div>"},postRender:function(){this.Stateful_postRender();this.setDisabled(this.disabled)},_onClick:function(){if(!this.isDisabled()){this.fireEvent("click");if(typeof window.editor.options.ueditorChangeEvent=="function"){window.editor.options.ueditorChangeEvent()}}}};utils.inherits(Button,UIBase);utils.extend(Button.prototype,Stateful)})();(function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,domUtils=baidu.editor.dom.domUtils,UIBase=baidu.editor.ui.UIBase,Stateful=baidu.editor.ui.Stateful,SplitButton=baidu.editor.ui.SplitButton=function(options){this.initOptions(options);this.initSplitButton()};SplitButton.prototype={dialogId:"",popup:null,uiName:"splitbutton",title:"",initSplitButton:function(){this.initUIBase();this.Stateful_init();var me=this;if(this.popup!=null){var popup=this.popup;this.popup=null;this.setPopup(popup)}},_UIBase_postRender:UIBase.prototype.postRender,postRender:function(){this.Stateful_postRender();this._UIBase_postRender()},setPopup:function(popup){if(this.popup===popup){return}if(this.popup!=null){this.popup.dispose()}popup.addListener("show",utils.bind(this._onPopupShow,this));popup.addListener("hide",utils.bind(this._onPopupHide,this));popup.addListener("postrender",utils.bind(function(){popup.getDom("body").appendChild(uiUtils.createElementByHtml('<div id="'+this.popup.id+'_bordereraser" class="edui-bordereraser edui-background" style="width:'+(uiUtils.getClientRect(this.getDom()).width-2)+'px"></div>'));popup.getDom().className+=" "+this.className},this));this.popup=popup},_onPopupShow:function(){this.addState("opened")},_onPopupHide:function(){this.removeState("opened")},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"><div '+(this.title?'title="'+this.title+'"':"")+' id="##_state" stateful><div class="%%-body"><div id="##_button_body" class="edui-box edui-button-body" onclick="$$._onButtonClick(event, this);"><div class="edui-box edui-icon"></div></div><div class="edui-box edui-splitborder"></div><div class="edui-box edui-arrow" onclick="$$._onArrowClick();"></div></div></div></div>'},showPopup:function(){var rect=uiUtils.getClientRect(this.getDom());rect.top-=this.popup.SHADOW_RADIUS;rect.height+=this.popup.SHADOW_RADIUS;this.popup.showAnchorRect(rect)},_onArrowClick:function(event,el){if(!this.isDisabled()){this.showPopup();if(typeof this.editor.options.ueditorChangeEvent=="function"){this.editor.options.ueditorChangeEvent()}}},_onButtonClick:function(){if(!this.isDisabled()){this.fireEvent("buttonclick");if(typeof this.editor.options.ueditorChangeEvent=="function"){this.editor.options.ueditorChangeEvent()}}}};utils.inherits(SplitButton,UIBase);utils.extend(SplitButton.prototype,Stateful,true)})();(function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,ColorPicker=baidu.editor.ui.ColorPicker,Popup=baidu.editor.ui.Popup,SplitButton=baidu.editor.ui.SplitButton,ColorButton=baidu.editor.ui.ColorButton=function(options){this.initOptions(options);this.initColorButton()};ColorButton.prototype={initColorButton:function(){var me=this;this.popup=new Popup({content:new ColorPicker({noColorText:me.editor.getLang("clearColor"),editor:me.editor,onpickcolor:function(t,color){me._onPickColor(color)},onpicknocolor:function(t,color){me._onPickNoColor(color)},onopenupcolortext:function(t,color){me._onPickColor(color)}}),editor:me.editor});this.initSplitButton()},_SplitButton_postRender:SplitButton.prototype.postRender,postRender:function(){this._SplitButton_postRender();this.getDom("button_body").appendChild(uiUtils.createElementByHtml('<div id="'+this.id+'_colorlump" class="edui-colorlump"></div>'));this.getDom().className+=" edui-colorbutton"},setColor:function(color){this.getDom("colorlump").style.backgroundColor=color;this.color=color;if(color!="transparent"){$(".edui-colorpicker-preview_textModifyColor").val(color)}},_onPickColor:function(color){if(this.fireEvent("pickcolor",color)!==false){this.setColor(color);this.popup.hide()}},_onPickNoColor:function(color){if(this.fireEvent("picknocolor")!==false){this.popup.hide()}},_onArrowClick:function(event,el){if(!this.isDisabled()){if(typeof this.editor.options.ueditorChangeEvent=="function"){this.editor.options.ueditorChangeEvent()}this.showPopup();var value=this.getDom("colorlump").style.backgroundColor;if(/rgba?\s*\([^)]*\)/.test(value)){value=value.replace(/rgba?\s*\(([^)]*)\)/g,function(str){return utils.fixColor("color",str)});$(".edui-colorpicker-preview_textModifyColor").val(value)}}}};utils.inherits(ColorButton,SplitButton)})();(function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,QQFacePicker=baidu.editor.ui.QQFacePicker,Popup=baidu.editor.ui.Popup,SplitButton=baidu.editor.ui.SplitButton,QQFacerButton=baidu.editor.ui.QQFacerButton=function(options){this.initOptions(options);this.initQQFacerButton()};QQFacerButton.prototype={initQQFacerButton:function(){var me=this;this.popup=new Popup({content:new QQFacePicker({noColorText:me.editor.getLang("clearColor"),editor:me.editor,oncloseface:function(){me._onCloseFace()}}),editor:me.editor});this.initSplitButton()},_SplitButton_postRender:SplitButton.prototype.postRender,postRender:function(){this._SplitButton_postRender();this.getDom("button_body").appendChild(uiUtils.createElementByHtml('<div id="'+this.id+'_colorlump" class="edui-colorlump"></div>'));this.getDom().className+=" edui-colorbutton"},_onCloseFace:function(){this.popup.hide()},_onButtonClick:function(){this._onArrowClick()},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"><div '+(this.title?'title="'+this.title+'"':"")+' id="##_state" stateful><div class="%%-body"><div id="##_button_body" class="edui-box edui-button-body" onclick="$$._onButtonClick(event, this);"><div class="edui-qqface edui-icon"></div></div></div></div></div>'}};utils.inherits(QQFacerButton,SplitButton)})();(function(){var utils=baidu.editor.utils,Popup=baidu.editor.ui.Popup,TablePicker=baidu.editor.ui.TablePicker,SplitButton=baidu.editor.ui.SplitButton,TableButton=baidu.editor.ui.TableButton=function(options){this.initOptions(options);this.initTableButton()};TableButton.prototype={initTableButton:function(){var me=this;this.popup=new Popup({content:new TablePicker({editor:me.editor,onpicktable:function(t,numCols,numRows){me._onPickTable(numCols,numRows)},onmore:function(){me.popup.hide();me.fireEvent("more")}}),editor:me.editor});this.initSplitButton()},_onPickTable:function(numCols,numRows){if(this.fireEvent("picktable",numCols,numRows)!==false){this.popup.hide()}},_onButtonClick:function(){this._onArrowClick()},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"><div '+(this.title?'title="'+this.title+'"':"")+' id="##_state" stateful><div class="%%-body"><div id="##_button_body" class="edui-box edui-button-body" onclick="$$._onButtonClick(event, this);"><div class="edui-box edui-icon"></div></div></div></div></div>'}};utils.inherits(TableButton,SplitButton)})();(function(){var utils=baidu.editor.utils,Popup=baidu.editor.ui.Popup,FlashSetPicker=baidu.editor.ui.FlashSetPicker,SplitButton=baidu.editor.ui.SplitButton,FlashSetButton=baidu.editor.ui.FlashSetButton=function(options){this.initOptions(options);this.initFlashSetButton()};FlashSetButton.prototype={initFlashSetButton:function(){var me=this;this.popup=new Popup({content:new FlashSetPicker({editor:me.editor}),editor:me.editor,hide:function(){if(!this._hidden&&this.getDom()){this.getDom().style.display="none";this._hidden=true;this.fireEvent("hide")}}});var flag=0;this.popup.addListener("postRenderAfter",function(urlSrc){var popupUI=this;if(flag){return}var cont=this.getDom(),btnConfirm=cont.getElementsByTagName("button")[0],btnCancel=cont.getElementsByTagName("button")[1];btnConfirm.onclick=function(urlSrc){var url,jHeight=$("#xheFlashHeight"),jWidth=$("#xheFlashWidth");if($("#faiscoWebFile").is(":checked")){url=$("#xheFlashLocalSrc").val()}else{if(urlSrc){url=urlSrc}}var flashTag=/\s*<embed\s*((?:\s+[\w-:]*(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(?:(?:>)|(?:>\s*<\/embed>))/i;if(flashTag.test(url)){var flashAttr=/([\w-(?:\:\w+)?]+)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g;var tmpUrl=url;tmpUrl.replace(flashAttr,function(match,name){name=name.toLowerCase();var value=arguments[2]?arguments[2]:arguments[3]?arguments[3]:arguments[4]?arguments[4]:"";if(name=="src"){url=value}else{if(name=="width"){jWidth.val(value)}else{if(name=="height"){jHeight.val(value)}}}})}if(url!=""&&url!="http://"){var w=jWidth.val(),h=jHeight.val(),reg=/^[0-9]+$/;if(!reg.test(w)){w=412}if(!reg.test(h)){h=300}var sBaseCode='<embed type="application/x-shockwave-flash" style="border:1px dotted  #234455" classid="clsid:d27cdb6e-ae6d-11cf-96b8-4445535400000" wmode="transparent"quality="high" menu="false" play="true" loop="true"';var aUrl=url.split(" ");if(aUrl.length>1){var sTemplate=sBaseCode+"",sEmbed,arrEmbed=[];sTemplate+=' width="xhe_width" height="xhe_height" />';for(var i in aUrl){url=aUrl[i].split(",");sEmbed=sTemplate;sEmbed=sEmbed.replace("xhe_tmpurl",url[0]);sEmbed=sEmbed.replace("xhe_width",url[1]?url[1]:w);sEmbed=sEmbed.replace("xhe_height",url[2]?url[2]:h);if(url!=""){arrEmbed.push(sEmbed)}}editor.execCommand("inserthtml",arrEmbed.join("&nbsp;"),true)}else{if(aUrl.length==1){url=aUrl[0].split(",");sBaseCode+=" width='"+jWidth.val()+"' height='"+jHeight.val()+"' src='"+url+"'";editor.execCommand("inserthtml",sBaseCode+" />",true)}}}popupUI.hide();$(".xheUpload").remove();var xheFlashSrc=$('<input type="text" id="xheFlashSrc" disabled="true" value="" class="xheText" style="position: absolute;  width: 107px;  top: 0px;  left: 0px;  z-index: 1000003;">');$("#xheFlashSrcPanel").append(xheFlashSrc);return false};btnCancel.onclick=function(){popupUI.hide()};document.getElementById("faiscoWebFile").onclick=function(){document.getElementById("xheFlashLocalSrcPanel").style.display="block";document.getElementById("xheFlashSrcPanel").style.display="none"};document.getElementById("faiscoLocalFile").onclick=function(){document.getElementById("xheFlashLocalSrcPanel").style.display="none";document.getElementById("xheFlashSrcPanel").style.display="block"};document.getElementById("faiscoWebFileSpan").onclick=function(){document.getElementById("xheFlashLocalSrcPanel").style.display="block";document.getElementById("xheFlashSrcPanel").style.display="none";$("#faiscoWebFile").attr("checked","true")};document.getElementById("faiscoLocalFileSpan").onclick=function(){document.getElementById("xheFlashLocalSrcPanel").style.display="none";document.getElementById("xheFlashSrcPanel").style.display="block";$("#faiscoLocalFile").attr("checked","true")};flag=1});this.initSplitButton()},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"><div '+(this.title?'title="'+this.title+'"':"")+' id="##_state" stateful><div class="%%-body"><div id="##_button_body" class="edui-box edui-button-body" onclick="$$._onArrowClick(event, this);"><div class="edui-box edui-icon"></div></div></div></div></div>'},_onArrowClick:function(event,el){if(!this.isDisabled()){this.showPopup();var jText=$("#xheFlashSrc"),xheDivSrcPanel=$("#xheFlashSrcPanel"),toUrl=this.editor.options.upLoadFlashUrl+"&app="+this.editor.options.upImgApp+"&_TOKEN="+$("#_TOKEN").attr("value"),uptext=this.editor.options.upFlashExt;this.editor.execCommand("uploadinit",this,jText,toUrl,uptext,xheDivSrcPanel);$("#"+this.id+"_body").before(' <iframe style="position:absolute;z-index:-1;left:0;top:0;background-color: white;" frameborder="0" width="100%" height="100%" src="javascript:"></iframe>');if(typeof this.editor.options.ueditorChangeEvent=="function"){this.editor.options.ueditorChangeEvent()}}}};utils.inherits(FlashSetButton,SplitButton)})();(function(){var utils=baidu.editor.utils,Popup=baidu.editor.ui.Popup,UpLoadImgSetPicker=baidu.editor.ui.UpLoadImgSetPicker,SplitButton=baidu.editor.ui.SplitButton,UpLoadImgSetButton=baidu.editor.ui.UpLoadImgSetButton=function(options){this.initOptions(options);this.initUpLoadImgSetButton()};UpLoadImgSetButton.prototype={initUpLoadImgSetButton:function(){var me=this;this.popup=new Popup({content:new UpLoadImgSetPicker({editor:me.editor}),editor:me.editor,hide:function(){if(!this._hidden&&this.getDom()){this.getDom().style.display="none";this._hidden=true;this.fireEvent("hide")}}});var flag=0;this.popup.addListener("postRenderAfter",function(urlSrc){var popupUI=this;if(flag){return}var cont=this.getDom(),btnConfirm=cont.getElementsByTagName("button")[0],btnCancel=cont.getElementsByTagName("button")[1];if(btnConfirm&&btnCancel){btnConfirm.onclick=function(urlSrc){var jImg=$("#imageIncludeDiv"),jParent=$("img"),jSrc=$("#xheImgSrc"),jAlt=$("#xheImgAlt"),jAlign=$("#xheImgAlign"),jWidth=$("#xheImgWidth"),jHeight=$("#xheImgHeight"),jBorder=$("#xheImgBorder"),jVspace=$("#xheImgVspace"),jHspace=$("#xheImgHspace"),jLink=$("a"),jImgLink=$("#xheImgLink");var ie7=($.browser.msie&&$.browser.version==7),ie6=($.browser.msie&&$.browser.version==6);var url=jImgLink.val();if(!url){url=urlSrc}if(url!=""&&url!="http://"){var aUrl=url.split(" "),sAlt=jAlt.val(),sAlign=jAlign.val(),sWidth=jWidth.val(),sHeight=jHeight.val(),sBorder=jBorder.val(),sVspace=jVspace.val(),sHspace=jHspace.val();if(aUrl.length>1){var sTemplate='<img src="xhe_tmpurl"',sImg,arrImg=[];if(sAlt!=""){sTemplate+=' alt="'+sAlt+'"'}else{sTemplate+=' alt=""'}if(sAlign&&sAlign!=""){sTemplate+=' align="'+sAlign+'"'}if(sWidth&&sWidth!=""){sTemplate+=' width="'+sWidth+'"'}if(sHeight&&sHeight!=""){sTemplate+=' height="'+sHeight+'"'}if(sBorder&&sBorder!=""){sTemplate+=' border="'+sBorder+'"'}if(sVspace&&sVspace!=""){sTemplate+=' vspace="'+sVspace+'"'}if(sHspace&&sHspace!=""){sTemplate+=' hspace="'+sHspace+'"'}sTemplate+=" />";for(var i in aUrl){url=aUrl[i];if(url!=""){url=url.split(",");sImg=sTemplate;sImg=sImg.replace("xhe_tmpurl",url[0]);if(url[1]){sImg='<a href="'+url[1]+'" target="_blank">'+sImg+"</a>"}arrImg.push(sImg)}}me.editor.execCommand("inserthtml",arrImg.join("&nbsp;"),true);popupUI.hide()}else{if(aUrl.length==1){url=aUrl[0];if(url!=""){url=url.split(",");var image;if(jImgLink.val()){image='<a href="'+jImgLink.val()+'"><img src="'+url[0]+'" width="'+sWidth+'" height="'+sHeight+'"/></a>'}else{image='<img src="'+url[0]+'"/>'}me.editor.execCommand("inserthtml",image,true);jImgLink.val("");jWidth.val("");jHeight.val("");popupUI.hide()}}}}$(".xheUpload").remove();var xheImgSrc=$('<input type="text" disabled="true" id="xheImgSrc" value="" class="xheText" style="position: absolute;width: 107px;top: 0px;left: 0px;z-index: 1000003;">');$("#xheImageDiv").append(xheImgSrc);return false};btnCancel.onclick=function(){popupUI.hide()};document.getElementById("faiscoLocalFileImage").onclick=function(){document.getElementById("xheImageDiv").style.display="block";document.getElementById("xheImageWebDiv").style.display="none"};document.getElementById("faiscoWebFileImage").onclick=function(){document.getElementById("xheImageDiv").style.display="none";document.getElementById("xheImageWebDiv").style.display="block"};document.getElementById("faiscoLocalFileImageSpan").onclick=function(){document.getElementById("xheImageDiv").style.display="block";document.getElementById("xheImageWebDiv").style.display="none";$("#faiscoLocalFileImage").attr("checked","true")};document.getElementById("faiscoWebFileImageSpan").onclick=function(){document.getElementById("xheImageDiv").style.display="none";document.getElementById("xheImageWebDiv").style.display="block";$("#faiscoWebFileImage").attr("checked","true")}}if(this.editor.options.imageExtends){cont.getElementsByTagName("div")[0].onclick=function(){popupUI.hide()}}flag=1});this.initSplitButton()},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"><div '+(this.title?'title="'+this.title+'"':"")+' id="##_state" stateful><div class="%%-body"><div id="##_button_body" class="edui-box edui-button-body" onclick="'+(this.editor.options.imageExtends?this.editor.options.htmlChoiceImage:"$$._onArrowClick();")+' "><div class="edui-box edui-icon"></div></div>'+(this.editor.options.imageExtends?'<div class="edui-box edui-splitborder"></div><div class="edui-box edui-arrow" onclick="$$._onButtonClick();"></div>':"")+"</div></div></div>"},_onButtonClick:function(event,el){if(!this.isDisabled()){this.showPopup()}},_onArrowClick:function(event,el){if(!this.isDisabled()){if(typeof this.editor.options.ueditorChangeEvent=="function"){this.editor.options.ueditorChangeEvent()}this.showPopup();var jText=$("#xheImgSrc"),xheDivSrcPanel=$("#xheImageDiv"),toUrl=this.editor.options.upLoadImageUrl+"?app="+this.editor.options.upImgApp+"&maxWidth=1024&maxHeight=1024&imgMode=2&_TOKEN="+$("#_TOKEN").attr("value"),uptext=this.editor.options.upImageExt;this.editor.execCommand("uploadinit",this,jText,toUrl,uptext,xheDivSrcPanel)}}};utils.inherits(UpLoadImgSetButton,SplitButton)})();(function(){var utils=baidu.editor.utils,Popup=baidu.editor.ui.Popup,UpLoadHoverImgSetPicker=baidu.editor.ui.UpLoadHoverImgSetPicker,SplitButton=baidu.editor.ui.SplitButton,UploadHoverImgSetButton=baidu.editor.ui.UploadHoverImgSetButton=function(options){this.initOptions(options);this.initUploadHoverImgSetButton()};UploadHoverImgSetButton.prototype={initUploadHoverImgSetButton:function(){var me=this;this.editor.options.hoverImageData={defImg:{},hovImg:{}};this.popup=new Popup({content:new UpLoadHoverImgSetPicker({editor:me.editor}),editor:me.editor,hide:function(){if(!this._hidden&&this.getDom()){this.getDom().style.display="none";this._hidden=true;this.fireEvent("hide");me.editor.options.clearPopupContent()}}});var flag=0;this.popup.addListener("postRenderAfter",function(urlSrc){var popupUI=this;if(flag){return}var cont=this.getDom(),btnConfirm=cont.getElementsByTagName("button")[0],btnCancel=cont.getElementsByTagName("button")[1];if(btnConfirm&&btnCancel){btnConfirm.onclick=function(){var defImg=me.editor.options.hoverImageData.defImg;var defImgId=defImg.id;var defImgPath=defImg.path;var defImgWidth=defImg.width;var defImgHeight=defImg.height;var hovImg=me.editor.options.hoverImageData.hovImg;var hovImgPath=hovImg.path;var str="";if(!defImgPath||defImgPath.length==0){Fai.ing("请添加默认图片",true);return}if(!hovImgPath||hovImgPath.length==0){Fai.ing("请添加悬停图片",true);return}str+='<img class="hoverImage" id="hoverImg_'+defImgId+'" src="'+defImgPath+'" _defImg="'+defImgPath+'" _hovImg="'+hovImgPath+'"';if(defImgWidth&&defImgHeight){str+=' width="'+defImgWidth+'"';str+=' height="'+defImgHeight+'"'}str+="/>";me.editor.pasteChoiceImage(str);me.editor.fireEvent("afterscencerestore");me.editor.options.clearPopupContent();me.editor.options.restoreHoverPickerWidth();popupUI.hide();me.editor.options.hoverImageData={defImg:{},hovImg:{}}};btnCancel.onclick=function(){var defImg=me.editor.options.hoverImageData.defImg;$(me.editor.body).find("#hoverImg_"+defImg.id).remove();me.editor.options.clearPopupContent();me.editor.options.restoreHoverPickerWidth();popupUI.hide();me.editor.options.hoverImageData={defImg:{},hovImg:{}}}}flag=1});this.editor.options.addHoverThumb=function(isDef){var defImg=this.hoverImageData.defImg;var hovImg=this.hoverImageData.hovImg;var defImgPath=defImg.path;var hovImgPath=hovImg.path;var cont=me.popup.getDom();var popupBody=$(cont).find(".edui-popup-body");var popupContent=$(cont).find(".edui-popup-content").children()[0];if(defImgPath||hovImgPath){var delBtn="<a class='clearHoverThumb' href='javascript:;' style='margin-left: 5px;'>删除</a>";$(popupBody).css("width","170px");$(popupContent).css("width","155px");if(isDef){var insertHoverImgItemDef=$(cont).find(".insertHoverImg.defImg");if($(insertHoverImgItemDef).find("img").length==0){var defImgThumb="<img src="+defImgPath+" width='34' height='20' style='float: left;' />";$(insertHoverImgItemDef).css("width","150px");$(insertHoverImgItemDef).find("input").remove();$(insertHoverImgItemDef).append(defImgThumb);$(insertHoverImgItemDef).append(delBtn)}}else{var insertHoverImgItemHov=$(cont).find(".insertHoverImg.hoverImg");if($(insertHoverImgItemHov).find("img").length==0){var hovImgThumb="<img src="+hovImgPath+" width='34' height='20' style='float: left;' />";$(insertHoverImgItemHov).css("width","150px");$(insertHoverImgItemHov).find("input").remove();$(insertHoverImgItemHov).append(hovImgThumb);$(insertHoverImgItemHov).append(delBtn)}}}$(cont).find(".clearHoverThumb").off(".hoverImage");$(cont).find(".clearHoverThumb").on("click.hoverImage",function(){me.editor.options.clearHoverThumb(this);me.editor.options.restoreHoverPickerWidth();if($(cont).find("img").length==0){$(me.editor.body).find("#hoverImg_"+hoverImageData.defImgId).remove();me.editor.options.hoverImageData={defImg:{},hovImg:{}}}})};this.editor.options.clearHoverThumb=function(delBtn){var cont=me.popup.getDom();var hoverImageData=me.editor.options.hoverImageData;var insertHoverImgItem=$(delBtn).parent();var isClearDefItem=$(delBtn).parent(".defImg").length;var inputHtml='<input type="button" value="插入" onclick='+this.editor.options.htmlChoiceDefImage+' style="width: 32px; height: 18px; line-height: 18px; padding: 0px;border: 1px solid #959595; outline: none; text-align: center; color: #959595; background-color: #fff; float: left; cursor: pointer;" />';if(isClearDefItem){hoverImageData.defImg={}}else{hoverImageData.hovImg={};inputHtml='<input type="button" value="插入" onclick='+this.editor.options.htmlChoiceHoverImage+' style="width: 32px; height: 18px; line-height: 18px;padding: 0px;border: 1px solid #959595; outline: none;text-align: center;color: #959595;background-color: #fff;float: left;cursor: pointer;" />'}$(delBtn).remove();$(insertHoverImgItem).find("img").remove();$(insertHoverImgItem).append(inputHtml)};this.editor.options.clearPopupContent=function(){var cont=me.popup.getDom();var delBtns=$(cont).find("a");for(var i=0;i<delBtns.length;i++){me.editor.options.clearHoverThumb(delBtns[i])}me.editor.options.restoreHoverPickerWidth()};this.editor.options.restoreHoverPickerWidth=function(){var cont=me.popup.getDom();if($(cont).find("img").length==0){var popupBody=$(cont).find(".edui-popup-body");var popupContent=$(cont).find(".edui-popup-content").children()[0];var insertHoverImgItems=$(cont).find(".insertHoverImg");$(popupBody).css("width","153px");$(popupContent).css("width","135px");$(insertHoverImgItems).css("width","119px")}};this.initSplitButton();if(me.editor.options.outerFunction.hoverChangeImage){me.editor.addListener("afterscencerestore",me.editor.options.outerFunction.hoverChangeImage)}},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"><div '+(this.title?'title="'+this.title+'"':"")+' id="##_state" stateful><div class="%%-body"><div id="##_button_body" class="edui-box edui-button-body" onclick="$$._onButtonClick();"><div class="edui-box edui-icon"></div></div></div></div></div>'},_onButtonClick:function(event,el){if(!this.isDisabled()){this.showPopup()}},_onArrowClick:function(event,el){if(!this.isDisabled()){if(typeof this.editor.options.ueditorChangeEvent=="function"){this.editor.options.ueditorChangeEvent()}this.showPopup()}}};utils.inherits(UploadHoverImgSetButton,SplitButton)})();(function(){var utils=baidu.editor.utils,Popup=baidu.editor.ui.Popup,QQSetPicker=baidu.editor.ui.QQSetPicker,SplitButton=baidu.editor.ui.SplitButton,QQSetButton=baidu.editor.ui.QQSetButton=function(options){this.initOptions(options);this.initQQSetButtion()};QQSetButton.prototype={initQQSetButtion:function(){var me=this;this.popup=new Popup({content:new QQSetPicker({editor:me.editor}),editor:me.editor,hide:function(){if(!this._hidden&&this.getDom()){this.getDom().style.display="none";this._hidden=true;this.fireEvent("hide")}}});var flag=0;this.popup.addListener("postRenderAfter",function(){var popupUI=this;if(flag){return}var cont=this.getDom(),btnQQ=cont.getElementsByTagName("button")[0],btnQQCancel=cont.getElementsByTagName("button")[1],btnMSN=cont.getElementsByTagName("button")[2],btnMSNCancel=cont.getElementsByTagName("button")[3],btnSkype=cont.getElementsByTagName("button")[4],btnSkypeCancel=cont.getElementsByTagName("button")[5],btnAliWangWang=cont.getElementsByTagName("button")[6],btnAliWangWangCancel=cont.getElementsByTagName("button")[7],btnTaoBaoWangWang=cont.getElementsByTagName("button")[8],btnTaoBaoWangWangCancel=cont.getElementsByTagName("button")[9];btnQQ.onclick=function(){me.editor.execCommand("qqservice",me,cont)};btnMSN.onclick=function(){me.editor.execCommand("msnservice",me,cont)};btnSkype.onclick=function(){me.editor.execCommand("skypeservice",me,cont)};btnAliWangWang.onclick=function(){me.editor.execCommand("aliwangwangservice",me,cont)};btnTaoBaoWangWang.onclick=function(){me.editor.execCommand("taobaowangwangservice",me,cont)};btnMSNCancel.onclick=function(){popupUI.hide()};btnQQCancel.onclick=function(){popupUI.hide()};btnSkypeCancel.onclick=function(){popupUI.hide()};btnAliWangWangCancel.onclick=function(){popupUI.hide()};btnTaoBaoWangWangCancel.onclick=function(){popupUI.hide()};var tabQQ=document.getElementById("faiscoTypeOfQQ");var tabMSN=document.getElementById("faiscoTypeOfMSN");var tabSkype=document.getElementById("faiscoTypeOfSkype");var tabAliWangWang=document.getElementById("faiscoTypeOfAliWangWang");var tabTaoBaoWangWang=document.getElementById("faiscoTypeOfTaoBaoWangWang");var panelQQ=document.getElementById("xheDialogQQ");var panelMSN=document.getElementById("xheDialogMSN");var panelSkype=document.getElementById("xheDialogSkype");var panelAliWangWang=document.getElementById("xheDialogAliWangWang");var panelTaoBaoWangWang=document.getElementById("xheDialogTaoBaoWangWang");tabQQ.onclick=function(){panelQQ.style.display="block";panelMSN.style.display="none";panelSkype.style.display="none";panelAliWangWang.style.display="none";panelTaoBaoWangWang.style.display="none";tabQQ.style.background="#FFFFFF";tabMSN.style.background="#E6E6E6";tabSkype.style.background="#E6E6E6";tabAliWangWang.style.background="#E6E6E6";tabTaoBaoWangWang.style.background="#E6E6E6"};tabMSN.onclick=function(){panelQQ.style.display="none";panelMSN.style.display="block";panelSkype.style.display="none";panelAliWangWang.style.display="none";panelTaoBaoWangWang.style.display="none";tabQQ.style.background="#E6E6E6";tabMSN.style.background="#FFFFFF";tabSkype.style.background="#E6E6E6";tabAliWangWang.style.background="#E6E6E6";tabTaoBaoWangWang.style.background="#E6E6E6"};tabSkype.onclick=function(){panelQQ.style.display="none";panelMSN.style.display="none";panelSkype.style.display="block";panelAliWangWang.style.display="none";panelTaoBaoWangWang.style.display="none";tabQQ.style.background="#E6E6E6";tabMSN.style.background="#E6E6E6";tabSkype.style.background="#FFFFFF";tabAliWangWang.style.background="#E6E6E6";tabTaoBaoWangWang.style.background="#E6E6E6"};tabAliWangWang.onclick=function(){panelQQ.style.display="none";panelMSN.style.display="none";panelSkype.style.display="none";panelAliWangWang.style.display="block";panelTaoBaoWangWang.style.display="none";tabQQ.style.background="#E6E6E6";tabMSN.style.background="#E6E6E6";tabSkype.style.background="#E6E6E6";tabAliWangWang.style.background="#FFFFFF";tabTaoBaoWangWang.style.background="#E6E6E6"};tabTaoBaoWangWang.onclick=function(){panelQQ.style.display="none";panelMSN.style.display="none";panelSkype.style.display="none";panelAliWangWang.style.display="none";panelTaoBaoWangWang.style.display="block";tabQQ.style.background="#E6E6E6";tabMSN.style.background="#E6E6E6";tabSkype.style.background="#E6E6E6";tabAliWangWang.style.background="#E6E6E6";tabTaoBaoWangWang.style.background="#FFFFFF"};flag=1});this.initSplitButton()},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"><div '+(this.title?'title="'+this.title+'"':"")+' id="##_state" stateful><div class="%%-body"><div id="##_button_body" class="edui-box edui-button-body" onclick="$$._onArrowClick(event, this);"><div class="edui-box edui-icon"></div></div></div></div></div>'},_onArrowClick:function(event,el){if(!this.isDisabled()){this.showPopup();if(typeof this.editor.options.ueditorChangeEvent=="function"){this.editor.options.ueditorChangeEvent()}var me=this,editor=me.editor,range=editor.selection.getRange();var qqName,qqNumber,msnNumber,msnName,qqStyleVlaue,skyNumber,skyName,qqStateVlaue,aliWangWang,aliWangWangName,showAliWangWangstate,taobaoWangWang,taobaoWangWangName,showTaoBaoWangWangstate;var xheQQ=document.getElementById("xheQQ"),xheName=document.getElementById("xheName");var xheMSN=document.getElementById("xheMSN"),xheNameMSN=document.getElementById("xheNameMSN");var xheSkype=document.getElementById("xheSkype"),xheNameSkype=document.getElementById("xheNameSkype");var xheAliWangWang=document.getElementById("xheAliWangWang"),xheNameAliWangWang=document.getElementById("xheNameAliWangWang");var xheTaoBaoWangWang=document.getElementById("xheTaoBaoWangWang"),xheNameTaoBaoWangWang=document.getElementById("xheNameTaoBaoWangWang");var qqservice=range.collapsed?editor.queryCommandValue("link"):editor.selection.getStart(),qqservice=domUtils.findParentByTagName(qqservice,"a",true);if(qqservice){qqName=qqservice.getAttribute("qqName");qqNumber=qqservice.getAttribute("qqNumber");msnNumber=qqservice.getAttribute("msnNumber");msnName=qqservice.getAttribute("msnName");qqStyleVlaue=qqservice.getAttribute("qqStyleVlaue");qqStateVlaue=qqservice.getAttribute("qqStateValue");skyNumber=qqservice.getAttribute("skyNumber");skyName=qqservice.getAttribute("skyName");aliWangWang=qqservice.getAttribute("aliWangWang");aliWangWangName=qqservice.getAttribute("aliWangWangName");showAliWangWangstate=qqservice.getAttribute("aliwangwangstatevalue");taobaoWangWang=qqservice.getAttribute("taobaoWangWang");taobaoWangWangName=qqservice.getAttribute("taobaoWangWangName");showTaoBaoWangWangstate=qqservice.getAttribute("taobaowangwangstatevalue")}var tabQQ=document.getElementById("faiscoTypeOfQQ");var tabMSN=document.getElementById("faiscoTypeOfMSN");var tabSkype=document.getElementById("faiscoTypeOfSkype");var tabAliWangWang=document.getElementById("faiscoTypeOfAliWangWang");var tabTaoBaoWangWang=document.getElementById("faiscoTypeOfTaoBaoWangWang");var panelQQ=document.getElementById("xheDialogQQ");var panelMSN=document.getElementById("xheDialogMSN");var panelSkype=document.getElementById("xheDialogSkype");var panelAliWangWang=document.getElementById("xheDialogAliWangWang");var panelTaoBaoWangWang=document.getElementById("xheDialogTaoBaoWangWang");if(qqNumber){panelQQ.style.display="block";panelMSN.style.display="none";panelSkype.style.display="none";panelAliWangWang.style.display="none";panelTaoBaoWangWang.style.display="none";tabQQ.style.background="#FFFFFF";tabMSN.style.background="#E6E6E6";tabSkype.style.background="#E6E6E6";tabAliWangWang.style.background="#E6E6E6";tabTaoBaoWangWang.style.background="#E6E6E6"}if(msnNumber){panelQQ.style.display="none";panelMSN.style.display="block";panelSkype.style.display="none";panelAliWangWang.style.display="none";panelTaoBaoWangWang.style.display="none";tabQQ.style.background="#E6E6E6";tabMSN.style.background="#FFFFFF";tabSkype.style.background="#E6E6E6";tabAliWangWang.style.background="#E6E6E6";tabTaoBaoWangWang.style.background="#E6E6E6"}if(skyNumber){panelQQ.style.display="none";panelMSN.style.display="none";panelSkype.style.display="block";panelAliWangWang.style.display="none";panelTaoBaoWangWang.style.display="none";tabQQ.style.background="#E6E6E6";tabMSN.style.background="#E6E6E6";tabSkype.style.background="#FFFFFF";tabAliWangWang.style.background="#E6E6E6";tabTaoBaoWangWang.style.background="#E6E6E6"}if(aliWangWang){panelQQ.style.display="none";panelMSN.style.display="none";panelSkype.style.display="none";panelAliWangWang.style.display="block";panelTaoBaoWangWang.style.display="none";tabQQ.style.background="#E6E6E6";tabMSN.style.background="#E6E6E6";tabSkype.style.background="#E6E6E6";tabAliWangWang.style.background="#FFFFFF";tabTaoBaoWangWang.style.background="#E6E6E6"}if(taobaoWangWang){panelQQ.style.display="none";panelMSN.style.display="none";panelSkype.style.display="none";panelAliWangWang.style.display="none";panelTaoBaoWangWang.style.display="block";tabQQ.style.background="#E6E6E6";tabMSN.style.background="#E6E6E6";tabSkype.style.background="#E6E6E6";tabAliWangWang.style.background="#E6E6E6";tabTaoBaoWangWang.style.background="#FFFFFF"}xheQQ.value=qqNumber?qqNumber:"";xheName.value=qqName?UE.utils.html(qqName):"";if(qqStyleVlaue){$("#displayStyle"+qqStyleVlaue)[0].click()}else{$("#displayStyle45")[0].click()}if(qqservice&&qqStateVlaue!==null){$("#showQQstate"+qqStateVlaue)[0].click()}else{if(qqservice&&qqservice.getAttribute("qqNumber")&&qqStateVlaue===null){$("#showQQstate1")[0].click()}else{$("#showQQstate0")[0].click()}}if(showAliWangWangstate){$("#showAliWangWangstate"+showAliWangWangstate)[0].click()}else{$("#showAliWangWangstate0")[0].click()}if(showTaoBaoWangWangstate){$("#showTaoBaoWangWangstate"+showTaoBaoWangWangstate)[0].click()}else{$("#showTaoBaoWangWangstate0")[0].click()}xheMSN.value=msnNumber?msnNumber:"";xheNameMSN.value=msnName?UE.utils.html(msnName):"";xheSkype.value=skyNumber?skyNumber:"";xheNameSkype.value=skyName?skyName:"";xheAliWangWang.value=aliWangWang?aliWangWang:"";xheNameAliWangWang.value=aliWangWangName?aliWangWangName:"";xheTaoBaoWangWang.value=taobaoWangWang?taobaoWangWang:"";xheNameTaoBaoWangWang.value=taobaoWangWangName?taobaoWangWangName:""}}};utils.inherits(QQSetButton,SplitButton)})();(function(){var utils=baidu.editor.utils,Popup=baidu.editor.ui.Popup,PhoneSetPicker=baidu.editor.ui.PhoneSetPicker,SplitButton=baidu.editor.ui.SplitButton,PhoneSetButton=baidu.editor.ui.PhoneSetButton=function(options){this.initOptions(options);this.initPhoneSetButtion()};PhoneSetButton.prototype={initPhoneSetButtion:function(){var me=this;this.popup=new Popup({content:new PhoneSetPicker({editor:me.editor}),editor:me.editor,hide:function(){if(!this._hidden&&this.getDom()){this.getDom().style.display="none";this._hidden=true;this.fireEvent("hide")}}});var flag=0;this.popup.addListener("postRenderAfter",function(){var popupUI=this;if(flag){return}var cont=this.getDom(),btnPhone=cont.getElementsByTagName("button")[0],btnPhoneCancel=cont.getElementsByTagName("button")[1];btnPhone.onclick=function(){me.editor.execCommand("phoneservice",me,cont)};btnPhoneCancel.onclick=function(){popupUI.hide()};flag=1});this.initSplitButton()},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"><div '+(this.title?'title="'+this.title+'"':"")+' id="##_state" stateful><div class="%%-body"><div id="##_button_body" class="edui-box edui-button-body" onclick="$$._onArrowClick(event, this);"><div class="edui-box edui-icon"></div></div></div></div></div>'},_onArrowClick:function(event,el){if(!this.isDisabled()){this.showPopup();if(typeof this.editor.options.ueditorChangeEvent=="function"){this.editor.options.ueditorChangeEvent()}var me=this,editor=me.editor,range=editor.selection.getRange();var phoneNumber;var xhePhoneNumber=document.getElementById("xhePhoneNumber");var phoneservice=range.collapsed?editor.queryCommandValue("link"):editor.selection.getStart(),phoneservice=domUtils.findParentByTagName(phoneservice,"a",true);if(phoneservice){phoneNumber=phoneservice.getAttribute("phoneNumber")}xhePhoneNumber.value=phoneNumber?phoneNumber:""}}};utils.inherits(PhoneSetButton,SplitButton)})();(function(){var utils=baidu.editor.utils,Popup=baidu.editor.ui.Popup,LinkSetPicker=baidu.editor.ui.LinkSetPicker,SplitButton=baidu.editor.ui.SplitButton,orgText,LinkSetButton=baidu.editor.ui.LinkSetButton=function(options){this.initOptions(options);this.initLinkSetButton()};LinkSetButton.prototype={initLinkSetButton:function(){var me=this;this.popup=new Popup({content:new LinkSetPicker({editor:me.editor}),editor:me.editor,hide:function(){if(!this._hidden&&this.getDom()){this.getDom().style.display="none";this._hidden=true;this.fireEvent("hide")}}});var flag=0;this.popup.addListener("postRenderAfter",function(){var popupUI=this;if(flag){return}var cont=this.getDom(),me=this,editor=me.editor,opt=editor.options,range=editor.selection.getRange(),text=$G("linkTextId"),link=range.collapsed?editor.queryCommandValue("link"):editor.selection.getStart(),unlink=editor.selection.getStart();btnConfirm=cont.getElementsByTagName("button")[0],btnCancel=cont.getElementsByTagName("button")[1],inputNums=cont.getElementsByTagName("input"),rangeLink=domUtils.findParentByTagName(link,"a",true);for(var i=0;i<inputNums.length;i++){if(inputNums[i].id=="isUnLinkId"){inputNums[i].onclick=function(){editor.execCommand("unlink");popupUI.hide()}}}btnConfirm.onclick=function(){var linkPicker=popupUI.getDom();var jumpCtrlUE=$(linkPicker).find("#jumpCtrlUE")[0];var linkAddress=$(linkPicker).find("#linkAddressId")[0];var href,link=range.collapsed?editor.queryCommandValue("link"):editor.selection.getStart();var rangeLink=domUtils.findParentByTagName(link,"a",true);if(editor.options.openJumpCtrl){href=jumpCtrlUE.getAttribute("_lurl")?jumpCtrlUE.getAttribute("_lurl").replace(/^\s+|\s+$/g,""):"unlink"}else{href=linkAddress.value.replace(/^\s+|\s+$/g,"")}if(href&&linkAddress.value.replace(/^\s+|\s+$/g,"")!=""){var jType=2;if(editor.options.openJumpCtrl){jType=parseInt(jumpCtrlUE.getAttribute("_ltype"))}if(jType===103||jType===2){try{if(top.location.hostname&&href.indexOf("http://"+top.location.hostname)==0){href=href.substring(("http://"+top.location.hostname).length)}}catch(exp){}if(href.length>=1&&href.charAt(0)!="/"&&href.charAt(0)!="#"){if(/^(\w+:).+/.test(href)==false){href="http://"+href}}}else{if(editor.options.openWxCententLink&&href!="unlink"){href="http://"+editor.options.mobiDomainOpt.MainMobiDomain+"/"+href}}var obj={href:href,aStyle_h:(editor.options.styleSettingOpt.linkStyleClose)?"2":"1",forecolor:(editor.options.styleSettingOpt.wColor==undefined)?"":"color:"+editor.options.styleSettingOpt.wColor+";",target:$G("linkOpenType").value=="newWindow"?"_blank":"_self",title:$G("linkTextId").value.replace(/^\s+|\s+$/g,"")=="只支持选中一个链接时生效"?"":$G("linkTextId").value.replace(/^\s+|\s+$/g,""),data_ue_src:href,wUnderline:editor.options.styleSettingOpt.wUnderline,wBold:editor.options.styleSettingOpt.wBold,styleHover:editor.options.styleHoverSettingOpt,wbackColor_h:editor.options.backHoverSettingOpt,linkStyleClose:(editor.options.styleSettingOpt.linkStyleClose==undefined)?"":editor.options.styleSettingOpt.linkStyleClose,wbackColorClose:(editor.options.styleSettingOpt.wbackColorClose==undefined)?"":editor.options.styleSettingOpt.wbackColorClose};if(editor.options.openJumpCtrl){obj._t=jumpCtrlUE.getAttribute("_ltype");obj._i=jumpCtrlUE.getAttribute("_lide");obj._n=jumpCtrlUE.getAttribute("_lName")||$G("linkAddressId").value;var extJIde=jumpCtrlUE.getAttribute("_extJIde");if(extJIde!=null){obj._mi=extJIde}var extJUrl=jumpCtrlUE.getAttribute("_extJUrl");if(extJUrl!=null){obj._mu=extJUrl;obj["class"]="switchJump"}var extName=jumpCtrlUE.getAttribute("_extJName");if(extName!=null){obj._mn=extName}}if(jType===108){obj.target=""}if(orgText&&text.value!=orgText){if(link){link[browser.ie?"innerText":"textContent"]=obj.textValue=text.value;range.selectNode(link).select()}}if(range.collapsed){obj.textValue=text.value}editor.execCommand("backcolor",editor.options.styleSettingOpt.wbackColor);editor.execCommand("FontSize",editor.options.styleSettingOpt.wfontSize);editor.execCommand("forecolor",editor.options.styleSettingOpt.wColor);if(editor.options.styleSettingOpt.wfontfamily!=undefined){editor.execCommand("FontFamily",editor.options.styleSettingOpt.wfontfamily)}editor.execCommand("link",obj);popupUI.hide()}};btnCancel.onclick=function(){popupUI.hide()};function isEmpty(obj){for(var name in obj){return false}return true}flag=1});this.initSplitButton()},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"><div '+(this.title?'title="'+this.title+'"':"")+' id="##_state" stateful><div class="%%-body"><div id="##_button_body" class="edui-box edui-button-body" onclick="$$._onArrowClick(event, this);"><div class="edui-box edui-icon"></div></div></div></div></div>'},_onArrowClick:function(event,el){if(!this.isDisabled()){if(typeof this.editor.options.ueditorChangeEvent=="function"){this.editor.options.ueditorChangeEvent()}if(this.editor.selection.getRange().collapsed&&domUtils.findParentByTagName(this.editor.selection.getRange().getCommonAncestor(),"a",true)==null){return}this.showPopup();var me=this,editor=me.editor,range=editor.selection.getRange(),link=range.collapsed?editor.queryCommandValue("link"):editor.selection.getStart(),url,lang=editor.getLang("link"),text=$G("linkTextId"),isUnLink=$G("isUnLinkId"),rangeLink=domUtils.findParentByTagName(range.getCommonAncestor(),"a",true);link=domUtils.findParentByTagName(link,"a",true);$("#linkStyle").parent().show();if(link){if(browser.version<9){if(isUnLink.getAttribute("disabled")==true||isUnLink.getAttribute("disabled")=="disabled"){isUnLink.removeAttribute("disabled")}}if(isUnLink.getAttribute("disabled")=="true"){isUnLink.removeAttribute("disabled")}if(!editor.options.openJumpCtrl){url=utils.html(link.getAttribute("data_ue_src")||link.getAttribute("href",2))}if(rangeLink===link&&!link.getElementsByTagName("img").length){text.removeAttribute("disabled");orgText=text.value=link[browser.ie?"innerText":"textContent"]}else{text.setAttribute("disabled","true");text.value=lang.validLink;if(browser.version<9){text.value=editor.selection.getIERange().text.toString()}else{text.value=editor.selection.getText().trim()}}}else{if(browser.version<9){if(isUnLink.getAttribute("disabled")==false){isUnLink.setAttribute("disabled","true")}}if(isUnLink.getAttribute("disabled")=="false"||isUnLink.getAttribute("disabled")==null){isUnLink.setAttribute("disabled","true")}if(range.collapsed){text.removeAttribute("disabled");text.value=""}else{text.setAttribute("disabled","true");if(browser.version<9){text.value=editor.selection.getIERange().text.toString()}else{text.value=editor.selection.getText().trim()}}}if(editor.options.openJumpCtrl){var jUrl="",jumpType=0,jumpIde="",jumpName="",mJIde="",mJName="",mJUrl;if(link){jUrl=link.getAttribute("data_ue_src")||link.getAttribute("href",2);jumpType=link.getAttribute("_t")||link.getAttribute("jumpType");jumpIde=link.getAttribute("_i")||link.getAttribute("jumpIde");jumpName=link.getAttribute("_n")||link.getAttribute("jumpName");mJIde=link.getAttribute("_mi")||link.getAttribute("mJIde");mJName=link.getAttribute("_mn")||link.getAttribute("mJName");mJUrl=link.getAttribute("_mu");if(jumpIde==null){jumpType=0;jumpIde=jUrl}if(jumpName==null){jumpName=jUrl}}var jumpOptions={inputId:"linkAddressId",moduleType:3,ueditor:true,jumpType:jumpType,jumpIde:jumpIde,jumpUrl:jUrl,jumpName:jumpName,difSource:editor.options.difSource};if(mJIde!=null&&mJIde!=""){jumpOptions.mJIde=mJIde}if(mJName!=null){jumpOptions.mJName=mJName}if(mJUrl!=null){jumpOptions.mJUrl=mJUrl}if(editor.options.isMobi){jumpOptions.fromMobi=true;jumpOptions.frameSrcUrl=top.Mobi.getPreviewWindow().Mobi.getSiteMultiLanguageUrl()}if(editor.options.mobiEditor){jumpOptions.mobiEditor=true}editor.options.jumpCtrlFunc&&editor.options.jumpCtrlFunc(jumpOptions)}else{$G("linkAddressId").value=url?url:""}if(link&&link.target=="_blank"){$G("linkOpenType").value="newWindow"}else{$G("linkOpenType").value="currentWindow"}editor.options.styleSettingOpt={};editor.options.styleHoverSettingOpt={};editor.options.backHoverSettingOpt={};var stylehover=$.parseJSON($(link).attr("stylehover"));var wbackColor_h=$.parseJSON($(link).attr("wbackColor_h"));var linkStyleOptions={wUnderline:true,wBold:false,wfontSize:editor.queryCommandValue("fontSize"),wfontfamily:(link==null)?"line-through":editor.queryCommandValue("fontFamily"),wColor:(link==null)?"#0000EE":editor.queryCommandValue("forecolor"),wbackColor:editor.queryCommandValue("backcolor"),wUnderline_h:stylehover!=null?stylehover.u:true,wBold_h:stylehover!=null?stylehover.b:false,wfontSize_h:stylehover!=null?stylehover.fs:"12px",wfontfamily_h:stylehover!=null?stylehover.ff:"line-through",wColor_h:stylehover!=null?stylehover.c:"#0000EE",wbackColor_h:wbackColor_h!=null?wbackColor_h.bc:"",linkStyleObj:editor.options.styleSettingOpt,linkHoverStyleObj:editor.options.styleHoverSettingOpt,linkbackHoverColorObj:editor.options.backHoverSettingOpt};editor.options.mobiDomainOpt={};var wxMobiDomainOptions={MainMobiDomain:editor.options.mobiDomainOpt};if(link){if($(link).css("textDecoration")=="none"){linkStyleOptions.linkStyleObj.wUnderline=false;linkStyleOptions.wUnderline=false}else{linkStyleOptions.linkStyleObj.wUnderline=true;linkStyleOptions.wUnderline=true}if(domUtils.getElementsByTagName(link,"strong").length==1){linkStyleOptions.wBold=true;linkStyleOptions.linkStyleObj.wBold=true}else{linkStyleOptions.wBold=false;linkStyleOptions.linkStyleObj.wBold=false}}else{var unlink=editor.selection.getStart()}$focus($G("linkAddressId"));if(text.value==""){$($(".edui-popup-body")[1]).css("height","");$("#linkStyle").parent().hide();return}else{if(editor.options.openSetLinkStyle){editor.options.initSetLinkStyle(linkStyleOptions)}}if(editor.options.openWxCententLink){editor.options.initMainMobiDomain(wxMobiDomainOptions)}}}};function hrefStartWith(href,arr){href=href.replace(/^\s+|\s+$/g,"");for(var i=0,ai;ai=arr[i++];){if(href.indexOf(ai)==0){return true}}return false}function $G(id){return document.getElementById(id)}function $focus(node){setTimeout(function(){if(browser.ie){var r=node.createTextRange();r.collapse(false);r.select()}else{node.focus()}},0)}utils.inherits(LinkSetButton,SplitButton)})();(function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,me=this,UIBase=baidu.editor.ui.UIBase,Toolbar=baidu.editor.ui.Toolbar=function(options){this.initOptions(options);this.initToolbar()};Toolbar.prototype={items:null,initToolbar:function(){this.items=this.items||[];this.initUIBase()},add:function(item){this.items.push(item)},getHtmlTpl:function(){var buff=[];var shrinkopenup="";for(var i=0;i<this.items.length;i++){buff[i]=this.items[i].renderHtml()}var editoruiToolbar='<div id="##" width="123" class="edui-toolbar shrinkopenup %%" onselectstart="return false;" onmousedown="return $$._onMouseDown(event, this);">'+buff.join("")+"</div>";return editoruiToolbar},postRender:function(){var box=this.getDom();for(var i=0;i<this.items.length;i++){this.items[i].postRender()}uiUtils.makeUnselectable(box)},_onMouseDown:function(event){var target=event.target||event.srcElement;if(target.id!=="SWFUpload_0"){return false}}};utils.inherits(Toolbar,UIBase)})();(function(){var utils=baidu.editor.utils,domUtils=baidu.editor.dom.domUtils,uiUtils=baidu.editor.ui.uiUtils,UIBase=baidu.editor.ui.UIBase,Popup=baidu.editor.ui.Popup,Stateful=baidu.editor.ui.Stateful,Menu=baidu.editor.ui.Menu=function(options){this.initOptions(options);this.initMenu()};var menuSeparator={renderHtml:function(){return'<div class="edui-menuitem edui-menuseparator"><div class="edui-menuseparator-inner"></div></div>'},postRender:function(){},queryAutoHide:function(){return true}};Menu.prototype={items:null,uiName:"menu",initMenu:function(){this.items=this.items||[];this.initPopup();this.initItems()},initItems:function(){for(var i=0;i<this.items.length;i++){var item=this.items[i];if(item=="-"){this.items[i]=this.getSeparator()}else{if(!(item instanceof MenuItem)){this.items[i]=this.createItem(item)}}}},getSeparator:function(){return menuSeparator},createItem:function(item){return new MenuItem(item)},_Popup_getContentHtmlTpl:Popup.prototype.getContentHtmlTpl,getContentHtmlTpl:function(){if(this.items.length==0){return this._Popup_getContentHtmlTpl()}var buff=[];for(var i=0;i<this.items.length;i++){var item=this.items[i];buff[i]=item.renderHtml()}return('<div class="%%-body">'+buff.join("")+"</div>")},_Popup_postRender:Popup.prototype.postRender,postRender:function(){var me=this;for(var i=0;i<this.items.length;i++){var item=this.items[i];item.ownerMenu=this;item.postRender()}domUtils.on(this.getDom(),"mouseover",function(evt){evt=evt||event;var rel=evt.relatedTarget||evt.fromElement;var el=me.getDom();if(!uiUtils.contains(el,rel)&&el!==rel){me.fireEvent("over")}});this._Popup_postRender()},queryAutoHide:function(el){if(el){if(uiUtils.contains(this.getDom(),el)){return false}for(var i=0;i<this.items.length;i++){var item=this.items[i];if(item.queryAutoHide(el)===false){return false}}}},clearItems:function(){for(var i=0;i<this.items.length;i++){var item=this.items[i];clearTimeout(item._showingTimer);clearTimeout(item._closingTimer);if(item.subMenu){item.subMenu.destroy()}}this.items=[]},destroy:function(){if(this.getDom()){domUtils.remove(this.getDom())}this.clearItems()},dispose:function(){this.destroy()}};utils.inherits(Menu,Popup);var MenuItem=baidu.editor.ui.MenuItem=function(options){this.initOptions(options);this.initUIBase();this.Stateful_init();if(this.subMenu&&!(this.subMenu instanceof Menu)){this.subMenu=new Menu(this.subMenu)}};MenuItem.prototype={label:"",subMenu:null,ownerMenu:null,uiName:"menuitem",alwalysHoverable:true,getHtmlTpl:function(){return'<div id="##" class="%%" stateful onclick="$$._onClick(event, this);"><div class="%%-body">'+this.renderLabelHtml()+"</div></div>"},postRender:function(){var me=this;this.addListener("over",function(){me.ownerMenu.fireEvent("submenuover",me);if(me.subMenu){me.delayShowSubMenu()}});if(this.subMenu){this.getDom().className+=" edui-hassubmenu";this.subMenu.render();this.addListener("out",function(){me.delayHideSubMenu()});this.subMenu.addListener("over",function(){clearTimeout(me._closingTimer);me._closingTimer=null;me.addState("opened")});this.ownerMenu.addListener("hide",function(){me.hideSubMenu()});this.ownerMenu.addListener("submenuover",function(t,subMenu){if(subMenu!==me){me.delayHideSubMenu()}});this.subMenu._bakQueryAutoHide=this.subMenu.queryAutoHide;this.subMenu.queryAutoHide=function(el){if(el&&uiUtils.contains(me.getDom(),el)){return false}return this._bakQueryAutoHide(el)}}this.getDom().style.tabIndex="-1";uiUtils.makeUnselectable(this.getDom());this.Stateful_postRender()},delayShowSubMenu:function(){var me=this;if(!me.isDisabled()){me.addState("opened");clearTimeout(me._showingTimer);clearTimeout(me._closingTimer);me._closingTimer=null;me._showingTimer=setTimeout(function(){me.showSubMenu()},250)}},delayHideSubMenu:function(){var me=this;if(!me.isDisabled()){me.removeState("opened");clearTimeout(me._showingTimer);if(!me._closingTimer){me._closingTimer=setTimeout(function(){if(!me.hasState("opened")){me.hideSubMenu()}me._closingTimer=null},400)}}},renderLabelHtml:function(){return'<div class="edui-arrow"></div><div class="edui-box edui-icon"></div><div class="edui-box edui-label %%-label">'+(this.label||"")+"</div>"},getStateDom:function(){return this.getDom()},queryAutoHide:function(el){if(this.subMenu&&this.hasState("opened")){return this.subMenu.queryAutoHide(el)}},_onClick:function(event,this_){if(this.hasState("disabled")){return}if(this.fireEvent("click",event,this_)!==false){if(this.subMenu){this.showSubMenu()}else{Popup.postHide()}}},showSubMenu:function(){var rect=uiUtils.getClientRect(this.getDom());rect.right-=5;rect.left+=2;rect.width-=7;rect.top-=4;rect.bottom+=4;rect.height+=8;this.subMenu.showAnchorRect(rect,true,true)},hideSubMenu:function(){this.subMenu.hide()}};utils.inherits(MenuItem,UIBase);utils.extend(MenuItem.prototype,Stateful,true)})();(function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,Menu=baidu.editor.ui.Menu,SplitButton=baidu.editor.ui.SplitButton,Combox=baidu.editor.ui.Combox=function(options){this.initOptions(options);this.initCombox()};Combox.prototype={uiName:"combox",initCombox:function(){var me=this;this.items=this.items||[];for(var i=0;i<this.items.length;i++){var item=this.items[i];item.uiName="listitem";item.index=i;item.onclick=function(){me.selectByIndex(this.index)}}this.popup=new Menu({items:this.items,uiName:"list",editor:this.editor});this.initSplitButton()},_SplitButton_postRender:SplitButton.prototype.postRender,postRender:function(){this._SplitButton_postRender();this.setLabel(this.label||"");this.setValue(this.initValue||"")},showPopup:function(){var rect=uiUtils.getClientRect(this.getDom());rect.top+=1;rect.bottom-=1;rect.height-=2;this.popup.showAnchorRect(rect)},getValue:function(){return this.value},setValue:function(value){var index=this.indexByValue(value);if(index!=-1){this.selectedIndex=index;this.setLabel(this.items[index].label);this.value=this.items[index].value}else{this.selectedIndex=-1;this.setLabel(this.getLabelForUnknowValue(value));this.value=value}},setLabel:function(label){},getLabelForUnknowValue:function(value){return value},indexByValue:function(value){for(var i=0;i<this.items.length;i++){if(value==this.items[i].value){return i}}return -1},getItem:function(index){return this.items[index]},selectByIndex:function(index){if(index<this.items.length&&this.fireEvent("select",index)!==false){this.selectedIndex=index;this.value=this.items[index].value;this.setLabel(this.items[index].label)}},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"><div '+(this.title?'title="'+this.title+'"':"")+' id="##_state" stateful><div class="%%-body"><div id="##_button_body" class="edui-box edui-button-body" onclick="$$._onArrowClick(event, this);"><div class="edui-box edui-icon"></div></div></div></div></div>'}};utils.inherits(Combox,SplitButton)})();(function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,Popup=baidu.editor.ui.Popup,SplitButton=baidu.editor.ui.SplitButton,data={},FontsizeSlider=baidu.editor.ui.FontsizeSlider=function(options){this.initOptions(options);this.initFontsizeSlider();data=options};var $fontsizeInput;var scale=2;FontsizeSlider.prototype={uiName:"combox",initFontsizeSlider:function(){var me=this;this.popup=new Popup({content:getContent(),uiName:"fontsizeSlider",editor:this.editor});this.popup.editor.addListener("popupCanHide",function(){me.popup._hidden=false});this.popup.editor.addListener("popupCanNotHide",function(){me.popup._hidden=true});this.initSplitButton()},showPopup:function(){var bindFlag=false;if($("#"+this.popup.id+"_slider").find(".fontsizeSliderBtn").length<1){bindFlag=true}var rect=uiUtils.getClientRect(this.getDom());rect.top+=1;rect.bottom-=1;rect.height-=2;this.popup.showAnchorRect(rect);if(bindFlag){bindSlider($("#"+this.popup.id+"_slider").find(".fontsizeSliderBtn"),$("#"+this.popup.id+"_slider").find(".fontsizeInput"))}},getValue:function(){var $btn=$("#"+this.popup.id+"_slider").find(".fontsizeInput");if($btn.length<1){return data.initValue+"px"}return $btn.val()+"px"},setValue:function(value){var tmp=parseInt(value);var $btn=$("#"+this.popup.id+"_slider").find(".fontsizeSliderBtn");var $input=$("#"+this.popup.id+"_slider").find(".fontsizeInput");if(!$input.data("edit")){$btn.css({left:parseInt((tmp-data.minValue)*scale)+"px"});$input.val(tmp)}},getHtmlTpl:function(){return""}};utils.inherits(FontsizeSlider,SplitButton);function getContent(){var html=[];html.push('<div id="##_slider" class="fontsizeSlider">');html.push('<input type="text" maxlength="2" value="12" class="fontsizeInput" />');html.push('<label class="fontsizeLabel">px</label>');html.push('<div class="fontsizeSliderBarContainer">');html.push('<div class="fontsizeSliderBar"></div>');html.push('<div class="fontsizeSliderBtn"></div>');html.push("</div>");html.push("</div>");return html.join("")}function bindSlider(obj,inputObj){$fontsizeInput=$(inputObj);$(obj).draggable("destroy");checkData();$(obj).css({left:parseInt((data.initValue-data.minValue)*scale)+"px"});$(inputObj).val(data.initValue);$(obj).draggable({axis:"x",containment:"parent",grid:[scale,0],scroll:false,creat:sliderCreat,start:sliderStart,drag:sliderDrag,stop:sliderStop});$(inputObj).keyup(function(){var inputVal=$(this).val();if($.isNumeric(inputVal)){if(inputVal<data.minValue){$(obj).css({left:"0"})}else{if(inputVal>data.maxValue){$(obj).css({left:parseInt((data.maxValue-data.minValue)*scale)+"px"})}else{$(obj).css({left:parseInt((inputVal-data.minValue)*scale)+"px"})}}}}).focusin(function(){$(this).data("edit",1)}).focusout(function(){var inputVal=$(this).val();$(this).data("edit",0);if($.isNumeric(inputVal)){if(inputVal<data.minValue){inputVal=data.minValue;Fai.ing("字号范围在12-60之间",true)}else{if(inputVal>data.maxValue){inputVal=data.maxValue;Fai.ing("字号范围在12-60之间",true)}}}else{Fai.ing("字号范围在12-60之间",true);inputVal=data.minValue}$(this).val(inputVal);$(obj).css({left:parseInt((inputVal-data.minValue)*scale)+"px"});editor.fireEvent("fontsizeChange")})}function sliderCreat(event,ui){if(!!$fontsizeInput){$fontsizeInput=$(ui.helper).parent().siblings(".fontsizeInput")}}function sliderStart(event,ui){editor.fireEvent("popupCanNotHide");var displayNum=parseInt(ui.position.left/scale)+parseInt(data.minValue);$fontsizeInput.val(displayNum);editor.fireEvent("fontsizeChange")}function sliderDrag(event,ui){var displayNum=parseInt(ui.position.left/scale)+parseInt(data.minValue);$fontsizeInput.val(displayNum);editor.fireEvent("fontsizeChange")}function sliderStop(event,ui){var displayNum=parseInt(ui.position.left/scale)+parseInt(data.minValue);if(displayNum<data.minValue){displayNum=data.minValue;$(ui.helper).css({left:parseInt((displayNum-data.minValue)*scale)+"px"})}else{if(displayNum>data.maxValue){displayNum=data.maxValue;$(ui.helper).css({left:parseInt((displayNum-data.minValue)*scale)+"px"})}}$fontsizeInput.val(displayNum);editor.fireEvent("fontsizeChange");editor.fireEvent("popupCanHide")}function checkData(){if(data.initValue<data.minValue){data.initValue=data.minValue}if(data.initValue>data.maxValue){data.initValue=data.maxValue}}})();(function(){var utils=baidu.editor.utils,domUtils=baidu.editor.dom.domUtils,uiUtils=baidu.editor.ui.uiUtils,Mask=baidu.editor.ui.Mask,UIBase=baidu.editor.ui.UIBase,Button=baidu.editor.ui.Button,Dialog=baidu.editor.ui.Dialog=function(options){this.initOptions(utils.extend({autoReset:true,draggable:true,onok:function(){},oncancel:function(){},onclose:function(t,ok){return ok?this.onok():this.oncancel()}},options));this.initDialog()};var modalMask;var dragMask;Dialog.prototype={draggable:false,uiName:"dialog",initDialog:function(){var me=this;this.initUIBase();this.modalMask=(modalMask||(modalMask=new Mask({className:"edui-dialog-modalmask"})));this.dragMask=(dragMask||(dragMask=new Mask({className:"edui-dialog-dragmask"})));this.closeButton=new Button({className:"edui-dialog-closebutton",title:me.closeDialog,onclick:function(){me.close(false)}});if(this.buttons){for(var i=0;i<this.buttons.length;i++){if(!(this.buttons[i] instanceof Button)){this.buttons[i]=new Button(this.buttons[i])}}}},fitSize:function(){var popBodyEl=this.getDom("body");var size=this.mesureSize();popBodyEl.style.width=size.width+"px";popBodyEl.style.height=size.height+"px";return size},safeSetOffset:function(offset){var me=this;var el=me.getDom();var vpRect=uiUtils.getViewportRect();var rect=uiUtils.getClientRect(el);var left=offset.left;if(left+rect.width>vpRect.right){left=vpRect.right-rect.width}var top=offset.top;if(top+rect.height>vpRect.bottom){top=vpRect.bottom-rect.height}el.style.left=Math.max(left,0)+"px";el.style.top=Math.max(top,0)+"px"},showAtCenter:function(){this.getDom().style.display="";var vpRect=uiUtils.getViewportRect();var popSize=this.fitSize();var titleHeight=this.getDom("titlebar").offsetHeight|0;var left=vpRect.width/2-popSize.width/2;var top=vpRect.height/2-(popSize.height-titleHeight)/2-titleHeight;var popEl=this.getDom();this.safeSetOffset({left:Math.max(left|0,0),top:Math.max(top|0,0)});if(!domUtils.hasClass(popEl,"edui-state-centered")){popEl.className+=" edui-state-centered"}this._show()},getContentHtml:function(){var contentHtml="";if(typeof this.content=="string"){contentHtml=this.content}else{if(this.iframeUrl){contentHtml='<span id="'+this.id+'_contmask" class="dialogcontmask"></span><iframe id="'+this.id+'_iframe" class="%%-iframe" height="100%" width="100%" frameborder="0" src="'+this.iframeUrl+'"></iframe>'}}return contentHtml},getHtmlTpl:function(){var footHtml="";if(this.buttons){var buff=[];for(var i=0;i<this.buttons.length;i++){buff[i]=this.buttons[i].renderHtml()}footHtml='<div class="%%-foot"><div id="##_buttons" class="%%-buttons">'+buff.join("")+"</div></div>"}return'<div id="##" class="%%"><div class="%%-wrap"><div id="##_body" class="%%-body"><div class="%%-shadow"></div><div id="##_titlebar" class="%%-titlebar"><div class="%%-draghandle" onmousedown="$$._onTitlebarMouseDown(event, this);"><span class="%%-caption">'+(this.title||"")+"</span></div>"+this.closeButton.renderHtml()+'</div><div id="##_content" class="%%-content">'+(this.autoReset?"":this.getContentHtml())+"</div>"+footHtml+"</div></div></div>"},postRender:function(){if(!this.modalMask.getDom()){this.modalMask.render();this.modalMask.hide()}if(!this.dragMask.getDom()){this.dragMask.render();this.dragMask.hide()}var me=this;this.addListener("show",function(){me.modalMask.show(this.getDom().style.zIndex-2)});this.addListener("hide",function(){me.modalMask.hide()});if(this.buttons){for(var i=0;i<this.buttons.length;i++){this.buttons[i].postRender()}}domUtils.on(window,"resize",function(){setTimeout(function(){if(!me.isHidden()){me.safeSetOffset(uiUtils.getClientRect(me.getDom()))}})});this._hide()},mesureSize:function(){var body=this.getDom("body");var width=uiUtils.getClientRect(this.getDom("content")).width;var dialogBodyStyle=body.style;dialogBodyStyle.width=width;return uiUtils.getClientRect(body)},_onTitlebarMouseDown:function(evt,el){if(this.draggable){var rect;var vpRect=uiUtils.getViewportRect();var me=this;uiUtils.startDrag(evt,{ondragstart:function(){rect=uiUtils.getClientRect(me.getDom());me.getDom("contmask").style.visibility="visible";me.dragMask.show(me.getDom().style.zIndex-1)},ondragmove:function(x,y){var left=rect.left+x;var top=rect.top+y;me.safeSetOffset({left:left,top:top})},ondragstop:function(){me.getDom("contmask").style.visibility="hidden";domUtils.removeClasses(me.getDom(),["edui-state-centered"]);me.dragMask.hide()}})}},reset:function(){this.getDom("content").innerHTML=this.getContentHtml()},_show:function(){if(this._hidden){this.getDom().style.display="";this.editor.container.style.zIndex&&(this.getDom().style.zIndex=this.editor.container.style.zIndex*1+10);this._hidden=false;this.fireEvent("show");baidu.editor.ui.uiUtils.getFixedLayer().style.zIndex=this.getDom().style.zIndex-4}},isHidden:function(){return this._hidden},_hide:function(){if(!this._hidden){this.getDom().style.display="none";this.getDom().style.zIndex="";this._hidden=true;this.fireEvent("hide")}},open:function(){if(this.autoReset){try{this.reset()}catch(e){this.render();this.open()}}this.showAtCenter();if(this.iframeUrl){try{this.getDom("iframe").focus()}catch(ex){}}},_onCloseButtonClick:function(evt,el){this.close(false)},close:function(ok){if(this.fireEvent("close",ok)!==false){this._hide()}}};utils.inherits(Dialog,UIBase)})();(function(){var _internal=baidu.editor._internal=function(tid){var parent=window.self;dialog=parent.$EDITORUI[tid];editor=dialog.editor;UE=parent.UE;domUtils=UE.dom.domUtils;utils=UE.utils;browser=UE.browser;ajax=UE.ajax;$G=function(id){return document.getElementById(id)};$focus=function(node){setTimeout(function(){if(browser.ie){var r=node.createTextRange();r.collapse(false);r.select()}else{node.focus()}},0)};lang=UE.I18N[editor.options.lang][dialog.className.split("-")[2]];utils.domReady(function(){var langImgPath=editor.options.langPath+editor.options.lang+"/images/";for(var i in lang["static"]){var dom=$G(i);if(!dom){continue}var tagName=dom.tagName,content=lang["static"][i];if(content.src){content=utils.extend({},content,false);content.src=langImgPath+content.src}if(content.style){content=utils.extend({},content,false);content.style=content.style.replace(/url\s*\(/g,"url("+langImgPath)}switch(tagName.toLowerCase()){case"var":dom.parentNode.replaceChild(document.createTextNode(content),dom);break;case"select":var ops=dom.options;for(var j=0,oj;oj=ops[j];){oj.innerHTML=content.options[j++]}for(var p in content){p!="options"&&dom.setAttribute(p,content[p])}break;default:domUtils.setAttributes(dom,content)}}})}})();(function(){_inserttable=baidu.editor._inserttable=function(tableId){var inputs=document.getElementsByTagName("input"),me=this,selects=[];selects.push(document.getElementById("align"));selects.push(document.getElementById("borderType"));for(var i=0,ci;ci=inputs[i++];){switch(ci.id){case"numRows":case"numCols":ci.value=5;break;case"bgColor":ci.value="";break;case"borderColor":ci.value="#000000";break;case"border":ci.value=1;break;case"cellSpacing":ci.value="0";break;case"cellPadding":ci.value="";break;default:}}for(var i=0,ci;ci=selects[i++];){ci.options[0].selected=true}var state=editor.queryCommandState("edittable");if(state==0){var range=editor.selection.getRange(),table=domUtils.findParentByTagName(range.startContainer,"table",true);if(table){var numRows=table.rows.length,cellCount=0;for(var i=0,ri;ri=table.rows[i++];){var tmpCellCount=0;for(var j=0,cj;cj=ri.cells[j++];){if(cj.style.display!="none"){tmpCellCount++}}cellCount=Math.max(tmpCellCount,cellCount)}domUtils.setAttributes($G("numRows"),{value:numRows,disabled:true});domUtils.setAttributes($G("numCols"),{value:cellCount,disabled:true});$G("cellPadding").value=table.getAttribute("cellPadding")||"";$G("cellSpacing").value=table.getAttribute("cellSpacing")||"0";var value=table.getAttribute("width");value=!value?["",table.offsetWidth]:/%$/.test(value)?value.match(/(\d+)(%)?/):["",value.replace(/px/i,"")];$G("ueditorWidth").value=value[1];value=table.getAttribute("height");value=!value?["",""]:/%$/.test(value)?value.match(/(\d+)(%)?/):["",value.replace(/px/i,"")];$G("ueditorHeight").value=value[1];$G("borderColor").value=(table.getAttribute("borderColor")||"#000000").toUpperCase();$G("border").value=table.getAttribute("border");for(var i=0,ip,opts=$G("align").options;ip=opts[i++];){if(ip.value==(table.getAttribute("align")||"").toLowerCase()){ip.selected=true;break}}$G("borderType").options[table.getAttribute("borderType")=="1"?1:0].selected=true;$G("bgColor").value=(table.getAttribute("bgColor")||"").toUpperCase();createTable()}}else{$focus($G("numRows"))}var init=function(){addColorPickListener();addPxChangeListener();addFloatListener();addBorderTypeChangeListener();addCommCellPaddingChangeListener()};function addBorderTypeChangeListener(){domUtils.on($G("borderType"),"change",createTable)}function addCommCellPaddingChangeListener(){}function addFloatListener(){domUtils.on($G("align"),"change",function(){setTablePosition(this.value)})}function setTablePosition(value){var table=$G("preview").children[0],margin=(table.parentNode.offsetWidth-table.offsetWidth)/2;if(value=="center"){table.style.marginLeft=margin+"px"}else{if(value=="right"){table.style.marginLeft=2*margin-5+"px"}else{table.style.marginLeft="5px"}}}function addPxChangeListener(){var ids=["border","cellPadding","cellSpacing"];for(var i=0,ci;ci=$G(ids[i++]);){domUtils.on(ci,"keyup",function(){$G("message").style.display="none";switch(this.id){case"border":$G("border").value=filter(this.value,"border");break;case"cellPadding":$G("cellPadding").value=filter(this.value,"cellPadding");break;case"cellSpacing":$G("cellSpacing").value=filter(this.value,"cellSpacing");break;default:}createTable()})}}function isNum(str){return/^(0|[1-9][0-9]*)$/.test(str)}function createTable(){var border=$G("border").value||1,borderColor=$G("borderColor").value||"#000000",cellPadding=$G("cellPadding").value||"",cellSpacing=$G("cellSpacing").value||0,bgColor=$G("bgColor").value||"#FFFFFF",align=$G("align").value||"",borderType=$G("borderType").value||0;border=setMax(border,5);cellPadding=setMax(cellPadding,5);cellSpacing=setMax(cellSpacing,5);var html=["<table "];if(cellSpacing>0){html.push(' style="border-collapse:separate; border:'+(border||1)+"px solid "+(borderColor||"#000000")+';"')}else{html.push(' style="border-collapse:collapse; border:'+(border||1)+"px solid "+(borderColor||"#000000")+';"')}if(borderType=="1"){html.push(' frame="box" rules="none" ')}cellSpacing>0&&html.push(' cellSpacing="'+cellSpacing+'" ');html.push(' border="'+(border||1)+'" borderColor="'+(borderColor||"#000000")+'"');bgColor&&html.push(' bgColor="'+bgColor+'"');html.push(' ><tr><td colspan="3" style="width:90px;">'+lang["static"]["lang_forPreview"]+"</td></tr><tr><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr></table>");var preview=$G("preview");preview.innerHTML=html.join("");var table=preview.firstChild;for(var i=0,td,tds=domUtils.getElementsByTagName(table,"td");td=tds[i++];){td.style.padding=cellPadding+"px";td.style.borderColor=borderType=="1"?"":borderColor}setTablePosition(align.toLowerCase())}function setMax(value,max){return value>max?max:value}function filter(value,property){var maxPreviewValue=5,maxValue=10;if(!isNum(value)&&value!=""){$G(property).value="";$G("message").style.display="";$G("messageContent").innerHTML=lang.errorNum;return property=="border"?1:0}if(value>maxPreviewValue){$G("message").style.display="";$G("messageContent").innerHTML=lang.overflowPreviewMsg.replace("{#value}",maxPreviewValue);if(value>maxValue){$G("messageContent").innerHTML=lang.overflowMsg.replace("{#value}",maxValue);$G(property).value=maxValue;return maxValue}}return value}function addColorPickListener(){var colorPicker=getColorPicker(),ids=["bgColor","borderColor"];for(var i=0,ci;ci=$G(ids[i++]);){domUtils.on(ci,"click",function(){var me=this;showColorPicker(colorPicker,me);colorPicker.content.onpickcolor=function(t,color){me.value=color.toUpperCase();colorPicker.hide();createTable()};colorPicker.content.onpicknocolor=function(){me.value="";colorPicker.hide();createTable()}});domUtils.on(ci,"keyup",function(){colorPicker.hide();createTable()})}domUtils.on(document,"mousedown",function(){})}function getColorPicker(){return new UE.ui.Popup({content:new UE.ui.ColorPicker({noColorText:lang.noColor,editor:editor})})}function showColorPicker(colorPicker,anchorObj){colorPicker.showAnchor(anchorObj)}init();domUtils.on($G("ueditorWidth"),"keyup",function(){var value=this.value;if(value>100){}});domUtils.on($G("ueditorHeight"),"keyup",function(){var value=this.value;if(value>100){}});$("#tablewrapper_id").find("button")[0].onclick=function(){for(var i=0,opt={},ci;ci=inputs[i++];){switch(ci.id){case"numRows":case"numCols":case"ueditorHeight":case"ueditorWidth":if(ci.value&&!/^[1-9]+[0-9]*$/.test(parseInt(ci.value))){alert(lang.errorNum);$focus(ci);return false}ci.value?ci.value=parseInt(ci.value):"";break;case"cellspacing":case"cellpadding":case"border":if(ci.value&&!/^[0-9]*$/.test(ci.value)){alert(lang.errorNum);$focus(ci);return false}break;case"bgColor":case"borderColor":if(ci.value&&!/^#(?:[0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/.test(ci.value)){alert(lang.errorColor);$focus(ci);return false}break;default:}opt[ci.id]=ci.value||(ci.id=="border"?0:"")}for(var i=0,ci;ci=selects[i++];){opt[ci.id]=ci.value.toUpperCase()}if(opt.numCols.replace(/(^\s*)|(\s*$)/g,"")==""||opt.numRows.replace(/(^\s*)|(\s*$)/g,"")==""){Fai.ing("行数或者列数不能为空！",true);return false}editor.execCommand(state==-1?"inserttable":"edittable",opt);var dialog="";if(tableId.dialogId){dialog=window.self.$EDITORUI[tableId.dialogId]}else{dialog=window.self.$EDITORUI[tableId.id]}dialog.close(true)};$("#tablewrapper_id").find("button")[1].onclick=function(){var dialog="";if(tableId.dialogId){dialog=window.self.$EDITORUI[tableId.dialogId]}else{dialog=window.self.$EDITORUI[tableId.id]}dialog.close(true)}}})();(function(){var utils=baidu.editor.utils,Menu=baidu.editor.ui.Menu,SplitButton=baidu.editor.ui.SplitButton,MenuButton=baidu.editor.ui.MenuButton=function(options){this.initOptions(options);this.initMenuButton()};MenuButton.prototype={initMenuButton:function(){var me=this;this.uiName="menubutton";this.popup=new Menu({items:me.items,className:me.className,editor:me.editor});this.popup.addListener("show",function(){var list=this;for(var i=0;i<list.items.length;i++){list.items[i].removeState("checked");if(list.items[i].value==me._value){list.items[i].addState("checked");this.value=me._value}}});this.initSplitButton()},setValue:function(value){this._value=value},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"><div '+(this.title?'title="'+this.title+'"':"")+' id="##_state" stateful><div class="%%-body"><div id="##_button_body" class="edui-box edui-button-body" onclick="$$._onArrowClick(event, this);"><div class="edui-box edui-icon"></div></div></div></div></div>'}};utils.inherits(MenuButton,SplitButton)})();(function(){var utils=baidu.editor.utils;var editorui=baidu.editor.ui;var _Dialog=editorui.Dialog;editorui.Dialog=function(options){var dialog=new _Dialog(options);dialog.addListener("hide",function(){if(dialog.editor){var editor=dialog.editor;try{if(browser.gecko){var y=editor.window.scrollY,x=editor.window.scrollX;editor.body.focus();editor.window.scrollTo(x,y)}else{editor.focus()}}catch(ex){}}});return dialog};var iframeUrlMap={insertimage:"/manage/fileUploadV2.jsp",inserttable:"~//js/comm/ueditor/dialogs/table/table.html",edittd:"~//js/comm/ueditor/dialogs/table/table.html"};var btnCmds=["bold","italic","underline","undo","redo","source","indent","strikethrough","selectall","pasteplain","pagebreak","horizontal","subscript","superscript","zhspace","deletetable","insertparagraphbeforetable","insertrow","deleterow","insertcol","deletecol","mergecells","mergeright","mergedown","splittocells","splittorows","splittocols"];for(var i=0,ci;ci=btnCmds[i++];){ci=ci.toLowerCase();editorui[ci]=function(cmd){return function(editor){var ui=new editorui.Button({className:"edui-for-"+cmd,title:editor.options.labelMap[cmd]||editor.getLang("labelMap."+cmd)||"",onclick:function(){editor.execCommand(cmd)},showText:false});editor.addListener("selectionchange",function(type,causeByUi,uiReady){var state=editor.queryCommandState(cmd);if(state==-1){ui.setDisabled(true);ui.setChecked(false)}else{if(!uiReady){ui.setDisabled(false);ui.setChecked(state)}}});return ui}}(ci)}for(var i=0,ci;ci=["backcolor","forecolor"][i++];){editorui[ci]=function(cmd){return function(editor){var ui=new editorui.ColorButton({className:"edui-for-"+cmd,color:"default",title:editor.options.labelMap[cmd]||editor.getLang("labelMap."+cmd)||"",editor:editor,onpickcolor:function(t,color){editor.execCommand(cmd,color)},onpicknocolor:function(){editor.execCommand(cmd,"default");this.setColor("transparent");this.color="default"},onbuttonclick:function(){editor.execCommand(cmd,this.color)}});editor.addListener("selectionchange",function(){ui.setDisabled(editor.queryCommandState(cmd)==-1)});return ui}}(ci)}var dialogBtns={noOk:[],ok:["link","insertimage"]};for(var p in dialogBtns){(function(type,vals){for(var i=0,ci;ci=vals[i++];){if(browser.opera&&ci==="searchreplace"){continue}(function(cmd){editorui[cmd]=function(editor,iframeUrl,title){iframeUrl=iframeUrl||(editor.options.iframeUrlMap||{})[cmd]||iframeUrlMap[cmd];title=editor.options.labelMap[cmd]||editor.getLang("labelMap."+cmd)||"";var dialog;if(iframeUrl){dialog=new editorui.Dialog(utils.extend({iframeUrl:editor.ui.mapUrl(iframeUrl),editor:editor,className:"edui-for-"+cmd,title:title,closeDialog:editor.getLang("closeDialog")},type=="ok"?{buttons:[{className:"edui-okbutton",label:editor.getLang("ok"),onclick:function(){dialog.close(true)}},{className:"edui-cancelbutton",label:editor.getLang("cancel"),onclick:function(){dialog.close(false)}}]}:{}));editor.ui._dialogs[cmd+"Dialog"]=dialog}var ui=new editorui.Button({className:"edui-for-"+cmd,title:title,onclick:function(){if(dialog){switch(cmd){case"wordimage":editor.execCommand("wordimage","word_img");if(editor.word_img){dialog.render();dialog.open()}break;case"scrawl":if(editor.queryCommandState("scrawl")!=-1){dialog.render();dialog.open()}break;default:dialog.render();dialog.open()}}},disabled:cmd=="scrawl"&&editor.queryCommandState("scrawl")==-1});editor.addListener("selectionchange",function(){var unNeedCheckState={edittd:1,edittable:1};if(cmd in unNeedCheckState){return}var state=editor.queryCommandState(cmd);ui.setDisabled(state==-1);ui.setChecked(state)});return ui}})(ci.toLowerCase())}})(p,dialogBtns[p])}editorui.justifyright=function(editor){var vals=editor.options.wordagejustify,_onMenuClick=function(){editor.execCommand("justify",this.value)},items=[];for(var i in vals){items.push({label:vals[i],value:i,onclick:_onMenuClick})}var ui=new editorui.MenuButton({editor:editor,className:"edui-for-justifyjustify",title:"段落对齐",items:items,onbuttonclick:function(){var value=editor.queryCommandValue("justify");editor.execCommand("justify",value)}});editor.addListener("selectionchange",function(){var state=editor.queryCommandState("justify");if(state==-1){ui.setDisabled(true)}else{ui.setDisabled(false);var value=editor.queryCommandValue("justify");ui.setValue(value);ui.setChecked(state)}});return ui};editorui.swfuploadword=function(editor){if(!editor.options.swfuploadSrc){editor.options.swfuploadSrc=""}var script=document.createElement("script");script.type="text/javascript";script.src=editor.options.swfuploadSrc;document.getElementsByTagName("head")[0].appendChild(script);function uploadProgress(options){if(options.status=="start"){$("#showNewUploadFileContent").removeClass("startToUpload");var tr2=['<div id="progressBody_'+options.id+'" class="bodyDisable_1"></div>','<div id="progressWrap_'+options.id+'" class="bodyProgressWrap_1">','<div class="progressCenter"></div>','<div class="progressIngBody_1">','<div class="progressIngTitle">'+options.title+"  正在导入...</div>",'<div class="progressIngMission">','<div class="mission"><div id="progress" class="progress"></div></div>','<div id="progressNum" class="progressNum">100%</div>',"</div>",'<div class="progressInfo"><span class="progressFileSize">文件大小:'+Fai.parseFileSize(options.size)+'</span><a class="progressCancel">取消</a></div>',"</div>","</div>"];$("body").append(tr2.join(""));$("#progressWrap_"+options.id+" .progressCancel").live("click",function(){var opt={status:"end",id:options.id};uploadProgress(opt);if(typeof(editor.swfObj)!="undefined"){editor.swfObj.cancelUpload()}isCancel=true})}else{if(options.status=="ing"){$("#progress").css("width",options.percent+"%");$("#progressNum").html(options.percent+"%")}else{if(options.status=="end"){$("#progressBody_"+options.id).remove();$("#progressWrap_"+options.id).remove()}else{if(options.status=="error"){$("#progress").addClass("progressError")}}}}}editor.swfObj,setting_objects={file_post_name:"Filedata",upload_url:"/static/web/ajax/updocx.jsp?cmd=add",button_placeholder_id:"ueditor_swfuploadButton",file_size_limit:"20MB",file_types:"*.doc;*.docx;",button_width:20,button_height:20,button_image_url:editor.options.UEDITOR_HOME_URL+"/image/word.png",upload_start_handler:function(file){var tmpOptions={status:"start",id:file.id,title:file.name,size:file.size};uploadProgress(tmpOptions);isCancel=false;if(typeof editor.options.ueditorChangeEvent=="function"){editor.options.ueditorChangeEvent()}},file_queue_error_handler:function(file,errCode,message){switch(errCode){case SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:Fai.ing("导入word文档不能超过20MB",true);break;case SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE:Fai.ing("不允许0字节文件",true);break;case SWFUpload.QUEUE_ERROR.INVALID_FILETYPE:Fai.ing("不允许的文件类型",true);break;default:Fai.ing("系统错误",true);break}},file_dialog_complete_handler:function(selectFilesNum,queuedFilesNum){if(queuedFilesNum>0){this.startUpload()}},upload_success_handler:function(file,result){var data=jQuery.parseJSON(result);if(data.success){!isCancel&&Fai.ing("word文档 "+file.name+" 导入成功",true);var html=editor.getContent();if($(data.docx).length>0&&$(data.docx).find(".window1")[0]){html+=isCancel?"":$(data.docx).find(".window1")[0].innerHTML}editor.setContent(html);if($("#progress").length>0){var tmpOptions={status:"end",id:file.id,title:file.name};uploadProgress(tmpOptions)}editor.fireEvent("contentchange")}else{Fai.ing("word文档"+file.name+"，"+(data.msg?data.msg:"文件已经损坏"),true);var tmpOptions={status:"error",id:file.id,title:file.name,size:file.size};uploadProgress(tmpOptions)}},view_progress:function(file,bytesLoaded,bytesTotal,percent){if($("#progress").length>0){var tmpOptions={status:"ing",percent:percent,id:file.id,title:file.name,size:file.size};uploadProgress(tmpOptions)}}};var ui=new editorui.Button({postRender:function(){this.Stateful_postRender();this.setDisabled(this.disabled);script.onload=script.onreadystatechange=function(){setTimeout(function(){editor.swfObj=SWFUploadCreator.create(setting_objects)},0)}},getHtmlTpl:function(){return'<div id="##" class="edui-box %% edui-for-swfupload"><div id="##_state" stateful><div class="%%-wrap"><div id="##_body" style="height:20px;width:20px;" unselectable="on" title="word文档导入"class="%%-body"><div class="edui-box edui-icon"><span id="ueditor_swfuploadButton"></span></div></div></div></div></div>'},_onArrowClick:function(event,el){},_onButtonClick:function(){}});editor.addListener("selectionchange",function(){var state=editor.queryCommandState("swfuploadword");if(state==-1){ui.setDisabled(true)}else{ui.setDisabled(false)}});return ui};editorui.fontfamily=function(editor,list,title){list=editor.options.fontfamily||[];title=editor.options.labelMap.fontfamily||editor.getLang("labelMap.fontfamily")||"";for(var i=0,ci,items=[];ci=list[i];i++){items.push({label:ci.second,value:ci.first,renderLabelHtml:function(){return'<div class="edui-label %%-label" style="font-family:'+utils.unhtml(this.value)+'">'+(this.label||"")+"</div>"}})}var ui=new editorui.Combox({editor:editor,items:items,getHtmlTpl:function(){return'<div id="##" class="edui-box %%"><div '+(this.title?'title="'+this.title+'"':"")+' id="##_state" stateful><div class="%%-body"><div id="##_button_body" class="edui-box edui-button-body" onclick="$$._onButtonClick(event, this);"><div class="edui-box edui-icon '+this.className+'_background "></div></div></div></div></div>'},onselect:function(t,index){editor.execCommand("FontFamily",this.items[index].value);editor.options.outerFunction.logFontFamilyUse&&editor.options.outerFunction.logFontFamilyUse(this.items[index].value)},onbuttonclick:function(){this.showPopup()},title:title,initValue:title,className:"edui-for-fontfamily",indexByValue:function(value){if(value){for(var i=0,ci;ci=this.items[i];i++){if(ci.value.indexOf(value)!=-1){return i}}}return -1}});editor.addListener("selectionchange",function(type,causeByUi,uiReady){if(!uiReady){var state=editor.queryCommandState("FontFamily");if(state==-1){ui.setDisabled(true)}else{ui.setDisabled(false);var value=editor.queryCommandValue("FontFamily");value&&(value=value.replace(/['"]/g,"").split(",")[0]);ui.setValue(value)}}});return ui};editorui.qqface=function(editor){var ui=new editorui.QQFacerButton({editor:editor,title:editor.options.labelMap.qqface||editor.getLang("labelMap.qqface")||"",className:"edui-for-qqface",onbuttonclick:function(){editor.execCommand("qqface")}});editor.addListener("selectionchange",function(){ui.setDisabled(editor.queryCommandState("qqface")==-1)});return ui};editorui.fontsize=function(editor,list,title){title=editor.options.labelMap.fontsize||editor.getLang("labelMap.fontsize")||"";list=list||editor.options.fontsize||[];if(!!!editor.options.useDefaultFontsizeComBox){var ui=new editorui.FontsizeSlider({editor:editor,title:title,initValue:12,minValue:12,maxValue:60,getHtmlTpl:function(){return'<div id="##" class="edui-box %%"><div '+(this.title?'title="'+this.title+'"':"")+' id="##_state" stateful><div class="%%-body"><div id="##_button_body" class="edui-box edui-button-body" onclick="$$._onButtonClick(event, this);"><div class="edui-box edui-icon '+this.className+'_background "></div></div></div></div></div>'},onbuttonclick:function(){this.showPopup();editor.fireEvent("selectionchange")},className:"edui-for-fontsize"});editor.addListener("selectionchange",function(type,causeByUi,uiReady){if(!uiReady){var state=editor.queryCommandState("FontSize");if(state==-1){ui.setDisabled(true)}else{ui.setDisabled(false);ui.setValue(editor.queryCommandValue("FontSize"))}}});editor.addListener("fontsizeChange",function(type,causeByUi,uiReady){if(!uiReady){var state=editor.queryCommandState("FontSize");if(state==-1){ui.setDisabled(true)}else{ui.setDisabled(false);editor.execCommand("FontSize",ui.getValue())}}});return ui}else{var items=[];for(var i=0;i<list.length;i++){var size=list[i]+"px";items.push({label:size,value:size,renderLabelHtml:function(){return'<div class="edui-label %%-label" style="line-height:1;font-size:'+this.value+'">'+(this.label||"")+"</div>"}})}var ui=new editorui.Combox({editor:editor,items:items,title:title,initValue:title,getHtmlTpl:function(){return'<div id="##" class="edui-box %%"><div '+(this.title?'title="'+this.title+'"':"")+' id="##_state" stateful><div class="%%-body"><div id="##_button_body" class="edui-box edui-button-body" onclick="$$._onButtonClick(event, this);"><div class="edui-box edui-icon '+this.className+'_background "></div></div></div></div></div>'},onselect:function(t,index){editor.execCommand("FontSize",this.items[index].value)},onbuttonclick:function(){this.showPopup()},className:"edui-for-fontsize"});editor.addListener("selectionchange",function(type,causeByUi,uiReady){if(!uiReady){var state=editor.queryCommandState("FontSize");if(state==-1){ui.setDisabled(true)}else{ui.setDisabled(false);ui.setValue(editor.queryCommandValue("FontSize"))}}});return ui}};editorui.edittd=function(editor,iframeUrl,title){iframeUrl=iframeUrl||(editor.options.iframeUrlMap||{})["edittd"]||iframeUrlMap.edittd;title=editor.options.labelMap.edittd||editor.getLang("labelMap.edittd")||"";var dialog;if(iframeUrl){dialog=new editorui.Dialog({iframeUrl:editor.ui.mapUrl(iframeUrl),editor:editor,className:"edui-for-edittd",title:title,closeDialog:editor.getLang("closeDialog"),getContentHtml:function(){var contentHtml="";var iframeContent="";if(typeof this.content=="string"){contentHtml=this.content}else{if(this.iframeUrl){contentHtml='<span id="'+this.id+'_contmask" class="dialogcontmask"></span><div id="'+this.id+'divContetnt" ></div>'}}return contentHtml},reset:function(){this.getDom("content").innerHTML=this.getContentHtml()},open:function(){if(this.autoReset){try{this.reset()}catch(e){this.render();this.open()}}this.showAtCenter();this.insertIframeHtml();baidu.editor._internal(this.id);this._insettd();if(typeof editor.options.ueditorChangeEvent=="function"){editor.options.ueditorChangeEvent()}},_insettd:function(){var me=this;addColorPickListener();$("#"+me.id+"_edittd_id").find("button")[0].onclick=function(){var tdItem={bgColor:$G(me.id+"bgColor").value||"",align:$G(me.id+"align").value||"",vAlign:$G(me.id+"vAlign").value||""};editor.execCommand("edittd",tdItem);var dialog=window.self.$EDITORUI[me.id];dialog.close(true)};$("#"+me.id+"_edittd_id").find("button")[1].onclick=function(){var dialog=window.self.$EDITORUI[me.id];dialog.close(true)};(function(){if(!editor.currentSelectedArr.length){var range=editor.selection.getRange();var td=domUtils.findParentByTagName(range.startContainer,"td",true);var table=domUtils.findParentByTagName(range.startContainer,"table",true);if(td){$G(me.id+"bgColor").value=(td.bgColor||table.bgColor||"#FFFFFF").toUpperCase();$G(me.id+"align").value=td.align||"";$G(me.id+"vAlign").value=td.vAlign||""}}})();function addColorPickListener(){var colorPicker=getColorPicker(),ids=[me.id+"bgColor"];for(var i=0,ci;ci=$G(ids[i++]);){domUtils.on(ci,"click",function(){var me=this;showColorPicker(colorPicker,me);colorPicker.content.onpickcolor=function(t,color){me.value=color.toUpperCase();colorPicker.hide()};colorPicker.content.onpicknocolor=function(){me.value="";colorPicker.hide()}});domUtils.on(ci,"keyup",function(){colorPicker.hide()})}domUtils.on(document,"mousedown",function(){})}function getColorPicker(){return new UE.ui.Popup({content:new UE.ui.ColorPicker({noColorText:lang.noColor,editor:editor})})}function showColorPicker(colorPicker,anchorObj){colorPicker.showAnchor(anchorObj)}},insertIframeHtml:function(){var iframe=document.getElementById(this.id+"divContetnt");$("#"+this.id).parent().css("z-index","1000");document.getElementById(this.id+"_content").style.backgroundColor="#ffffff";var iframeContent=['<table id="'+this.id+'_edittd_id" style=" margin: 0px 10px 5px 10px;font-size: 12px">','<tr style="height: 25px">','<td width="70"><span class="strong" style="font-weight: bold;"><var id="lang_background"></var></span></td>','<td><input id="'+this.id+'bgColor" style="width: 110px;border: 1px solid #ccc;" type="text"></td>',"</tr>",'<tr style="height: 25px">','<td rowspan="2"><span class="strong" style="font-weight: bold;"><var id="lang_alignment"></var></span></td>','<td><var id="lang_horizontal"></var>：<select style="width: 76px;margin-left:6px\9;" id="'+this.id+'align">','<option value="">默认</option>','<option value="center">居中</option>','<option value="left">居左</option>','<option value="right">居右</option>',"</select>","</td>",'</tr style="height: 25px">','<tr style="height: 25px">','<td><var id="lang_vertical"></var>：<select style="width: 76px;margin-left:6px\9;" id="'+this.id+'vAlign">','<option value="">默认</option>','<option value="middle">居中</option>','<option value="top">顶端对齐</option>','<option value="bottom">底端对齐</option>',"</select>","</td>","</tr>",'<tr style="height: 25px">',"<td>",'<button style=" height: 24px;width: 76px;font-size: 12px;line-height: 18px;text-align: center;cursor: pointer;line-height: 18px;">确定</button>',"</td>","<td>",'<button style=" height: 24px;width: 76px;margin-left: 35px;font-size: 12px;line-height: 18px;text-align: center;cursor: pointer;line-height: 18px;">取消</button>',"</td>","</tr>","</table>"];iframe.innerHTML=iframeContent.join("");$("#"+this.id+"_body").before(' <iframe style="position:absolute;z-index:-1;left:0;top:0;background-color: white;" frameborder="0" width="100%" height="100%" src="javascript:"></iframe>')}});dialog.render();editor.ui._dialogs.edittdDialog=dialog}var ui=new editorui.Button({className:"edui-for-edittd",title:title,onclick:function(){if(dialog){dialog.render();dialog.open()}}});editor.addListener("selectionchange",function(){var unNeedCheckState={edittd:1,edittable:1};if("edittd" in unNeedCheckState){return}var state=editor.queryCommandState("edittd");ui.setDisabled(state==-1);ui.setChecked(state)});editor.addListener("selectionchange",function(type,causeByUi,uiReady){var state=editor.queryCommandState("edittd");if(state==-1){ui.setDisabled(true);ui.setChecked(false)}else{if(!uiReady){ui.setDisabled(false);ui.setChecked(state)}}});return ui};editorui.inserttable=function(editor,iframeUrl,title){iframeUrl=iframeUrl||(editor.options.iframeUrlMap||{})["inserttable"]||iframeUrlMap.inserttable;var ueditorUrl=iframeUrl;title=editor.options.labelMap.inserttable||editor.getLang("labelMap.inserttable")||"";if(iframeUrl){var dialog=new editorui.Dialog({iframeUrl:editor.ui.mapUrl(iframeUrl),editor:editor,className:"edui-for-inserttable",title:title,getContentHtml:function(){var contentHtml="";var iframeContent="";if(typeof this.content=="string"){contentHtml=this.content}else{if(this.iframeUrl){contentHtml='<span id="'+this.id+'_contmask" class="dialogcontmask"></span><div id="'+this.id+'divContetnt" ></div>'}}return contentHtml},reset:function(){this.getDom("content").innerHTML=this.getContentHtml()},open:function(){if(this.autoReset){try{this.reset()}catch(e){this.render();this.open()}}this.showAtCenter();if(this.iframeUrl){try{this.getDom("iframe").focus()}catch(ex){}}this.insertIframeHtml()},alterTableOpen:function(){if(this.autoReset){try{this.reset()}catch(e){this.render();this.open()}}this.showAtCenter();this.insertIframeHtml();baidu.editor._internal(this.id);baidu.editor._inserttable(this);if(typeof editor.options.ueditorChangeEvent=="function"){editor.options.ueditorChangeEvent()}},insertIframeHtml:function(){var iframe=document.getElementById(this.id+"divContetnt");$("#"+this.id).parent().css("z-index","1000");if(browser.version<9){document.getElementById(this.id+"_body").style.height="332px"}else{document.getElementById(this.id+"_body").style.height="352px"}document.getElementById(this.id+"_body").style.backgroundColor="#ffffff";var iframeContent=['<div class="wrapper" id="tablewrapper_id" style="height: 305px;background-color:#ffffff;">','<fieldset  class="base">','<legend style="margin-left: 5px; font-weight: bold;font-size: 12px;color: #0066cc;"><var id="lang_baseInfo"></var></legend>','<table style="margin-left: 5px;float: left;">',"<tr>",'<td width="120"><label for="numRows"><var id="lang_rows"></var>：</label><input id="numRows" maxLength="2" value="5" type="text" style="width: 50px;border:1px solid #ccc;" /> <var id="lang_rowUnit"></var></td>',"<td>",'<label for="ueditorWidth"><var id="lang_width"></var>：</label><input id="ueditorWidth" type="text" style="width: 50px;border:1px solid #ccc;" />','<label for="ueditorWidthUnit"> px</label>',"</td>","</tr>","<tr>",'<td><label for="numCols"><var id="lang_cols"></var>：</label><input id="numCols" maxLength="2" value="5" type="text" style="width: 50px;border:1px solid #ccc;" /> <var id="lang_colUnit"></var></td>',"<td>",'<label for="ueditorHeight"><var id="lang_height"></var>：</label><input id="ueditorHeight" type="text" style="width: 50px;border:1px solid #ccc;" />','<label for="ueditorHeightUnit"> px</label>',"</select>","</td>","</tr>","</table>",'<div id="message" style="display: none">','<p><var id="lang_warmPrompt"></var>：</p>','<p id="messageContent"><var id="lang_maxPadding"></var></p>',"</div>","</fieldset>","<div>",'<fieldset  class="extend">','<legend style="color: #0066cc;font-weight: bold;"><var id="lang_extendInfo"></var><span style="font-weight: normal;">(<var id="lang_preview"></var>)</span></legend>',"<table>","<tr>",'<td width="60"><span class="bold"><var id="lang_tableBorder"></var></span>：</td>','<td><label for="border"><var id="lang_borderSize"></var>: </label><input id="border" type="text" style="width: 50px;border:1px solid #ccc;" /> px&nbsp;</td>','<td><label for="borderColor"><var id="lang_borderColor"></var>: </label><input id="borderColor" type="text" style="width: 55px;border:1px solid #ccc;" /></td>',"</tr>",'<tr style="border-bottom: 1px solid #ddd">','<td><span class="bold"><var id="lang_mar_pad"></var></span>：</td>','<td><label for="cellPadding"><var id="lang_margin"></var>：</label><input id="cellPadding" type="text" style="width: 50px;border:1px solid #ccc;" /> px&nbsp;</td>','<td><label for="cellSpacing"><var id="lang_padding"></var>：</label><input id="cellSpacing" type="text" style="width: 55px;border:1px solid #ccc;" /> px </td>',"</tr>","<tr>",'<td colspan="3"><span class="bold"><var id="lang_table_background"></var></span>：','<input id="bgColor" type="text" style="width: 90px;border:1px solid #ccc;" />',"</td>","</tr>","<tr>",'<td colspan="3"><span class="bold"><var id="lang_table_alignment"></var></span>：','<select id="align" style="width: 92px">','<option value=""></option>','<option value="center"></option>','<option value="left"></option>','<option value="right"></option>',"</select>","</td>","</tr>","<tr>",'<td colspan="3">','<span class="bold"><var id="lang_borderFor"></var></span>：','<select id="borderType">','<option value="0"></option>','<option value="1"></option>',"</select>","</td>","</tr>","</table>","</fieldset>",'<div id="preview">','<table border="1" borderColor="#000" cellpadding="0" cellspacing="0" style="border-collapse: collapse;">','<tr><td colspan="3" style="width:90px;"><var id="lang_forPreview"></var></td></tr>',"<tr><td></td><td></td><td></td></tr>","<tr><td></td><td></td><td></td></tr>","</table>","</div>","</div>",'<div style="float: right;margin-right: 30px; _width:200px;_margin-right:0px;">','<button style=" height: 24px;margin-right: 20px;width: 76px;font-size: 12px;line-height: 18px;text-align: center;cursor: pointer;line-height: 18px;">确定</button>','<button style=" height: 24px;width: 76px;font-size: 12px;line-height: 18px;text-align: center;cursor: pointer;line-height: 18px;">取消</button>',"</div>","</div>"];iframe.innerHTML=iframeContent.join("");if($("#"+this.id+"_body").parent().find(">iframe").length==0){$("#"+this.id+"_body").before(' <iframe style="position:absolute;z-index:-1;left:0;top:0;background-color: white;" frameborder="0" width="100%" height="100%" src="javascript:"></iframe>')}}});dialog.render();editor.ui._dialogs.inserttableDialog=dialog}var openDialog=function(){if(dialog){if(browser.webkit){dialog.open();dialog.close()}dialog.open()}};var ui=new editorui.TableButton({dialogId:dialog.id,editor:editor,title:title,className:"edui-for-inserttable",onpicktable:function(t,numCols,numRows){editor.execCommand("InsertTable",{numRows:numRows,numCols:numCols,border:1})},onmore:openDialog,onbuttonclick:openDialog});editor.addListener("selectionchange",function(){ui.setDisabled(editor.queryCommandState("inserttable")==-1)});return ui};editorui.shrinkopenup=function(editor){var title=editor.options.labelMap.shrinkopenup||editor.getLang("labelMap.shrinkopenup")||"";var me=this;var ui=new editorui.Button({className:"edui-for-shrinkopenup",title:title,onclick:function(){var shrinkopenupDom=this.getDom(),toolbarDom=shrinkopenupDom.parentNode,eduiBody=document.getElementById(this.id+"_body"),eduiIcon=$("#"+this.id+" .edui-icon");if(domUtils.hasClass(toolbarDom,"shrinkopenup")){domUtils.removeClasses(toolbarDom,"shrinkopenup");var toolBarsHeight=toolbarDom.offsetHeight,editorBodyHeight=editor.iframe.clientHeight;editor.iframe.parentNode.style.height=editorBodyHeight-Math.floor(toolBarsHeight/2)+"px";eduiBody.title="收缩";eduiIcon.css("background-position","-850px -42px");toolbarDom.style.height=toolbarDom.offsetHeight+"px"}else{var toolBarsHeight=toolbarDom.offsetHeight,editorBodyHeight=editor.iframe.clientHeight;editor.iframe.parentNode.style.height=editorBodyHeight+Math.floor(toolBarsHeight/2)+"px";eduiBody.title="展开";eduiIcon.css("background-position","-830px -42px");domUtils.addClass(toolbarDom,"shrinkopenup");toolbarDom.style.height=""}}});editor.addListener("selectionchange",function(){ui.setDisabled(editor.queryCommandState("shrinkopenup")==-1)});return ui};editorui.removeformat=function(editor){var val=editor.options.removeformatSelect;for(var i=0,ci,items=[];ci=val[i++];){items.push({label:ci,value:ci,onclick:function(){editor.execCommand("removeformat","","","","",this.value)}})}var ui=new editorui.MenuButton({editor:editor,className:"edui-for-removeformat",title:editor.getLang("labelMap.removeformat")||"",items:items,onbuttonclick:function(){var value=editor.queryCommandValue("removeformat")||this.value;editor.execCommand("removeformat","","","","",value)}});editor.addListener("selectionchange",function(){var state=editor.queryCommandState("removeformat");if(state==-1){ui.setDisabled(true)}else{ui.setDisabled(false);var value=editor.queryCommandValue("removeformat");value&&ui.setValue((value+"").replace(/cm/,""));ui.setChecked(state)}});return ui};editorui.link=function(editor){var ui=new editorui.LinkSetButton({editor:editor,title:editor.options.labelMap.link||editor.getLang("labelMap.link")||"",className:"edui-for-link",onbuttonclick:function(){editor.execCommand("link")}});editor.addListener("selectionchange",function(){ui.setDisabled(editor.queryCommandState("link")==-1)});return ui};editorui.phone=function(editor){var ui=new editorui.PhoneSetButton({editor:editor,title:editor.options.labelMap.phone||editor.getLang("labelMap.phone")||"",className:"edui-for-phone"});editor.addListener("selectionchange",function(){ui.setDisabled(editor.queryCommandState("phoneservice")==-1)});return ui};editorui.qqservice=function(editor){var ui=new editorui.QQSetButton({editor:editor,title:editor.options.labelMap.qqservice||editor.getLang("labelMap.qqservice")||"",className:"edui-for-qqservice"});editor.addListener("selectionchange",function(){ui.setDisabled(editor.queryCommandState("qqservice")==-1)});return ui};editorui.flash=function(editor){var ui=new editorui.FlashSetButton({editor:editor,title:editor.options.labelMap.flash||editor.getLang("labelMap.flash")||"",className:"edui-for-flash"});editor.addListener("selectionchange",function(){ui.setDisabled(editor.queryCommandState("flash")==-1)});return ui};var imageFun=["insertimage","image"];for(var i=0,ci;ci=imageFun[i++];){editorui[ci]=function(editor){var ui=new editorui.UpLoadImgSetButton({editor:editor,title:editor.options.labelMap.insertimage||editor.getLang("labelMap.insertimage")||"",className:"edui-for-insertimage"});editor.addListener("selectionchange",function(){ui.setDisabled(editor.queryCommandState("insertimage")==-1)});return ui}}editorui.hoverimage=function(editor){var ui=new editorui.UploadHoverImgSetButton({className:"edui-for-hoverimage",title:editor.options.labelMap.hoverimage||editor.getLang("labelMap.hoverimage")||"",editor:editor});editor.addListener("selectionchange",function(){ui.setDisabled(editor.queryCommandState("hoverimage")==-1)});return ui};editorui.fullscreen=function(editor,title){title=editor.options.labelMap.fullscreen||editor.getLang("labelMap.fullscreen")||"";var ui=new editorui.Button({className:"edui-for-fullscreen",title:title,onclick:function(){if(editor.ui){editor.ui.setFullScreen(!editor.ui.isFullScreen())}this.setChecked(editor.ui.isFullScreen())}});editor.addListener("selectionchange",function(){var state=editor.queryCommandState("fullscreen");ui.setDisabled(state==-1);ui.setChecked(editor.ui.isFullScreen())});return ui};editorui.insertmp4=function(editor,title){title=editor.options.labelMap.insertmp4||editor.getLang("labelMap.insertmp4")||"";var ui=new editorui.Button({className:"edui-for-insertmp4",title:title,onclick:function(){editor.options.htmlChoiceMP4&&editor.options.htmlChoiceMP4(editor)}});editor.addListener("selectionchange",function(){ui.setDisabled(editor.queryCommandState("insertmp4")==-1)});return ui};var rowspacings=["top","bottom"];for(var r=0,ri;ri=rowspacings[r++];){(function(cmd){editorui["rowspacing"+cmd]=function(editor){var val=editor.options["rowspacing"+cmd];for(var i=0,ci,items=[];ci=val[i++];){items.push({label:ci,value:ci,onclick:function(){editor.execCommand("rowspacing",this.value,cmd)}})}var ui=new editorui.MenuButton({editor:editor,className:"edui-for-rowspacing"+cmd,title:editor.options.labelMap["rowspacing"+cmd]||editor.getLang("labelMap.rowspacing"+cmd)||"",items:items,onbuttonclick:function(){var value=editor.queryCommandValue("rowspacing",cmd)||this.value;editor.execCommand("rowspacing",value,cmd)}});editor.addListener("selectionchange",function(){var state=editor.queryCommandState("rowspacing",cmd);if(state==-1){ui.setDisabled(true)}else{ui.setDisabled(false);var value=editor.queryCommandValue("rowspacing",cmd);value&&ui.setValue((value+"").replace(/%/,""));ui.setChecked(state)}});return ui}})(ri)}editorui.lineheight=function(editor){var val=editor.options.lineheight;for(var i=0,ci,items=[];ci=val[i++];){items.push({label:ci,value:ci,onclick:function(){editor.execCommand("lineheight",this.value)}})}var ui=new editorui.MenuButton({editor:editor,className:"edui-for-lineheight",title:editor.options.labelMap.lineheight||editor.getLang("labelMap.lineheight")||"",items:items,onbuttonclick:function(){var value=editor.queryCommandValue("LineHeight")||this.value;editor.execCommand("LineHeight",value)}});editor.addListener("selectionchange",function(){var state=editor.queryCommandState("LineHeight");if(state==-1){ui.setDisabled(true)}else{ui.setDisabled(false);var value=editor.queryCommandValue("LineHeight");value&&ui.setValue((value+"").replace(/cm/,""));ui.setChecked(state)}});return ui};var lists=["insertorderedlist","insertunorderedlist"];for(var l=0,cl;cl=lists[l++];){(function(cmd){editorui[cmd]=function(editor){var vals=editor.options[cmd],_onMenuClick=function(){editor.execCommand(cmd,this.value)},items=[];for(var i in vals){items.push({label:vals[i]||editor.getLang()[cmd][i]||"",value:i,onclick:_onMenuClick})}var ui=new editorui.MenuButton({editor:editor,className:"edui-for-"+cmd,title:editor.getLang("labelMap."+cmd)||"",items:items,onbuttonclick:function(){var value=editor.queryCommandValue(cmd)||this.value;editor.execCommand(cmd,value)}});editor.addListener("selectionchange",function(){var state=editor.queryCommandState(cmd);if(state==-1){ui.setDisabled(true)}else{ui.setDisabled(false);var value=editor.queryCommandValue(cmd);ui.setValue(value);ui.setChecked(state)}});return ui}})(cl)}})();(function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,UIBase=baidu.editor.ui.UIBase,domUtils=baidu.editor.dom.domUtils;function EditorUI(options){this.initOptions(options);this.initEditorUI()}EditorUI.prototype={uiName:"editor",initEditorUI:function(){this.editor.ui=this;this._dialogs={};this.initUIBase();this._initToolbars();var editor=this.editor,me=this;editor.addListener("ready",function(){editor.getDialog=function(name){return editor.ui._dialogs[name+"Dialog"]};domUtils.on(editor.window,"scroll",function(){baidu.editor.ui.Popup.postHide()});if(editor.options.elementPathEnabled){editor.ui.getDom("elementpath").innerHTML='<div class="edui-editor-breadcrumb">'+editor.getLang("elementPathTip")+":</div>"}if(editor.options.wordCount){editor.ui.getDom("wordcount").innerHTML=editor.getLang("wordCountTip");editor.addListener("keyup",function(type,evt){var keyCode=evt.keyCode||evt.which;if(keyCode==32){me._wordCount()}})}if(!editor.options.elementPathEnabled&&!editor.options.wordCount){editor.ui.getDom("elementpath").style.display="none";editor.ui.getDom("wordcount").style.display="none"}if(!editor.selection.isFocus()){return}editor.fireEvent("selectionchange",false,true)});editor.addListener("mousedown",function(t,evt){if(evt.button==2&&typeof editor.options.ueditorChangeEvent=="function"){editor.options.ueditorChangeEvent()}var el=evt.target||evt.srcElement;baidu.editor.ui.Popup.postHide(el)});editor.addListener("contextmenu",function(t,evt){baidu.editor.ui.Popup.postHide()});editor.addListener("selectionchange",function(){if(editor.options.elementPathEnabled){me[(editor.queryCommandState("elementpath")==-1?"dis":"en")+"ableElementPath"]()}if(editor.options.wordCount){me[(editor.queryCommandState("wordcount")==-1?"dis":"en")+"ableWordCount"]()}});var popup=new baidu.editor.ui.Popup({editor:editor,content:"",className:"edui-tool4",_onEditButtonClick:function(){this.hide();editor.ui._dialogs.linkDialog.open()},_onImgEditButtonClick:function(name){this.hide();editor.ui._dialogs[name]&&editor.ui._dialogs[name].open()},_onImgSetFloat:function(value){this.hide();editor.execCommand("imagefloat",value)},_setIframeAlign:function(value){var frame=popup.anchorEl;var newFrame=frame.cloneNode(true);switch(value){case -2:newFrame.setAttribute("align","");break;case -1:newFrame.setAttribute("align","left");break;case 1:newFrame.setAttribute("align","right");break;case 2:newFrame.setAttribute("align","middle");break}frame.parentNode.insertBefore(newFrame,frame);domUtils.remove(frame);popup.anchorEl=newFrame;popup.showAnchor(popup.anchorEl)},_updateIframe:function(){editor._iframe=popup.anchorEl;editor.ui._dialogs.insertframeDialog.open();popup.hide()},_onRemoveButtonClick:function(cmdName){editor.execCommand(cmdName);this.hide()},queryAutoHide:function(el){if(el&&el.ownerDocument==editor.document){if(el.tagName.toLowerCase()=="img"||domUtils.findParentByTagName(el,"a",true)){return el!==popup.anchorEl}}return baidu.editor.ui.Popup.prototype.queryAutoHide.call(this,el)},_changeImageAttr:function(img){},_showImageAttr:function(){var imagePanel=document.getElementById("tool4edit-panel");imagePanel.style.display="block"},_removeImage:function(){}});popup.render();editor.addListener("mouseover click",function(t,event){var conditionalNode=null;if(browser.version<9){if(!event.srcElement){return}conditionalNode=event.srcElement.tagName}else{if(!event.target){return}conditionalNode=event.target.nodeName}if(conditionalNode&&(conditionalNode.toLowerCase()=="img"||conditionalNode.toLowerCase()=="embed"||conditionalNode.toLowerCase()=="video"||conditionalNode.toLowerCase()=="object")){var img=null;if(browser.version<9){img=event.srcElement}else{img=event.target}if(img.getAttribute("_hidetool")){return}var hasHoverImage=$(img).hasClass("hoverImage")||$(img).hasClass("J_hoverImage");if(hasHoverImage){var parent=$(img).parent();img=$(parent).find(".hoverImage")[0]}var tool=$("#tool4edit-container"),init_image_describe=Fai.encodeHtml(img.title),init_image_width=img.style.width.replace("px",""),init_image_height=img.style.height.replace("px",""),autoplay=$(img).attr("autoplay")?true:false,loop=$(img).attr("loop")?true:false;if(tool.length>1){return}if(init_image_width==""&&init_image_height==""){init_image_width=img.width==0?"":img.width;init_image_height=img.height==0?"":img.height}modifyImageTips=[];modifyImageTips.push('<div id="tool4edit-container" class="tool4edit-container"');modifyImageTips.push(" >");modifyImageTips.push('<div class="tool4edit tool4edit-body '+(hasHoverImage?"tool4edit-hoverImage-body":"")+'">');modifyImageTips.push('<div class="tool4edit" style="_background-color:#ffffff">');modifyImageTips.push('<iframe style="position:absolute;z-index:-1;left:0;top:0;background-color: white;" frameborder="0" width="100%" height="100%" src="javascript:"></iframe>');modifyImageTips.push('<span class="tool4edit tool4edit-imagefloat-button" title="位置"></span>');modifyImageTips.push('<div class="tool4-imagefloat-panel" style="display:none; ">');modifyImageTips.push('<div class="edui-popup-content" style="width:93px;height:81px; _height:95px; ">');modifyImageTips.push('<iframe style="position:absolute;z-index:-1;left:0;top:0;background-color: white;" frameborder="0" width="100%" height="100%" src="javascript:"></iframe>');modifyImageTips.push('<div class="tool4editImage">');modifyImageTips.push('<div class="imageItem imageItemDefault" pos="none"><span class="tool4imagefloat imagedefault"></span><span class="spanname">默认</span></div>');modifyImageTips.push('<div class="imageItem imageItemCenter" pos="center"><span class="tool4imagefloat imagecenter"></span><span  class="spanname">居中</span></div>');modifyImageTips.push('<div class="imageItem imageItemLeft" pos="left"><span class="tool4imagefloat imageroundleft"></span><span  class="spanname">左环绕</span></div>');modifyImageTips.push('<div class="imageItem imageItemRight" pos="right"><span class="tool4imagefloat imageroundright"></span><span  class="spanname">右环绕</span></div>');modifyImageTips.push("</div></div>");modifyImageTips.push("</div>");modifyImageTips.push("</div>");if(hasHoverImage){modifyImageTips.push('<div class="tool4edit" style="_background-color:#ffffff">');modifyImageTips.push('<span class="tool4edit tool4edit-hoverImage-button" title="修改鼠标悬停图片"></span>');modifyImageTips.push('<iframe style="position:absolute;z-index:-1;left:0;top:0;background-color: white;" frameborder="0" width="100%" height="100%" src="javascript:"></iframe>');modifyImageTips.push('<div class="tool4-hoverImage-panel" style="display:none; ">');modifyImageTips.push('<div class="edui-popup-content" style="width: 128px; height: 82px; _height:80px;">');modifyImageTips.push('<iframe style="position:absolute; z-index:-1; left:0; top:0; background-color: white;" frameborder="0" width="100%" height="100%" src="javascript:"></iframe>');modifyImageTips.push('<div class="tool4editImage">');modifyImageTips.push('<div style="font-size: 12px; color: #000; height: 82px; margin-top: 6px; margin-left: 6px;">');modifyImageTips.push('<div class="insertHoverImg defImg" style="width: 114px; height: 20px; line-height: 20px; margin-bottom: 4px;">');modifyImageTips.push('<div style="width: 80px; float: left;">默认图片</div>');modifyImageTips.push("<img class='J_hoverThumbImg' src='' width='34' height='20' style='float: left; cursor: pointer;' />");modifyImageTips.push("</div>");modifyImageTips.push('<div class="insertHoverImg hovImg" style="width: 114px; height: 20px; line-height: 20px; margin-bottom: 11px;">');modifyImageTips.push('<div style="width: 80px; float: left;">鼠标悬停图片</div>');modifyImageTips.push("<img class='J_hoverThumbImg' src='' width='34' height='20' style='float: left; cursor: pointer;' />");modifyImageTips.push("</div>");modifyImageTips.push('<div style="width: 100px;height: 23px;margin: 0 auto;">');modifyImageTips.push('<input class=" tool4edit-submit" type="button" value="确定" style="width: 40px; height: 20px; margin-right: 16px;" />');modifyImageTips.push('<input class=" tool4edit-cancel" type="button" value="取消" style="width: 40px; height: 20px;" />');modifyImageTips.push("</div>");modifyImageTips.push("</div>");modifyImageTips.push("</div>");modifyImageTips.push("</div>");modifyImageTips.push("</div>");modifyImageTips.push("</div>")}modifyImageTips.push('<div class="tool4edit" style="_background-color:#ffffff">');modifyImageTips.push('<span class="tool4edit tool4edit-edit-button" title="修改"></span>');modifyImageTips.push('<iframe style="position:absolute;z-index:-1;left:0;top:0;background-color: white;" frameborder="0" width="100%" height="100%" src="javascript:"></iframe>');modifyImageTips.push('<div class="tool4edit-panel" style="display:none; ">');modifyImageTips.push('<div class="edui-popup-content" style="width:280px;'+(editor.options.isMobi?"":"height:auto;")+' _height:85px; ">');modifyImageTips.push('<iframe style="position:absolute;z-index:-1;left:0;top:0;background-color: white;" frameborder="0" width="100%" height="100%" src="javascript:"></iframe>');modifyImageTips.push('<div class="tool4editImage">');if(!editor.options.isMobi){modifyImageTips.push('<div style="margin:2px 0 2px 6px;"><span>宽度</span>：<input value="'+init_image_width+'" class=" tool4edit-width" max-length="4" type="text" />');modifyImageTips.push('<span style="margin-left:7px;">高度</span>：<input value="'+init_image_height+'" class=" tool4edit-height" max-length="4" type="text" />');modifyImageTips.push("</div>")}modifyImageTips.push('<div style="margin:6px 0 2px 6px;">');if(conditionalNode.toLowerCase()=="video"){modifyImageTips.push('<input class=" tool4edit-playVideo" id="autoPlayVideo" type="checkBox" '+(autoplay?"checked=true":"")+' /><label for="autoPlayVideo" style="margin-left:0px;">自动播放</label>');modifyImageTips.push('<input class=" tool4edit-playVideo" id="loopPlayVideo" type="checkBox" '+(loop?"checked=true":"")+'/><label for="loopPlayVideo" style="margin-right:10px;">循环播放</label>')}else{modifyImageTips.push('<span>描述</span>：<input value="'+init_image_describe+'" class=" tool4edit-describe" style="width:120px;*width:122px;" type="text" />')}modifyImageTips.push("</div>");modifyImageTips.push('<div style="margin:6px 0 2px 6px;">');modifyImageTips.push('<span>链接</span>：<input type="text" name="linkAddressSec" id="linkAddressSecId" style="width: 120px;*width:122px;">');modifyImageTips.push('<span id="jumpCtrlToolEdit" class="jumpCtrlUE" style="display: inline-block; margin-left: 5px; padding: 0px 3px;line-height: 22px;" >设置链接</span>');modifyImageTips.push('<input class="tool4edit-submit" type="button" value="确定" style="padding: 0px;margin: 0px 0px 0px 4px;width: 45px;height: 26px;" />');modifyImageTips.push("</div>");modifyImageTips.push("</div></div>");modifyImageTips.push("</div>");modifyImageTips.push("</div>");modifyImageTips.push('<div class="tool4edit" style="_background-color:#ffffff">');modifyImageTips.push('<span class="tool4edit tool4edit-delete-button" title="删除"></span>');modifyImageTips.push("</div>");modifyImageTips.push("</div>");modifyImageTips.push("</div>");var html=popup.formatHtml(modifyImageTips.join(""));if(html){popup.getDom("content").innerHTML=html;popup.anchorEl=img;popup.showImageTool(popup.anchorEl);if(hasHoverImage){var popupContent=popup.getDom("content");var defImg=$(img).attr("_defImg");var hovImg=$(img).attr("_hovImg");var defImgElem=$(popupContent).find("#tool4edit-container .tool4-hoverImage-panel .defImg img");var hovImgElem=$(popupContent).find("#tool4edit-container .tool4-hoverImage-panel .hovImg img");$(defImgElem).attr("src",defImg);$(hovImgElem).attr("src",hovImg)}}else{popup.hide()}$("#tool4edit-container .tool4edit-submit, #loopPlayVideo, #autoPlayVideo").click(function(){var width=$("#tool4edit-container .tool4edit-width").val(),height=$("#tool4edit-container .tool4edit-height").val(),describe=$("#tool4edit-container .tool4edit-describe").val(),autoPlayVideo=$("#autoPlayVideo").prop("checked"),loopPlayVideo=$("#loopPlayVideo").prop("checked"),imgTagName=img.tagName.toLowerCase(),isHoverImage=$(img).hasClass("hoverImage"),linkAddress=$("#tool4edit-container .tool4edit-panel").find("#linkAddressSecId")[0],jumpCtrlUE=$("#tool4edit-container .tool4edit-panel").find("#jumpCtrlToolEdit")[0],link=$(img).parents("a")[0];if(!(imgTagName==="video"&&editor.options.isMobi)){var isWidth=/[^\d]/.test(width);var isHeight=/[^\d]/.test(height);if((isWidth||isHeight)&&!editor.options.isMobi){alert("请输入合法的字符！");return false}$(img).css("width",width);$(img).css("height",height);$(img).removeAttr("width").removeAttr("height")}if(imgTagName=="video"){var object=$(img).find("embed")[0];if(!(imgTagName==="video"&&editor.options.isMobi)){$(object).attr("width",width);$(object).attr("height",height)}if(autoPlayVideo){$(img).attr("autoplay",true)}else{$(img).attr("autoplay",false)}if(loopPlayVideo){$(img).attr("loop",true)}else{$(img).attr("loop",false)}}if(isHoverImage){var oldDefImg=$(img).attr("_defImg");var oldHovImg=$(img).attr("_hovImg");var newDefImg=$(this).parents(".tool4-hoverImage-panel").find(".defImg img").attr("src");var newHovImg=$(this).parents(".tool4-hoverImage-panel").find(".hovImg img").attr("src");var hoverImage=$(img).parent().find(".J_hoverImage");var imageParent=$(img).parent(".J_hoverImageParent");if(oldDefImg!=newDefImg){$(img).attr("src",newDefImg);$(img).attr("_defImg",newDefImg)}if(oldHovImg!=newHovImg){$(img).attr("_hovImg",newHovImg);$(hoverImage).attr("src",newHovImg)}$(hoverImage).attr("title",describe);$(hoverImage).attr("alt",describe);$(hoverImage).css("width",width);$(hoverImage).css("height",height);$(imageParent).css("width",width);$(imageParent).css("height",height)}$(img).attr("title",describe);$(img).attr("alt",describe);var href;var imageParent=isHoverImage?$(img).parents(".J_hoverImageParent")[0]:$(img).parent()[0];var imgIndex=getElementIndex(img);var startContainerOffset=imgIndex;var endContainerOffset=isHoverImage?2:getElementIndex(img)+1;var imageRange=new dom.Range(editor.document).setStart(imageParent,startContainerOffset).setEnd(imageParent,endContainerOffset);if(editor.options.openJumpCtrl){href=jumpCtrlUE.getAttribute("_lurl")?jumpCtrlUE.getAttribute("_lurl").replace(/^\s+|\s+$/g,""):linkAddress.value.replace(/^\s+|\s+$/g,"")}else{href=linkAddress.value.replace(/^\s+|\s+$/g,"")}if(href){var jType=2;if(editor.options.openJumpCtrl){jType=parseInt(jumpCtrlUE.getAttribute("_ltype"))}if(jType===103||jType===2){try{if(top.location.hostname&&href.indexOf("http://"+top.location.hostname)==0){href=href.substring(("http://"+top.location.hostname).length)}}catch(exp){}if(href.length>=1&&href.charAt(0)!="/"&&href.charAt(0)!="#"){if(/^(\w+:).+/.test(href)==false){href="http://"+href}}}var obj={href:href,data_ue_src:href};if(editor.options.openJumpCtrl){obj._t=jumpCtrlUE.getAttribute("_ltype");obj._i=jumpCtrlUE.getAttribute("_lide");obj._n=jumpCtrlUE.getAttribute("_lName")||linkAddress.value;var extJIde=jumpCtrlUE.getAttribute("_extJIde");if(extJIde!=null){obj._mi=extJIde}var extJUrl=jumpCtrlUE.getAttribute("_extJUrl");if(extJUrl!=null){obj._mu=extJUrl;obj["class"]="switchJump"}var extName=jumpCtrlUE.getAttribute("_extJName");if(extName!=null){obj._mn=extName}}imageRange.select();editor.execCommand("link",obj)}if(this.id!=="loopPlayVideo"&&this.id!=="autoPlayVideo"){popup.hide()}if(typeof editor.options.ueditorChangeEvent=="function"){editor.options.ueditorChangeEvent()}function getElementIndex(elem){var prev=elem.previousSibling,index=0;while(prev){prev=prev.previousSibling;index++}return index}});$("#tool4edit-container .tool4edit-cancel").click(function(){popup.hide()});$("#tool4edit-container .tool4edit-edit-button").click(function(){var rect=uiUtils.getClientRect(img),top=rect.top+rect.height-20,iframeRect=uiUtils.getClientRect(editor.iframe),iframeTop=iframeRect.top,tool4editHeight=$("#tool4edit-container .tool4edit-panel").outerHeight(),tool4editWidth=$("#tool4edit-container .tool4edit-panel").outerWidth(),imageOffsetLeft=rect.left,iframeHeight=iframeRect.height,iframeWidth=iframeRect.width;if(top>iframeTop+iframeHeight-tool4editHeight){$("#tool4edit-container .tool4edit-panel").css("top",-tool4editHeight+"px")}var imagefloatPanel=$("#tool4edit-container .tool4-imagefloat-panel");if(imagefloatPanel.css("display")=="block"){imagefloatPanel.css("display","none")}var hoverImagePanel=$("#tool4edit-container .tool4-hoverImage-panel");if(hoverImagePanel.css("display")=="block"){hoverImagePanel.css("display","none")}if($("#img-content").is(":visible")){imageOffsetLeft-=$("#img-content").outerWidth()}if(imageOffsetLeft+tool4editWidth>iframeWidth){$("#tool4edit-container .tool4edit-panel").css("left",-(tool4editWidth-$(this).outerWidth()*2-1)+"px").css("display","block")}else{$("#tool4edit-container .tool4edit-panel").css("left","0px").css("display","block")}initImageLink();function initImageLink(){var tool4editPanel=$("#tool4edit-container .tool4edit-panel"),linkAddress=tool4editPanel.find("#linkAddressSecId")[0],href,url,link=$(img).parents("a")[0];if(editor.options.openJumpCtrl){var jUrl="",jumpType=0,jumpIde="",jumpName="",mJIde="",mJName="";if(link){jUrl=link.getAttribute("data_ue_src")||link.getAttribute("href",2);jumpType=link.getAttribute("_t")||link.getAttribute("jumpType");jumpIde=link.getAttribute("_i")||link.getAttribute("jumpIde");jumpName=link.getAttribute("_n")||link.getAttribute("jumpName");mJIde=link.getAttribute("_mi")||link.getAttribute("mJIde");mJName=link.getAttribute("_mn")||link.getAttribute("mJName");if(jumpIde==null){jumpType=0;jumpIde=jUrl}if(jumpName==null){jumpName=jUrl}}var jumpOptions={inputId:"linkAddressSecId",moduleType:3,ueditor:true,jumpCusUEId:"jumpCtrlToolEdit",jumpType:jumpType,jumpIde:jumpIde,jumpUrl:jUrl,jumpName:jumpName,difSource:editor.options.difSource};if(mJIde!=null&&mJIde!=""){jumpOptions.mJIde=mJIde}if(mJName!=null){jumpOptions.mJName=mJName}if(editor.options.isMobi){jumpOptions.fromMobi=true;jumpOptions.frameSrcUrl=Mobi.getPreviewWindow().Mobi.getSiteMultiLanguageUrl()}if(editor.options.mobiEditor){jumpOptions.mobiEditor=true}editor.options.jumpCtrlFunc&&editor.options.jumpCtrlFunc(jumpOptions)}else{url=link.getAttribute("data_ue_src")||link.getAttribute("href",2);linkAddress.value=url?url:""}}});$("#tool4edit-container .tool4edit-hoverImage-button").click(function(){var rect=uiUtils.getClientRect(img),top=rect.top+rect.height-20,iframeRect=uiUtils.getClientRect(editor.iframe),iframeTop=iframeRect.top,tool4editHeight=$("#tool4edit-container .tool4-hoverImage-panel").outerHeight(),tool4editWidth=$("#tool4edit-container .tool4-hoverImage-panel").outerWidth(),imageOffsetLeft=rect.left,iframeHeight=iframeRect.height,iframeWidth=iframeRect.width;if(top>iframeTop+iframeHeight-tool4editHeight){$("#tool4edit-container .tool4-hoverImage-panel").css("top",-tool4editHeight+"px")}var imagefloatPanel=$("#tool4edit-container .tool4-imagefloat-panel");if(imagefloatPanel.css("display")=="block"){imagefloatPanel.css("display","none")}var editPanel=$("#tool4edit-container .tool4edit-panel");if(editPanel.css("display")=="block"){editPanel.css("display","none")}if(imageOffsetLeft+tool4editWidth>iframeWidth){$("#tool4edit-container .tool4-hoverImage-panel").css("left",-(tool4editWidth-$(this).outerWidth()*2-1)+"px").css("display","block")}else{$("#tool4edit-container .tool4-hoverImage-panel").css("left","0px").css("display","block")}});$("#tool4edit-container .tool4edit-imagefloat-button").click(function(){var rect=uiUtils.getClientRect(img),top=rect.top+rect.height-20,iframeRect=uiUtils.getClientRect(editor.iframe),iframeTop=iframeRect.top,iframeHeight=iframeRect.height,iframeWidth=iframeRect.width,imageOffsetLeft=img.offsetLeft,imagefloatWidth=$("#tool4edit-container .tool4-imagefloat-panel").outerWidth(),imagefloatHeight=$("#tool4edit-container .tool4-imagefloat-panel").outerHeight(),imageFloat=$(img).css("float"),imageCenter=$(img).parent().css("text-align"),isHovImage=$(img).hasClass("hoverImage");if(isHovImage){imageFloat=$(img).parent().css("float");imageCenter=$(img).parent().parent().css("text-align")}if(imageFloat=="left"){$(".tool4-imagefloat-panel .imageItemLeft").addClass("imageItemSelect")}else{if(imageFloat=="right"){$(".tool4-imagefloat-panel .imageItemRight").addClass("imageItemSelect")}else{if(imageCenter=="center"){$(".tool4-imagefloat-panel .imageItemCenter").addClass("imageItemSelect")}else{$(".tool4-imagefloat-panel .imageItemDefault").addClass("imageItemSelect")}}}if(top>iframeTop+iframeHeight-imagefloatHeight){$("#tool4edit-container .tool4-imagefloat-panel").css("top",-imagefloatHeight+"px")}var hoverImagePanel=$("#tool4edit-container .tool4-hoverImage-panel");if(hoverImagePanel.css("display")=="block"){hoverImagePanel.css("display","none")}var editPanel=$("#tool4edit-container .tool4edit-panel");if(editPanel.css("display")=="block"){editPanel.css("display","none")}if(imageOffsetLeft+imagefloatWidth>iframeWidth){$("#tool4edit-container .tool4-imagefloat-panel").css("left",-(imagefloatWidth-$(this).outerWidth()*3-1)+"px")}$("#tool4edit-container .tool4-imagefloat-panel").css("display","block")});$(".tool4-imagefloat-panel .imageItem").click(function(){var range=editor.selection.getRange();range.selectNode(img).select();var cmd=$(this).attr("pos");editor.execCommand("imagefloat",cmd);popup.hide();if(typeof editor.options.ueditorChangeEvent=="function"){editor.options.ueditorChangeEvent()}}).hover(function(){$(this).addClass("imageItemHover")},function(){$(this).removeClass("imageItemHover")});$("#tool4edit-container .tool4edit-delete-button").click(function(){if((img.tagName.toLowerCase()==="embed"||img.tagName.toLowerCase()==="vedio"||img.className==="hoverImage")&&img.parentNode){$(img.parentNode).remove()}else{$(img).remove()}popup.hide();if(typeof editor.options.ueditorChangeEvent=="function"){editor.options.ueditorChangeEvent()}});$("#tool4edit-container .tool4-hoverImage-panel .J_hoverThumbImg").click(function(){var thisImg=this;var upload_setting={title:"替换图片",maxSize:5,type:["jpg","jpeg","bmp","png","gif"],imgMode:2,maxChoiceList:1,netFileMode:true};editor.options.outerFunction.fileUpload2&&editor.options.outerFunction.fileUpload2("",upload_setting,changeHoverImageCallback);function changeHoverImageCallback(result){var str="";if(result){var data=$.parseJSON(result).data;var filePath=data[0].filePath;$(thisImg).attr("src",filePath)}}});domUtils.on(img,"dragstart",function(){if(typeof editor.options.ueditorChangeEvent=="function"){editor.options.ueditorChangeEvent()}},false)}});if(editor.options.imagePopup){editor.addListener("mouseover",function(t,evt){evt=evt||window.event;var el=evt.target||evt.srcElement;if(editor.ui._dialogs.insertframeDialog&&/iframe/ig.test(el.tagName)){var html=popup.formatHtml("<nobr>"+editor.getLang("property")+': <span onclick=$$._setIframeAlign(-2) class="edui-clickable">'+editor.getLang("default")+'</span>&nbsp;&nbsp;<span onclick=$$._setIframeAlign(-1) class="edui-clickable">'+editor.getLang("justifyleft")+'</span>&nbsp;&nbsp;<span onclick=$$._setIframeAlign(1) class="edui-clickable">'+editor.getLang("justifyright")+'</span>&nbsp;&nbsp;<span onclick=$$._setIframeAlign(2) class="edui-clickable">'+editor.getLang("justifycenter")+'</span> <span onclick="$$._updateIframe( this);" class="edui-clickable">'+editor.getLang("modify")+"</span></nobr>");if(html){popup.getDom("content").innerHTML=html;popup.anchorEl=el;popup.showAnchor(popup.anchorEl)}else{popup.hide()}}});editor.addListener("selectionchange",function(t,causeByUi){if(!causeByUi){return}var html="",img=editor.selection.getRange().getClosedNode(),dialogs=editor.ui._dialogs;if(img&&img.tagName=="IMG"&&!img.getAttribute("_hideTool")){var dialogName="insertimageDialog";if(img.className.indexOf("edui-faked-video")!=-1){dialogName="insertvideoDialog"}if(img.className.indexOf("edui-faked-webapp")!=-1){dialogName="webappDialog"}if(img.src.indexOf("http://api.map.baidu.com")!=-1){dialogName="mapDialog"}if(img.src.indexOf("http://maps.google.com/maps/api/staticmap")!=-1){dialogName="gmapDialog"}if(img.getAttribute("anchorname")){dialogName="anchorDialog";html=popup.formatHtml("<nobr>"+editor.getLang("property")+': <span onclick=$$._onImgEditButtonClick("anchorDialog") class="edui-clickable">'+editor.getLang("modify")+"</span>&nbsp;&nbsp;<span onclick=$$._onRemoveButtonClick('anchor') class=\"edui-clickable\">"+editor.getLang("delete")+"</span></nobr>")}if(img.getAttribute("word_img")){editor.word_img=[img.getAttribute("word_img")];dialogName="wordimageDialog"}if(!dialogs[dialogName]){return}}if(editor.ui._dialogs.linkDialog){var link=domUtils.findParentByTagName(editor.selection.getStart(),"a",true);var url;if(link&&(url=(link.getAttribute("data_ue_src")||link.getAttribute("href",2)))){var txt=url;if(url.length>30){txt=url.substring(0,20)+"..."}if(html){html+='<div style="height:5px;"></div>'}html+=popup.formatHtml("<nobr>"+editor.getLang("anthorMsg")+': <a target="_blank" href="'+url+'" title="'+url+'" >'+txt+'</a> <span class="edui-clickable" onclick="$$._onEditButtonClick();">'+editor.getLang("modify")+'</span> <span class="edui-clickable" onclick="$$._onRemoveButtonClick(\'unlink\');"> '+editor.getLang("clear")+"</span></nobr>");popup.showAnchor(link)}}if(html){popup.getDom("content").innerHTML=html;popup.anchorEl=img||link;popup.showAnchor(popup.anchorEl)}else{popup.hide()}})}},_initToolbars:function(){var editor=this.editor;var toolbars=this.toolbars||[];var toolbarUis=[];for(var i=0;i<toolbars.length;i++){var toolbar=toolbars[i];var toolbarUi=new baidu.editor.ui.Toolbar();for(var j=0;j<toolbar.length;j++){var toolbarItem=toolbar[j];var toolbarItemUi=null;if(typeof toolbarItem=="string"){toolbarItem=toolbarItem.toLowerCase();if(toolbarItem=="|"){toolbarItem="Separator"}if(toolbarItem=="||"){toolbarItem="NewlineSeparator"}if(baidu.editor.ui[toolbarItem]){toolbarItemUi=new baidu.editor.ui[toolbarItem](editor)}if(toolbarItem=="shrinkopenup"){if(toolbarUis&&toolbarUis[0]){toolbarUis[0].items.splice(0,0,toolbarItemUi)}else{toolbarItemUi&&toolbarUi.items.splice(0,0,toolbarItemUi)}continue}}else{toolbarItemUi=toolbarItem}if(toolbarItem=="hoverimage"&&!editor.options.openHoverImage){continue}if(toolbarItemUi){toolbarUi.add(toolbarItemUi)}}toolbarUis[i]=toolbarUi}this.toolbars=toolbarUis},getHtmlTpl:function(){return'<div id="##" class="%%"><div id="##_toolbarbox" class="%%-toolbarbox">'+(this.toolbars.length?'<div id="##_toolbarboxouter" class="%%-toolbarboxouter"><div class="%%-toolbarboxinner">'+this.renderToolbarBoxHtml()+"</div></div>":"")+'<div id="##_toolbarmsg" class="%%-toolbarmsg" style="display:none;"><div id = "##_upload_dialog" class="%%-toolbarmsg-upload" onclick="$$.showWordImageDialog();">'+this.editor.getLang("clickToUpload")+'</div><div class="%%-toolbarmsg-close" onclick="$$.hideToolbarMsg();">x</div><div id="##_toolbarmsg_label" class="%%-toolbarmsg-label"></div><div style="height:0;overflow:hidden;clear:both;"></div></div></div><div id="##_iframeholder" class="%%-iframeholder"></div><div id="##_bottombar" class="%%-bottomContainer"><table><tr><td id="##_elementpath" class="%%-bottombar"></td><td id="##_wordcount" class="%%-wordcount"></td></tr></table></div></div>'},showWordImageDialog:function(){this.editor.execCommand("wordimage","word_img");this._dialogs.wordimageDialog.open()},renderToolbarBoxHtml:function(){var buff=[];for(var i=0;i<this.toolbars.length;i++){buff.push(this.toolbars[i].renderHtml())}return buff.join("")},setFullScreen:function(fullscreen){if(this._fullscreen!=fullscreen){this._fullscreen=fullscreen;this.editor.fireEvent("beforefullscreenchange",fullscreen);var editor=this.editor;editor.options.fullscreenCallback&&editor.options.fullscreenCallback(fullscreen);if(baidu.editor.browser.gecko){var bk=editor.selection.getRange().createBookmark()}if(fullscreen){this._bakHtmlOverflow=document.documentElement.style.overflow;this._bakBodyOverflow=document.body.style.overflow;this._bakAutoHeight=this.editor.autoHeightEnabled;this._bakScrollTop=Math.max(document.documentElement.scrollTop,document.body.scrollTop);if(this._bakAutoHeight){editor.autoHeightEnabled=false;this.editor.disableAutoHeight()}document.documentElement.style.overflow="hidden";document.body.style.overflow="hidden";this._bakCssText=this.getDom().style.cssText;this._bakCssText1=this.getDom("iframeholder").style.cssText;this._updateFullScreen()}else{this.getDom().style.cssText=this._bakCssText;this.getDom("iframeholder").style.cssText=this._bakCssText1;if(this._bakAutoHeight){editor.autoHeightEnabled=true;this.editor.enableAutoHeight()}document.documentElement.style.overflow=this._bakHtmlOverflow;document.body.style.overflow=this._bakBodyOverflow;window.scrollTo(0,this._bakScrollTop)}if(baidu.editor.browser.gecko){var input=document.createElement("input");document.body.appendChild(input);editor.body.contentEditable=false;setTimeout(function(){input.focus();setTimeout(function(){editor.body.contentEditable=true;editor.selection.getRange().moveToBookmark(bk).select(true);baidu.editor.dom.domUtils.remove(input);fullscreen&&window.scroll(0,0)})})}this.editor.fireEvent("fullscreenchanged",fullscreen);this.triggerLayout()}},_wordCount:function(){var wdcount=this.getDom("wordcount");if(!this.editor.options.wordCount){wdcount.style.display="none";return}wdcount.innerHTML=this.editor.queryCommandValue("wordcount")},disableWordCount:function(){var w=this.getDom("wordcount");w.innerHTML="";w.style.display="none";this.wordcount=false},enableWordCount:function(){var w=this.getDom("wordcount");w.style.display="";this.wordcount=true;this._wordCount()},_updateFullScreen:function(){if(this._fullscreen){var vpRect=uiUtils.getViewportRect();this.getDom().style.cssText="border:0;position:absolute;left:0;top:"+(this.editor.options.topOffset||0)+"px;width:"+vpRect.width+"px;height:"+vpRect.height+"px;z-index:"+(this.getDom().style.zIndex*1+100);uiUtils.setViewportOffset(this.getDom(),{left:0,top:this.editor.options.topOffset||0});this.editor.setHeight(vpRect.height-this.getDom("toolbarbox").offsetHeight-this.getDom("bottombar").offsetHeight-(this.editor.options.topOffset||0))}},_updateElementPath:function(){var bottom=this.getDom("elementpath"),list;if(this.elementPathEnabled&&(list=this.editor.queryCommandValue("elementpath"))){var buff=[];for(var i=0,ci;ci=list[i];i++){buff[i]=this.formatHtml('<span unselectable="on" onclick="$$.editor.execCommand(&quot;elementpath&quot;, &quot;'+i+'&quot;);">'+ci+"</span>")}bottom.innerHTML='<div class="edui-editor-breadcrumb" onmousedown="return false;">'+this.editor.getLang("elementPathTip")+": "+buff.join(" &gt; ")+"</div>"}else{bottom.style.display="none"}},disableElementPath:function(){var bottom=this.getDom("elementpath");bottom.innerHTML="";bottom.style.display="none";this.elementPathEnabled=false},enableElementPath:function(){var bottom=this.getDom("elementpath");bottom.style.display="";this.elementPathEnabled=true;this._updateElementPath()},isFullScreen:function(){return this._fullscreen},postRender:function(){UIBase.prototype.postRender.call(this);for(var i=0;i<this.toolbars.length;i++){this.toolbars[i].postRender()}var me=this;var timerId,domUtils=baidu.editor.dom.domUtils,updateFullScreenTime=function(){clearTimeout(timerId);timerId=setTimeout(function(){me._updateFullScreen()})};domUtils.on(window,"resize",updateFullScreenTime);me.addListener("destroy",function(){domUtils.un(window,"resize",updateFullScreenTime);clearTimeout(timerId)})},showToolbarMsg:function(msg,flag){this.getDom("toolbarmsg_label").innerHTML=msg;this.getDom("toolbarmsg").style.display="";if(!flag){var w=this.getDom("upload_dialog");w.style.display="none"}},hideToolbarMsg:function(){this.getDom("toolbarmsg").style.display="none"},mapUrl:function(url){return url?url.replace("~/",this.editor.options.UEDITOR_HOME_URL||""):""},triggerLayout:function(){var dom=this.getDom();if(dom.style.zoom=="1"){dom.style.zoom="100%"}else{dom.style.zoom="1"}}};utils.inherits(EditorUI,baidu.editor.ui.UIBase);baidu.editor.ui.Editor=function(options){var editor=new baidu.editor.Editor(options);editor.options.editor=editor;var oldRender=editor.render;editor.render=function(holder){utils.domReady(function(){editor.langIsReady?renderUI():editor.addListener("langReady",renderUI);function renderUI(){editor.setOpt({labelMap:editor.options.labelMap||UE.I18N[editor.options.lang].labelMap});new EditorUI(editor.options);if(holder){if(holder.constructor===String){holder=document.getElementById(holder)}holder&&holder.getAttribute("name")&&(editor.options.textarea=holder.getAttribute("name"));if(holder&&/script|textarea/ig.test(holder.tagName)){var newDiv=document.createElement("div");holder.parentNode.insertBefore(newDiv,holder);var cont=holder.value||holder.innerHTML;editor.options.initialContent=/^[\t\r\n ]*$/.test(cont)?editor.options.initialContent:cont.replace(/>[\n\r\t]+([ ]{4})+/g,">").replace(/[\n\r\t]+([ ]{4})+</g,"<").replace(/>[\n\r\t]+</g,"><");holder.id&&(newDiv.id=holder.id);holder.className&&(newDiv.className=holder.className);holder.style.cssText&&(newDiv.style.cssText=holder.style.cssText);if(/textarea/i.test(holder.tagName)){editor.textarea=holder;editor.textarea.style.display="none"}else{holder.parentNode.removeChild(holder)}holder=newDiv;holder.innerHTML=""}}editor.ui.render(holder);var iframeholder=editor.ui.getDom("iframeholder");editor.container=editor.ui.getDom();editor.container.style.zIndex=editor.options.zIndex;oldRender.call(editor,iframeholder)}})};return editor}})()})();