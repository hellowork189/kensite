Site.addModuleContextMenu = function(b) {
    if (!Fai.top._contextMenu) {
        return
    }
    if (! ("contextMenu" in $)) {
        return
    }
    if (Object.prototype.toString.call(b).toLowerCase() != "[object object]") {
        throw new Error("Site.addModuleContextMenu 参数错误");
        return
    }
    var c;
    if (Fai.top.$("#module" + b.id).hasClass("formStyle80")) {
        return
    }
    $.contextMenu({
        selector: "#module" + b.id,
        className: "fk-moduleContextMenu fk-moduleContextMenu" + b.id,
        classNames: {
            icon: "f-icon"
        },
        build: function(n, y) {
            var q = {},
            B = {},
            A = {},
            x = {},
            C = b.id,
            g = Fai.top.$("#module" + C),
            k = b.moduleStateList || {},
            z = b.moduleDirectionList || {},
            D = b.moduleOtherList || {},
            w = k.length,
            m = z.length,
            s = D.length,
            u = false,
            o = false,
            d = false,
            t = false,
            F,
            E,
            p,
            r,
            l,
            v;
            for (v = 0; v < w; v++) {
                F = k[v];
                E = F.iconClass || "menu" + v;
                p = F.text;
                r = F.statusScript || 1;
                l = F.evalScript;
                if (Fai.fkEval(r) != -1) {
                    u = true;
                    o = true;
                    B[E] = {};
                    B[E]["name"] = p;
                    B[E]["usehtml"] = true;
                    B[E]["html"] = "<div class='f-tip'></div><div>" + p + "</div>";
                    B[E]["icon"] = E;
                    B[E]["callback"] = h(l)
                }
            }
            for (v = 0; v < m; v++) {
                F = z[v];
                E = F.iconClass || "edit" + v;
                p = F.text;
                r = F.statusScript || 1;
                l = F.evalScript;
                if (Fai.fkEval(r) != -1) {
                    u = true;
                    d = true;
                    A[E] = {};
                    A[E]["name"] = p;
                    A[E]["usehtml"] = true;
                    A[E]["html"] = "<div class='f-tip'></div><div>" + p + "</div>";
                    A[E]["icon"] = E;
                    A[E]["callback"] = h(l)
                }
            }
            var f = g.attr("_side"),
            j = g.attr("_flutterSwitch");
            if (f == 2 && Fai.top._canDesign) {
                l = "Site.flutterStopSwitch('module" + C + "')";
                if (j == "true") {
                    E = "flutterStart";
                    p = "开始飘动"
                } else {
                    E = "flutterStop";
                    p = "停止飘动"
                }
                u = true;
                d = true;
                A[E] = {};
                A[E]["name"] = p;
                A[E]["usehtml"] = true;
                A[E]["html"] = "<div class='f-tip'></div><div>" + p + "</div>";
                A[E]["icon"] = E;
                A[E]["callback"] = h(l);
                E = "Location";
                p = "设为飘动起始位置";
                l = 'Site.flutterSetStartLocation("module' + C + '")';
                A[E] = {};
                A[E]["name"] = p;
                A[E]["usehtml"] = true;
                A[E]["html"] = "<div class='f-tip'></div><div>" + p + "</div>";
                A[E]["icon"] = E;
                A[E]["callback"] = h(l)
            }
            for (v = 0; v < s; v++) {
                F = D[v];
                E = F.iconClass || "other" + v;
                p = F.text;
                r = F.statusScript || 1;
                l = F.evalScript;
                if (Fai.fkEval(r) != -1) {
                    u = true;
                    t = true;
                    x[E] = {};
                    x[E]["name"] = p;
                    x[E]["usehtml"] = true;
                    x[E]["html"] = "<div class='f-tip'></div><div>" + p + "</div>";
                    x[E]["icon"] = E;
                    x[E]["callback"] = h(l)
                }
            }
            q = B;
            if (o && d) {
                q.sep1 = "-------"
            }
            q = $.extend(q, A);
            if (d && t) {
                q.sep2 = "-------"
            }
            q = $.extend(q, x);
            function h(e) {
                return function(G, i) {
                    Fai.fkEval(e);
                    switch (G) {
                    case "mtop":
                    case "mbottom":
                    case "mleft":
                    case "mright":
                    case "lock":
                    case "dockModule":
                    case "absModule":
                    case "mzindex":
                    case "flutterStop":
                        Site.scrollToModuleDiv(Fai.top.$("#module" + b.id));
                        Site.triggerGobalEvent("showFindModuleDiv", b.id);
                        break;
                    default:
                    }
                }
            }
            if (!u) {
                Fai.ing("请将模块移离当前区域，再尝试右键操作", true);
                return false
            }
            return {
                items: q
            }
        },
        events: {
            show: function() {
                var d = Fai.top.$("#module" + b.id),
                f = a(d),
                h = -1,
                g,
                e;
                if (f.inTabId > 0) {
                    h = f.inTabId
                } else {
                    if (f.inMulColId > 0) {
                        h = f.inMulColId
                    } else {
                        if (f.inFullmeasureId > 0) {
                            h = f.inFullmeasureId
                        }
                    }
                }
                if (h > 0) {
                    g = Fai.top.$("#module" + h);
                    Site.moduleEditTool.contextMenu(h, true)
                }
                Site.moduleEditTool.contextMenu(b.id, true);
                Site.removeAllEditLayer();
                Site.addMoveFrame("module" + b.id);
                if (d.attr("_side") == "2" && d.attr("_flutterswitch") != "true") {
                    d.attr("_edit", true);
                    Site.stopFlutterInterval(d)
                } else {
                    if (d.attr("_side") == "1") {
                        d.off("mouseenter.sideModule").off("mouseleave.sideModule")
                    } else {
                        if (g && g.length > 0) {
                            e = g.attr("_side");
                            if (e == "1") {
                                g.off("mouseenter.sideModule").off("mouseleave.sideModule")
                            } else {
                                if (e == "2" && g.attr("_flutterswitch") != "true") {
                                    g.attr("_edit", true);
                                    Site.stopFlutterInterval(g)
                                }
                            }
                        }
                    }
                }
                c = setTimeout(function() {
                    var i = Fai.top.$("#module" + b.id);
                    Site.addMoveFrame("module" + b.id);
                    if (i.data("bottomLine") == 1) {
                        Fai.top.$("#module" + b.id + "moveFrameBottom").css({
                            opacity: 1
                        })
                    }
                    if (i.data("topLine") == 1) {
                        Fai.top.$("#module" + b.id + "moveFrameTop").css({
                            opacity: 1
                        })
                    }
                    if (i.data("leftLine") == 1) {
                        Fai.top.$("#module" + b.id + "moveFrameLeft").css({
                            opacity: 1
                        })
                    }
                    if (i.data("rightLine") == 1) {
                        Fai.top.$("#module" + b.id + "moveFrameRight").css({
                            opacity: 1
                        })
                    }
                },
                200)
            },
            hide: function() {
                clearTimeout(c);
                c = null;
                Site.removeMoveFrame("module" + b.id);
                var d = Fai.top.$("#module" + b.id),
                e = a(d),
                g = -1,
                f;
                if (e.inTabId > 0) {
                    g = e.inTabId
                } else {
                    if (e.inMulColId > 0) {
                        g = e.inMulColId
                    } else {
                        if (e.inFullmeasureId > 0) {
                            g = e.inFullmeasureId
                        }
                    }
                }
                if (d.attr("_side") == 2 && d.attr("_flutterswitch") != "true") {
                    d.removeAttr("_edit");
                    Site.startFlutterInterval(d)
                } else {
                    if (d.attr("_side") == 1) {
                        Site.reSetSidePosition(d)
                    }
                }
                Site.moduleEditTool.contextMenu(b.id, false);
                if (g > 0) {
                    f = Fai.top.$("#module" + g);
                    Site.moduleEditTool.contextMenu(g, false);
                    if (f.attr("_side") == 2 && f.attr("_flutterswitch") != "true") {
                        f.removeAttr("_edit");
                        Site.startFlutterInterval(f)
                    } else {
                        if (f.attr("_side") == 1) {
                            Site.reSetSidePosition(f)
                        }
                    }
                }
            }
        }
    });
    function a(f) {
        if (Object.prototype.toString.call(f).toLowerCase() != "[object object]") {
            throw new Error("contextMenu getModuleData 参数错误");
            return
        }
        var i = false,
        d = false,
        m = 0,
        e = false,
        h = false,
        l = 0,
        o = false,
        g = false,
        k = 0,
        j = false,
        n = false;
        if (f.hasClass("formStyle80")) {
            i = true
        } else {
            if (f.hasClass("formStyle35")) {
                o = true
            } else {
                if (f.hasClass("formStyle29")) {
                    e = true
                }
            }
        }
        m = f.attr("_infullmeasure") || 0;
        if (m > 0) {
            d = true
        }
        l = f.attr("_intab") || 0;
        if (l > 0) {
            h = true
        }
        k = f.attr("_inmulmcol") || 0;
        if (k > 0) {
            g = true
        }
        if (e || o) {
            j = true
        }
        if (h || g) {
            n = true
        }
        return {
            isFullmeasure: i,
            inFullmeasure: d,
            inFullmeasureId: m,
            isTab: e,
            inTab: h,
            inTabId: l,
            isMulCol: o,
            inMulCol: g,
            inMulColId: k,
            isMultiModule: j,
            inMultiModule: n
        }
    }
};
Site.moduleEditTool = {}; (function(w, z, j) {
    var v = [];
    var n = function() {
        var L = {};
        return {
            lock: function(M) {
                L[M] = L[M] || {};
                L[M].lock = true
            },
            open: function(M) {
                L[M] = L[M] || {};
                delete L[M].lock
            },
            getStatus: function(N) {
                var M = false;
                if (L[N]) {
                    M = L[N].status
                }
                return M
            },
            getActivePart: function(N) {
                var M = -1;
                if (L[N]) {
                    if ("part" in L[N]) {
                        M = L[N].part
                    }
                }
                return M
            },
            isActive: function(N, M) {
                L[N] = L[N] || {};
                if ( !! L[N].lock) {
                    return
                }
                L[N].status = true;
                if (M == "tool") {
                    L[N].part = 1
                } else {
                    if (M == "dragBtn") {
                        L[N].part = 2
                    } else {
                        if (M == "resizeCancel") {
                            L[N].part = 3
                        } else {
                            if (M == "child") {
                                L[N].part = 4
                            } else {
                                L[N].part = 0
                            }
                        }
                    }
                }
            },
            getContextMenu: function(M) {
                L[M] = L[M] || {};
                return L[M].contextMenu || false
            },
            getMultiModule: function(M) {
                L[M] = L[M] || {};
                return L[M].multiModule || false
            },
            isLeave: function(M) {
                L[M] = L[M] || {};
                if ( !! L[M].lock) {
                    return
                }
                L[M].status = false;
                delete L[M].part
            },
            onContextMenu: function(M) {
                L[M] = L[M] || {};
                L[M].contextMenu = true
            },
            offContextMenu: function(M) {
                L[M] = L[M] || {};
                L[M].contextMenu = false
            },
            onMultiModule: function(M) {
                L[M] = L[M] || {};
                L[M].multiModule = true
            },
            offMultiModule: function(M) {
                L[M] = L[M] || {};
                L[M].multiModule = false
            },
            clearAll: function(M) {
                delete L[M]
            }
        }
    } ();
    z.init = function(L) {
        if (Object.prototype.toString.call(L).toLowerCase() != "[object object]") {
            throw new Error("Site.moduleEditTool.init 参数错误");
            return
        }
        var M = Fai.top.$("#module" + L.id);
        if (M.length < 1) {
            return
        }
        M.off("mouseover.moduleEdit").off("mouseleave.moduleEdit").on("mouseover.moduleEdit",
        function(P) {
            F(L.id, "addGuideTimer");
            var O = setTimeout(function() {
                g(L.id)
            },
            200);
            p(L.id, "addGuideTimer", O);
            F(L.id, "leaveParentModule");
            F(L.id, "leaveSideModule");
            F(L.id, "bindToolbarEvent_mouseleave");
            F(L.id, "initDrag");
            F(L.id, "bindToolbarEvent_mouseover");
            F(L.id, "initToolbar_mouseover");
            n.isActive(L.id);
            var N = t(w(this)),
            Q = -1;
            if (N.inTabId > 0) {
                Q = N.inTabId
            } else {
                if (N.inMulColId > 0) {
                    Q = N.inMulColId
                } else {
                    if (N.inFullmeasureId > 0) {
                        Q = N.inFullmeasureId
                    }
                }
            }
            if (Q > 0) {
                F(Q, "leaveParentModule");
                F(Q, "leaveSideModule");
                n.open(Q);
                n.isActive(Q, "child");
                n.lock(Q)
            }
            B(L);
            m(L);
            G(L);
            H(L)
        }).on("mouseleave.moduleEdit",
        function(O) {
            F(L.id, "addGuideTimer");
            F(L.id, "leaveParentModule");
            F(L.id, "leaveSideModule");
            F(L.id, "bindToolbarEvent_mouseleave");
            n.isLeave(L.id);
            var N = t(w(this)),
            Q = -1;
            if (N.inTabId > 0) {
                Q = N.inTabId
            } else {
                if (N.inMulColId > 0) {
                    Q = N.inMulColId
                } else {
                    if (N.inFullmeasureId > 0) {
                        Q = N.inFullmeasureId
                    }
                }
            }
            if (Q > 0) {
                F(Q, "leaveParentModule");
                F(Q, "leaveSideModule");
                n.open(Q);
                n.isLeave(Q)
            }
            u(L);
            i(L);
            l(L);
            a(L);
            F(L.id, "moduleEditMouseleave");
            var P = setTimeout(function() {
                if (!n.getStatus(L.id)) {
                    q(L)
                }
            },
            300);
            p(L.id, "moduleEditMouseleave", P)
        });
        c(L);
        r(L);
        if (!Fai.top._canDesign) {
            Site.removeDesignEditLayer()
        }
        if (!Fai.top._canEditData) {
            Site.removeAllDataEditLayer()
        }
    };
    z.remove = function(L) {
        q({
            id: L
        })
    };
    z.contextMenu = function(O, L) {
        var M = t(Fai.top.$("#module" + O)),
        N = -1;
        if (M.inTabId > 0) {
            N = M.inTabId
        } else {
            if (M.inMulColId > 0) {
                N = M.inMulColId
            } else {
                if (M.inFullmeasureId > 0) {
                    N = M.inFullmeasureId
                }
            }
        }
        if (L) {
            n.onContextMenu(O)
        } else {
            n.offContextMenu(O)
        }
        D(O);
        if (N > 0) {
            if (L) {
                n.onContextMenu(N)
            } else {
                n.offContextMenu(N)
            }
            D(N)
        }
    };
    z.disabledAddGuide = function() {
        z.disabledAddGuideFlag = true;
        A();
        setTimeout(function() {
            delete z.disabledAddGuideFlag
        },
        300)
    };
    function c(L) {
        var M = Fai.top.$("#module" + L.id);
        if (M.length < 1) {
            return
        }
        var N = t(M);
        if (N.isMulCol) {
            M.find(".formBanner" + L.id).off("mouseover.moduleEdit").off("mouseleave.moduleEdit").on("mouseover.moduleEdit",
            function() {
                n.onMultiModule(L.id)
            }).on("mouseleave.moduleEdit",
            function() {
                n.offMultiModule(L.id)
            })
        } else {
            if (N.isTab) {
                M.find(".titleTable").off("mouseover.moduleEdit").off("mouseleave.moduleEdit").on("mouseover.moduleEdit",
                function() {
                    n.onMultiModule(L.id)
                }).on("mouseleave.moduleEdit",
                function() {
                    n.offMultiModule(L.id)
                })
            }
        }
    }
    function b(L) {
        var M = Fai.top.$("#fk-moduleToolbar" + L.id);
        M.off("mouseover.toolbar").off("mouseleave.toolbar").on("mouseover.toolbar",
        function() {
            var N = Fai.top.$("#module" + L.id),
            O = t(N),
            R = -1,
            P;
            if (O.inTabId > 0) {
                R = O.inTabId
            } else {
                if (O.inMulColId > 0) {
                    R = O.inMulColId
                } else {
                    if (O.inFullmeasureId > 0) {
                        R = O.inFullmeasureId
                    }
                }
            }
            F(L.id, "dragBtnMouseover");
            F(L.id, "resizeCancelBtnMouseleave");
            F(L.id, "leaveSideModule");
            F(L.id, "leaveParentModule");
            n.open(L.id);
            n.isActive(L.id, "tool");
            x(L.id);
            if (R > 0) {
                n.open(R);
                n.isActive(R, "child");
                n.lock(R);
                F(R, "leaveSideModule");
                F(R, "leaveParentModule")
            }
            if (N.attr("_side") == "2") {
                Site.stopFlutterInterval(N)
            }
            if (R > 0) {
                P = Fai.top.$("#module" + R);
                if (P.attr("_side") == "2") {
                    Site.stopFlutterInterval(P)
                }
            }
            F(L.id, "bindToolbarEvent_mouseleave");
            F(L.id, "bindToolbarEvent_mouseover");
            var Q = setTimeout(function() {
                if (n.getStatus(L.id) && n.getActivePart(L.id) == 1) {
                    E(L.id);
                    y(L.id)
                }
            },
            300);
            p(L.id, "bindToolbarEvent_mouseover", Q)
        }).on("mouseleave.toolbar",
        function() {
            var N = Fai.top.$("#module" + L.id),
            O = t(N),
            Q = -1;
            if (O.inTabId > 0) {
                Q = O.inTabId
            } else {
                if (O.inMulColId > 0) {
                    Q = O.inMulColId
                } else {
                    if (O.inFullmeasureId > 0) {
                        Q = O.inFullmeasureId
                    }
                }
            }
            if (Q > 0) {
                n.open(Q);
                n.isLeave(Q)
            }
            n.open(L.id);
            n.isLeave(L.id);
            F(L.id, "bindToolbarEvent_mouseover");
            F(L.id, "bindToolbarEvent_mouseleave");
            var P = setTimeout(function() {
                if (!n.getStatus(L.id)) {
                    q(L)
                }
            },
            300);
            p(L.id, "bindToolbarEvent_mouseleave", P)
        })
    }
    function o(L) {
        Fai.top.$("#fk-moduleToolbar" + L).remove()
    }
    function C(P) {
        var V = P.id,
        N = P.toolList,
        Z = N.length || 0,
        Y = 0,
        T = [],
        ac,
        X,
        ab,
        ad,
        U,
        O,
        R;
        if (N.length < 0) {
            return
        }
        var L = Fai.top.$("#fk-moduleToolbar" + V);
        if (L.length > 0) {
            k(V);
            return
        }
        var M = Fai.top.$("#module" + V),
        W = t(M),
        aa = Site.getModuleAttrPattern(V),
        Q = "",
        S = false;
        if (W.isMultiModule) {
            Q = "fk-moduleToolbar-multiModule"
        } else {
            if (W.isFullmeasure) {
                Q = "fk-moduleToolbar-fullmeasure"
            }
        }
        if (aa.border.y === 1 && aa.bannerType === 1 && aa.contentBg.y === 1) {
            S = true
        }
        T.push("<div id='fk-moduleToolbar" + V + "' class='fk-moduleToolbar " + Q + "'>");
        if (W.isFullmeasure) {
            for (Y = 0; Y < Z; Y++) {
                ac = N[Y];
                X = true;
                if (ac.statusScript) {
                    if (Fai.fkEval(ac.statusScript) == -1) {
                        X = false
                    }
                }
                if (!X) {
                    continue
                }
                R = ac.toolDisplay;
                ab = ac.evalScript;
                U = ac.text || "";
                ad = ac.text || "";
                O = ac.toolClass || "";
                if (R == "toolIcon") {
                    U = "&nbsp;"
                }
                T.push("<div class='f-toolItem f-toolItem" + O + "'>");
                T.push("<a class='f-title' title='" + ad + "' onclick=\"" + ab + ';Site.removeAllEditLayer();return false;">' + U + "</a>");
                T.push("</div>")
            }
        } else {
            for (Y = 0; Y < Z; Y++) {
                ac = N[Y];
                X = true;
                if (ac.statusScript) {
                    if (Fai.fkEval(ac.statusScript) == -1) {
                        X = false
                    }
                }
                if (!X) {
                    continue
                }
                ab = ac.evalScript;
                ad = ac.text || "";
                O = ac.iconClass || "";
                if (ac.setTB && X) {
                    if (S) {
                        O = "resetTB";
                        ad = "显示外框";
                        ab = "Site.oneKeySetModuleTB(" + V + ", false)"
                    } else {
                        O = "clearTB";
                        ad = "隐藏外框";
                        ab = "Site.oneKeySetModuleTB(" + V + ", true)"
                    }
                }
                T.push("<div class='f-toolItem f-toolItem" + O + "'>");
                T.push("<a class='f-title' onclick=\"" + ab + ";Site.removeAllEditLayer();return false;\"><span class='f-icon'></span><span class='f-icon f-onlyIcon' title='" + ad + "'></span><span class='f-text'>" + ad + "</span></a>");
                T.push("</div>")
            }
        }
        T.push("</div>");
        Fai.top.$("body").append(T.join(""));
        k(V);
        b(P)
    }
    function B(L) {
        if (!Fai.isNull(Site._enableEditLayer) && !Site._enableEditLayer) {
            K(L.id);
            return
        }
        F(L.id, "initToolbar_mouseover");
        var M = setTimeout(function() {
            if (n.getStatus(L.id) && n.getActivePart(L.id) != 4) {
                if (t(Fai.top.$("#module" + L.id)).isMultiModule) {
                    if (n.getMultiModule(L.id)) {
                        C(L);
                        x(L.id)
                    } else {
                        C(L);
                        if (n.getActivePart(L.id) != 2 && n.getActivePart(L.id) != 1) {
                            K(L.id)
                        }
                    }
                } else {
                    C(L);
                    x(L.id)
                }
            } else {
                K(L.id)
            }
        },
        100);
        p(L.id, "initToolbar_mouseover", M)
    }
    function u(L) {
        F(L.id, "initToolbar_mouseleave");
        var M = setTimeout(function() { ! n.getStatus(L.id) && K(L.id)
        },
        100);
        p(L.id, "initToolbar_mouseleave", M)
    }
    function m(L) {
        if (!Fai.isNull(Site._enableEditLayer) && !Site._enableEditLayer) {
            return
        }
        var M = Fai.top.$("#module" + L.id);
        if (n.getStatus(L.id) && n.getActivePart(L.id) != 4) {
            Site.removeMoveFrame("module" + L.id);
            Site.addMoveFrame("module" + L.id)
        }
        Site.refreshResizableHandles(M)
    }
    function i(L) {
        var M = Fai.top.$("#module" + L.id);
        if (M.data("bottomLine") == 1) {
            Fai.top.$("#module" + L.id + "moveFrameBottom").css({
                opacity: 1
            })
        }
        if (M.data("topLine") == 1) {
            Fai.top.$("#module" + L.id + "moveFrameTop").css({
                opacity: 1
            })
        }
        if (M.data("leftLine") == 1) {
            Fai.top.$("#module" + L.id + "moveFrameLeft").css({
                opacity: 1
            })
        }
        if (M.data("rightLine") == 1) {
            Fai.top.$("#module" + L.id + "moveFrameRight").css({
                opacity: 1
            })
        }
    }
    function G(L) {
        if (!Fai.top._canDesign) {
            return
        }
        if (!Fai.isNull(Site._enableEditLayer) && !Site._enableEditLayer) {
            E(L.id);
            return
        }
        J(L.id)
    }
    function l(L) {
        F(L.id, "initDrag");
        var M = setTimeout(function() {
            if (!n.getStatus(L.id)) {
                E(L.id)
            }
        },
        100);
        p(L.id, "initDrag", M)
    }
    function H(L) {
        if (!Fai.top._canDesign) {
            return
        }
        if (!Fai.isNull(Site._enableEditLayer) && !Site._enableEditLayer) {
            y(L.id);
            return
        }
        if (n.getStatus(L.id) && n.getActivePart(L.id) != 4) {
            s(L.id)
        } else {
            y(L.id)
        }
    }
    function a(L) {
        F(L.id, "initResizeCancel_mouseleave");
        var M = setTimeout(function() { ! n.getStatus(L.id) && y(L.id)
        },
        100);
        p(L.id, "initResizeCancel_mouseleave", M)
    }
    function r(L) {
        Fai.top.$("#module" + L.id).delegate(".J_resizableTip", "mouseover.resizeCancelBtn",
        function() {
            n.isActive(L.id, "resizeCancel");
            n.lock(L.id);
            F(L.id, "resizeCancelBtnMouseover");
            F(L.id, "resizeCancelBtnMouseleave");
            var M = setTimeout(function() {
                if (n.getActivePart(L.id) == 3) {
                    E(L.id);
                    K(L.id, 400)
                }
            },
            300);
            p(L.id, "resizeCancelBtnMouseover", M)
        }).delegate(".J_resizableTip", "mouseleave.resizeCancelBtn",
        function() {
            n.open(L.id);
            n.isLeave(L.id);
            F(L.id, "resizeCancelBtnMouseover");
            F(L.id, "resizeCancelBtnMouseleave");
            var M = setTimeout(function() {
                if (n.getStatus(L.id) && n.getActivePart(L.id) != 4) {
                    x(L.id);
                    I(L.id)
                }
            },
            100);
            p(L.id, "resizeCancelBtnMouseleave", M)
        })
    }
    function k(ac) {
        var L = Fai.top.$("#fk-moduleToolbar" + ac);
        if (L.length < 0) {
            return
        }
        var N = Fai.top.$("#module" + ac),
        ad = t(N),
        P = N.outerWidth(true),
        O = N.outerHeight(true),
        S = N.offset(),
        R = S.left,
        aa = S.top,
        ak = R + P,
        T = aa + O,
        ah = Fai.top.$(".floatRightBottom").offset(),
        ag = Fai.top.$(".floatLeftTop").offset(),
        al = ah.left,
        U = ah.top,
        aj = Fai.getScrollWidth(),
        ae = L.outerWidth(true),
        ai = L.outerHeight(true),
        V = 0,
        Z = 0,
        ab = 0,
        Y = false,
        Q = "",
        X = false,
        M = false,
        af = 0;
        if (ad.isFullmeasure) {
            V = al - ae;
            Z = aa - ai;
            Q = "fk-moduleToolbar-left";
            if (Z < ag.top) {
                Z = ag.top
            }
            L.css({
                right: aj + "px",
                top: Z + "px"
            })
        } else {
            if (N.find(".formMiddleContent" + ac).children(".pd_mall_G_J").length > 0 || N.find(".formMiddleContent" + ac).children(".navA_C_J").length > 0) {
                X = true
            }
            if (ak <= (al - ae) && !ad.inMulCol && !ad.inTab && !X) {
                V = ak;
                Z = aa;
                Q = "fk-moduleToolbar-right";
                af = 2
            } else {
                if (R >= ae) {
                    V = R - ae;
                    Z = aa;
                    Q = "fk-moduleToolbar-left";
                    M = true;
                    af = 1
                } else {
                    if ((aa - ag.top) >= 38) {
                        Q = "fk-moduleToolbar-top";
                        L.removeClass("fk-moduleToolbar-left fk-moduleToolbar-right fk-moduleToolbar-top fk-moduleToolbar-bottom").addClass(Q);
                        ae = L.outerWidth(true);
                        ai = L.outerHeight(true);
                        V = ak - ae;
                        Z = aa - ai;
                        af = 3
                    } else {
                        if ((T + 38) <= U) {
                            Q = "fk-moduleToolbar-bottom";
                            L.removeClass("fk-moduleToolbar-left fk-moduleToolbar-right fk-moduleToolbar-top fk-moduleToolbar-bottom").addClass(Q);
                            ae = L.outerWidth(true);
                            ai = L.outerHeight(true);
                            V = ak - ae;
                            Z = T;
                            af = 4
                        } else {
                            V = R;
                            Z = aa;
                            Q = "fk-moduleToolbar-left";
                            M = true;
                            af = 5
                        }
                    }
                }
            }
            switch (af) {
            case 1:
            case 2:
                if (U < (Z + ai)) {
                    Y = true;
                    ab = 0
                } else {
                    if (Z < ag.top) {
                        Z = ag.top
                    }
                }
                break;
            case 3:
            case 4:
            case 5:
                if (V < 0) {
                    V = 0
                } else {
                    if ((V + ae) > (al - aj)) {
                        V = al - ae - aj
                    }
                }
                break;
            default:
            }
            if (Y) {
                L.css({
                    left:
                    V + "px",
                    bottom: ab + "px"
                })
            } else {
                L.css({
                    left: V + "px",
                    top: Z + "px"
                })
            }
            if (ad.isMultiModule) {
                var W = document.createElement("div"),
                am = "fk-multiDragBtn-left";
                if (typeof W.style.borderRadius == "undefined") {
                    am += " fk-multiDragBtn-left-low";
                    W = null
                }
                if (ad.isTab) {
                    M ? N.find(".J_tabHandle").addClass(am) : N.find(".J_tabHandle").removeClass(am)
                } else {
                    if (ad.isMulCol) {
                        M ? N.find(".J_multiHandle").addClass(am) : N.find(".J_multiHandle").removeClass(am)
                    }
                }
            }
        }
        L.removeClass("fk-moduleToolbar-left fk-moduleToolbar-right fk-moduleToolbar-top fk-moduleToolbar-bottom").addClass(Q)
    }
    function q(L) {
        var M = Fai.top.$("#module" + L.id),
        O = t(M),
        Q = -1,
        P,
        N;
        if (O.inTabId > 0) {
            Q = O.inTabId
        } else {
            if (O.inMulColId > 0) {
                Q = O.inMulColId
            } else {
                if (O.inFullmeasureId > 0) {
                    Q = O.inFullmeasureId
                }
            }
        }
        D(L.id);
        o(L.id);
        E(L.id);
        y(L.id);
        if (!n.getContextMenu(L.id)) {
            Site.removeMoveFrame("module" + L.id)
        }
        if (M.attr("_side") == "2" && M.attr("_flutterSwitch") != "true") {
            Site.startFlutterInterval(M);
            n.clearAll(L.id)
        } else {
            if (M.attr("_side") == "1") {
                F(L.id, "leaveSideModule");
                P = setTimeout(function() {
                    if (!n.getStatus(L.id) && !n.getContextMenu(L.id) && Fai.top.$(".fk-moduleContextMenu" + L.id).length < 1) {
                        Site.reSetSidePosition(M);
                        n.clearAll(L.id)
                    }
                },
                300);
                p(L.id, "leaveSideModule", P)
            } else {
                n.clearAll(L.id)
            }
        }
        if (Q > 0 && !n.getStatus(Q)) {
            F(Q, "leaveParentModule");
            N = setTimeout(function() {
                var R = Fai.top.$("#module" + L.id),
                S = t(R),
                T = -1;
                if (S.inTabId > 0) {
                    T = S.inTabId
                } else {
                    if (S.inMulColId > 0) {
                        T = S.inMulColId
                    } else {
                        if (S.inFullmeasureId > 0) {
                            T = S.inFullmeasureId
                        }
                    }
                }
                q({
                    id: T
                })
            },
            300);
            p(Q, "leaveParentModule", N)
        }
    }
    function t(N) {
        if (Object.prototype.toString.call(N).toLowerCase() != "[object object]") {
            throw new Error("Site.moduleEditTool getModuleData 参数错误");
            return
        }
        var Q = false,
        L = false,
        U = 0,
        M = false,
        P = false,
        T = 0,
        W = false,
        O = false,
        S = 0,
        R = false,
        V = false;
        if (N.hasClass("formStyle80")) {
            Q = true
        } else {
            if (N.hasClass("formStyle35")) {
                W = true
            } else {
                if (N.hasClass("formStyle29")) {
                    M = true
                }
            }
        }
        U = N.attr("_infullmeasure") || 0;
        if (U > 0) {
            L = true
        }
        T = N.attr("_intab") || 0;
        if (T > 0) {
            P = true
        }
        S = N.attr("_inmulmcol") || 0;
        if (S > 0) {
            O = true
        }
        if (M || W) {
            R = true
        }
        if (P || O) {
            V = true
        }
        return {
            isFullmeasure: Q,
            inFullmeasure: L,
            inFullmeasureId: U,
            isTab: M,
            inTab: P,
            inTabId: T,
            isMulCol: W,
            inMulCol: O,
            inMulColId: S,
            isMultiModule: R,
            inMultiModule: V
        }
    }
    function J(M) {
        var N = Fai.top.$("#module" + M);
        if (N.length < 1) {
            return
        }
        var P = t(N),
        S = false;
        if (!P.isMultiModule && !P.isFullmeasure) {
            if (N.find(".formBanner").is(":hidden") && N.find(".formMiddleContent a[href]").filter(":not([href^='javascript'])").length > 0) {} else {
                if (! (N.hasClass("formStyle72") || N.hasClass("formStyle79") || N.hasClass("formStyle81") || N.hasClass("formStyle82") || N.hasClass("formStyle18") || N.hasClass("formStyle36") || N.hasClass("formStyle17") || N.hasClass("formStyle20"))) {
                    return
                } else {
                    if (N.find(".formBanner").is(":visible")) {
                        return
                    }
                }
            }
            if (N.children(".draggableBtn").find(".J_handle").length < 1) {
                var Q = [],
                T = 30,
                O = N.width() / 2 - T;
                Q.push("<div class='draggableBtn' _mouseIn='0' style='left:" + O + "px;'>");
                Q.push("<a href='javascript:;' onclick='return false;' class='J_handle dragHandle'></a>");
                Q.push("</div>");
                N.append(Q.join(""));
                N.off("Fai_onModuleSizeChange.dragBtn").off("Fai_onModuleLayoutChange.dragBtn").on("Fai_onModuleSizeChange.dragBtn",
                function() {
                    Site.fixDragBtnPos(w(this))
                }).on("Fai_onModuleLayoutChange.dragBtn",
                function() {
                    Site.fixDragBtnPos(w(this))
                });
                S = true
            }
        } else {
            var L = document.createElement("div"),
            R = "fk-multiDragBtn";
            if (typeof L.style.borderRadius == "undefined") {
                R = "fk-multiDragBtn-low";
                L = null
            }
            if (P.isMulCol && N.find(".J_multiHandle").length < 1) {
                N.append('<div class="J_multiHandle ' + R + '" title="按住鼠标，可随意拖动模块列布局。"></div>');
                S = true
            } else {
                if (P.isTab && N.find(".J_tabHandle").length < 1) {
                    N.append('<div class="J_tabHandle ' + R + '" title="按住鼠标，可随意拖动模块组布局。"></div>');
                    N.find(".formTabButton").attr("title", "按住鼠标，可随意调整模块组内模块顺序");
                    N.find(".formTab").addClass("column");
                    S = true
                } else {
                    if (P.isFullmeasure && N.find(".J_fullmeasureHandle").length < 1) {
                        N.append('<div class="J_fullmeasureHandle fk-fullmeasureDragBtn" title="按住鼠标，可随意拖动通栏模块布局。"></div>');
                        S = true
                    }
                }
            }
        }
        if (S) {
            Site.addDragBtnHandle(N);
            e(M)
        } else {
            Site.fixDragBtnPos(N)
        }
        I(M)
    }
    function E(N) {
        var L = Fai.top.$("#module" + N);
        if (L.length < 1) {
            return
        }
        var M = t(L);
        if (M.isTab) {
            L.find(".J_tabHandle").hide()
        } else {
            if (M.isMulCol) {
                L.find(".J_multiHandle").hide()
            } else {
                if (M.isFullmeasure) {
                    L.find(".J_fullmeasureHandle").hide()
                } else {
                    L.children(".draggableBtn").hide()
                }
            }
        }
    }
    function I(N) {
        var L = Fai.top.$("#module" + N);
        if (L.length < 1) {
            return
        }
        var M = t(L);
        if (M.isTab) {
            L.find(".J_tabHandle").stop().show()
        } else {
            if (M.isMulCol) {
                L.find(".J_multiHandle").stop().show()
            } else {
                if (M.isFullmeasure) {
                    L.find(".J_fullmeasureHandle").stop().show()
                } else {
                    L.children(".draggableBtn").stop().show()
                }
            }
        }
    }
    function K(M, L) {
        if (typeof L == "number") {
            Fai.top.$("#fk-moduleToolbar" + M).stop().fadeOut(L)
        } else {
            Fai.top.$("#fk-moduleToolbar" + M).stop().hide()
        }
    }
    function x(L) {
        Fai.top.$("#fk-moduleToolbar" + L).stop().css("opacity", 1).show()
    }
    function e(O) {
        var M = Fai.top.$("#module" + O);
        if (M.length < 1) {
            return
        }
        var N = t(M),
        L;
        if (N.isTab) {
            L = M.find(".J_tabHandle")
        } else {
            if (N.isMulCol) {
                L = M.find(".J_multiHandle")
            } else {
                if (N.isFullmeasure) {
                    L = M.find(".J_fullmeasureHandle")
                } else {
                    L = M.children(".draggableBtn")
                }
            }
        }
        L.off("mouseover.moduleEdit").off("mouseleave.moduleEdit").on("mouseover.moduleEdit",
        function(P) {
            n.isActive(O, "dragBtn");
            n.lock(O);
            F(O, "dragBtnMouseover");
            var Q = setTimeout(function() {
                var R = t(Fai.top.$("#module" + O));
                if (R.isMultiModule || R.isFullmeasure) {
                    x(O);
                    s(O)
                } else {
                    if (n.getActivePart(O) == 2) {
                        K(O, 400);
                        y(O)
                    }
                }
                F(O, "dragBtnMouseover")
            },
            300);
            p(O, "dragBtnMouseover", Q)
        }).on("mouseleave.moduleEdit",
        function(P) {
            n.open(O);
            n.isLeave(O);
            F(O, "dragBtnMouseover");
            var Q = setTimeout(function() {
                if (n.getStatus(O) && n.getActivePart(O) != 4) {
                    x(O);
                    s(O)
                }
            },
            100);
            p(O, "dragBtnMouseleave", Q)
        })
    }
    function s(M) {
        var L = Fai.top.$("#module" + M);
        if (L.length < 1) {
            return
        }
        L.children(".J_resizableTip").show()
    }
    function y(M) {
        var L = Fai.top.$("#module" + M);
        if (L.length < 1) {
            return
        }
        L.children(".J_resizableTip").hide()
    }
    function p(N, L, M) {
        v[N] = v[N] || {};
        v[N][L] = M
    }
    function F(M, L) {
        if (v[M] && v[M][L]) {
            clearTimeout(v[M][L]);
            delete v[M][L]
        }
    }
    function D(M) {
        var L;
        if (v[M]) {
            for (L in v[M]) {
                if (v[M].hasOwnProperty(L)) {
                    clearTimeout(v[M][L]);
                    delete v[M][L]
                }
            }
            delete v[M]
        }
    }
    function A() {
        var L;
        for (L in v) {
            if (v.hasOwnProperty(L)) {
                D(L)
            }
        }
        v = []
    }
    function g(X) {
        if ( !! z.disabledAddGuideFlag) {
            return
        }
        if ( !! f({
            name: "moduleEditToolPrompt"
        })) {
            return
        }
        var L = Fai.top.$("#module" + X);
        if (L.hasClass("formStyle80")) {
            return
        }
        var ac = Fai.top.$("#fk-moduleEditToolGuide"),
        N = L.outerWidth(true),
        M = L.outerHeight(true),
        Q = L.offset(),
        O = Q.left,
        W = Q.top,
        ab = O + N,
        R = W + M,
        aa = Fai.top.$(".floatRightBottom").offset(),
        ad = aa.left,
        T = aa.top,
        V = "",
        Y = 0,
        P = 0,
        S = 412,
        Z = 233,
        U = [];
        if (Fai.top.$("#fk-moduleEditToolGuide").length > 0) {
            Fai.top.$("#fk-moduleEditToolGuide").show();
            return
        }
        P = W;
        if (N > S) {
            Y = O + N / 2 - S / 3
        } else {
            Y = O + S / 8
        }
        if (Y < 0) {
            Y = 0
        } else {
            if ((Y + S) > ad) {
                Y = ad - S
            }
        }
        if (P < 0) {
            P = 0
        } else {
            if ((P + Z) > T) {
                P = T - Z
            }
        }
        V = "left:" + Y + "px;top:" + P + "px;";
        U.push("<div id='fk-moduleEditToolGuide' class='fk-moduleEditToolGuide'>");
        U.push("<div class='f-contentBg'></div>");
        U.push("<div class='f-content' style='" + V + "'>");
        U.push("<a href='javascript:;' class='J_konwIt f-konwIt'></a>");
        U.push("</div>");
        U.push("</div>");
        Fai.top.$("body").append(U.join(""));
        Fai.top.$("#fk-moduleEditToolGuide").contextmenu(function(ae) {
            h({
                name: "moduleEditToolPrompt",
                value: "1",
                time: 90
            });
            d();
            Fai.top.$("#module" + X).trigger(w.Event("contextmenu", {
                pageX: ae.pageX,
                pageY: ae.pageY
            }));
            return false
        }).find(".J_konwIt").click(function() {
            h({
                name: "moduleEditToolPrompt",
                value: "1",
                time: 90
            });
            d()
        })
    }
    function d() {
        Fai.top.$("#fk-moduleEditToolGuide").remove()
    }
    function h(M) {
        var L = M.name || "",
        N = M.value,
        O = M.time || 90;
        if (window.localStorage && window.localStorage.setItem) {
            window.localStorage.setItem(L, N)
        } else {
            w.cookie("moduleEditToolPrompt", "1", {
                expires: O,
                path: "/"
            })
        }
    }
    function f(M) {
        var L = M.name || "",
        N = false;
        if (window.localStorage && window.localStorage.getItem) {
            N = window.localStorage.getItem(L)
        } else {
            N = w.cookie("moduleEditToolPrompt", {
                path: "/"
            })
        }
        return N
    }
})(jQuery, Site.moduleEditTool);